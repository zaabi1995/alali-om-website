import{m as P,r as o,j as t}from"./index-DGBU46UJ.js";import{d as v}from"./dayjs.min-8Z1s2ZZV.js";import{ai as m,aA as w,aB as i,ar as F,ay as j}from"./IdurarOs-CJ9ViAhm.js";import{C as l}from"./index-CjcNLPXh.js";import{S as n}from"./index-jUM5zKUs.js";import{S as M}from"./index-DbQUCUwL.js";import{F as D}from"./Table-D6trtlAr.js";import{T as B}from"./index-BJe3uNvq.js";import{j as T,a as _}from"./ErpApp-CYUZ8TN2.js";import{P as I}from"./index-4j7roaEt.js";import{s as b}from"./index-C-NUezbm.js";import{P as z}from"./PlusOutlined-WiqW7VqH.js";import{D as E}from"./DeleteOutlined-CPNGvea9.js";import"./Skeleton-CtKtAXNJ.js";import"./index-CjgSDB-1.js";import"./pickAttrs-fHa9THfw.js";import"./DownOutlined-CLg65-LR.js";import"./useClosable-CO9qeB94.js";import"./ActionButton-CXYEvTjl.js";const{Title:$}=F;function h(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}const f={prospect:"default",active:"green",on_hold:"orange",completed:"blue",cancelled:"red"};function ae(){const d=P(),[a,g]=o.useState([]),[y,u]=o.useState(!1),[c,C]=o.useState(""),p=async()=>{u(!0);const e=c?`?status=${c}`:"",s=await fetch(j+`project/list${e}`,{headers:h()}).then(r=>r.json()).catch(()=>({}));s.success&&g(s.result||[]),u(!1)};o.useEffect(()=>{p()},[c]);const S=a.reduce((e,s)=>e+(s.revenueOMR||0),0),x=a.reduce((e,s)=>e+(s.profitOMR||0),0),R=a.filter(e=>e.status==="active").length,O=[{title:"Code",dataIndex:"code",width:120,render:(e,s)=>{var r;return t.jsx("a",{onClick:()=>d(`/projects/read/${s._id}`),style:{fontWeight:700,color:"#034D57"},children:e||"PRJ-"+((r=s._id)==null?void 0:r.slice(-4))})}},{title:"Project Name",dataIndex:"name",ellipsis:!0},{title:"Client",dataIndex:["client","name"],render:e=>e||"—"},{title:"Status",dataIndex:"status",width:100,render:e=>t.jsx(B,{color:f[e],children:e==null?void 0:e.replace(/_/g," ").toUpperCase()})},{title:"Budget",dataIndex:"budgetOMR",align:"right",render:e=>e?`${parseFloat(e).toFixed(3)} OMR`:"—"},{title:"Revenue",dataIndex:"revenueOMR",align:"right",render:e=>e?t.jsxs("span",{style:{color:"#4CB480"},children:[parseFloat(e).toFixed(3)," OMR"]}):"—"},{title:"Profit",dataIndex:"profitOMR",align:"right",render:e=>e!==void 0?t.jsxs("span",{style:{color:e>=0?"#4CB480":"#e53e3e",fontWeight:700},children:[parseFloat(e).toFixed(3)," OMR"]}):"—"},{title:"Start",dataIndex:"startDate",width:100,render:e=>e?v(e).format("DD MMM YY"):"—"},{title:"",width:70,render:(e,s)=>t.jsxs(T,{children:[t.jsx(m,{size:"small",icon:t.jsx(_,{}),onClick:()=>d(`/projects/read/${s._id}`)}),t.jsx(I,{title:"Delete?",onConfirm:async()=>{await fetch(j+`project/delete/${s._id}`,{method:"DELETE",headers:h()}),b.success("Deleted"),p()},children:t.jsx(m,{size:"small",danger:!0,icon:t.jsx(E,{})})})]})}];return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx($,{level:4,style:{margin:0,color:"#034D57"},children:"Projects & Jobs"}),t.jsx(m,{type:"primary",icon:t.jsx(z,{}),onClick:()=>d("/projects/create"),style:{background:"#034D57"},children:"New Project"})]}),t.jsxs(w,{gutter:12,style:{marginBottom:16},children:[t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Active Projects",value:R,valueStyle:{color:"#034D57"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Revenue",value:S.toFixed(3),suffix:"OMR",valueStyle:{color:"#4CB480"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Profit",value:x.toFixed(3),suffix:"OMR",valueStyle:{color:x>=0?"#4CB480":"#e53e3e"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Projects",value:a.length})})})]}),t.jsx("div",{style:{marginBottom:12},children:t.jsx(M,{placeholder:"Filter by status",allowClear:!0,style:{width:160},onChange:e=>C(e||""),options:Object.keys(f).map(e=>({value:e,label:e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})}),t.jsx(D,{columns:O,dataSource:a,rowKey:"_id",loading:y,size:"small"})]})}export{ae as default};
