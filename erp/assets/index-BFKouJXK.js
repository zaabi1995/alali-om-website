import{m as R,o as F,r as y,j as e}from"./index-CfD99eWM.js";import{a as n,o as S}from"./omrFormat-DaDUL0TV.js";import{w as v,T as d,k as T,g as m}from"./ErpApp-5RKUdHDV.js";import{aV as D,aB as p,b5 as $,aM as B,aL as l,aY as E}from"./IdurarOs-CIf1RHA4.js";import{P as Y}from"./index-BUvRxWel.js";import{C as a}from"./index-3Eb24upP.js";import{S as c}from"./index-Da50WqsO.js";import{D as r}from"./index-g-F5wqfX.js";import{T as P}from"./index-C2hiuglI.js";import{F as u}from"./Table-D2HkX3gJ.js";import{s as w}from"./index-DE8wEg85.js";import{A as _}from"./ArrowLeftOutlined-nIbloWvE.js";import"./ActionButton-CVmzQOIY.js";import"./Skeleton-OgAJrl8z.js";import"./PlusOutlined-C4PIKCeA.js";const{Title:k}=E;function I(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const A={prospect:"default",active:"green",on_hold:"orange",completed:"blue",cancelled:"red"};function se(){var j,f,g;const x=R(),{id:o}=F(),[t,C]=y.useState(null);y.useEffect(()=>{fetch(D+`project/read/${o}`,{headers:I()}).then(s=>s.json()).then(s=>{s.success&&C(s.result)}).catch(()=>{})},[o]);const M=async()=>{await fetch(D+`project/delete/${o}`,{method:"DELETE",headers:I()}),w.success("Deleted"),x("/projects")};if(!t)return e.jsx("div",{style:{padding:24},children:"Loading…"});const h=t.revenueOMR>0?(t.profitOMR/t.revenueOMR*100).toFixed(1):0,b=[{title:"Invoice",dataIndex:"number",render:(s,i)=>`INV-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:s=>S(s),align:"right"},{title:"Status",dataIndex:"paymentStatus",render:s=>e.jsx(d,{color:s==="paid"?"green":s==="partial"?"orange":"red",children:s})}],O=[{title:"PO",dataIndex:"number",render:(s,i)=>`PO-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:(s,i)=>`${parseFloat(s||0).toFixed(3)} ${i.currency}`,align:"right"},{title:"Status",dataIndex:"status",render:s=>e.jsx(d,{children:s})}],z=[{title:"Description",dataIndex:"description"},{title:"Category",dataIndex:"category",render:s=>e.jsx(d,{children:s})},{title:"Total",dataIndex:"total",render:s=>S(s),align:"right"},{title:"Date",dataIndex:"date",render:s=>m(s).format("DD MMM YY")}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(v,{children:[e.jsx(p,{icon:e.jsx(_,{}),onClick:()=>x("/projects")}),e.jsx(k,{level:4,style:{margin:0,color:"#034D57"},children:t.code||t.name}),e.jsx(d,{color:A[t.status],children:(j=t.status)==null?void 0:j.replace(/_/g," ").toUpperCase()})]}),e.jsxs(v,{children:[e.jsx(p,{icon:e.jsx($,{}),onClick:()=>x(`/projects/edit/${o}`),children:"Edit"}),e.jsx(Y,{title:"Delete?",onConfirm:M,children:e.jsx(p,{danger:!0,icon:e.jsx(T,{}),children:"Delete"})})]})]}),e.jsxs(B,{gutter:12,style:{marginBottom:16},children:[e.jsx(l,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Budget",value:parseFloat(t.budgetOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14}})})}),e.jsx(l,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Revenue",value:parseFloat(t.revenueOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:"#4CB480"}})})}),e.jsx(l,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Costs",value:parseFloat(t.costOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:"#e53e3e"}})})}),e.jsx(l,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Profit",value:parseFloat(t.profitOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:t.profitOMR>=0?"#4CB480":"#e53e3e",fontWeight:700}})})}),e.jsx(l,{xs:12,sm:4,children:e.jsxs(a,{size:"small",style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,color:"#888"},children:"Margin"}),e.jsxs("div",{style:{fontSize:20,fontWeight:700,color:h>=20?"#4CB480":"#e53e3e"},children:[h,"%"]})]})})]}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(r,{column:{xs:1,sm:2},size:"small",bordered:!0,children:[e.jsx(r.Item,{label:"Project Name",children:e.jsx("b",{children:t.name})}),e.jsx(r.Item,{label:"Client",children:((f=t.client)==null?void 0:f.name)||"—"}),e.jsx(r.Item,{label:"Sector",children:((g=t.sector)==null?void 0:g.replace(/_/g," "))||"—"}),e.jsx(r.Item,{label:"Start",children:t.startDate?m(t.startDate).format("DD MMM YYYY"):"—"}),e.jsx(r.Item,{label:"End",children:t.endDate?m(t.endDate).format("DD MMM YYYY"):"—"}),t.description&&e.jsx(r.Item,{label:"Description",span:2,children:t.description})]})}),e.jsx(P,{items:[{key:"invoices",label:`Invoices (${(t.invoices||[]).length})`,children:e.jsx(u,{columns:b,dataSource:t.invoices||[],rowKey:"_id",size:"small",pagination:!1})},{key:"pos",label:`Purchase Orders (${(t.purchaseOrders||[]).length})`,children:e.jsx(u,{columns:O,dataSource:t.purchaseOrders||[],rowKey:"_id",size:"small",pagination:!1})},{key:"expenses",label:`Expenses (${(t.expenses||[]).length})`,children:e.jsx(u,{columns:z,dataSource:t.expenses||[],rowKey:"_id",size:"small",pagination:!1})}]})]})}export{se as default};
