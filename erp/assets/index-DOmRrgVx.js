import{r as o,j as e}from"./index-COaFcvEx.js";import{o as _}from"./omrFormat-sWU5GH6x.js";import{d as M}from"./dayjs.min-BzW2oJxm.js";import{b7 as n,aB as b,aM as h,aL as s,aR as le,a_ as i,b9 as se,aY as te,aZ as g,b4 as ne}from"./IdurarOs-xaNdaDtf.js";import{C as S}from"./index-DRmv351-.js";import{S as I}from"./index-CBgLQCY3.js";import{F as ie}from"./Table-eiro1pWr.js";import{M as oe}from"./index-DC75SekX.js";import{T as re}from"./index-C0CtLGXX.js";import{d as de,e as x,a8 as ce,T as O,r as me}from"./ErpApp-ylpRU2yB.js";import{D as L}from"./index-CXp9CO6H.js";import{T as v}from"./index-DgnfKOwn.js";import{S as pe}from"./index-DfBduLyF.js";import{s as w}from"./index-BxbWwr5Z.js";import{P as ue}from"./index-B-_te2t6.js";import{P as H}from"./PlusOutlined-Ct0BwzAe.js";import{D as V}from"./DeleteOutlined-Dc4sl4Zn.js";import"./Skeleton-BHJyNqTm.js";import"./ActionButton-DUdJBdpV.js";import"./fade-DIk_qyQx.js";import"./ClockCircleOutlined-CqcQV-E2.js";const{Title:he,Text:D}=te;function A(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function xe(){return{...A(),"Content-Type":"application/json"}}const je={General:"default",Sales:"blue",Finance:"green",Procurement:"gold",Operations:"purple",Admin:"cyan",IT:"orange",HR:"pink"},ye={active:"success",inactive:"default",on_leave:"warning"},fe=[{value:"housing",label:"Housing Allowance"},{value:"transport",label:"Transport Allowance"},{value:"food",label:"Food Allowance"},{value:"phone",label:"Phone/Communication"},{value:"bonus",label:"Bonus"},{value:"other",label:"Other"}];function Le(){var N,R;const[J,U]=o.useState([]),[p,$]=o.useState(null),[G,E]=o.useState(!1),[W,j]=o.useState(!1),[c,B]=o.useState(null),[q,z]=o.useState(!1),[m]=n.useForm(),[y,u]=o.useState([]),[f,C]=o.useState(!1),P=async()=>{E(!0);const[a,l]=await Promise.all([fetch(g+"employee/list?items=100",{headers:A()}).then(t=>t.json()).catch(()=>({})),fetch(g+"employee/stats",{headers:A()}).then(t=>t.json()).catch(()=>({}))]);a.success&&U(a.result||[]),l.success&&$(l.result),E(!1)};o.useEffect(()=>{P()},[]);const Y=()=>{B(null),m.resetFields(),u([]),C(!1),j(!0)},K=a=>{B(a),m.setFieldsValue({...a,joinDate:a.joinDate?M(a.joinDate):null,endDate:a.endDate?M(a.endDate):null}),u(a.allowancePresets||[]),C(!!a.pasiEnrolled),j(!0)},Z=async()=>{var l;let a;try{a=await m.validateFields()}catch{return}a.joinDate&&(a.joinDate=a.joinDate.toISOString()),a.endDate&&(a.endDate=a.endDate.toISOString()),a.allowancePresets=y.filter(t=>t.amount>0),a.pasiEnrolled=f,z(!0);try{const t=c?`employee/update/${c._id}`:"employee/create",d=c?"PATCH":"POST",r=await fetch(g+t,{method:d,headers:xe(),body:JSON.stringify(a)}).then(T=>T.json());r.success?(w.success(c?"Updated":`Created: ${(l=r.result)==null?void 0:l.employeeId}`),j(!1),P()):w.error(r.message||"Failed")}finally{z(!1)}},Q=async a=>{(await fetch(g+`employee/delete/${a}`,{method:"DELETE",headers:A()}).then(t=>t.json()).catch(()=>({}))).success?(w.success("Deleted"),P()):w.error("Failed")},X=()=>u(a=>[...a,{type:"housing",description:"",amount:0}]),ee=a=>u(l=>l.filter((t,d)=>d!==a)),k=(a,l,t)=>u(d=>d.map((r,T)=>T===a?{...r,[l]:t}:r)),F=y.reduce((a,l)=>a+(l.amount||0),0),ae=[{title:"ID",dataIndex:"employeeId",width:90,render:a=>e.jsx(D,{code:!0,style:{fontSize:11},children:a})},{title:"Name",dataIndex:"name",render:(a,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:a}),l.position&&e.jsx(D,{type:"secondary",style:{fontSize:11},children:l.position})]})},{title:"Department",dataIndex:"department",render:a=>e.jsx(O,{color:je[a]||"default",children:a})},{title:"Contact",render:(a,l)=>e.jsxs("div",{style:{fontSize:11},children:[l.email&&e.jsx("div",{children:l.email}),l.phone&&e.jsx("div",{style:{color:"#888"},children:l.phone})]})},{title:"Basic Salary",dataIndex:"salary",align:"right",render:a=>a?_(a):"â€”"},{title:"Total Pkg",align:"right",render:(a,l)=>{const t=(l.salary||0)+(l.allowancePresets||[]).reduce((d,r)=>d+(r.amount||0),0);return t>0?e.jsx("span",{style:{color:"#4CB480",fontWeight:700},children:_(t)}):"â€”"}},{title:"PASI",dataIndex:"pasiEnrolled",align:"center",render:a=>a?e.jsx(O,{color:"gold",children:"PASI"}):"â€”"},{title:"Status",dataIndex:"status",render:a=>e.jsx(O,{color:ye[a],children:a==null?void 0:a.replace("_"," ").toUpperCase()})},{title:"",key:"actions",width:80,render:(a,l)=>e.jsxs(me,{size:4,children:[e.jsx(b,{size:"small",icon:e.jsx(ne,{}),onClick:()=>K(l)}),e.jsx(ue,{title:"Delete employee?",onConfirm:()=>Q(l._id),children:e.jsx(b,{size:"small",danger:!0,icon:e.jsx(V,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(he,{level:4,style:{margin:0,color:"#034D57"},children:"Employees"}),e.jsx(b,{type:"primary",icon:e.jsx(H,{}),onClick:Y,style:{background:"#034D57",borderColor:"#034D57"},children:"Add Employee"})]}),p&&e.jsxs(h,{gutter:[12,12],style:{marginBottom:16},children:[e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Total",value:p.total,prefix:e.jsx(de,{})})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Active",value:p.active,valueStyle:{color:"#4CB480"}})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Present Today",value:((N=p.today)==null?void 0:N.present)||0,valueStyle:{color:"#034D57"}})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Absent Today",value:((R=p.today)==null?void 0:R.absent)||0,valueStyle:{color:"#e53e3e"}})})})]}),e.jsx(ie,{columns:ae,dataSource:J,rowKey:"_id",loading:G,size:"small",pagination:{pageSize:20}}),e.jsx(oe,{title:c?`Edit â€” ${c.name}`:"Add New Employee",open:W,onCancel:()=>j(!1),onOk:Z,okText:"Save",confirmLoading:q,width:700,okButtonProps:{style:{background:"#034D57",borderColor:"#034D57"}},children:e.jsx(n,{form:m,layout:"vertical",style:{marginTop:8},children:e.jsx(re,{items:[{key:"personal",label:e.jsxs("span",{children:[e.jsx(le,{})," Personal Info"]}),children:e.jsxs(h,{gutter:12,children:[e.jsx(s,{span:14,children:e.jsx(n.Item,{name:"name",label:"Full Name",rules:[{required:!0}],children:e.jsx(i,{})})}),e.jsx(s,{span:10,children:e.jsx(n.Item,{name:"department",label:"Department",children:e.jsx(x,{options:["General","Sales","Finance","Procurement","Operations","Admin","IT","HR"].map(a=>({value:a,label:a})),allowClear:!0})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"position",label:"Position / Job Title",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"nationality",label:"Nationality",children:e.jsx(i,{placeholder:"e.g. Omani, Indian"})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"nationalId",label:"National ID / Passport No.",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"email",label:"Work Email",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"phone",label:"Phone",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"joinDate",label:"Join Date",children:e.jsx(L,{style:{width:"100%"}})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"endDate",label:"End Date (if applicable)",children:e.jsx(L,{style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(n.Item,{name:"status",label:"Status",initialValue:"active",children:e.jsx(x,{options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"on_leave",label:"On Leave"}]})})}),e.jsx(s,{span:16,children:e.jsx(n.Item,{name:"notes",label:"Notes",children:e.jsx(i.TextArea,{rows:2})})})]})},{key:"salary",label:"ðŸ’° Salary & Allowances",children:e.jsxs("div",{children:[e.jsxs(h,{gutter:12,children:[e.jsx(s,{span:10,children:e.jsx(n.Item,{name:"salary",label:"Basic Salary",rules:[{required:!0}],children:e.jsx(v,{style:{width:"100%"},min:0,precision:3,addonBefore:"OMR"})})}),e.jsx(s,{span:7,children:e.jsx(n.Item,{name:"salaryType",label:"Pay Type",initialValue:"monthly",children:e.jsx(x,{options:[{value:"monthly",label:"Monthly"},{value:"daily",label:"Daily"},{value:"hourly",label:"Hourly"}]})})}),e.jsx(s,{span:7,children:e.jsx(n.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(i,{})})})]}),e.jsx(se,{orientation:"left",style:{fontSize:12,color:"#888"},children:"Standard Allowances (auto-included in every payroll run)"}),y.map((a,l)=>e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6,alignItems:"center"},children:[e.jsx(x,{size:"small",style:{width:160},value:a.type,onChange:t=>k(l,"type",t),options:fe}),e.jsx(i,{size:"small",style:{flex:1},placeholder:"Description (optional)",value:a.description,onChange:t=>k(l,"description",t.target.value)}),e.jsx(v,{size:"small",style:{width:130},min:0,precision:3,value:a.amount,onChange:t=>k(l,"amount",t||0),addonBefore:"OMR"}),e.jsx(V,{onClick:()=>ee(l),style:{color:"#e53e3e",cursor:"pointer"}})]},l)),e.jsx(b,{size:"small",icon:e.jsx(H,{}),onClick:X,style:{marginBottom:10},children:"Add Allowance"}),y.length>0&&e.jsx("div",{style:{background:"#f0f6f7",padding:"8px 12px",borderRadius:6,marginTop:6},children:e.jsxs(D,{style:{fontSize:12},children:["Total package: OMR ",((m.getFieldValue("salary")||0)+F).toFixed(3),"Â (Basic: ",(m.getFieldValue("salary")||0).toFixed(3)," + Allowances: ",F.toFixed(3),")"]})})]})},{key:"pasi",label:"ðŸ› PASI / GOSI",children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[e.jsx(pe,{checked:f,onChange:C}),e.jsx(D,{children:f?"PASI enrolled â€” deductions will be calculated":"Not enrolled in PASI/GOSI"})]}),f&&e.jsxs(h,{gutter:12,children:[e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"pasiEmployeeRate",label:"Employee Contribution (%)",initialValue:6.5,children:e.jsx(v,{style:{width:"100%"},min:0,max:100,precision:2,addonAfter:"%"})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"pasiEmployerRate",label:"Employer Contribution (%)",initialValue:10.5,children:e.jsx(v,{style:{width:"100%"},min:0,max:100,precision:2,addonAfter:"%"})})}),e.jsx(s,{span:24,children:e.jsxs("div",{style:{background:"#fff8e6",border:"1px solid #fcd34d",borderRadius:6,padding:"10px 14px",fontSize:12},children:[e.jsx("strong",{children:"PASI rates (Oman, 2024):"}),e.jsx("br",{}),"Employee: 6.5% of basic salary Â· Employer: 10.5% of basic salary",e.jsx("br",{}),"Calculated on basic salary only, not allowances"]})})]})]})},{key:"bank",label:e.jsxs("span",{children:[e.jsx(ce,{})," Bank Details"]}),children:e.jsxs(h,{gutter:12,children:[e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"bankName",label:"Bank Name",children:e.jsx(x,{options:["BankMuscat","Bank Dhofar","National Bank of Oman","HSBC Oman","Ahli Bank","Sohar International","Bank Nizwa","Al Izz Bank","Other"].map(a=>({value:a,label:a})),allowClear:!0,showSearch:!0})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"bankAccount",label:"Account Number",children:e.jsx(i,{})})}),e.jsx(s,{span:24,children:e.jsx(n.Item,{name:"iban",label:"IBAN",children:e.jsx(i,{placeholder:"OM00 0000 0000 0000 0000 0000",style:{fontFamily:"monospace"}})})})]})}]})})})]})}export{Le as default};
