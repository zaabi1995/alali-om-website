import{m as C,o as b,r as g,j as e}from"./index-CKjWyx67.js";import{d as m}from"./dayjs.min-CIecPvxL.js";import{ay as y,ai as x,aw as z,aA as F,aB as o,ar as $}from"./IdurarOs-BgMdBggr.js";import{j as S}from"./ErpApp-M1iameEO.js";import{T as n}from"./index-XVJtUZ3d.js";import{P as T}from"./index-Dbcm0SGK.js";import{C as a}from"./index-ZIE74Uk7.js";import{S as d}from"./index-CPBX8aEI.js";import{D as r}from"./index-CegXI76Z.js";import{T as B}from"./index-Bvd6GFZp.js";import{F as p}from"./Table-DqQBpqxK.js";import{s as E}from"./index-XM48pMGy.js";import{A as P}from"./ArrowLeftOutlined-b4ymjTZt.js";import{D as Y}from"./DeleteOutlined-rUVA3-yV.js";import"./useClosable-jXBiFFW8.js";import"./ActionButton--BPorTej.js";import"./Skeleton-BIytMwGH.js";import"./pickAttrs-DdF16Fa2.js";import"./PlusOutlined-BVkVZY4D.js";import"./index-DJ9T48TP.js";import"./DownOutlined-BY38r6sB.js";const{Title:w}=$;function v(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}const _={prospect:"default",active:"green",on_hold:"orange",completed:"blue",cancelled:"red"};function oe(){var h,j,f;const c=C(),{id:l}=b(),[t,M]=g.useState(null);g.useEffect(()=>{fetch(y+`project/read/${l}`,{headers:v()}).then(s=>s.json()).then(s=>{s.success&&M(s.result)}).catch(()=>{})},[l]);const O=async()=>{await fetch(y+`project/delete/${l}`,{method:"DELETE",headers:v()}),E.success("Deleted"),c("/projects")};if(!t)return e.jsx("div",{style:{padding:24},children:"Loading…"});const u=t.revenueOMR>0?(t.profitOMR/t.revenueOMR*100).toFixed(1):0,D=[{title:"Invoice",dataIndex:"number",render:(s,i)=>`INV-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:s=>`${parseFloat(s||0).toFixed(3)} OMR`,align:"right"},{title:"Status",dataIndex:"paymentStatus",render:s=>e.jsx(n,{color:s==="paid"?"green":s==="partial"?"orange":"red",children:s})}],I=[{title:"PO",dataIndex:"number",render:(s,i)=>`PO-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:(s,i)=>`${parseFloat(s||0).toFixed(3)} ${i.currency}`,align:"right"},{title:"Status",dataIndex:"status",render:s=>e.jsx(n,{children:s})}],R=[{title:"Description",dataIndex:"description"},{title:"Category",dataIndex:"category",render:s=>e.jsx(n,{children:s})},{title:"Total",dataIndex:"total",render:s=>`${parseFloat(s||0).toFixed(3)} OMR`,align:"right"},{title:"Date",dataIndex:"date",render:s=>m(s).format("DD MMM YY")}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(S,{children:[e.jsx(x,{icon:e.jsx(P,{}),onClick:()=>c("/projects")}),e.jsx(w,{level:4,style:{margin:0,color:"#034D57"},children:t.code||t.name}),e.jsx(n,{color:_[t.status],children:(h=t.status)==null?void 0:h.replace(/_/g," ").toUpperCase()})]}),e.jsxs(S,{children:[e.jsx(x,{icon:e.jsx(z,{}),onClick:()=>c(`/projects/edit/${l}`),children:"Edit"}),e.jsx(T,{title:"Delete?",onConfirm:O,children:e.jsx(x,{danger:!0,icon:e.jsx(Y,{}),children:"Delete"})})]})]}),e.jsxs(F,{gutter:12,style:{marginBottom:16},children:[e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(d,{title:"Budget",value:parseFloat(t.budgetOMR||0).toFixed(3),suffix:"OMR",valueStyle:{fontSize:14}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(d,{title:"Revenue",value:parseFloat(t.revenueOMR||0).toFixed(3),suffix:"OMR",valueStyle:{fontSize:14,color:"#4CB480"}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(d,{title:"Costs",value:parseFloat(t.costOMR||0).toFixed(3),suffix:"OMR",valueStyle:{fontSize:14,color:"#e53e3e"}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(d,{title:"Profit",value:parseFloat(t.profitOMR||0).toFixed(3),suffix:"OMR",valueStyle:{fontSize:14,color:t.profitOMR>=0?"#4CB480":"#e53e3e",fontWeight:700}})})}),e.jsx(o,{xs:12,sm:4,children:e.jsxs(a,{size:"small",style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,color:"#888"},children:"Margin"}),e.jsxs("div",{style:{fontSize:20,fontWeight:700,color:u>=20?"#4CB480":"#e53e3e"},children:[u,"%"]})]})})]}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(r,{column:{xs:1,sm:2},size:"small",bordered:!0,children:[e.jsx(r.Item,{label:"Project Name",children:e.jsx("b",{children:t.name})}),e.jsx(r.Item,{label:"Client",children:((j=t.client)==null?void 0:j.name)||"—"}),e.jsx(r.Item,{label:"Sector",children:((f=t.sector)==null?void 0:f.replace(/_/g," "))||"—"}),e.jsx(r.Item,{label:"Start",children:t.startDate?m(t.startDate).format("DD MMM YYYY"):"—"}),e.jsx(r.Item,{label:"End",children:t.endDate?m(t.endDate).format("DD MMM YYYY"):"—"}),t.description&&e.jsx(r.Item,{label:"Description",span:2,children:t.description})]})}),e.jsx(B,{items:[{key:"invoices",label:`Invoices (${(t.invoices||[]).length})`,children:e.jsx(p,{columns:D,dataSource:t.invoices||[],rowKey:"_id",size:"small",pagination:!1})},{key:"pos",label:`Purchase Orders (${(t.purchaseOrders||[]).length})`,children:e.jsx(p,{columns:I,dataSource:t.purchaseOrders||[],rowKey:"_id",size:"small",pagination:!1})},{key:"expenses",label:`Expenses (${(t.expenses||[]).length})`,children:e.jsx(p,{columns:R,dataSource:t.expenses||[],rowKey:"_id",size:"small",pagination:!1})}]})]})}export{oe as default};
