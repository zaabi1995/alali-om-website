import{r as a,m as _,o as H,j as e}from"./index-DWVcmqXa.js";import{d as M}from"./dayjs.min-DcWz5x55.js";import{O as J,g as V,aZ as f,aN as W,aB as n,aS as q,b4 as K,aM as Q,aL as F,aY as X}from"./IdurarOs-USsksKtA.js";import{s as h}from"./index-FFjCNGTz.js";import{T as Z,r as G,F as I}from"./ErpApp-C9DE2qQ1.js";import{C as p}from"./index-DEUEd5L0.js";import{D as i}from"./index-Aw-h1892.js";import{F as u}from"./Table-CarGh9yd.js";import{M as ee}from"./index-ujfwKfqL.js";import{A as te}from"./ArrowLeftOutlined-BoAShemW.js";import{C as B}from"./CheckCircleOutlined-BN95QACq.js";import"./Skeleton-WERULY8S.js";import"./index--4J1Vb1Q.js";import"./PlusOutlined-D1ey1NHx.js";import"./ActionButton-90oA-TFZ.js";import"./fade-B8UqtJLD.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},se=function(l,t){return a.createElement(J,V({},l,{ref:t,icon:re}))};const ne=a.forwardRef(se),{Title:U,Text:x}=X,ae={draft:"default",sent:"blue",acknowledged:"cyan",shipped:"orange",received:"green",cancelled:"red"};function y(){const o=((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token;return o?{Authorization:`Bearer ${o}`}:{}}function Se(){var P,D,L,R,T;const o=_(),{id:l}=H(),[t,v]=a.useState(null),[$,z]=a.useState(!0),[w,k]=a.useState(!1),[E,O]=a.useState(!1),[d,g]=a.useState(null),[A,j]=a.useState(!1);a.useEffect(()=>{fetch(f+`purchaseorder/read/${l}`,{headers:y()}).then(r=>r.json()).then(r=>{r.success&&v(r.result)}).catch(()=>h.error("Failed to load")).finally(()=>z(!1))},[l]);const m=async r=>{const c=await(await fetch(f+`purchaseorder/update/${l}`,{method:"PATCH",headers:{...y(),"Content-Type":"application/json"},body:JSON.stringify({status:r})})).json();c.success&&(v(c.result),h.success(`Status: ${r}`))},C=async(r=!1)=>{k(!0);try{const s=await fetch(f+`purchaseorder/pdf/${l}`,{headers:y()});if(!s.ok)throw new Error("PDF failed");const c=await s.blob(),b=URL.createObjectURL(c);if(r){const S=document.createElement("a");S.href=b,S.download=`PO-${t==null?void 0:t.number}-${t==null?void 0:t.year}.pdf`,S.click(),URL.revokeObjectURL(b)}else g(b),j(!0)}catch(s){h.error(s.message)}finally{k(!1)}},N=async()=>{O(!0);try{const s=await(await fetch(f+"purchaseorder/mail",{method:"POST",headers:{...y(),"Content-Type":"application/json"},body:JSON.stringify({id:l})})).json();s.success?h.success(s.message):h.error(s.message||"Email failed")}catch{h.error("Network error")}finally{O(!1)}};if($)return e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(W,{size:"large"})});if(!t)return e.jsx("div",{style:{padding:24},children:"Not found."});const Y=[{title:"#",width:40,render:(r,s,c)=>c+1},{title:"Part Number",dataIndex:"partNumber",render:r=>e.jsx("strong",{children:r||"—"})},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"Qty",dataIndex:"quantity",align:"center"},{title:"Unit",dataIndex:"unit",width:60},{title:"Unit Price",dataIndex:"unitPrice",align:"right",render:(r,s)=>`${parseFloat(r||0).toFixed(4)} ${s.currency||t.currency}`},{title:"Total",dataIndex:"total",align:"right",render:(r,s)=>e.jsxs("strong",{children:[parseFloat(r||0).toFixed(2)," ",s.currency||t.currency]})},{title:"HS Code",dataIndex:"hsCode",render:r=>r||"—"}];return e.jsxs("div",{style:{padding:"24px",maxWidth:1100},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(n,{icon:e.jsx(te,{}),onClick:()=>o("/purchase-order")}),e.jsxs("div",{children:[e.jsxs(U,{level:4,style:{margin:0,color:"#034D57"},children:["Purchase Order PO-",t.number,"/",t.year]}),e.jsx(Z,{color:ae[t.status]||"default",style:{marginTop:4},children:(P=t.status)==null?void 0:P.toUpperCase()})]})]}),e.jsxs(G,{wrap:!0,children:[t.status==="draft"&&e.jsx(n,{icon:e.jsx(ne,{}),onClick:()=>m("sent"),style:{borderColor:"#1890ff",color:"#1890ff"},children:"Mark Sent"}),t.status==="sent"&&e.jsx(n,{icon:e.jsx(B,{}),onClick:()=>m("acknowledged"),style:{borderColor:"#4CB480",color:"#4CB480"},children:"Mark Acknowledged"}),t.status==="acknowledged"&&e.jsx(n,{onClick:()=>m("shipped"),style:{borderColor:"#fa8c16",color:"#fa8c16"},children:"Mark Shipped"}),t.status==="shipped"&&e.jsx(n,{icon:e.jsx(B,{}),onClick:()=>m("received"),style:{borderColor:"#4CB480",color:"#4CB480"},children:"Mark Received"}),e.jsx(n,{icon:e.jsx(q,{}),onClick:N,loading:E,children:"Email Vendor"}),e.jsx(n,{icon:e.jsx(I,{}),onClick:()=>C(!1),loading:w,children:"Preview PDF"}),e.jsx(n,{icon:e.jsx(I,{}),onClick:()=>C(!0),loading:w,style:{background:"#034D57",borderColor:"#034D57",color:"#fff"},children:"Download PDF"}),e.jsx(n,{icon:e.jsx(K,{}),onClick:()=>o(`/purchase-order/edit/${l}`),children:"Edit"})]})]}),e.jsxs(Q,{gutter:16,style:{marginBottom:16},children:[e.jsx(F,{xs:24,md:12,children:e.jsxs(p,{size:"small",title:"Vendor",style:{height:"100%"},children:[e.jsx(U,{level:5,style:{color:"#034D57",marginTop:0},children:((D=t.vendor)==null?void 0:D.companyName)||"—"}),((L=t.vendor)==null?void 0:L.contactEmail)&&e.jsx(x,{type:"secondary",style:{fontSize:12},children:t.vendor.contactEmail}),((R=t.vendor)==null?void 0:R.country)&&e.jsx("div",{children:e.jsx(x,{type:"secondary",style:{fontSize:12},children:t.vendor.country})})]})}),e.jsx(F,{xs:24,md:12,children:e.jsx(p,{size:"small",title:"Order Details",style:{height:"100%"},children:e.jsxs(i,{size:"small",column:2,children:[e.jsx(i.Item,{label:"Date",children:M(t.date).format("DD MMM YYYY")}),t.deliveryDate&&e.jsx(i.Item,{label:"Required By",children:M(t.deliveryDate).format("DD MMM YYYY")}),e.jsx(i.Item,{label:"Currency",children:e.jsx("strong",{children:t.currency})}),t.vendorRef&&e.jsx(i.Item,{label:"Vendor Ref",children:t.vendorRef}),t.incoterms&&e.jsx(i.Item,{label:"Incoterms",children:t.incoterms}),t.paymentTerms&&e.jsx(i.Item,{label:"Payment",children:t.paymentTerms})]})})})]}),e.jsxs(p,{size:"small",title:`Line Items (${((T=t.items)==null?void 0:T.length)||0})`,style:{marginBottom:16},children:[e.jsx("div",{style:{overflowX:"auto"},children:e.jsx(u,{columns:Y,dataSource:t.items||[],rowKey:(r,s)=>s,pagination:!1,size:"small",summary:()=>e.jsxs(u.Summary.Row,{style:{background:"#f0f6f7"},children:[e.jsx(u.Summary.Cell,{index:0,colSpan:5,children:e.jsx("strong",{children:"Totals"})}),e.jsx(u.Summary.Cell,{index:5,align:"right",children:e.jsx(x,{type:"secondary",children:"Subtotal"})}),e.jsx(u.Summary.Cell,{index:6,align:"right",children:e.jsxs("strong",{children:[parseFloat(t.subTotal||0).toFixed(2)," ",t.currency]})}),e.jsx(u.Summary.Cell,{index:7})]})})}),e.jsxs("div",{style:{textAlign:"right",marginTop:8,padding:"8px 10px",background:"#034D57",borderRadius:4},children:[t.shippingCost>0&&e.jsxs("div",{style:{color:"#fff",fontSize:11},children:["Shipping: ",parseFloat(t.shippingCost).toFixed(2)," ",t.currency]}),e.jsxs("div",{style:{color:"#4CB480",fontWeight:800,fontSize:16},children:["TOTAL: ",parseFloat(t.total||0).toFixed(2)," ",t.currency]})]})]}),t.notes&&e.jsx(p,{size:"small",title:"Notes",style:{marginBottom:16,borderLeft:"3px solid #f59e0b"},children:e.jsx(x,{children:t.notes})}),e.jsx(ee,{title:`PDF Preview — PO-${t.number}/${t.year}`,open:A,width:"80%",style:{top:20},onCancel:()=>{j(!1),d&&URL.revokeObjectURL(d),g(null)},footer:[e.jsx(n,{type:"primary",onClick:()=>C(!0),style:{background:"#034D57"},children:"Download"},"dl"),e.jsx(n,{onClick:()=>{j(!1),d&&URL.revokeObjectURL(d),g(null)},children:"Close"},"cl")],children:d&&e.jsx("iframe",{src:d,style:{width:"100%",height:"70vh",border:"none"},title:"PO PDF"})})]})}export{Se as default};
