import{r as i,j as e}from"./index-ClqzZDiS.js";import{o as B}from"./omrFormat-DNGdXNut.js";import{aH as a,ai as c,aE as l,aN as U,aB as _,aC as s,ar as H,az as m,ax as L}from"./IdurarOs-CHCZktHs.js";import{m as g}from"./ErpApp-DOO6aifX.js";import{S as f}from"./index-CqjsIYRU.js";import{F as $}from"./Table-B4XMbQJ3.js";import{M as J}from"./index-Cqw7DHRy.js";import{T as S}from"./index-Czxh2YbS.js";import{S as N}from"./index-17lJTWuS.js";import{s as b}from"./index-AP7AWxYa.js";import{T}from"./index-DTPupOjh.js";import{P as q}from"./index-xQhJl5p8.js";import{P as Y}from"./PlusOutlined-CmFXVI8f.js";import{D as G}from"./DeleteOutlined-BlDXr5qT.js";import"./pickAttrs-mVhLSgBh.js";import"./DownOutlined-CYOYTl5A.js";import"./ActionButton-DJ55UCf5.js";import"./useClosable-BNjxKjE2.js";import"./fade-Byi1tFDZ.js";const{Title:K}=H;function A(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function W(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const Q={product:"blue",service:"green",part:"orange"};function ye(){const[E,O]=i.useState([]),[D,I]=i.useState(!1),[P,k]=i.useState({page:1,count:0}),[u,R]=i.useState(""),[x,v]=i.useState(""),[F,C]=i.useState(!1),[o,w]=i.useState(null),[h]=a.useForm(),d=async(t=1)=>{I(!0);const r=new URLSearchParams({page:t,items:30});u&&r.set("type",u),x&&r.set("q",x);const n=await fetch(m+`product/list?${r}`,{headers:A()}).then(y=>y.json()).catch(()=>({}));n.success&&(O(n.result),k(n.pagination||{})),I(!1)};i.useEffect(()=>{d(1)},[u,x]);const p=(t=null)=>{w(t),h.setFieldsValue(t?{...t}:{type:"product",taxRate:5,unit:"EA",currency:"OMR",taxable:!0,isActive:!0}),C(!0)},j=()=>{C(!1),h.resetFields(),w(null)},M=async t=>{const r=o?m+`product/update/${o._id}`:m+"product/create",n=await fetch(r,{method:o?"PATCH":"POST",headers:W(),body:JSON.stringify(t)}).then(y=>y.json()).catch(()=>({}));n.success?(b.success(o?"Updated":"Created"),j(),d(1)):b.error(n.message||"Failed")},V=async t=>{await fetch(m+`product/delete/${t}`,{method:"DELETE",headers:A()}),b.success("Deleted"),d(1)},z=[{title:"Code",dataIndex:"code",width:90,render:t=>t||"—"},{title:"Name",dataIndex:"name",ellipsis:!0,render:(t,r)=>e.jsx("a",{onClick:()=>p(r),style:{color:"#034D57",fontWeight:600},children:t})},{title:"Part #",dataIndex:"partNumber",width:110,render:t=>t?e.jsx("code",{style:{fontSize:11},children:t}):"—"},{title:"NSN",dataIndex:"nsn",width:110,render:t=>t||"—"},{title:"Type",dataIndex:"type",width:80,render:t=>e.jsx(T,{color:Q[t],children:t})},{title:"Sale Price",dataIndex:"salePrice",align:"right",render:t=>B(t)},{title:"Unit",dataIndex:"unit",width:60,render:t=>t||"EA"},{title:"Active",dataIndex:"isActive",width:70,render:t=>e.jsx(T,{color:t?"green":"default",children:t?"Yes":"No"})},{title:"",width:70,render:(t,r)=>e.jsxs(g,{children:[e.jsx(c,{size:"small",icon:e.jsx(L,{}),onClick:()=>p(r)}),e.jsx(q,{title:"Delete?",onConfirm:()=>V(r._id),children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(K,{level:4,style:{margin:0,color:"#034D57"},children:"Products & Services"}),e.jsx(c,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>p(),style:{background:"#034D57"},children:"Add Item"})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(l,{placeholder:"Search name, part #, NSN...",prefix:e.jsx(U,{}),allowClear:!0,style:{width:240},onPressEnter:t=>v(t.target.value),onChange:t=>!t.target.value&&v("")}),e.jsx(f,{placeholder:"Type",allowClear:!0,style:{width:120},onChange:t=>R(t||""),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})]}),e.jsx($,{columns:z,dataSource:E,rowKey:"_id",loading:D,size:"small",pagination:{current:P.page,total:P.count,pageSize:30,onChange:t=>d(t)}}),e.jsx(J,{title:o?"Edit Product":"New Product / Service",open:F,onCancel:j,footer:null,width:680,children:e.jsxs(a,{form:h,layout:"vertical",onFinish:M,children:[e.jsxs(_,{gutter:12,children:[e.jsx(s,{xs:24,sm:16,children:e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"code",label:"Internal Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"partNumber",label:"Part Number",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"nsn",label:"NSN",children:e.jsx(l,{placeholder:"NATO Stock Number"})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"type",label:"Type",initialValue:"product",children:e.jsx(f,{options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(f,{options:["OMR","USD","EUR","GBP","AED"].map(t=>({value:t,label:t}))})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"salePrice",label:"Sale Price",initialValue:0,children:e.jsx(S,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"costPrice",label:"Cost Price",initialValue:0,children:e.jsx(S,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxRate",label:"VAT %",initialValue:5,children:e.jsx(S,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"manufacturer",label:"Manufacturer",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"hsCode",label:"HS Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"category",label:"Category",children:e.jsx(l,{placeholder:"e.g. Aviation Parts"})})}),e.jsx(s,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(l.TextArea,{rows:2})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"taxable",label:"Taxable",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:8},children:e.jsxs(g,{children:[e.jsx(c,{onClick:j,children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{ye as default};
