import{r as u,j as e,m as M,n as te,u as N}from"./index-CyT0g67B.js";import{u as _}from"./useMoney-BWVHDu_i.js";import{F as se,D as ie,E as oe,s as Q,a as ae,C as ne,b as I,B as P,S as le,T as re,c as ce,O as V}from"./ErpApp-n-sDWNhY.js";import{X as de,b as ue,av as he,aw as xe,an as pe,ax as me,at as W,ay as f,az as k,aA as B,aB as y,ai as fe,ar as ge,aC as H}from"./IdurarOs-CoqKtLRd.js";import{u as je}from"./useFetch-Q3iESGIv.js";import{e as E}from"./actions-Cd8lNVvt.js";import{F as ye}from"./Table-CMJN-8Gn.js";import{C as ve}from"./CheckCircleOutlined-BohFqxZ-.js";import{C as w}from"./index-BZVWF8RY.js";import"./currency.es-9OAR_aOO.js";import"./pickAttrs-CO3lP972.js";import"./index-C33Svftv.js";import"./DownOutlined-C1w3tzOL.js";import"./Skeleton-Bj6nBjWH.js";import"./index-OrgXV5Bf.js";import"./PlusOutlined-CsTGChi8.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M193 796c0 17.7 14.3 32 32 32h574c17.7 0 32-14.3 32-32V563c0-176.2-142.8-319-319-319S193 386.8 193 563v233zm72-233c0-136.4 110.6-247 247-247s247 110.6 247 247v193H404V585c0-5.5-4.5-10-10-10h-44c-5.5 0-10 4.5-10 10v171h-75V563zm-48.1-252.5l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3l-67.9-67.9a8.03 8.03 0 00-11.3 0l-39.6 39.6a8.03 8.03 0 000 11.3l67.9 67.9c3.1 3.1 8.1 3.1 11.3 0zm669.6-79.2l-39.6-39.6a8.03 8.03 0 00-11.3 0l-67.9 67.9a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l67.9-67.9c3.1-3.2 3.1-8.2 0-11.3zM832 892H192c-17.7 0-32 14.3-32 32v24c0 4.4 3.6 8 8 8h688c4.4 0 8-3.6 8-8v-24c0-17.7-14.3-32-32-32zM484 180h56c4.4 0 8-3.6 8-8V76c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v96c0 4.4 3.6 8 8 8z"}}]},name:"alert",theme:"outlined"},Se=function(i,s){return u.createElement(de,ue({},i,{ref:s,icon:be}))};const Be=u.forwardRef(Se);function $({...o}){const i=pe();let{entity:s,dataTableColumns:r}=o;const a=[{label:i("Show"),key:"read",icon:e.jsx(he,{})},{label:i("Edit"),key:"edit",icon:e.jsx(xe,{})},{label:i("Download"),key:"download",icon:e.jsx(se,{})}],d=M(),n=te(),T=l=>{n(E.currentItem({data:l})),d(`/${s}/read/${l._id}`)},h=l=>{n(E.currentAction({actionType:"update",data:l})),d(`/${s}/update/${l._id}`)},D=l=>{window.open(`${me}${s}/${s}-${l._id}.pdf`,"_blank")};r=[...r,{title:"",key:"action",render:(l,S)=>e.jsx(ie,{menu:{items:a,onClick:({key:x})=>{switch(x){case"read":T(S);break;case"edit":h(S);break;case"download":D(S);break}}},trigger:["click"],children:e.jsx(oe,{style:{cursor:"pointer",fontSize:"24px"},onClick:x=>x.preventDefault()})})}];const v=()=>W.list({entity:s}),{result:c,isLoading:z,isSuccess:C}=je(v),b=()=>C&&c?c.slice(0,5):[];return e.jsx(ye,{columns:r,rowKey:l=>l._id,dataSource:C&&b(),pagination:!1,loading:z,scroll:{x:!0}})}const{Title:g,Text:_e}=ge;function j(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function p({icon:o,label:i,value:s,color:r,subtitle:a,loading:d,onClick:n}){return e.jsx(y,{xs:12,sm:8,md:6,lg:4,children:e.jsxs(w,{onClick:n,style:{borderRadius:10,border:`1px solid ${r}22`,cursor:n?"pointer":"default",transition:"box-shadow 0.2s"},bodyStyle:{padding:"14px 12px",textAlign:"center"},hoverable:!!n,children:[e.jsx("div",{style:{fontSize:24,color:r,marginBottom:4},children:o}),d?e.jsx(H,{size:"small"}):e.jsx("div",{style:{fontSize:24,fontWeight:800,color:"#034D57",lineHeight:1},children:(s==null?void 0:s.toLocaleString())??"—"}),e.jsx("div",{style:{fontSize:12,color:"#555",marginTop:3,fontWeight:600},children:i}),a&&e.jsx("div",{style:{fontSize:11,color:"#aaa",marginTop:1},children:a})]})})}function m({title:o,value:i,subtitle:s,loading:r,color:a="#034D57"}){_(),N(Q);const d=!r&&i!==void 0?Number(i||0).toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):null;return e.jsx(y,{xs:12,sm:12,md:6,lg:6,children:e.jsxs(w,{style:{borderRadius:10,borderLeft:`3px solid ${a}`},bodyStyle:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:12,color:"#888",fontWeight:600,marginBottom:6},children:o}),r?e.jsx(H,{size:"small"}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7},children:[e.jsx(V,{size:14,style:{filter:"brightness(0) saturate(100%) invert(20%) sepia(60%) saturate(400%) hue-rotate(160deg)"}}),e.jsx("span",{style:{fontSize:20,fontWeight:800,color:a,fontVariantNumeric:"tabular-nums"},children:d??"0.000"})]}),e.jsx("div",{style:{fontSize:11,color:"#aaa",marginTop:2},children:s})]})})}function ze(){var R,L;_();const o=M(),i=N(Q),[s,r]=u.useState(null),[a,d]=u.useState(!0),[n,T]=u.useState(null),[h,D]=u.useState(null);u.useEffect(()=>{fetch(f+"rfq/stats",{headers:j()}).then(t=>t.json()).then(t=>{t.success&&r(t.result)}).catch(()=>{}).finally(()=>d(!1)),fetch(f+"opportunity/stats",{headers:j()}).then(t=>t.json()).then(t=>{t.success&&T(t.result)}).catch(()=>{}),Promise.all([fetch(f+"vendorbill/ap-summary",{headers:j()}).then(t=>t.json()).catch(()=>({})),fetch(f+"expense/summary",{headers:j()}).then(t=>t.json()).catch(()=>({})),fetch(f+"bankaccount/list",{headers:j()}).then(t=>t.json()).catch(()=>({})),fetch(f+"project/list?status=active",{headers:j()}).then(t=>t.json()).catch(()=>({}))]).then(([t,O,K,X])=>{const G=t.grandTotal||0,J=O.grandTotal||0,Y=(K.result||[]).reduce((ee,A)=>ee+(A.currency==="OMR"&&A.currentBalance||0),0),Z=(X.result||[]).length;D({apDue:G,expTotal:J,bankBal:Y,activeProj:Z})}).catch(()=>{})},[]);const v=async({entity:t,currency:O})=>W.summary({entity:t,options:{currency:O}}),{result:c,isLoading:z,onFetch:C}=k(),{result:b,isLoading:l,onFetch:S}=k(),{result:x,isLoading:U,onFetch:q}=k();u.useEffect(()=>{const t=(i==null?void 0:i.default_currency_code)||"OMR";C(v({entity:"invoice",currency:t})),S(v({entity:"quote",currency:t})),q(v({entity:"payment",currency:t}))},[i==null?void 0:i.default_currency_code]);const F=[{title:"#",dataIndex:"number",width:70},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Total",dataIndex:"total",align:"right",render:(t,O)=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:12},children:[e.jsx(V,{size:10}),Number(t||0).toLocaleString("en-US",{minimumFractionDigits:3})]})},{title:"Status",dataIndex:"status",width:90,render:t=>e.jsx("span",{style:{fontSize:12,textTransform:"capitalize"},children:t})}];return i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(g,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Quick Actions"}),e.jsx(B,{gutter:[12,12],children:[{label:"New Quote",icon:e.jsx(ae,{}),color:"#034D57",path:"/quote/create"},{label:"New Invoice",icon:e.jsx(ne,{}),color:"#4CB480",path:"/invoice/create"},{label:"View RFQs",icon:e.jsx(I,{}),color:"#1890ff",path:"/rfq"},{label:"Opportunities",icon:e.jsx(P,{}),color:"#fa8c16",path:"/opportunities"}].map(t=>e.jsx(y,{xs:12,sm:6,children:e.jsx(fe,{block:!0,icon:t.icon,onClick:()=>o(t.path),style:{height:52,borderRadius:8,borderColor:t.color,color:t.color,fontWeight:600,fontSize:13},children:t.label})},t.label))})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx(g,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Procurement"}),e.jsxs(B,{gutter:[12,12],children:[e.jsx(p,{icon:e.jsx(I,{}),label:"Total RFQs",value:s==null?void 0:s.total,color:"#034D57",loading:a,onClick:()=>o("/rfq")}),e.jsx(p,{icon:e.jsx(le,{}),label:"Active",value:s==null?void 0:s.active,color:"#1890ff",subtitle:"open RFQs",loading:a,onClick:()=>o("/rfq?status=new,in_progress,researched")}),e.jsx(p,{icon:e.jsx(Be,{}),label:"IOR",value:(R=s==null?void 0:s.byPriority)==null?void 0:R.ior,color:"#ff4d4f",subtitle:"priority",loading:a,onClick:()=>o("/rfq?priority=ior")}),e.jsx(p,{icon:e.jsx(ve,{}),label:"Quoted",value:(L=s==null?void 0:s.byStatus)==null?void 0:L.quoted,color:"#52c41a",loading:a,onClick:()=>o("/rfq?status=quoted")}),e.jsx(p,{icon:e.jsx(re,{}),label:"Suppliers",value:s==null?void 0:s.totalVendors,color:"#4CB480",loading:a,onClick:()=>o("/suppliers")}),e.jsx(p,{icon:e.jsx(ce,{}),label:"Parts",value:s==null?void 0:s.totalParts,color:"#722ed1",loading:a,onClick:()=>o("/parts")}),e.jsx(p,{icon:e.jsx(P,{}),label:"Opportunities",value:(n==null?void 0:n.total)??"—",color:"#fa8c16",subtitle:n!=null&&n.highPriority?`${n.highPriority} high priority`:void 0,loading:!1,onClick:()=>o("/opportunities")})]})]}),e.jsx("div",{className:"space20"}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx(g,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Financial Summary"}),e.jsxs(B,{gutter:[12,12],children:[e.jsx(m,{title:"Invoices This Month",value:c==null?void 0:c.total,loading:z,color:"#034D57",subtitle:"billed"}),e.jsx(m,{title:"Quotes This Month",value:b==null?void 0:b.total,loading:l,color:"#1890ff",subtitle:"proposed"}),e.jsx(m,{title:"Received Payments",value:x==null?void 0:x.total,loading:U,color:"#52c41a",subtitle:"this month"}),e.jsx(m,{title:"Unpaid Balance",value:c==null?void 0:c.total_undue,loading:z,color:"#ff4d4f",subtitle:"outstanding"})]})]}),e.jsx("div",{className:"space20"}),h&&e.jsxs("div",{style:{marginBottom:6},children:[e.jsx(g,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Business Health"}),e.jsxs(B,{gutter:[12,12],children:[e.jsx(m,{title:"AP Due (Vendor Bills)",value:h.apDue,color:"#e53e3e",subtitle:"total accounts payable"}),e.jsx(m,{title:"Expenses (All Time)",value:h.expTotal,color:"#fa8c16",subtitle:"approved + paid"}),e.jsx(m,{title:"Bank Balance (OMR)",value:h.bankBal,color:"#4CB480",subtitle:"OMR accounts only"}),e.jsx(y,{xs:12,sm:12,md:6,lg:6,children:e.jsxs(w,{style:{borderRadius:10,borderLeft:"3px solid #1890ff",cursor:"pointer"},bodyStyle:{padding:"14px 16px"},onClick:()=>o("/projects?status=active"),children:[e.jsx("div",{style:{fontSize:12,color:"#888",fontWeight:600,marginBottom:6},children:"Active Projects"}),e.jsx("div",{style:{fontSize:28,fontWeight:800,color:"#1890ff"},children:h.activeProj}),e.jsx("div",{style:{fontSize:11,color:"#aaa",marginTop:2},children:"click to view"})]})})]})]}),e.jsx("div",{className:"space30"}),e.jsxs(B,{gutter:[16,16],children:[e.jsx(y,{xs:24,lg:12,children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{borderRadius:8},children:[e.jsx(g,{level:5,style:{color:"#034D57",marginBottom:12},children:"Recent Invoices"}),e.jsx($,{entity:"invoice",dataTableColumns:F})]})}),e.jsx(y,{xs:24,lg:12,children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{borderRadius:8},children:[e.jsx(g,{level:5,style:{color:"#034D57",marginBottom:12},children:"Recent Quotes"}),e.jsx($,{entity:"quote",dataTableColumns:F})]})})]})]}):null}function Qe(){return e.jsx(ze,{})}export{Qe as default};
