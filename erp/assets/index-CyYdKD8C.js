import{r as o,m as X,j as e}from"./index-DWVcmqXa.js";import{O as J,g as U,aZ as p,aM as w,aL as O,aB as u,b3 as ee,aN as te,ac as ne,a_ as re,aY as le}from"./IdurarOs-USsksKtA.js";import{B as W,r as j,c as oe,R as H,e as b,j as se,T as f}from"./ErpApp-C9DE2qQ1.js";import{C as E}from"./index-DEUEd5L0.js";import{S as ae}from"./index-QUQfItR1.js";import{A as ie}from"./index-C-bnuMcw.js";import{P as ce}from"./progress-CFEta0FK.js";import{M as D}from"./index-ujfwKfqL.js";import{R as de}from"./ReloadOutlined-C62mRCF2.js";import{T as ue}from"./TrophyOutlined-ClrXjIJX.js";import{E as he}from"./ExportOutlined-4qgsUgzz.js";import{W as ge}from"./WarningOutlined-BnMD1-3b.js";import{C as me}from"./ClockCircleOutlined-B4cYSzQe.js";import"./Skeleton-WERULY8S.js";import"./index--4J1Vb1Q.js";import"./PlusOutlined-D1ey1NHx.js";import"./ActionButton-90oA-TFZ.js";import"./fade-B8UqtJLD.js";var ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M834.1 469.2A347.49 347.49 0 00751.2 354l-29.1-26.7a8.09 8.09 0 00-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 01-47.5 46.1 352.6 352.6 0 00-100.3 121.5A347.75 347.75 0 00160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0075.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 00760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0027.7-136c0-48.8-10-96.2-29.9-140.9zM713 808.5c-53.7 53.2-125 82.4-201 82.4s-147.3-29.2-201-82.4c-53.5-53.1-83-123.5-83-198.4 0-43.5 9.8-85.2 29.1-124 18.8-37.9 46.8-71.8 80.8-97.9a349.6 349.6 0 0058.6-56.8c25-30.5 44.6-64.5 58.2-101a240 240 0 0012.1-46.5c24.1 22.2 44.3 49 61.2 80.4 33.4 62.6 48.8 118.3 45.8 165.7a74.01 74.01 0 0024.4 59.8 73.36 73.36 0 0053.4 18.8c19.7-1 37.8-9.7 51-24.4 13.3-14.9 24.8-30.1 34.4-45.6 14 17.9 25.7 37.4 35 58.4 15.9 35.8 24 73.9 24 113.1 0 74.9-29.5 145.4-83 198.4z"}}]},name:"fire",theme:"outlined"},fe=function(s,a){return o.createElement(J,U({},s,{ref:a,icon:ye}))};const q=o.forwardRef(fe);var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},pe=function(s,a){return o.createElement(J,U({},s,{ref:a,icon:xe}))};const je=o.forwardRef(pe),{Title:ve,Text:y,Paragraph:z}=le,{Option:v}=b,h="#034D57",T="#4CB480";function S(){var r,s;try{const a=(s=(r=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:r.current)==null?void 0:s.token;return a?{Authorization:`Bearer ${a}`}:{}}catch{return{}}}const N={defense:{label:"Defense & Security",color:"red"},oil_gas:{label:"Oil & Gas",color:"orange"},aviation:{label:"Aviation",color:"blue"},marine:{label:"Marine",color:"cyan"},construction:{label:"Construction",color:"brown"},renewable:{label:"Renewable Energy",color:"green"},printing:{label:"Printing",color:"purple"},health_safety:{label:"Health & Safety",color:"geekblue"},logistics:{label:"Logistics",color:"magenta"},general:{label:"General Supply",color:"default"},unknown:{label:"Other",color:"default"}},R=[{value:"spotted",label:"Spotted",color:"blue"},{value:"evaluating",label:"Evaluating",color:"orange"},{value:"bidding",label:"Bidding",color:"purple"},{value:"won",label:"Won",color:"success"},{value:"lost",label:"Lost",color:"error"},{value:"ignored",label:"Ignored",color:"default"}];function G(r){return r>=70?"#f5222d":r>=50?"#fa8c16":r>=30?T:"#8c8c8c"}function Se(r){return r==null?null:r<0?e.jsx(f,{color:"default",children:"Closed"}):r<=7?e.jsxs(f,{color:"red",icon:e.jsx(q,{}),children:[r,"d left"]}):r<=14?e.jsxs(f,{color:"orange",icon:e.jsx(ge,{}),children:[r,"d left"]}):e.jsxs(f,{color:"green",icon:e.jsx(me,{}),children:[r,"d left"]})}function Ie(){var $,F,I;const r=X(),[s,a]=o.useState([]),[i,Q]=o.useState(null),[_,P]=o.useState(!0),[k,L]=o.useState(!1),[c,V]=o.useState({page:1,pages:1,count:0}),[d,A]=o.useState({status:"",sector:"",sort:"relevance"}),[g,C]=o.useState({open:!1,id:null,notes:""}),B=o.useCallback(async()=>{try{const n=await(await fetch(p+"opportunity/stats",{headers:S()})).json();n.success&&Q(n.result)}catch{}},[]),x=o.useCallback(async(t=1)=>{P(!0);try{const n=new URLSearchParams({page:t,items:12,sort:d.sort});d.status&&n.set("status",d.status),d.sector&&n.set("sector",d.sector);const l=await(await fetch(p+`opportunity/list?${n}`,{headers:S()})).json();l.success&&(a(l.result),V(l.pagination))}catch{}P(!1)},[d]);o.useEffect(()=>{B(),x(1)},[x]);const M=async()=>{L(!0);try{(await(await fetch(p+"opportunity/scan",{method:"POST",headers:{...S(),"Content-Type":"application/json"}})).json()).success&&D.info({title:"Scan Started",content:"Scanning eTendering portal... This takes ~2 minutes. Refresh the page shortly."})}catch{}setTimeout(()=>L(!1),5e3)},Y=async(t,n)=>{try{await fetch(p+`opportunity/update/${t}`,{method:"PATCH",headers:{...S(),"Content-Type":"application/json"},body:JSON.stringify({status:n})}),a(m=>m.map(l=>l._id===t?{...l,status:n}:l)),B()}catch{}},Z=async()=>{try{await fetch(p+`opportunity/update/${g.id}`,{method:"PATCH",headers:{...S(),"Content-Type":"application/json"},body:JSON.stringify({notes:g.notes})}),a(t=>t.map(n=>n._id===g.id?{...n,notes:g.notes}:n)),C({open:!1,id:null,notes:""})}catch{}};return e.jsxs("div",{style:{padding:"24px",maxWidth:1400,margin:"0 auto"},children:[e.jsxs(w,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsxs(O,{children:[e.jsxs(ve,{level:2,style:{margin:0,color:h},children:[e.jsx(W,{style:{marginRight:8}}),"Opportunities"]}),e.jsx(y,{type:"secondary",children:"Live tenders from Oman eTendering portal â€” matched to Alali's capabilities"})]}),e.jsx(O,{children:e.jsxs(j,{children:[e.jsx(u,{icon:e.jsx(de,{}),onClick:()=>{B(),x(1)},children:"Refresh"}),e.jsx(u,{type:"primary",icon:e.jsx(oe,{spin:k}),onClick:M,loading:k,style:{backgroundColor:h,borderColor:h},children:"Scan eTendering Now"})]})})]}),i&&e.jsx(w,{gutter:16,style:{marginBottom:24},children:[{title:"Total Opportunities",value:i.total,icon:e.jsx(W,{}),color:h},{title:"High Priority",value:i.highPriority,icon:e.jsx(q,{}),color:"#f5222d"},{title:"Evaluating",value:(($=i.byStatus)==null?void 0:$.evaluating)||0,icon:e.jsx(ee,{}),color:"#fa8c16"},{title:"Bidding",value:((F=i.byStatus)==null?void 0:F.bidding)||0,icon:e.jsx(H,{}),color:"#722ed1"},{title:"Won",value:((I=i.byStatus)==null?void 0:I.won)||0,icon:e.jsx(ue,{}),color:T},{title:"New Today",value:i.recentlyAdded||0,icon:e.jsx(je,{}),color:"#1890ff"}].map(t=>e.jsx(O,{xs:12,sm:8,md:4,children:e.jsx(E,{size:"small",style:{textAlign:"center"},children:e.jsx(ae,{title:t.title,value:t.value,valueStyle:{color:t.color,fontSize:22},prefix:t.icon})})},t.title))}),!_&&s.length===0&&(i==null?void 0:i.total)===0&&e.jsx(ie,{type:"info",showIcon:!0,message:"No opportunities loaded yet",description:'Click "Scan eTendering Now" to fetch live tenders from the Oman Tender Board portal. The scan takes ~2 minutes.',style:{marginBottom:24},action:e.jsx(u,{size:"small",type:"primary",onClick:M,loading:k,style:{backgroundColor:h,borderColor:h},children:"Scan Now"})}),e.jsx(E,{size:"small",style:{marginBottom:16},children:e.jsxs(j,{wrap:!0,children:[e.jsx(b,{placeholder:"Filter by sector",allowClear:!0,style:{width:200},value:d.sector||void 0,onChange:t=>A(n=>({...n,sector:t||""})),children:Object.entries(N).filter(([t])=>t!=="unknown").map(([t,n])=>e.jsx(v,{value:t,children:n.label},t))}),e.jsx(b,{placeholder:"Filter by status",allowClear:!0,style:{width:160},value:d.status||void 0,onChange:t=>A(n=>({...n,status:t||""})),children:R.map(t=>e.jsx(v,{value:t.value,children:t.label},t.value))}),e.jsxs(b,{value:d.sort,style:{width:160},onChange:t=>A(n=>({...n,sort:t})),children:[e.jsx(v,{value:"relevance",children:"Sort: Relevance"}),e.jsx(v,{value:"deadline",children:"Sort: Deadline"}),e.jsx(v,{value:"newest",children:"Sort: Newest"})]}),e.jsxs(y,{type:"secondary",children:[c.count," opportunities found"]})]})}),_?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(te,{size:"large"})}):s.length===0?e.jsx(se,{description:"No opportunities match your filters"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{gutter:[16,16],children:s.map(t=>{var m;const n=N[t.sector]||N.unknown;return R.find(l=>l.value===t.status),e.jsx(O,{xs:24,sm:24,md:12,lg:8,children:e.jsxs(E,{size:"small",style:{height:"100%",borderLeft:`4px solid ${G(t.relevanceScore)}`,borderRadius:8},title:e.jsxs(j,{children:[e.jsx(ne,{title:`Relevance: ${t.relevanceScore}/100`,children:e.jsx(ce,{type:"circle",percent:t.relevanceScore,width:32,strokeColor:G(t.relevanceScore),format:l=>e.jsx("span",{style:{fontSize:9},children:l})})}),e.jsx(f,{color:n.color,children:n.label}),Se(t.daysLeft)]}),extra:e.jsx(b,{size:"small",value:t.status,style:{width:110},onChange:l=>Y(t._id,l),options:R.map(l=>({value:l.value,label:l.label}))}),children:[t.titleEn&&e.jsx(z,{ellipsis:{rows:2},style:{fontWeight:600,marginBottom:2,fontSize:13},children:t.titleEn}),e.jsx(z,{ellipsis:{rows:t.titleEn?1:2},style:{fontWeight:t.titleEn?400:600,fontSize:t.titleEn?11:13,marginBottom:4,direction:"rtl",textAlign:"right",color:t.titleEn?"#888":"inherit"},children:t.titleAr||t.title}),e.jsxs(y,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:2},children:["ðŸ“ ",t.ministryEn||t.ministry]}),t.ministryAr&&t.ministryEn&&e.jsx(y,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:6,direction:"rtl",textAlign:"right",color:"#aaa"},children:t.ministryAr}),t.tenderNo&&e.jsxs(y,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8},children:["TND: ",t.tenderNo]}),((m=t.matchReasons)==null?void 0:m.length)>0&&e.jsx("div",{style:{marginBottom:8},children:t.matchReasons.slice(0,2).map((l,K)=>e.jsxs(f,{color:"geekblue",style:{marginBottom:4,fontSize:11},children:["âœ“ ",l]},K))}),t.notes&&e.jsxs(z,{ellipsis:{rows:1},style:{fontSize:12,color:"#666",marginBottom:8},children:["ðŸ“ ",t.notes]}),e.jsxs(j,{style:{marginTop:8},wrap:!0,children:[t.link&&e.jsx(u,{size:"small",icon:e.jsx(he,{}),href:t.link,target:"_blank",rel:"noopener noreferrer",children:"View Tender"}),e.jsx(u,{size:"small",onClick:()=>C({open:!0,id:t._id,notes:t.notes||""}),children:"Notes"}),e.jsx(u,{size:"small",type:"primary",icon:e.jsx(H,{}),onClick:()=>r("/quote/create"),style:{backgroundColor:T,borderColor:T},children:"Create Quote"})]})]})},t._id)})}),c.pages>1&&e.jsx(w,{justify:"center",style:{marginTop:24},children:e.jsxs(j,{children:[e.jsx(u,{disabled:c.page<=1,onClick:()=>x(c.page-1),children:"Previous"}),e.jsxs(y,{children:["Page ",c.page," of ",c.pages]}),e.jsx(u,{disabled:c.page>=c.pages,onClick:()=>x(c.page+1),children:"Next"})]})})]}),e.jsx(D,{title:"Add Notes",open:g.open,onOk:Z,onCancel:()=>C({open:!1,id:null,notes:""}),okText:"Save",okButtonProps:{style:{backgroundColor:h,borderColor:h}},children:e.jsx(re.TextArea,{rows:4,value:g.notes,onChange:t=>C(n=>({...n,notes:t.target.value})),placeholder:"Add notes about this opportunity â€” contacts, strategy, requirements..."})})]})}export{Ie as default};
