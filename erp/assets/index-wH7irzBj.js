import{m as E,o as T,r as c,j as e}from"./index-DGBU46UJ.js";import{d as b}from"./dayjs.min-8Z1s2ZZV.js";import{aG as a,ay as l,ai as u,aA as O,aB as r,aD as j,ar as V}from"./IdurarOs-CJ9ViAhm.js";import{C as B}from"./index-CjcNLPXh.js";import{D as P}from"./index-Bg0HtXEY.js";import{S as i}from"./index-DbQUCUwL.js";import{T as y}from"./index-_ZzjbKBE.js";import{j as $}from"./ErpApp-CYUZ8TN2.js";import{s as x}from"./index-C-NUezbm.js";import{A as D}from"./ArrowLeftOutlined-B33LkA-B.js";import{S as N}from"./SaveOutlined-uyKAnfd2.js";import"./Skeleton-CtKtAXNJ.js";import"./index-CjgSDB-1.js";import"./PlusOutlined-WiqW7VqH.js";import"./ClockCircleOutlined-BVcQ8Scg.js";import"./pickAttrs-fHa9THfw.js";import"./DownOutlined-CLg65-LR.js";const{Title:R}=V,{TextArea:L}=j;function F(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}const q=["salaries","rent","travel","office","utilities","bank_charges","marketing","maintenance","insurance","professional_fees","customs_duties","shipping","telecommunications","other"];function oe(){const d=E(),{id:o}=T(),[f]=a.useForm(),[v,S]=c.useState([]),[w,C]=c.useState([]),[A,I]=c.useState([]),[k,g]=c.useState(!1);c.useEffect(()=>{const t={Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`};fetch(l+"vendor/listAll",{headers:t}).then(s=>s.json()).then(s=>{s.result&&S(s.result)}).catch(()=>{}),fetch(l+"project/list",{headers:t}).then(s=>s.json()).then(s=>{s.result&&C(s.result)}).catch(()=>{}),fetch(l+"bankaccount/list",{headers:t}).then(s=>s.json()).then(s=>{s.result&&I(s.result)}).catch(()=>{}),o&&fetch(l+`expense/read/${o}`,{headers:t}).then(s=>s.json()).then(s=>{var m,p;if(s.success&&s.result){const n=s.result;f.setFieldsValue({...n,date:n.date?b(n.date):null,vendor:((m=n.vendor)==null?void 0:m._id)||n.vendor,project:((p=n.project)==null?void 0:p._id)||n.project})}}).catch(()=>{})},[o]);const _=async t=>{var n;g(!0);const s={...t,date:(n=t.date)==null?void 0:n.toISOString()},m=o?l+`expense/update/${o}`:l+"expense/create",p=o?"PATCH":"POST";try{const h=await(await fetch(m,{method:p,headers:F(),body:JSON.stringify(s)})).json();h.success?(x.success(h.message||"Saved"),d(`/expense/read/${h.result._id}`)):x.error(h.message||"Failed")}catch{x.error("Network error")}finally{g(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:800},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(u,{icon:e.jsx(D,{}),onClick:()=>d("/expense")}),e.jsx(R,{level:4,style:{margin:0,color:"#034D57"},children:o?"Edit Expense":"New Expense"})]}),e.jsxs(a,{form:f,layout:"vertical",onFinish:_,children:[e.jsx(B,{title:"Expense Details",size:"small",style:{marginBottom:16},children:e.jsxs(O,{gutter:16,children:[e.jsx(r,{xs:24,sm:16,children:e.jsx(a.Item,{name:"description",label:"Description",rules:[{required:!0}],children:e.jsx(j,{placeholder:"What was this expense for?"})})}),e.jsx(r,{xs:24,sm:8,children:e.jsx(a.Item,{name:"date",label:"Date",rules:[{required:!0}],initialValue:b(),children:e.jsx(P,{style:{width:"100%"}})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"category",label:"Category",rules:[{required:!0}],initialValue:"other",children:e.jsx(i,{options:q.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(y,{min:0,precision:3,style:{width:"100%"},addonAfter:"OMR"})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxAmount",label:"VAT Amount",initialValue:0,children:e.jsx(y,{min:0,precision:3,style:{width:"100%"},addonAfter:"OMR"})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"paymentMethod",label:"Payment Method",initialValue:"bank_transfer",children:e.jsx(i,{options:["bank_transfer","cash","cheque","credit_card","other"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"reference",label:"Receipt / Voucher #",children:e.jsx(j,{placeholder:"Receipt number"})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"vendor",label:"Vendor (optional)",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Select vendor",filterOption:(t,s)=>s.label.toLowerCase().includes(t.toLowerCase()),options:v.map(t=>({value:t._id,label:t.companyName}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"project",label:"Project (optional)",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Link to project",filterOption:(t,s)=>s.label.toLowerCase().includes(t.toLowerCase()),options:w.map(t=>({value:t._id,label:`${t.code?t.code+" â€” ":""}${t.name}`}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"bankAccount",label:"Paid From",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Bank account",options:A.map(t=>({value:t._id,label:`${t.name} (${t.bankName||""})`}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"status",label:"Status",initialValue:"draft",children:e.jsx(i,{options:["draft","approved","paid","rejected"].map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"notes",label:"Notes",children:e.jsx(L,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs($,{children:[e.jsx(u,{onClick:()=>d("/expense"),children:"Cancel"}),e.jsx(u,{type:"primary",htmlType:"submit",loading:k,icon:e.jsx(N,{}),style:{background:"#034D57"},children:o?"Update":"Create Expense"})]})})]})]})}export{oe as default};
