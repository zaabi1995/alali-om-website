import{r as l,j as e}from"./index-DsxgoXaO.js";import{a as H}from"./omrFormat-C3L8_xkq.js";import{m as h,ac as L,T as b,l as $,f as S,h as J}from"./ErpApp-3NZWEkOD.js";import{O as U,g as Y,b8 as s,aB as i,b5 as q,aM as W,aL as n,aX as o,aY as K,aV as d}from"./IdurarOs-BmcscLXI.js";import{C as I}from"./index-D7xQuJHc.js";import{S as X}from"./index-BSG--CcV.js";import{P as G}from"./index-DhPG3d6O.js";import{M as A}from"./index-zM0xjAg8.js";import{T as O}from"./index-oBUcZv1I.js";import{S as Q}from"./index-CFpHVY4f.js";import{F as Z}from"./Table-B_wqoxqg.js";import{s as u}from"./index-DsmABsHN.js";import{P as ee}from"./PlusOutlined-C2sCGP9k.js";import"./Skeleton-DKI-OLNZ.js";import"./index-HED-hjAe.js";import"./ActionButton-B143qCRe.js";import"./fade-BS1XGtb3.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M536.1 273H488c-4.4 0-8 3.6-8 8v275.3c0 2.6 1.2 5 3.3 6.5l165.3 120.7c3.6 2.6 8.6 1.9 11.2-1.7l28.6-39c2.7-3.7 1.9-8.7-1.7-11.2L544.1 528.5V281c0-4.4-3.6-8-8-8zm219.8 75.2l156.8 38.3c5 1.2 9.9-2.6 9.9-7.7l.8-161.5c0-6.7-7.7-10.5-12.9-6.3L752.9 334.1a8 8 0 003 14.1zm167.7 301.1l-56.7-19.5a8 8 0 00-10.1 4.8c-1.9 5.1-3.9 10.1-6 15.1-17.8 42.1-43.3 80-75.9 112.5a353 353 0 01-112.5 75.9 352.18 352.18 0 01-137.7 27.8c-47.8 0-94.1-9.3-137.7-27.8a353 353 0 01-112.5-75.9c-32.5-32.5-58-70.4-75.9-112.5A353.44 353.44 0 01171 512c0-47.8 9.3-94.2 27.8-137.8 17.8-42.1 43.3-80 75.9-112.5a353 353 0 01112.5-75.9C430.6 167.3 477 158 524.8 158s94.1 9.3 137.7 27.8A353 353 0 01775 261.7c10.2 10.3 19.8 21 28.6 32.3l59.8-46.8C784.7 146.6 662.2 81.9 524.6 82 285 82.1 92.6 276.7 95 516.4 97.4 751.9 288.9 942 524.8 942c185.5 0 343.5-117.6 403.7-282.3 1.5-4.2-.7-8.9-4.9-10.4z"}}]},name:"history",theme:"outlined"},se=function(j,T){return l.createElement(U,Y({},j,{ref:T,icon:te}))};const ae=l.forwardRef(se),{Title:ne}=K;function w(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function z(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}function Ie(){const[p,j]=l.useState([]),[T,B]=l.useState(!1),[M,D]=l.useState(!1),[N,k]=l.useState(!1),[c,C]=l.useState(null),[r,F]=l.useState(null),[f]=s.useForm(),[y]=s.useForm(),m=async()=>{B(!0);const t=await fetch(d+"bankaccount/list",{headers:w()}).then(a=>a.json()).catch(()=>({}));t.success&&j(t.result||[]),B(!1)};l.useEffect(()=>{m()},[]);const v=(t=null)=>{C(t),f.setFieldsValue(t?{...t}:{type:"current",currency:"OMR",isDefault:!1,isActive:!0}),D(!0)},g=()=>{D(!1),f.resetFields(),C(null)},E=async t=>{const a=c?d+`bankaccount/update/${c._id}`:d+"bankaccount/create",x=await fetch(a,{method:c?"PATCH":"POST",headers:z(),body:JSON.stringify(t)}).then(_=>_.json()).catch(()=>({}));x.success?(u.success(c?"Updated":"Created"),g(),m()):u.error(x.message||"Failed")},P=async t=>{const a=await fetch(d+`bankaccount/transaction/${r._id}`,{method:"POST",headers:z(),body:JSON.stringify(t)}).then(x=>x.json()).catch(()=>({}));a.success?(u.success("Transaction recorded"),y.resetFields(),m(),F(a.result)):u.error(a.message||"Failed")},R=async t=>{await fetch(d+`bankaccount/delete/${t}`,{method:"DELETE",headers:w()}),u.success("Deleted"),m()},V=p.reduce((t,a)=>t+(a.currency==="OMR"&&a.currentBalance||0),0);return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(h,{children:[e.jsx(L,{style:{color:"#034D57",fontSize:20}}),e.jsx(ne,{level:4,style:{margin:0,color:"#034D57"},children:"Bank Accounts"})]}),e.jsx(i,{type:"primary",icon:e.jsx(ee,{}),onClick:()=>v(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx(I,{size:"small",style:{marginBottom:16,background:"#f0f9f9"},children:e.jsx(X,{title:"Total Balance",value:V.toFixed(3),suffix:H(13),valueStyle:{color:"#034D57",fontWeight:700}})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:12},children:p.map(t=>e.jsxs(I,{size:"small",title:e.jsxs(h,{children:[t.isDefault&&e.jsx(b,{color:"gold",children:"DEFAULT"}),e.jsx("b",{children:t.name})]}),extra:e.jsxs(h,{children:[e.jsx(i,{size:"small",icon:e.jsx(ae,{}),onClick:()=>{F(t),k(!0)}}),e.jsx(i,{size:"small",icon:e.jsx(q,{}),onClick:()=>v(t)}),e.jsx(G,{title:"Delete?",onConfirm:()=>R(t._id),children:e.jsx(i,{size:"small",danger:!0,icon:e.jsx($,{})})})]}),children:[e.jsxs("div",{style:{fontSize:22,fontWeight:700,color:t.currentBalance>=0?"#034D57":"#e53e3e"},children:[parseFloat(t.currentBalance||0).toFixed(3)," ",e.jsx("span",{style:{fontSize:14},children:t.currency})]}),e.jsxs("div",{style:{color:"#888",fontSize:12,marginTop:4},children:[t.bankName," • ",t.accountNumber||"—"]}),e.jsx(b,{style:{marginTop:6},children:t.type})]},t._id))}),e.jsx(A,{title:c?"Edit Account":"New Bank Account",open:M,onCancel:g,footer:null,width:540,children:e.jsxs(s,{form:f,layout:"vertical",onFinish:E,children:[e.jsxs(W,{gutter:12,children:[e.jsx(n,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Account Label",rules:[{required:!0}],children:e.jsx(o,{placeholder:"e.g. NBO Main Account"})})}),e.jsx(n,{xs:24,sm:8,children:e.jsx(s.Item,{name:"type",label:"Type",initialValue:"current",children:e.jsx(S,{options:["current","savings","petty_cash","other"].map(t=>({value:t,label:t.replace(/_/g," ")}))})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"bankName",label:"Bank Name",children:e.jsx(o,{placeholder:"National Bank of Oman"})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"accountNumber",label:"Account Number",children:e.jsx(o,{})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"iban",label:"IBAN",children:e.jsx(o,{})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"swiftCode",label:"SWIFT Code",children:e.jsx(o,{})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(S,{options:["OMR","USD","EUR"].map(t=>({value:t,label:t}))})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"openingBalance",label:"Opening Balance",initialValue:0,children:e.jsx(O,{precision:3,style:{width:"100%"}})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"isDefault",label:"Default",valuePropName:"checked",initialValue:!1,children:e.jsx(Q,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(h,{children:[e.jsx(i,{onClick:g,children:"Cancel"}),e.jsx(i,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})}),e.jsx(A,{title:`Transactions — ${(r==null?void 0:r.name)||""}`,open:N,onCancel:()=>{k(!1),y.resetFields()},footer:null,width:680,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"small",style:{marginBottom:12},children:e.jsxs(s,{form:y,layout:"inline",onFinish:P,children:[e.jsx(s.Item,{name:"type",label:"Type",initialValue:"credit",rules:[{required:!0}],children:e.jsx(S,{options:[{value:"credit",label:"Credit (In)"},{value:"debit",label:"Debit (Out)"}],style:{width:140}})}),e.jsx(s.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(O,{min:0,precision:3,placeholder:"0.000"})}),e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(o,{placeholder:"Description",style:{width:160}})}),e.jsx(s.Item,{children:e.jsx(i,{type:"primary",htmlType:"submit",size:"small",style:{background:"#034D57"},children:"Add"})})]})}),e.jsx(Z,{size:"small",rowKey:(t,a)=>a,pagination:{pageSize:10},dataSource:[...r.transactions||[]].reverse(),columns:[{title:"Date",dataIndex:"date",width:110,render:t=>J(t).format("DD MMM YYYY")},{title:"Type",dataIndex:"type",width:70,render:t=>e.jsx(b,{color:t==="credit"?"green":"red",children:t})},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"Amount",dataIndex:"amount",align:"right",render:(t,a)=>e.jsx("span",{style:{color:a.type==="credit"?"#4CB480":"#e53e3e"},children:parseFloat(t||0).toFixed(3)})},{title:"Balance",dataIndex:"balance",align:"right",render:t=>e.jsx("b",{children:parseFloat(t||0).toFixed(3)})}]})]})})]})}export{Ie as default};
