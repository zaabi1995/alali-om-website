import{m as O,o as P,r as d,j as e}from"./index-CKjWyx67.js";import{d as y}from"./dayjs.min-CIecPvxL.js";import{aG as s,ay as o,ai as m,aA as _,aB as r,aD as j,ar as T}from"./IdurarOs-BgMdBggr.js";import{C as B}from"./index-ZIE74Uk7.js";import{S as p}from"./index-DJ9T48TP.js";import{D as S}from"./index-BlgP1sFL.js";import{T as R}from"./index-DK-r3Khz.js";import{j as k}from"./ErpApp-M1iameEO.js";import{s as h}from"./index-XM48pMGy.js";import{A as E}from"./ArrowLeftOutlined-b4ymjTZt.js";import{S as N}from"./SaveOutlined-CVCCchr8.js";import"./Skeleton-BIytMwGH.js";import"./index-Bvd6GFZp.js";import"./PlusOutlined-BVkVZY4D.js";import"./pickAttrs-DdF16Fa2.js";import"./DownOutlined-BY38r6sB.js";import"./ClockCircleOutlined-D32GEBNK.js";const{Title:F}=T,{TextArea:b}=j;function $(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}function D(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}const L=["defense","aviation","oil_gas","construction","renewable_energy","marine","logistics","health_safety","printing","other"];function ae(){const i=O(),{id:n}=P(),[x]=s.useForm(),[C,w]=d.useState([]),[I,u]=d.useState(!1);d.useEffect(()=>{fetch(o+"client/listAll",{headers:D()}).then(t=>t.json()).then(t=>t.result&&w(t.result)).catch(()=>{}),n&&fetch(o+`project/read/${n}`,{headers:D()}).then(t=>t.json()).then(t=>{var a;if(t.success&&t.result){const l=t.result;x.setFieldsValue({...l,startDate:l.startDate?y(l.startDate):null,endDate:l.endDate?y(l.endDate):null,client:((a=l.client)==null?void 0:a._id)||l.client})}}).catch(()=>{})},[n]);const v=async t=>{var g,f;u(!0);const a={...t,startDate:(g=t.startDate)==null?void 0:g.toISOString(),endDate:(f=t.endDate)==null?void 0:f.toISOString()},l=n?o+`project/update/${n}`:o+"project/create";try{const c=await fetch(l,{method:n?"PATCH":"POST",headers:$(),body:JSON.stringify(a)}).then(A=>A.json());c.success?(h.success("Saved"),i(`/projects/read/${c.result._id}`)):h.error(c.message||"Failed")}catch{h.error("Network error")}finally{u(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:760},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(m,{icon:e.jsx(E,{}),onClick:()=>i("/projects")}),e.jsx(F,{level:4,style:{margin:0,color:"#034D57"},children:n?"Edit Project":"New Project"})]}),e.jsxs(s,{form:x,layout:"vertical",onFinish:v,children:[e.jsx(B,{title:"Project Details",size:"small",style:{marginBottom:16},children:e.jsxs(_,{gutter:16,children:[e.jsx(r,{xs:24,sm:8,children:e.jsx(s.Item,{name:"code",label:"Project Code",children:e.jsx(j,{placeholder:"e.g. RAFO-2026-001"})})}),e.jsx(r,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Project Name",rules:[{required:!0}],children:e.jsx(j,{})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"client",label:"Client",children:e.jsx(p,{showSearch:!0,allowClear:!0,filterOption:(t,a)=>a.label.toLowerCase().includes(t.toLowerCase()),placeholder:"Select client",options:C.map(t=>({value:t._id,label:t.name}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"sector",label:"Sector",children:e.jsx(p,{placeholder:"Select sector",allowClear:!0,options:L.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}))})})}),e.jsx(r,{xs:12,sm:6,children:e.jsx(s.Item,{name:"startDate",label:"Start Date",children:e.jsx(S,{style:{width:"100%"}})})}),e.jsx(r,{xs:12,sm:6,children:e.jsx(s.Item,{name:"endDate",label:"End Date",children:e.jsx(S,{style:{width:"100%"}})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"budgetOMR",label:"Budget (OMR)",initialValue:0,children:e.jsx(R,{min:0,precision:3,style:{width:"100%"},addonAfter:"OMR"})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"status",label:"Status",initialValue:"prospect",children:e.jsx(p,{options:["prospect","active","on_hold","completed","cancelled"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}))})})}),e.jsx(r,{xs:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(b,{rows:3})})}),e.jsx(r,{xs:24,children:e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(b,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(k,{children:[e.jsx(m,{onClick:()=>i("/projects"),children:"Cancel"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:I,icon:e.jsx(N,{}),style:{background:"#034D57"},children:"Save Project"})]})})]})]})}export{ae as default};
