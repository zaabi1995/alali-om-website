import{m as W,r as n,j as t}from"./index-COaFcvEx.js";import{aZ as I,aB as P,aM as Z,aL as K,a_ as Y,U as J,aY as X}from"./IdurarOs-xaNdaDtf.js";import{R as ee}from"./ReloadOutlined-R2J-lwkn.js";import{C as j}from"./index-DRmv351-.js";import{S as te}from"./index-CBgLQCY3.js";import{r as re,e as v,T as f,t as se}from"./ErpApp-ylpRU2yB.js";import{T as ae}from"./index-C0CtLGXX.js";import{T as oe}from"./ThunderboltOutlined-CdA8nCUC.js";import{F as le}from"./Table-eiro1pWr.js";import"./Skeleton-BHJyNqTm.js";import"./PlusOutlined-Ct0BwzAe.js";function D(){var d,y;try{const p=(y=(d=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:d.current)==null?void 0:y.token;return p?{Authorization:`Bearer ${p}`}:{}}catch{return{}}}const{Title:ne,Text:R}=X,{Option:i}=v,u="#034D57",B="#4CB480",ie={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},ce={ior:"red",routine:"orange",normal:"default"},de=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function ve(){var A,O,T,L,q;const d=W(),[y,p]=n.useState([]),[E,w]=n.useState(!0),[s,N]=n.useState(null),[ue,$]=n.useState({}),[S,C]=n.useState({current:1,pageSize:25,total:0}),[h,F]=n.useState("ALL"),[l,x]=n.useState({status:"",priority:"all",q:""}),[M,Q]=n.useState(""),k=n.useCallback(async()=>{try{const r=await(await fetch(I+"rfq/stats",{headers:D()})).json();r.success&&N(r.result)}catch{}},[]),m=n.useCallback(async(e=1)=>{w(!0);try{const r=new URLSearchParams({page:e,items:S.pageSize,...l.status&&l.status!=="active"?{status:l.status}:l.status==="active"?{status:"new,in_progress,researched"}:{},...l.priority!=="all"?{priority:l.priority}:{},...h!=="ALL"?{client:h}:{},...l.q?{q:l.q}:{}}),o=await(await fetch(I+`rfq/list?${r}`,{headers:D()})).json();if(o.success){p(o.result||[]),C(g=>{var _,z;return{...g,current:e,total:((_=o.pagination)==null?void 0:_.total)||((z=o.result)==null?void 0:z.length)||0}});const c={};(o.result||[]).forEach(g=>{c[g.client]=(c[g.client]||0)+1}),$(c)}}catch{}finally{w(!1)}},[l,h,S.pageSize]);n.useEffect(()=>{k()},[]),n.useEffect(()=>{m(1)},[l,h]);const b=e=>{if(!e.receivedAt)return null;const r=new Date(e.receivedAt),a=e.priority==="ior"?7:10,o=new Date(r.getTime()+a*864e5);return Math.ceil((o-new Date)/864e5)},G=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(e,r)=>t.jsxs("div",{children:[t.jsx(R,{strong:!0,style:{color:u,cursor:"pointer",fontSize:13},onClick:()=>d(`/rfq/${r._id}`),children:e||"â€”"}),r.priority==="ior"&&t.jsx(f,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:e=>t.jsx(f,{color:u,style:{color:"#fff",fontSize:11},children:e})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(e,r)=>t.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>d(`/rfq/${r._id}`),children:e})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,render:e=>t.jsx(f,{color:ce[e]||"default",children:(e||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>t.jsx(f,{color:ie[e]||"default",children:e==null?void 0:e.replace("_"," ")})},{title:"Parts",key:"parts",width:70,render:(e,r)=>t.jsx(se,{count:r.partsCount||0,showZero:!0,style:{backgroundColor:r.partsCount>0?B:"#e5e7eb",color:r.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,render:e=>e?new Date(e).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"Deadline",key:"deadline",width:110,sorter:(e,r)=>{const a=b(e),o=b(r);return a-o},render:(e,r)=>{if(["expired","quoted","won","lost"].includes(r.status))return t.jsx(R,{type:"secondary",style:{fontSize:11},children:"â€”"});const a=b(r);if(a===null)return t.jsx(R,{type:"secondary",style:{fontSize:11},children:"â€”"});let o,c;return a<0?(o="#ef4444",c=`${Math.abs(a)}d overdue`):a<=2?(o="#ef4444",c=`${a}d left`):a<=5?(o="#f59e0b",c=`${a}d left`):(o="#22c55e",c=`${a}d left`),t.jsx(f,{color:o,style:{fontSize:11,fontWeight:600},children:c})}},{title:"",key:"action",width:60,render:(e,r)=>t.jsx(P,{size:"small",type:"link",style:{color:u,padding:0},onClick:()=>d(`/rfq/${r._id}`),children:"View â†’"})}],H=((A=s==null?void 0:s.byPriority)==null?void 0:A.ior)||0,U=(((O=s==null?void 0:s.byStatus)==null?void 0:O.new)||0)+(((T=s==null?void 0:s.byStatus)==null?void 0:T.in_progress)||0)+(((L=s==null?void 0:s.byStatus)==null?void 0:L.researched)||0),V=((q=s==null?void 0:s.byStatus)==null?void 0:q.quoted)||0;return t.jsxs("div",{style:{padding:20,background:"#f0f2f5",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(ne,{level:3,style:{color:u,margin:0},children:"ðŸ“‹ RFQ Management"}),t.jsx(P,{icon:t.jsx(ee,{}),onClick:()=>{k(),m(1)},style:{borderColor:u,color:u},children:"Refresh"})]}),t.jsx(Z,{gutter:[12,12],style:{marginBottom:16},children:[{title:"Total RFQs",value:(s==null?void 0:s.total)||0,color:u},{title:"Active",value:U,color:"#3b82f6"},{title:"IOR Priority",value:H,color:"#ef4444"},{title:"Total Parts",value:(s==null?void 0:s.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:V,color:B},{title:"Vendors",value:(s==null?void 0:s.totalVendors)||0,color:"#f59e0b"}].map(({title:e,value:r,color:a})=>t.jsx(K,{xs:8,sm:4,children:t.jsx(j,{size:"small",style:{borderTop:`3px solid ${a}`,borderRadius:8,textAlign:"center"},children:t.jsx(te,{title:e,value:r,valueStyle:{color:a,fontSize:18,fontWeight:700}})})},e))}),t.jsx(j,{size:"small",style:{marginBottom:12,borderRadius:8},children:t.jsxs(re,{wrap:!0,children:[t.jsx(Y.Search,{placeholder:"Search RFQ#, part, subject...",value:M,onChange:e=>Q(e.target.value),onSearch:e=>x(r=>({...r,q:e})),onPressEnter:e=>x(r=>({...r,q:e.target.value})),style:{width:260},prefix:t.jsx(J,{style:{color:"#9ca3af"}})}),t.jsxs(v,{value:l.status||"active",onChange:e=>x(r=>({...r,status:e})),style:{width:140},children:[t.jsx(i,{value:"active",children:"Active"}),t.jsx(i,{value:"new",children:"New"}),t.jsx(i,{value:"in_progress",children:"In Progress"}),t.jsx(i,{value:"researched",children:"Researched"}),t.jsx(i,{value:"quoted",children:"Quoted"}),t.jsx(i,{value:"won",children:"Won"}),t.jsx(i,{value:"lost",children:"Lost"}),t.jsx(i,{value:"",children:"All Statuses"})]}),t.jsxs(v,{value:l.priority,onChange:e=>x(r=>({...r,priority:e})),style:{width:120},children:[t.jsx(i,{value:"all",children:"All Priority"}),t.jsx(i,{value:"ior",children:"ðŸš¨ IOR"}),t.jsx(i,{value:"routine",children:"Routine"}),t.jsx(i,{value:"normal",children:"Normal"})]})]})}),t.jsxs(j,{style:{borderRadius:8},bodyStyle:{padding:0},children:[t.jsx(ae,{activeKey:h,onChange:e=>{F(e),m(1)},size:"small",style:{paddingLeft:8},items:de.map(({key:e,label:r})=>({key:e,label:t.jsxs("span",{children:[e==="ALL"?t.jsx(oe,{}):null," ",r]})}))}),t.jsx(le,{rowKey:"_id",columns:G,dataSource:y,loading:E,size:"small",pagination:{...S,showSizeChanger:!1,showTotal:e=>`${e} RFQs`,onChange:e=>{C(r=>({...r,current:e})),m(e)}},rowClassName:e=>e.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:900},onRow:e=>({onClick:()=>d(`/rfq/${e._id}`),style:{cursor:"pointer"}})})]}),t.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{ve as default};
