import{r as n,j as e}from"./index-CKjWyx67.js";import{aG as a,ai as o,aA as O,aB as l,aD as c,ar as _,ay as d,aw as M}from"./IdurarOs-BgMdBggr.js";import{j as y,K as N}from"./ErpApp-M1iameEO.js";import{S as C}from"./index-DJ9T48TP.js";import{F as $}from"./Table-DqQBpqxK.js";import{M as q}from"./index-Bl6IZgWr.js";import{S as L}from"./index-BLyQ3zN-.js";import{s as m}from"./index-XM48pMGy.js";import{T as f}from"./index-XVJtUZ3d.js";import{P as R}from"./index-Dbcm0SGK.js";import{P as U}from"./PlusOutlined-BVkVZY4D.js";import{D as H}from"./DeleteOutlined-rUVA3-yV.js";import"./pickAttrs-DdF16Fa2.js";import"./DownOutlined-BY38r6sB.js";import"./ActionButton--BPorTej.js";import"./useClosable-jXBiFFW8.js";import"./fade-Cn8jLJnP.js";const{Title:Y}=_;function T(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function J(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}const K={asset:"blue",liability:"red",equity:"purple",income:"green",expense:"orange",bank:"cyan",receivable:"geekblue",payable:"volcano",tax:"gold"},I=["asset","liability","equity","income","expense","bank","receivable","payable","tax"];function me(){const[g,v]=n.useState([]),[F,b]=n.useState(!1),[u,E]=n.useState(""),[D,A]=n.useState(!1),[i,S]=n.useState(null),[p]=a.useForm(),h=async()=>{b(!0);const t=u?`?type=${u}`:"?active=all",s=await fetch(d+`account/list${t}`,{headers:T()}).then(r=>r.json()).catch(()=>({}));s.success&&v(s.result||[]),b(!1)};n.useEffect(()=>{h()},[u]);const w=(t=null)=>{S(t),p.setFieldsValue(t?{...t}:{isSystem:!1,isActive:!0}),A(!0)},x=()=>{A(!1),p.resetFields(),S(null)},k=async t=>{const s=i?d+`account/update/${i._id}`:d+"account/create",r=await fetch(s,{method:i?"PATCH":"POST",headers:J(),body:JSON.stringify(t)}).then(B=>B.json()).catch(()=>({}));r.success?(m.success(i?"Updated":"Created"),x(),h()):m.error(r.message||"Failed")},z=async t=>{const s=await fetch(d+`account/delete/${t}`,{method:"DELETE",headers:T()}).then(r=>r.json()).catch(()=>({}));s.success?(m.success("Deleted"),h()):m.error(s.message||"Cannot delete system account")},j={};(g||[]).forEach(t=>{j[t.type]||(j[t.type]=[]),j[t.type].push(t)});const P=[{title:"Code",dataIndex:"code",width:80,sorter:(t,s)=>t.code.localeCompare(s.code)},{title:"Account Name",dataIndex:"name",ellipsis:!0,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("b",{style:{color:"#034D57"},children:t}),s.isSystem&&e.jsx(f,{size:"small",style:{marginLeft:6,fontSize:10},children:"SYSTEM"})]})},{title:"Arabic Name",dataIndex:"nameAr",render:t=>e.jsx("span",{style:{fontFamily:"Tajawal, Arial",direction:"rtl"},children:t||"—"})},{title:"Type",dataIndex:"type",width:100,render:t=>e.jsx(f,{color:K[t],children:t})},{title:"Sub-Type",dataIndex:"subType",width:120,render:t=>(t==null?void 0:t.replace(/_/g," "))||"—"},{title:"Balance",dataIndex:"balance",align:"right",render:t=>`${parseFloat(t||0).toFixed(3)} OMR`},{title:"Active",dataIndex:"isActive",width:60,render:t=>e.jsx(f,{color:t?"green":"default",children:t?"✓":"✗"})},{title:"",width:70,render:(t,s)=>e.jsxs(y,{children:[e.jsx(o,{size:"small",icon:e.jsx(M,{}),onClick:()=>w(s)}),!s.isSystem&&e.jsx(R,{title:"Delete?",onConfirm:()=>z(s._id),children:e.jsx(o,{size:"small",danger:!0,icon:e.jsx(H,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(y,{children:[e.jsx(N,{style:{color:"#034D57",fontSize:20}}),e.jsx(Y,{level:4,style:{margin:0,color:"#034D57"},children:"Chart of Accounts"})]}),e.jsx(o,{type:"primary",icon:e.jsx(U,{}),onClick:()=>w(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(C,{placeholder:"Filter by type",allowClear:!0,style:{width:160},onChange:t=>E(t||""),options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})}),e.jsx($,{columns:P,dataSource:g,rowKey:"_id",loading:F,size:"small",rowClassName:t=>t.isActive?"":"row-inactive",pagination:{pageSize:50,showSizeChanger:!1}}),e.jsx(q,{title:i?`Edit: ${i.name}`:"New Account",open:D,onCancel:x,footer:null,width:580,children:e.jsxs(a,{form:p,layout:"vertical",onFinish:k,children:[e.jsxs(O,{gutter:12,children:[e.jsx(l,{xs:8,children:e.jsx(a.Item,{name:"code",label:"Account Code",rules:[{required:!0}],children:e.jsx(c,{placeholder:"e.g. 4100"})})}),e.jsx(l,{xs:16,children:e.jsx(a.Item,{name:"name",label:"Account Name",rules:[{required:!0}],children:e.jsx(c,{})})}),e.jsx(l,{xs:24,children:e.jsx(a.Item,{name:"nameAr",label:"Arabic Name",children:e.jsx(c,{style:{direction:"rtl",fontFamily:"Tajawal, Arial"}})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"type",label:"Type",rules:[{required:!0}],children:e.jsx(C,{options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"subType",label:"Sub-Type",children:e.jsx(c,{placeholder:"e.g. current_asset"})})}),e.jsx(l,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(c.TextArea,{rows:2})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(L,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(y,{children:[e.jsx(o,{onClick:x,children:"Cancel"}),e.jsx(o,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{me as default};
