import{r as l,j as e}from"./index-5ITuoeVY.js";import{d as f}from"./dayjs.min-S_U6Vk6n.js";import{X as B,b as F,ar as _,ai as C,aA as D,aB as g,ay as S,aI as T}from"./IdurarOs-2NdJjWBV.js";import{T as $}from"./index-D4F4D2Tf.js";import{a as U,h as N,K,N as V,k as M}from"./ErpApp-CTwOYhrl.js";import{C as m}from"./index-DRtkgJqY.js";import{S as y}from"./index-HDFpIo3E.js";import{F as p}from"./Table-CyRZwroC.js";import{D as W}from"./index-B-VD_0IL.js";import{T as I}from"./index-en4g6T-d.js";import{P as L}from"./progress-BRdczAx1.js";import{W as G}from"./WarningOutlined-DEA6jMkS.js";import"./PlusOutlined-CxDzqDnz.js";import"./Skeleton-DvXqHqzH.js";import"./pickAttrs-BIVrBSXA.js";import"./index-BnwwbmUc.js";import"./DownOutlined-D9fXyake.js";import"./ClockCircleOutlined-CV4B4TUH.js";import"./useClosable-1Ei4O6MR.js";var H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},q=function(h,i){return l.createElement(B,F({},h,{ref:i,icon:H}))};const Q=l.forwardRef(q);var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},J=function(h,i){return l.createElement(B,F({},h,{ref:i,icon:X}))};const Z=l.forwardRef(J),{Title:ee,Text:A}=_,{RangePicker:Y}=W;function b(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function j(t){return`${parseFloat(t||0).toFixed(3)} ر.ع.`}function te(){const[t,h]=l.useState(null),[i,c]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{c(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),x=await(await fetch(S+`reports/vat?${s}`,{headers:b()})).json();x.success&&h(x.result),c(!1)};l.useEffect(()=>{u()},[]);const a=[{title:"Invoice #",dataIndex:"number",render:(s,n)=>`INV-${s}/${n.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Date",dataIndex:"date",render:s=>f(s).format("DD MMM YYYY"),width:110},{title:"Subtotal",dataIndex:"subTotal",align:"right",render:j},{title:"VAT (5%)",dataIndex:"taxTotal",align:"right",render:s=>e.jsx(A,{style:{color:"#e53e3e"},children:j(s)})},{title:"Total",dataIndex:"total",align:"right",render:s=>e.jsx("strong",{children:j(s)})},{title:"Status",dataIndex:"status",width:90,render:s=>e.jsx(I,{children:s==null?void 0:s.toUpperCase()})}];return e.jsxs("div",{children:[e.jsxs(M,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:r,onChange:s=>s&&o(s)}),e.jsx(C,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{gutter:16,style:{marginBottom:20},children:[e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Total Sales",value:t.totals.subTotal,precision:3,suffix:"OMR"})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"VAT Collected (5%)",value:t.totals.taxTotal,precision:3,suffix:"OMR",valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Gross Revenue",value:t.totals.total,precision:3,suffix:"OMR",valueStyle:{color:"#034D57"}})})})]}),e.jsx(p,{columns:a,dataSource:t.invoices,rowKey:"_id",size:"small",pagination:{pageSize:20},loading:i,summary:()=>(t==null?void 0:t.totals)&&e.jsxs(p.Summary.Row,{style:{background:"#f0f6f7",fontWeight:700},children:[e.jsxs(p.Summary.Cell,{index:0,colSpan:3,children:["TOTAL (",t.count," invoices)"]}),e.jsx(p.Summary.Cell,{index:3,align:"right",children:j(t.totals.subTotal)}),e.jsx(p.Summary.Cell,{index:4,align:"right",style:{color:"#e53e3e"},children:j(t.totals.taxTotal)}),e.jsx(p.Summary.Cell,{index:5,align:"right",children:j(t.totals.total)}),e.jsx(p.Summary.Cell,{index:6})]})})]})]})}function se(){const[t,h]=l.useState(null),[i,c]=l.useState(!1);l.useEffect(()=>{c(!0),fetch(S+"reports/aged-receivables",{headers:b()}).then(a=>a.json()).then(a=>{a.success&&h(a.result)}).finally(()=>c(!1))},[]);const r=[{title:"Invoice #",dataIndex:"number",render:(a,s)=>`INV-${a}/${s.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Due Date",dataIndex:"expiredDate",render:a=>a?f(a).format("DD MMM YYYY"):"—",width:110},{title:"Days Overdue",dataIndex:"_daysOverdue",width:110,align:"center",render:a=>e.jsx(I,{color:a<=0?"green":a<=30?"orange":a<=60?"red":"purple",children:a<=0?"Current":`${a}d`})},{title:"Balance Due",dataIndex:"_balance",align:"right",render:j}],o=[{key:"current",label:"Current (not yet due)",color:"#4CB480"},{key:"d30",label:"1–30 Days",color:"#fa8c16"},{key:"d60",label:"31–60 Days",color:"#f5222d"},{key:"d90",label:"61–90 Days",color:"#722ed1"},{key:"over90",label:"Over 90 Days",color:"#820014"}],u=t?[...t.buckets.current||[],...t.buckets.d30||[],...t.buckets.d60||[],...t.buckets.d90||[],...t.buckets.over90||[]]:[];return e.jsx("div",{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{gutter:12,style:{marginBottom:20},children:[o.map(a=>{var s;return e.jsx(g,{xs:12,sm:8,md:4,children:e.jsxs(m,{size:"small",style:{borderTop:`3px solid ${a.color}`},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:a.label}),e.jsx("div",{style:{fontWeight:800,color:a.color,fontSize:14},children:j(t.sums[a.key])}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[((s=t.buckets[a.key])==null?void 0:s.length)||0," invoices"]})]})},a.key)}),e.jsx(g,{xs:12,sm:8,md:4,children:e.jsxs(m,{size:"small",style:{borderTop:"3px solid #034D57",background:"#f0f6f7"},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:"TOTAL RECEIVABLE"}),e.jsx("div",{style:{fontWeight:800,color:"#034D57",fontSize:14},children:j(t.grandTotal)}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[t.count," invoices"]})]})})]}),e.jsx(p,{columns:r,dataSource:u,rowKey:"_id",size:"small",loading:i,pagination:{pageSize:20},rowClassName:a=>a._daysOverdue>90?"ant-table-row-danger":""})]})})}function ae(){const[t,h]=l.useState(null),[i,c]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{c(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),x=await(await fetch(S+`reports/pnl?${s}`,{headers:b()})).json();x.success&&h(x.result),c(!1)};l.useEffect(()=>{u()},[]);const a=[{title:"Invoice #",dataIndex:"number",render:(s,n)=>`INV-${s}/${n.year}`,width:100},{title:"Client",dataIndex:"client",ellipsis:!0},{title:"Date",dataIndex:"date",render:s=>f(s).format("DD MMM YYYY"),width:110},{title:"Revenue",dataIndex:"revenue",align:"right",render:j},{title:"Cost (est.)",dataIndex:"costOMR",align:"right",render:s=>e.jsx(A,{type:"secondary",children:j(s)})},{title:"Gross Profit",dataIndex:"grossProfit",align:"right",render:s=>e.jsx("strong",{style:{color:s>=0?"#4CB480":"#e53e3e"},children:j(s)})},{title:"Margin",dataIndex:"margin",align:"center",width:100,render:s=>e.jsxs(I,{color:s>=30?"green":s>=10?"orange":"red",children:[s.toFixed(1),"%"]})},{title:"PO Linked",dataIndex:"hasLinkedPO",width:80,align:"center",render:s=>e.jsx(I,{color:s?"green":"default",children:s?"✓":"—"})}];return e.jsxs("div",{children:[e.jsxs(M,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:r,onChange:s=>s&&o(s)}),e.jsx(C,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),(t==null?void 0:t.summary)&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{gutter:16,style:{marginBottom:20},children:[e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Total Revenue",value:t.summary.totalRevenue,precision:3,suffix:"OMR"})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Total Cost (est.)",value:t.summary.totalCost,precision:3,suffix:"OMR",valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Gross Profit",value:t.summary.totalGrossProfit,precision:3,suffix:"OMR",valueStyle:{color:"#4CB480"}})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Avg Margin",value:t.summary.avgMargin,precision:1,suffix:"%",valueStyle:{color:t.summary.avgMargin>=30?"#4CB480":"#fa8c16"}})})})]}),e.jsx(p,{columns:a,dataSource:t.deals,rowKey:"_id",size:"small",loading:i,pagination:{pageSize:20}})]})]})}function le(){const[t,h]=l.useState([]),[i,c]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{c(!0);const n=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),d=await(await fetch(S+`reports/revenue-by-client?${n}`,{headers:b()})).json();d.success&&h(d.result),c(!1)};l.useEffect(()=>{u()},[]);const a=t.reduce((n,x)=>n+(x.total||0),0),s=[{title:"#",width:40,render:(n,x,d)=>d+1},{title:"Client",dataIndex:"clientName",ellipsis:!0},{title:"Invoices",dataIndex:"invoiceCount",width:80,align:"center"},{title:"Revenue",dataIndex:"total",align:"right",render:j},{title:"Share",dataIndex:"total",width:150,render:n=>e.jsx(L,{percent:a>0?parseFloat((n/a*100).toFixed(1)):0,size:"small",strokeColor:"#034D57",format:x=>`${x}%`})}];return e.jsxs("div",{children:[e.jsxs(M,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:r,onChange:n=>n&&o(n)}),e.jsx(C,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),e.jsx(p,{columns:s,dataSource:t,rowKey:"_id",size:"small",loading:i,pagination:!1})]})}function re(){var u,a,s,n,x,d,v,R,O,z;const[t,h]=l.useState(null),[i,c]=l.useState(!1),r=async()=>{c(!0);const w=await fetch(S+"account/balance-sheet",{headers:b()}).then(k=>k.json()).catch(()=>({}));w.success&&h(w.result),c(!1)};l.useEffect(()=>{r()},[]);const o=({label:w,value:k,bold:E,red:P})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid #f0f0f0",fontWeight:E?700:400,color:P?"#e53e3e":"inherit"},children:[e.jsx("span",{children:w}),e.jsxs("span",{children:[parseFloat(k||0).toFixed(3)," OMR"]})]});return e.jsxs("div",{children:[e.jsx(C,{type:"primary",onClick:r,loading:i,style:{background:"#034D57",marginBottom:16},children:"Refresh"}),t?e.jsxs(D,{gutter:16,children:[e.jsxs(g,{xs:24,sm:12,children:[e.jsxs(m,{title:"ASSETS",size:"small",headStyle:{background:"#034D57",color:"#fff"},style:{marginBottom:16},children:[e.jsx(o,{label:"Accounts Receivable",value:(u=t.assets)==null?void 0:u.accountsReceivable}),e.jsx(o,{label:"Cash & Bank",value:(a=t.assets)==null?void 0:a.cash}),e.jsx(T,{style:{margin:"8px 0"}}),e.jsx(o,{label:"TOTAL ASSETS",value:(s=t.assets)==null?void 0:s.total,bold:!0})]}),e.jsxs(m,{title:"LIABILITIES",size:"small",headStyle:{background:"#e53e3e",color:"#fff"},children:[e.jsx(o,{label:"Accounts Payable",value:(n=t.liabilities)==null?void 0:n.accountsPayable,red:!0}),e.jsx(T,{style:{margin:"8px 0"}}),e.jsx(o,{label:"TOTAL LIABILITIES",value:(x=t.liabilities)==null?void 0:x.total,bold:!0,red:!0})]})]}),e.jsxs(g,{xs:24,sm:12,children:[e.jsxs(m,{title:"EQUITY & PROFIT",size:"small",headStyle:{background:"#4CB480",color:"#fff"},children:[e.jsx(o,{label:"Total Revenue",value:(d=t.equity)==null?void 0:d.revenue}),e.jsx(o,{label:"Total Expenses",value:(v=t.equity)==null?void 0:v.expenses,red:!0}),e.jsx(T,{style:{margin:"8px 0"}}),e.jsx(o,{label:"NET PROFIT",value:(R=t.equity)==null?void 0:R.netProfit,bold:!0})]}),e.jsxs(m,{size:"small",style:{marginTop:12,background:"#f0f9f9",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,color:"#888"},children:"Net Position (Assets − Liabilities)"}),e.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#034D57"},children:[parseFloat((((O=t.assets)==null?void 0:O.total)||0)-(((z=t.liabilities)==null?void 0:z.total)||0)).toFixed(3)," OMR"]}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:["As of ",f().format("DD MMM YYYY")]})]})]})]}):e.jsx("div",{style:{textAlign:"center",color:"#888",padding:40},children:"Click Refresh to load"})]})}function ne(){const[t,h]=l.useState(null),[i,c]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{c(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),n=await fetch(S+`bankaccount/cash-flow?${s}`,{headers:b()}).then(x=>x.json()).catch(()=>({}));n.success&&h(n.result),c(!1)},a=[{title:"Month",dataIndex:"month",render:s=>f(s+"-01").format("MMM YYYY")},{title:"Cash In",dataIndex:"in",align:"right",render:s=>e.jsxs("span",{style:{color:"#4CB480"},children:[parseFloat(s||0).toFixed(3)," OMR"]})},{title:"Cash Out",dataIndex:"out",align:"right",render:s=>e.jsxs("span",{style:{color:"#e53e3e"},children:[parseFloat(s||0).toFixed(3)," OMR"]})},{title:"Net",dataIndex:"net",align:"right",render:s=>e.jsxs("b",{style:{color:s>=0?"#4CB480":"#e53e3e"},children:[parseFloat(s||0).toFixed(3)," OMR"]})}];return e.jsxs("div",{children:[e.jsxs(M,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:r,onChange:s=>s&&o(s)}),e.jsx(C,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{gutter:12,style:{marginBottom:16},children:[e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Cash In",value:parseFloat(t.cashIn||0).toFixed(3),suffix:"OMR",valueStyle:{color:"#4CB480"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Cash Out",value:parseFloat(t.cashOut||0).toFixed(3),suffix:"OMR",valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(y,{title:"Net Flow",value:parseFloat(t.netFlow||0).toFixed(3),suffix:"OMR",valueStyle:{color:t.netFlow>=0?"#4CB480":"#e53e3e",fontWeight:700}})})})]}),e.jsx(p,{columns:a,dataSource:t.monthly||[],rowKey:"month",size:"small",pagination:!1})]})]})}function ie(){const[t,h]=l.useState([]),[i,c]=l.useState(0),[r,o]=l.useState(!1),[u,a]=l.useState([f().startOf("year"),f()]),s={salaries:"Salaries",rent:"Rent",travel:"Travel",office:"Office Supplies",utilities:"Utilities",bank_charges:"Bank Charges",marketing:"Marketing",maintenance:"Maintenance",insurance:"Insurance",professional_fees:"Professional Fees",customs_duties:"Customs & Duties",shipping:"Shipping",telecommunications:"Telecom",other:"Other"},n=async()=>{o(!0);const d=new URLSearchParams({from:u[0].format("YYYY-MM-DD"),to:u[1].format("YYYY-MM-DD")}),v=await fetch(S+`reports/expenses-summary?${d}`,{headers:b()}).then(R=>R.json()).catch(()=>({}));v.success&&(h(v.result||[]),c(v.grandTotal||0)),o(!1)},x=[{title:"#",width:40,render:(d,v,R)=>R+1},{title:"Category",dataIndex:"_id",render:d=>s[d]||d},{title:"Expenses",dataIndex:"count",width:80,align:"center"},{title:"Total",dataIndex:"total",align:"right",render:d=>e.jsxs("b",{children:[parseFloat(d||0).toFixed(3)," OMR"]})},{title:"Share",dataIndex:"total",width:140,render:d=>e.jsx(L,{percent:i>0?parseFloat((d/i*100).toFixed(1)):0,size:"small",strokeColor:"#e53e3e",format:v=>`${v}%`})}];return e.jsxs("div",{children:[e.jsxs(M,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:u,onChange:d=>d&&a(d)}),e.jsx(C,{type:"primary",onClick:n,loading:r,style:{background:"#034D57"},children:"Run Report"})]}),t.length>0&&e.jsxs("div",{style:{marginBottom:8,fontWeight:700,color:"#034D57"},children:["Total Expenses: ",parseFloat(i).toFixed(3)," OMR"]}),e.jsx(p,{columns:x,dataSource:t,rowKey:"_id",size:"small",loading:r,pagination:!1})]})}function Ye(){return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(ee,{level:4,style:{color:"#034D57",marginBottom:20},children:"Financial Reports"}),e.jsx($,{defaultActiveKey:"vat",items:[{key:"vat",label:e.jsxs("span",{children:[e.jsx(U,{})," VAT Report"]}),children:e.jsx(te,{})},{key:"aged",label:e.jsxs("span",{children:[e.jsx(G,{})," Aged Receivables"]}),children:e.jsx(se,{})},{key:"pnl",label:e.jsxs("span",{children:[e.jsx(N,{})," P&L by Deal"]}),children:e.jsx(ae,{})},{key:"revenue",label:e.jsxs("span",{children:[e.jsx(K,{})," Revenue by Client"]}),children:e.jsx(le,{})},{key:"balance",label:e.jsxs("span",{children:[e.jsx(V,{})," Balance Sheet"]}),children:e.jsx(re,{})},{key:"cashflow",label:e.jsxs("span",{children:[e.jsx(Q,{})," Cash Flow"]}),children:e.jsx(ne,{})},{key:"expenses",label:e.jsxs("span",{children:[e.jsx(Z,{})," Expenses"]}),children:e.jsx(ie,{})}]})]})}export{Ye as default};
