import{r as i,j as e}from"./index-C8-4hbts.js";import{o as U}from"./omrFormat-DicYQ1VJ.js";import{b7 as a,aB as c,a_ as l,U as _,aM as z,aL as s,aY as L,aZ as u,b4 as $}from"./IdurarOs-CbjQM2OW.js";import{r as g,e as f,T}from"./ErpApp-D5jYyPXL.js";import{F as H}from"./Table-CK_5JiFu.js";import{M as J}from"./index-CIhjmZv_.js";import{T as b}from"./index-BfzeSpx5.js";import{S as N}from"./index-BcsRDSzT.js";import{s as S}from"./index-BLjLk_k2.js";import{P as Y}from"./index-BxYLosRB.js";import{P as q}from"./PlusOutlined-VHvzcD8O.js";import{D as G}from"./DeleteOutlined-DNCIIFPY.js";import"./ActionButton-CNQQc2KQ.js";import"./fade-CqTM4qm3.js";const{Title:K}=L;function A(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function W(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const Z={product:"blue",service:"green",part:"orange"};function me(){const[E,O]=i.useState([]),[D,I]=i.useState(!1),[P,k]=i.useState({page:1,count:0}),[m,M]=i.useState(""),[x,v]=i.useState(""),[R,w]=i.useState(!1),[o,C]=i.useState(null),[h]=a.useForm(),d=async(t=1)=>{I(!0);const r=new URLSearchParams({page:t,items:30});m&&r.set("type",m),x&&r.set("q",x);const n=await fetch(u+`product/list?${r}`,{headers:A()}).then(y=>y.json()).catch(()=>({}));n.success&&(O(n.result),k(n.pagination||{})),I(!1)};i.useEffect(()=>{d(1)},[m,x]);const p=(t=null)=>{C(t),h.setFieldsValue(t?{...t}:{type:"product",taxRate:5,unit:"EA",currency:"OMR",taxable:!0,isActive:!0}),w(!0)},j=()=>{w(!1),h.resetFields(),C(null)},F=async t=>{const r=o?u+`product/update/${o._id}`:u+"product/create",n=await fetch(r,{method:o?"PATCH":"POST",headers:W(),body:JSON.stringify(t)}).then(y=>y.json()).catch(()=>({}));n.success?(S.success(o?"Updated":"Created"),j(),d(1)):S.error(n.message||"Failed")},V=async t=>{await fetch(u+`product/delete/${t}`,{method:"DELETE",headers:A()}),S.success("Deleted"),d(1)},B=[{title:"Code",dataIndex:"code",width:90,render:t=>t||"—"},{title:"Name",dataIndex:"name",ellipsis:!0,render:(t,r)=>e.jsx("a",{onClick:()=>p(r),style:{color:"#034D57",fontWeight:600},children:t})},{title:"Part #",dataIndex:"partNumber",width:110,render:t=>t?e.jsx("code",{style:{fontSize:11},children:t}):"—"},{title:"NSN",dataIndex:"nsn",width:110,render:t=>t||"—"},{title:"Type",dataIndex:"type",width:80,render:t=>e.jsx(T,{color:Z[t],children:t})},{title:"Sale Price",dataIndex:"salePrice",align:"right",render:t=>U(t)},{title:"Unit",dataIndex:"unit",width:60,render:t=>t||"EA"},{title:"Active",dataIndex:"isActive",width:70,render:t=>e.jsx(T,{color:t?"green":"default",children:t?"Yes":"No"})},{title:"",width:70,render:(t,r)=>e.jsxs(g,{children:[e.jsx(c,{size:"small",icon:e.jsx($,{}),onClick:()=>p(r)}),e.jsx(Y,{title:"Delete?",onConfirm:()=>V(r._id),children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(K,{level:4,style:{margin:0,color:"#034D57"},children:"Products & Services"}),e.jsx(c,{type:"primary",icon:e.jsx(q,{}),onClick:()=>p(),style:{background:"#034D57"},children:"Add Item"})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(l,{placeholder:"Search name, part #, NSN...",prefix:e.jsx(_,{}),allowClear:!0,style:{width:240},onPressEnter:t=>v(t.target.value),onChange:t=>!t.target.value&&v("")}),e.jsx(f,{placeholder:"Type",allowClear:!0,style:{width:120},onChange:t=>M(t||""),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})]}),e.jsx(H,{columns:B,dataSource:E,rowKey:"_id",loading:D,size:"small",pagination:{current:P.page,total:P.count,pageSize:30,onChange:t=>d(t)}}),e.jsx(J,{title:o?"Edit Product":"New Product / Service",open:R,onCancel:j,footer:null,width:680,children:e.jsxs(a,{form:h,layout:"vertical",onFinish:F,children:[e.jsxs(z,{gutter:12,children:[e.jsx(s,{xs:24,sm:16,children:e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"code",label:"Internal Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"partNumber",label:"Part Number",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"nsn",label:"NSN",children:e.jsx(l,{placeholder:"NATO Stock Number"})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"type",label:"Type",initialValue:"product",children:e.jsx(f,{options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(f,{options:["OMR","USD","EUR","GBP","AED"].map(t=>({value:t,label:t}))})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"salePrice",label:"Sale Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"costPrice",label:"Cost Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxRate",label:"VAT %",initialValue:5,children:e.jsx(b,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"manufacturer",label:"Manufacturer",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"hsCode",label:"HS Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"category",label:"Category",children:e.jsx(l,{placeholder:"e.g. Aviation Parts"})})}),e.jsx(s,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(l.TextArea,{rows:2})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"taxable",label:"Taxable",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:8},children:e.jsxs(g,{children:[e.jsx(c,{onClick:j,children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{me as default};
