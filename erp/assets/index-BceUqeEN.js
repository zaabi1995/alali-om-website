import{m as P,o as O,r as d,j as e}from"./index-C236tqC8.js";import{b as _}from"./omrFormat-D9zakjTj.js";import{d as y}from"./dayjs.min-BePh7Oku.js";import{aG as s,ay as n,ai as m,aA as T,aB as a,aD as j,ar as B}from"./IdurarOs-CIvrJM3G.js";import{C as k}from"./index-DKmxjtwJ.js";import{S as p}from"./index-D07aC4PS.js";import{D as S}from"./index-D5L4Ge1X.js";import{T as E}from"./index-iX9YJgKp.js";import{l as N}from"./ErpApp-DwaI_8s0.js";import{s as h}from"./index-BTpainSG.js";import{A as R}from"./ArrowLeftOutlined-f_2GitlY.js";import{S as F}from"./SaveOutlined-DCPC5MIt.js";import"./Skeleton-BfIMR0fQ.js";import"./index-C-HV-BqQ.js";import"./PlusOutlined-DUjbHxHh.js";import"./pickAttrs-DhldMqNY.js";import"./DownOutlined-C4yJOkOC.js";import"./ClockCircleOutlined-DveV7d10.js";const{Title:$}=B,{TextArea:b}=j;function L(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}function D(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}const z=["defense","aviation","oil_gas","construction","renewable_energy","marine","logistics","health_safety","printing","other"];function le(){const i=P(),{id:o}=O(),[x]=s.useForm(),[C,w]=d.useState([]),[I,u]=d.useState(!1);d.useEffect(()=>{fetch(n+"client/listAll",{headers:D()}).then(t=>t.json()).then(t=>t.result&&w(t.result)).catch(()=>{}),o&&fetch(n+`project/read/${o}`,{headers:D()}).then(t=>t.json()).then(t=>{var r;if(t.success&&t.result){const l=t.result;x.setFieldsValue({...l,startDate:l.startDate?y(l.startDate):null,endDate:l.endDate?y(l.endDate):null,client:((r=l.client)==null?void 0:r._id)||l.client})}}).catch(()=>{})},[o]);const v=async t=>{var f,g;u(!0);const r={...t,startDate:(f=t.startDate)==null?void 0:f.toISOString(),endDate:(g=t.endDate)==null?void 0:g.toISOString()},l=o?n+`project/update/${o}`:n+"project/create";try{const c=await fetch(l,{method:o?"PATCH":"POST",headers:L(),body:JSON.stringify(r)}).then(A=>A.json());c.success?(h.success("Saved"),i(`/projects/read/${c.result._id}`)):h.error(c.message||"Failed")}catch{h.error("Network error")}finally{u(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:760},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(m,{icon:e.jsx(R,{}),onClick:()=>i("/projects")}),e.jsx($,{level:4,style:{margin:0,color:"#034D57"},children:o?"Edit Project":"New Project"})]}),e.jsxs(s,{form:x,layout:"vertical",onFinish:v,children:[e.jsx(k,{title:"Project Details",size:"small",style:{marginBottom:16},children:e.jsxs(T,{gutter:16,children:[e.jsx(a,{xs:24,sm:8,children:e.jsx(s.Item,{name:"code",label:"Project Code",children:e.jsx(j,{placeholder:"e.g. RAFO-2026-001"})})}),e.jsx(a,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Project Name",rules:[{required:!0}],children:e.jsx(j,{})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"client",label:"Client",children:e.jsx(p,{showSearch:!0,allowClear:!0,filterOption:(t,r)=>r.label.toLowerCase().includes(t.toLowerCase()),placeholder:"Select client",options:C.map(t=>({value:t._id,label:t.name}))})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"sector",label:"Sector",children:e.jsx(p,{placeholder:"Select sector",allowClear:!0,options:z.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"startDate",label:"Start Date",children:e.jsx(S,{style:{width:"100%"}})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"endDate",label:"End Date",children:e.jsx(S,{style:{width:"100%"}})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"budgetOMR",label:"Budget (OMR)",initialValue:0,children:e.jsx(E,{min:0,precision:3,style:{width:"100%"},addonAfter:_()})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"status",label:"Status",initialValue:"prospect",children:e.jsx(p,{options:["prospect","active","on_hold","completed","cancelled"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(b,{rows:3})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(b,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(N,{children:[e.jsx(m,{onClick:()=>i("/projects"),children:"Cancel"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:I,icon:e.jsx(F,{}),style:{background:"#034D57"},children:"Save Project"})]})})]})]})}export{le as default};
