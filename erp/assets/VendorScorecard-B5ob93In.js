import{r as l,o as U,m as W,j as e}from"./index-P0d3qDOI.js";import{O as X,g as Y,b8 as i,aN as Z,aM as u,aL as t,aB as S,aX as D,aY as ee,aV as P}from"./IdurarOs-C9Hfvmhw.js";import{m as F,l as a,T as j,C as re,z as te}from"./ErpApp-DhsEC5_U.js";import{C as m}from"./index-D7ycNofp.js";import{S as M}from"./index-B9Siwb96.js";import{P as b}from"./progress-DpCf3QQp.js";import{F as se}from"./Table-cLwJzRkI.js";import{M as ie}from"./index-CqP-1A0t.js";import{T as v}from"./index-CDFo9eRn.js";import{s as y}from"./index-GLktio_A.js";import{A as ne}from"./ArrowLeftOutlined-WCgDpsBv.js";import{P as oe}from"./PlusOutlined-7jHXhlhV.js";import{S as ae,T as C}from"./TrophyFilled-DNNb0CvR.js";import{C as le}from"./CheckCircleOutlined-C1gnfKMP.js";import"./Skeleton-HlVWT2JN.js";import"./index-uRPskGn0.js";import"./ActionButton-I_KEJ-cH.js";import"./fade-BGkIwWik.js";var de={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}},{tag:"path",attrs:{d:"M894 345a343.92 343.92 0 00-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4a31.95 31.95 0 0040.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1A367.31 367.31 0 00729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"}},{tag:"path",attrs:{d:"M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}}]},name:"comment",theme:"outlined"},ce=function(d,c){return l.createElement(X,Y({},d,{ref:c,icon:de}))};const N=l.forwardRef(ce);function A(){var o,d;try{const c=(d=(o=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:o.current)==null?void 0:d.token;return c?{Authorization:`Bearer ${c}`}:{}}catch{return{}}}const{Title:me,Text:s,Paragraph:xe}=ee;function qe(){const{vendorId:o}=U(),d=W(),[c,B]=l.useState(!0),[T,$]=l.useState(null),[E,g]=l.useState(!1),[V,I]=l.useState(!1),[w]=i.useForm(),k=async()=>{B(!0);try{const h=await(await fetch(`${P}vendorscore/scorecard/${o}`,{headers:A()})).json();h.success?$(h.result):y.error("Failed to load scorecard")}catch{y.error("Error loading scorecard")}B(!1)};l.useEffect(()=>{k()},[o]);const L=async r=>{var h,R;I(!0);try{const f=JSON.parse(localStorage.getItem("auth")||"{}"),H=(R=(h=f==null?void 0:f.current)==null?void 0:h.user)==null?void 0:R._id,K={vendor:o,deliveryTime:r.deliveryTime,quality:r.quality,pricing:r.pricing,communication:r.communication,notes:r.notes,ratedBy:H,relatedOrder:r.relatedOrder,orderDate:r.orderDate?new Date(r.orderDate).toISOString():null},q=await(await fetch(`${P}vendorscore/create`,{method:"POST",headers:{"Content-Type":"application/json",...A()},body:JSON.stringify(K)})).json();q.success?(y.success("Score submitted successfully"),w.resetFields(),g(!1),k()):y.error(q.message||"Failed to submit score")}catch{y.error("Error submitting score")}I(!1)};if(c)return e.jsx("div",{style:{textAlign:"center",padding:100},children:e.jsx(Z,{size:"large"})});if(!T)return e.jsx("div",{style:{textAlign:"center",padding:100},children:e.jsx(F,{description:"Vendor not found"})});const{vendor:G,scores:O,summary:_}=T,{badge:x,performanceScore:J,totalRatings:z,averages:n}=_,p={Gold:"#FFD700",Silver:"#C0C0C0",Bronze:"#CD7F32",None:"#d9d9d9"},Q=[{title:"Date",dataIndex:"created",key:"created",width:110,render:r=>new Date(r).toLocaleDateString("en-GB")},{title:"Rated By",dataIndex:["ratedBy","name"],key:"ratedBy",render:r=>r||"—"},{title:"Delivery",dataIndex:"deliveryTime",key:"deliveryTime",width:80,align:"center",render:r=>e.jsxs(j,{color:r>=4?"green":r>=3?"orange":"red",children:[r,"/5"]})},{title:"Quality",dataIndex:"quality",key:"quality",width:80,align:"center",render:r=>e.jsxs(j,{color:r>=4?"green":r>=3?"orange":"red",children:[r,"/5"]})},{title:"Pricing",dataIndex:"pricing",key:"pricing",width:80,align:"center",render:r=>e.jsxs(j,{color:r>=4?"green":r>=3?"orange":"red",children:[r,"/5"]})},{title:"Communication",dataIndex:"communication",key:"communication",width:120,align:"center",render:r=>e.jsxs(j,{color:r>=4?"green":r>=3?"orange":"red",children:[r,"/5"]})},{title:"Overall",dataIndex:"overallScore",key:"overallScore",width:80,align:"center",render:r=>e.jsxs(s,{strong:!0,style:{color:"#034D57"},children:[r,"/5"]})},{title:"Notes",dataIndex:"notes",key:"notes",ellipsis:!0,render:r=>r||"—"}];return e.jsxs("div",{style:{paddingBottom:24},children:[e.jsxs(u,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(t,{children:e.jsxs(a,{children:[e.jsx(S,{icon:e.jsx(ne,{}),onClick:()=>d("/suppliers"),children:"Back"}),e.jsxs(me,{level:4,style:{margin:0,color:"#034D57"},children:[G.companyName," — Performance Scorecard"]})]})}),e.jsx(t,{children:e.jsx(S,{type:"primary",icon:e.jsx(oe,{}),onClick:()=>g(!0),children:"Rate Vendor"})})]}),e.jsxs(u,{gutter:16,style:{marginBottom:16},children:[e.jsx(t,{xs:24,sm:12,md:6,children:e.jsx(m,{children:e.jsx(M,{title:"Overall Score",value:J,suffix:"/ 5",precision:2,prefix:e.jsx(ae,{style:{color:"#faad14"}})})})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsx(m,{children:e.jsx(M,{title:"Total Ratings",value:z,prefix:e.jsx(N,{})})})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsx(m,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(s,{type:"secondary",style:{display:"block",marginBottom:8},children:"Badge"}),x!=="None"?e.jsxs("div",{children:[e.jsx(C,{style:{fontSize:36,color:p[x]}}),e.jsx("div",{style:{marginTop:8},children:e.jsx(j,{color:x==="Gold"?"gold":x==="Silver"?"default":"orange",style:{fontSize:14,fontWeight:"bold"},children:x})})]}):e.jsx(s,{type:"secondary",children:"No badge yet"})]})})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsx(m,{children:e.jsxs("div",{children:[e.jsx(s,{type:"secondary",style:{display:"block",marginBottom:8},children:"Badge Requirements"}),e.jsxs(a,{direction:"vertical",size:4,style:{width:"100%"},children:[e.jsx("div",{children:e.jsxs(s,{style:{fontSize:11},children:[e.jsx(C,{style:{color:p.Gold}})," Gold: 4.5+ (3+ ratings)"]})}),e.jsx("div",{children:e.jsxs(s,{style:{fontSize:11},children:[e.jsx(C,{style:{color:p.Silver}})," Silver: 3.5+ (3+ ratings)"]})}),e.jsx("div",{children:e.jsxs(s,{style:{fontSize:11},children:[e.jsx(C,{style:{color:p.Bronze}})," Bronze: 2.5+ (3+ ratings)"]})})]})]})})})]}),z>0&&e.jsx(m,{title:"Performance Breakdown",style:{marginBottom:16},children:e.jsxs(u,{gutter:[16,16],children:[e.jsx(t,{xs:24,sm:12,md:6,children:e.jsxs("div",{children:[e.jsxs(a,{style:{marginBottom:8},children:[e.jsx(re,{style:{color:"#1890ff"}}),e.jsx(s,{strong:!0,children:"Delivery Time"})]}),e.jsx(b,{percent:n.deliveryTime/5*100,format:()=>`${n.deliveryTime}/5`,strokeColor:"#1890ff"})]})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsxs("div",{children:[e.jsxs(a,{style:{marginBottom:8},children:[e.jsx(le,{style:{color:"#52c41a"}}),e.jsx(s,{strong:!0,children:"Quality"})]}),e.jsx(b,{percent:n.quality/5*100,format:()=>`${n.quality}/5`,strokeColor:"#52c41a"})]})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsxs("div",{children:[e.jsxs(a,{style:{marginBottom:8},children:[e.jsx(te,{style:{color:"#faad14"}}),e.jsx(s,{strong:!0,children:"Pricing"})]}),e.jsx(b,{percent:n.pricing/5*100,format:()=>`${n.pricing}/5`,strokeColor:"#faad14"})]})}),e.jsx(t,{xs:24,sm:12,md:6,children:e.jsxs("div",{children:[e.jsxs(a,{style:{marginBottom:8},children:[e.jsx(N,{style:{color:"#722ed1"}}),e.jsx(s,{strong:!0,children:"Communication"})]}),e.jsx(b,{percent:n.communication/5*100,format:()=>`${n.communication}/5`,strokeColor:"#722ed1"})]})})]})}),e.jsx(m,{title:"Rating History",children:O.length===0?e.jsx(F,{description:"No ratings yet. Be the first to rate this vendor!"}):e.jsx(se,{dataSource:O,columns:Q,rowKey:"_id",size:"small",pagination:!1})}),e.jsx(ie,{title:"Rate Vendor Performance",open:E,onCancel:()=>{g(!1),w.resetFields()},footer:null,width:600,children:e.jsxs(i,{form:w,layout:"vertical",onFinish:L,children:[e.jsx(xe,{type:"secondary",children:"Rate the vendor on a scale of 1 (poor) to 5 (excellent) for each criterion."}),e.jsxs(u,{gutter:16,children:[e.jsx(t,{span:12,children:e.jsx(i.Item,{label:"Delivery Time",name:"deliveryTime",rules:[{required:!0,message:"Required"},{type:"number",min:1,max:5,message:"Must be between 1-5"}],children:e.jsx(v,{min:1,max:5,style:{width:"100%"},placeholder:"1-5"})})}),e.jsx(t,{span:12,children:e.jsx(i.Item,{label:"Quality",name:"quality",rules:[{required:!0,message:"Required"},{type:"number",min:1,max:5,message:"Must be between 1-5"}],children:e.jsx(v,{min:1,max:5,style:{width:"100%"},placeholder:"1-5"})})})]}),e.jsxs(u,{gutter:16,children:[e.jsx(t,{span:12,children:e.jsx(i.Item,{label:"Pricing",name:"pricing",rules:[{required:!0,message:"Required"},{type:"number",min:1,max:5,message:"Must be between 1-5"}],children:e.jsx(v,{min:1,max:5,style:{width:"100%"},placeholder:"1-5"})})}),e.jsx(t,{span:12,children:e.jsx(i.Item,{label:"Communication",name:"communication",rules:[{required:!0,message:"Required"},{type:"number",min:1,max:5,message:"Must be between 1-5"}],children:e.jsx(v,{min:1,max:5,style:{width:"100%"},placeholder:"1-5"})})})]}),e.jsx(i.Item,{label:"Notes (optional)",name:"notes",children:e.jsx(D.TextArea,{rows:3,placeholder:"Any additional comments..."})}),e.jsx(i.Item,{label:"Related Order (optional)",name:"relatedOrder",children:e.jsx(D,{placeholder:"PO number or reference"})}),e.jsx(i.Item,{children:e.jsxs(a,{children:[e.jsx(S,{type:"primary",htmlType:"submit",loading:V,children:"Submit Rating"}),e.jsx(S,{onClick:()=>g(!1),children:"Cancel"})]})})]})})]})}export{qe as default};
