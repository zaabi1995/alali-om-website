import{m as A,n as S,u as $,r as i,j as t,o as D,P as I}from"./index-qzPW9k5C.js";import{aH as E,aK as U,ai as _,an as L,aB as P,aC as T,aJ as C,aI as B}from"./IdurarOs-DNtyhAIr.js";import"./index-9ffFpET3.js";import{e as M,s as R,E as F}from"./selectors-BD2Dkjal.js";import{e as y}from"./actions-kMjkKMv8.js";import{P as k}from"./index-CvZUhI5z.js";import{s as N}from"./index-KrFx5yLV.js";import{u as v}from"./useMoney-CtWfgrH_.js";import{b as Y}from"./ErpApp-C6krObaP.js";import{d as H}from"./dayjs.min-IeqEFdrM.js";import{c as f}from"./calculate-CoT1A6Sl.js";import{P as O}from"./PaymentForm-CtlyKRS5.js";import{D as c}from"./index-DOLkIOS5.js";import{C as J}from"./CloseCircleOutlined-yCXO4uly.js";import"./index-tpPXjeXQ.js";import"./Breadcrumb-B1WYYhU3.js";import"./pickAttrs-HYIWXRHU.js";import"./DownOutlined-Cv0sD8Lj.js";import"./currency.es-9OAR_aOO.js";import"./index-BBXCin94.js";import"./useFetch-DunYkg8y.js";import"./color-CnuJOIlI.js";import"./index-B6mZ1Nih.js";import"./index-Bcrj0uk5.js";import"./index-BcmoYINL.js";import"./useClosable-D4tg0jNW.js";import"./useDate-CVNJWY79.js";import"./index-BCL6CBrr.js";import"./index-z8alQHp7.js";import"./ClockCircleOutlined-CBV0ymDz.js";function K({config:n,currentInvoice:s}){const a=L(),r=A();let{entity:m}=n;const o=S(),{isLoading:d,isSuccess:e}=$(M),[p]=E.useForm(),[h,g]=i.useState(0);i.useEffect(()=>{if(s){const{credit:l,total:u,discount:x,amount:w}=s;g(f.sub(f.sub(u,x),f.sub(f.sub(l,w))));const j={...s};j.date&&(j.date=H(j.date)),p.setFieldsValue(j)}},[s]),i.useEffect(()=>{e&&(p.resetFields(),o(y.resetAction({actionType:"recordPayment"})),o(y.list({entity:m})),r(`/${m.toLowerCase()}/read/${s._id}`))},[e]);const b=l=>{if(s){const{_id:u}=s,x=s.client&&s.client._id;l={...l,invoice:u,client:x}}o(y.update({entity:m,id:s._id,jsonData:l}))};return t.jsx(t.Fragment,{children:t.jsx(U,{isLoading:d,children:t.jsxs(E,{form:p,layout:"vertical",onFinish:b,children:[t.jsx(O,{maxAmount:h}),t.jsx(E.Item,{children:t.jsx(_,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function W({config:n,currentItem:s}){const a=L(),{entity:r,ENTITY_NAME:m}=n,o=v(),d=A(),[e,p]=i.useState(s);i.useEffect(()=>{const b=new AbortController;if(s){const{invoice:l,_id:u,...x}=s;p({...x,...l,_id:u})}return()=>b.abort()},[s]);const[h,g]=i.useState({});return i.useEffect(()=>{e!=null&&e.client&&g(e.client)},[e]),t.jsxs(t.Fragment,{children:[t.jsx(P,{gutter:[12,12],children:t.jsxs(T,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[t.jsx(k,{onBack:()=>d(`/${r.toLowerCase()}`),title:`Update  ${m} # ${e.number}/${e.year||""}`,ghost:!1,tags:t.jsx("span",{children:e.paymentStatus}),extra:[t.jsx(_,{onClick:()=>{d(`/${r.toLowerCase()}`)},icon:t.jsx(J,{}),children:a("Cancel")},`${N.generate()}`),t.jsx(_,{onClick:()=>d(`/invoice/read/${e._id}`),icon:t.jsx(Y,{}),children:a("Show invoice")},`${N.generate()}`)],style:{padding:"20px 0px"}}),t.jsx(C,{dashed:!0})]})}),t.jsxs(P,{gutter:[12,12],children:[t.jsxs(T,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[t.jsx("div",{className:"space50"}),t.jsxs(c,{title:`${a("Client")} : ${e.client.name}`,column:1,children:[t.jsx(c.Item,{label:a("email"),children:h.email}),t.jsx(c.Item,{label:a("Phone"),children:h.phone}),t.jsx(C,{dashed:!0}),t.jsx(c.Item,{label:a("Payment Status"),children:t.jsx("span",{children:e.paymentStatus})}),t.jsx(c.Item,{label:a("SubTotal"),children:o.moneyFormatter({amount:e.subTotal,currency_code:e.currency})}),t.jsx(c.Item,{label:a("Total"),children:o.moneyFormatter({amount:e.total,currency_code:e.currency})}),t.jsx(c.Item,{label:"Discount",children:o.moneyFormatter({amount:e.discount,currency_code:e.currency})}),t.jsx(c.Item,{label:"Balance",children:o.moneyFormatter({amount:e.credit,currency_code:e.currency})})]})]}),t.jsx(T,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:t.jsx(K,{config:n,currentInvoice:e})})]})]})}function q({config:n}){const s=S(),{id:a}=D();i.useLayoutEffect(()=>{s(y.read({entity:n.entity,id:a}))},[a]);const{result:r,isSuccess:m,isLoading:o=!0}=$(R);return i.useLayoutEffect(()=>{r&&s(y.currentAction({actionType:"update",id:a,data:r}))},[r]),o?t.jsx(F,{children:t.jsx(I,{})}):t.jsx(F,{children:m?t.jsx(W,{config:n,currentItem:r}):t.jsx(B,{entity:n.entity})})}function Lt(){const n=L(),s="payment",a={PANEL_TITLE:n("payment"),DATATABLE_TITLE:n("payment_list"),ADD_NEW_ENTITY:n("add_new_payment"),ENTITY_NAME:n("payment")},r={entity:s,...a};return t.jsx(q,{config:r})}export{Lt as default};
