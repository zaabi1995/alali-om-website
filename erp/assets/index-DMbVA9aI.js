import{r as i,j as t}from"./index-BJn_oD1P.js";import{d as c}from"./dayjs.min-DKvTBr6F.js";import{r as f}from"./relativeTime-DfjJhc7-.js";import{aB as x,aY as j,aV as S,ac as w}from"./IdurarOs-B9KFkIUP.js";import{l as I,f as T,T as z}from"./ErpApp-D8KMIIKs.js";import{F as C}from"./Table-BxS9KpKR.js";import{R}from"./ReloadOutlined-pdxDWj3s.js";c.extend(f);const{Title:A,Text:n}=j;function O(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const _={create:"green",update:"blue",delete:"red",view:"default",login:"cyan",email_sent:"purple",pdf_generated:"orange",status_change:"gold"},E=["Quote","Invoice","PurchaseOrder","DeliveryNote","CreditNote","Payment","Rfq","InventoryItem","Opportunity"];function U(){const[s,y]=i.useState([]),[r,p]=i.useState(!1),[u,m]=i.useState({page:1,count:0}),[o,g]=i.useState(""),l=async(e=1)=>{p(!0);const a=new URLSearchParams({page:e,items:50});o&&a.set("entity",o);try{const d=await(await fetch(S+`auditlog/list?${a}`,{headers:O()})).json();d.success&&(y(d.result),m(d.pagination||{}))}finally{p(!1)}};i.useEffect(()=>{l(1)},[o]);const h=[{title:"Time",dataIndex:"created",width:150,render:e=>t.jsx(w,{title:c(e).format("DD MMM YYYY HH:mm:ss"),children:t.jsx(n,{style:{fontSize:11},children:c(e).fromNow()})})},{title:"User",dataIndex:["user","email"],width:180,ellipsis:!0,render:(e,a)=>t.jsx(n,{style:{fontSize:11},children:e||a.userEmail||"â€”"})},{title:"Action",dataIndex:"action",width:110,render:e=>t.jsx(z,{color:_[e]||"default",style:{fontSize:10},children:e==null?void 0:e.toUpperCase().replace("_"," ")})},{title:"Entity",dataIndex:"entity",width:120,render:(e,a)=>t.jsxs("span",{children:[t.jsx(n,{strong:!0,style:{fontSize:11},children:e}),a.entityRef&&t.jsxs(n,{type:"secondary",style:{fontSize:10},children:[" #",a.entityRef]})]})},{title:"Description",dataIndex:"description",ellipsis:!0,render:e=>t.jsx(n,{style:{fontSize:11},children:e||"â€”"})},{title:"IP",dataIndex:"ip",width:110,render:e=>t.jsx(n,{type:"secondary",style:{fontSize:10},children:e||"â€”"})}];return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(A,{level:4,style:{margin:0,color:"#034D57"},children:"Audit Log"}),t.jsx(x,{icon:t.jsx(R,{}),onClick:()=>l(1),loading:r,children:"Refresh"})]}),t.jsx(I,{style:{marginBottom:14},wrap:!0,children:t.jsx(T,{placeholder:"Filter by entity",allowClear:!0,style:{width:180},onChange:e=>g(e||""),options:E.map(e=>({value:e,label:e}))})}),s.length===0&&!r&&t.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#aaa"},children:[t.jsx("div",{style:{fontSize:40},children:"ðŸ“‹"}),t.jsx("div",{style:{marginTop:8},children:"No audit logs yet."}),t.jsx("div",{style:{fontSize:12,marginTop:4},children:"Actions like creating, updating, and deleting records will appear here."})]}),(s.length>0||r)&&t.jsx(C,{columns:h,dataSource:s,rowKey:"_id",loading:r,size:"small",pagination:{current:u.page,total:u.count,pageSize:50,onChange:e=>l(e)}})]})}export{U as default};
