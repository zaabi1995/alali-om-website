import{r as l,j as e}from"./index-BolfsKLq.js";import{X as I,b as B,ar as M,az as p,ak as O}from"./IdurarOs-ImGZrK6V.js";import{X as m,m as v,A as D,Y as i,U as H,V as N,Z as J,_ as P,T as $}from"./ErpApp-CPyzesRl.js";import{C as k}from"./index-B1-0owN0.js";import{T as g}from"./index-HROpVfrd.js";import{F}from"./Table-DwPC3CMf.js";import{S as U}from"./index-B4i0fLDO.js";import{s as C}from"./index-Bcg4oSX2.js";import"./Skeleton-D8BNZGpQ.js";import"./index-SyqhotZh.js";import"./PlusOutlined-CXeZI9c1.js";import"./useClosable-B9lNjp8n.js";import"./pickAttrs-rA9L7BI5.js";import"./DownOutlined-CA7fmMYD.js";import"./Pagination-xSPnpsLs.js";var W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zm-126 534.1H250.3l-53.8-409.4 139.8 86.1L512 252.9l175.7 234.4 139.8-86.1-53.9 409.4zM512 509c-62.1 0-112.6 50.5-112.6 112.6S449.9 734.2 512 734.2s112.6-50.5 112.6-112.6S574.1 509 512 509zm0 160.9c-26.6 0-48.2-21.6-48.2-48.3 0-26.6 21.6-48.3 48.2-48.3s48.2 21.6 48.2 48.3c0 26.6-21.6 48.3-48.2 48.3z"}}]},name:"crown",theme:"outlined"},Y=function(o,u){return l.createElement(I,B({},o,{ref:u,icon:W}))};const V=l.forwardRef(Y),{Title:X,Text:d}=M;function y(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function G(){return{...y(),"Content-Type":"application/json"}}const x={owner:e.jsx(V,{}),admin:e.jsx(H,{}),gm:e.jsx(N,{}),manager:e.jsx(J,{}),sales:e.jsx(P,{}),staff:e.jsx($,{})};function K(){var c,o;try{return((o=(c=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:c.current)==null?void 0:o.role)||"staff"}catch{return"staff"}}const b=["owner","admin","gm","manager","sales","staff"];function ue(){const[c,o]=l.useState([]),[u,j]=l.useState(!1),[n,L]=l.useState(null),R=K(),f=m[R]??1,S=f>=m.admin,w=async()=>{j(!0);const[t,s]=await Promise.all([fetch(p+"users/list",{headers:y()}).then(a=>a.json()).catch(()=>({})),fetch(p+"users/me",{headers:y()}).then(a=>a.json()).catch(()=>({}))]);t.success&&o(t.result||[]),s.success&&L(s.result),j(!1)};l.useEffect(()=>{w()},[]);const _=async(t,s)=>{const a=await fetch(p+`users/update-role/${t}`,{method:"PATCH",headers:G(),body:JSON.stringify({role:s})}).then(h=>h.json()).catch(()=>({}));a.success?(C.success(a.message),w()):C.error(a.message||"Failed to update role")},z=[{title:"User",key:"user",render:(t,s)=>e.jsxs(v,{children:[e.jsx(D,{style:{background:"#034D57"},icon:e.jsx(O,{})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:600},children:[s.name," ",s.surname||"",(n==null?void 0:n._id)===s._id&&e.jsx(g,{color:"blue",style:{fontSize:10,marginLeft:6},children:"You"})]}),e.jsx(d,{type:"secondary",style:{fontSize:12},children:s.email})]})]})},{title:"Role",dataIndex:"role",width:220,render:(t,s)=>{const a=i[t]||i.staff,h=x[t]||e.jsx(O,{}),E=(n==null?void 0:n._id)===s._id,T=m[t]??1;if(!S||E||T>=f)return e.jsx(g,{color:a.color,icon:h,children:a.label});const A=b.filter(r=>m[r]<f);return e.jsx(U,{value:t||"staff",style:{width:150},onChange:r=>_(s._id,r),options:A.map(r=>({value:r,label:e.jsxs(v,{size:4,children:[x[r],e.jsx("span",{children:i[r].label})]})}))})}},{title:"Access Level",dataIndex:"role",width:300,render:t=>{const s=i[t]||i.staff;return e.jsx("div",{children:e.jsx(d,{style:{fontSize:12},children:s.desc})})}},{title:"Member Since",dataIndex:"created",width:120,render:t=>t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"â€”"}];return e.jsxs("div",{style:{padding:24,maxWidth:900},children:[e.jsx(X,{level:4,style:{margin:"0 0 4px",color:"#034D57"},children:"User Management"}),e.jsx(d,{type:"secondary",style:{display:"block",marginBottom:20},children:S?"Manage user roles. You can only assign roles below your own level.":"Contact an Admin or Owner to change user roles."}),e.jsxs(k,{size:"small",style:{marginBottom:20,background:"#f8fffe",borderColor:"#e6f7f5"},children:[e.jsx(d,{strong:!0,style:{display:"block",marginBottom:10,color:"#034D57"},children:"Role Permissions"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px 24px"},children:b.map(t=>{const s=i[t],a=x[t];return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(g,{color:s.color,icon:a,style:{margin:0,minWidth:70,textAlign:"center"},children:s.label}),e.jsx(d,{type:"secondary",style:{fontSize:11,lineHeight:"22px"},children:s.desc})]},t)})})]}),e.jsx(F,{columns:z,dataSource:c,rowKey:"_id",loading:u,size:"small",pagination:!1,rowClassName:t=>(n==null?void 0:n._id)===t._id?"row-highlight":""})]})}export{ue as default};
