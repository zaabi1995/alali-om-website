import{m as O,o as P,r as d,j as e}from"./index-BlXZDDd6.js";import{b as _}from"./omrFormat-BrmZ7tIx.js";import{d as S}from"./dayjs.min-CmLActg2.js";import{aH as s,az as n,ai as m,aB as T,aC as a,aE as j,ar as N}from"./IdurarOs-BD-puWxc.js";import{C as B}from"./index-Bd4wIeuI.js";import{S as p}from"./index-C3d3OXV3.js";import{D as y}from"./index-DD3NNLcM.js";import{T as E}from"./index-BqYPm3Xa.js";import{m as k}from"./ErpApp-BNfFHiJr.js";import{s as h}from"./index-9vxUZZ6M.js";import{A as R}from"./ArrowLeftOutlined-nATEGIfu.js";import{S as F}from"./SaveOutlined-CEs6w7Il.js";import"./Skeleton-CgIf7azr.js";import"./index-DkDPoTe-.js";import"./PlusOutlined-MDLlbw4k.js";import"./pickAttrs-DEwbeKAF.js";import"./DownOutlined-CxVHLUQB.js";import"./ClockCircleOutlined-C51Sj0Fz.js";const{Title:$}=N,{TextArea:b}=j;function z(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}function C(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const H=["defense","aviation","oil_gas","construction","renewable_energy","marine","logistics","health_safety","printing","other"];function le(){const i=O(),{id:o}=P(),[u]=s.useForm(),[D,w]=d.useState([]),[I,x]=d.useState(!1);d.useEffect(()=>{fetch(n+"client/listAll",{headers:C()}).then(t=>t.json()).then(t=>t.result&&w(t.result)).catch(()=>{}),o&&fetch(n+`project/read/${o}`,{headers:C()}).then(t=>t.json()).then(t=>{var r;if(t.success&&t.result){const l=t.result;u.setFieldsValue({...l,startDate:l.startDate?S(l.startDate):null,endDate:l.endDate?S(l.endDate):null,client:((r=l.client)==null?void 0:r._id)||l.client})}}).catch(()=>{})},[o]);const v=async t=>{var f,g;x(!0);const r={...t,startDate:(f=t.startDate)==null?void 0:f.toISOString(),endDate:(g=t.endDate)==null?void 0:g.toISOString()},l=o?n+`project/update/${o}`:n+"project/create";try{const c=await fetch(l,{method:o?"PATCH":"POST",headers:z(),body:JSON.stringify(r)}).then(A=>A.json());c.success?(h.success("Saved"),i(`/projects/read/${c.result._id}`)):h.error(c.message||"Failed")}catch{h.error("Network error")}finally{x(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:760},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(m,{icon:e.jsx(R,{}),onClick:()=>i("/projects")}),e.jsx($,{level:4,style:{margin:0,color:"#034D57"},children:o?"Edit Project":"New Project"})]}),e.jsxs(s,{form:u,layout:"vertical",onFinish:v,children:[e.jsx(B,{title:"Project Details",size:"small",style:{marginBottom:16},children:e.jsxs(T,{gutter:16,children:[e.jsx(a,{xs:24,sm:8,children:e.jsx(s.Item,{name:"code",label:"Project Code",children:e.jsx(j,{placeholder:"e.g. RAFO-2026-001"})})}),e.jsx(a,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Project Name",rules:[{required:!0}],children:e.jsx(j,{})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"client",label:"Client",children:e.jsx(p,{showSearch:!0,allowClear:!0,filterOption:(t,r)=>r.label.toLowerCase().includes(t.toLowerCase()),placeholder:"Select client",options:D.map(t=>({value:t._id,label:t.name}))})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"sector",label:"Sector",children:e.jsx(p,{placeholder:"Select sector",allowClear:!0,options:H.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"startDate",label:"Start Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"endDate",label:"End Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"budgetOMR",label:"Budget (OMR)",initialValue:0,children:e.jsx(E,{min:0,precision:3,style:{width:"100%"},addonAfter:_()})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"status",label:"Status",initialValue:"prospect",children:e.jsx(p,{options:["prospect","active","on_hold","completed","cancelled"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(b,{rows:3})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(b,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(k,{children:[e.jsx(m,{onClick:()=>i("/projects"),children:"Cancel"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:I,icon:e.jsx(F,{}),style:{background:"#034D57"},children:"Save Project"})]})})]})]})}export{le as default};
