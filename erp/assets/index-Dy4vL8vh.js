import{r as n,j as e}from"./index-qzPW9k5C.js";import{a as m,o as l}from"./omrFormat-BQCFoS4E.js";import{d as u}from"./dayjs.min-IeqEFdrM.js";import{X as B,b as M,az as g,ai as y,aN as P,aB as T,aC as h,ar as H}from"./IdurarOs-DNtyhAIr.js";import{C as x}from"./index-BT6S6B4u.js";import{m as F}from"./ErpApp-C6krObaP.js";import{S as O}from"./index-B6mZ1Nih.js";import{S as p}from"./index-ByIMSrJ7.js";import{F as i}from"./Table-BEwP-RQB.js";import{E as R}from"./index-Bcrj0uk5.js";import{D as k}from"./index-z8alQHp7.js";import{T as A}from"./index-BcmoYINL.js";import"./Skeleton-r7dioW59.js";import"./index-C5J7yocW.js";import"./PlusOutlined-BhF-bFT8.js";import"./pickAttrs-HYIWXRHU.js";import"./DownOutlined-Cv0sD8Lj.js";import"./Pagination-DLTxefs_.js";import"./ClockCircleOutlined-CBV0ymDz.js";import"./useClosable-D4tg0jNW.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},E=function(d,s){return n.createElement(B,M({},d,{ref:s,icon:V}))};const _=n.forwardRef(E),{Title:L,Text:$}=H,{RangePicker:U}=k;function C(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function me(){var S;const[f,d]=n.useState([]),[s,v]=n.useState(null),[a,b]=n.useState(null),[Y,j]=n.useState(!1),[o,w]=n.useState([null,null]);n.useEffect(()=>{fetch(g+"client/listAll",{headers:C()}).then(t=>t.json()).then(t=>t.result&&d(t.result)).catch(()=>{})},[]);const D=async()=>{if(!s)return;j(!0);const t=new URLSearchParams;o[0]&&t.set("from",o[0].format("YYYY-MM-DD")),o[1]&&t.set("to",o[1].format("YYYY-MM-DD"));const r=await fetch(g+`reports/customer-statement/${s}?${t}`,{headers:C()}).then(c=>c.json()).catch(()=>({}));r.success&&b(r.result),j(!1)},I={paid:"green",partial:"orange",unpaid:"red",overdue:"volcano"},z=[{title:"Date",dataIndex:"date",width:110,render:t=>u(t).format("DD MMM YYYY")},{title:"Invoice",dataIndex:"number",width:110,render:(t,r)=>e.jsxs("b",{children:["INV-",t,"/",r.year]})},{title:"Total",dataIndex:"total",align:"right",render:t=>l(t)},{title:"Paid",dataIndex:"credit",align:"right",render:t=>e.jsx("span",{style:{color:"#4CB480"},children:l(t||0)})},{title:"Balance",align:"right",render:(t,r)=>{const c=(r.total||0)-(r.credit||0);return e.jsx("b",{style:{color:c>0?"#e53e3e":"#4CB480"},children:l(c)})}},{title:"Due Date",dataIndex:"expiredDate",width:110,render:t=>t?u(t).format("DD MMM YYYY"):"—"},{title:"Status",dataIndex:"paymentStatus",width:90,render:t=>e.jsx(A,{color:I[t],children:t==null?void 0:t.toUpperCase()})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx(L,{level:4,style:{margin:0,color:"#034D57"},children:"Customer Statement"}),a&&e.jsx(y,{icon:e.jsx(_,{}),onClick:()=>window.print(),children:"Print"})]}),e.jsx(x,{size:"small",style:{marginBottom:20},children:e.jsxs(F,{wrap:!0,children:[e.jsx(O,{showSearch:!0,placeholder:"Select customer",style:{minWidth:260},onChange:t=>v(t),filterOption:(t,r)=>r.label.toLowerCase().includes(t.toLowerCase()),options:f.map(t=>({value:t._id,label:t.name}))}),e.jsx(U,{onChange:t=>w(t||[null,null]),style:{width:240}}),e.jsx(y,{type:"primary",icon:e.jsx(P,{}),onClick:D,loading:Y,style:{background:"#034D57"},disabled:!s,children:"Generate"})]})}),a?e.jsxs(e.Fragment,{children:[e.jsx(x,{title:e.jsxs(e.Fragment,{children:[e.jsx("b",{children:(S=a.client)==null?void 0:S.name})," — Account Statement"]}),size:"small",style:{marginBottom:16},extra:e.jsxs($,{type:"secondary",style:{fontSize:12},children:["Generated ",u().format("DD MMM YYYY HH:mm")]}),children:e.jsxs(T,{gutter:12,children:[e.jsx(h,{xs:8,children:e.jsx(p,{title:"Total Invoiced",value:parseFloat(a.totalInvoiced||0).toFixed(3),suffix:m(),valueStyle:{color:"#034D57",fontSize:16}})}),e.jsx(h,{xs:8,children:e.jsx(p,{title:"Total Paid",value:parseFloat(a.totalPaid||0).toFixed(3),suffix:m(),valueStyle:{color:"#4CB480",fontSize:16}})}),e.jsx(h,{xs:8,children:e.jsx(p,{title:"Outstanding Balance",value:parseFloat(a.balance||0).toFixed(3),suffix:m(),valueStyle:{color:a.balance>0?"#e53e3e":"#4CB480",fontSize:16,fontWeight:700}})})]})}),e.jsx(i,{columns:z,dataSource:a.invoices||[],rowKey:"_id",size:"small",pagination:{pageSize:20},summary:()=>e.jsxs(i.Summary.Row,{style:{background:"#f5f5f5"},children:[e.jsx(i.Summary.Cell,{colSpan:2,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(i.Summary.Cell,{align:"right",children:e.jsx("b",{children:l(a.totalInvoiced||0)})}),e.jsx(i.Summary.Cell,{align:"right",children:e.jsx("b",{style:{color:"#4CB480"},children:l(a.totalPaid||0)})}),e.jsx(i.Summary.Cell,{align:"right",children:e.jsx("b",{style:{color:"#e53e3e"},children:l(a.balance||0)})}),e.jsx(i.Summary.Cell,{colSpan:2})]})})]}):e.jsx(x,{children:e.jsx(R,{description:"Select a customer and click Generate"})})]})}export{me as default};
