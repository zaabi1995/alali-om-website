import{m as L,n as N,u as I,r as o,j as e,o as A,P as S}from"./index-BcNLKCvS.js";import{aH as g,aK as F,ai as b,an as P,aB as T,aC as E,aJ as _}from"./IdurarOs-Bnu_4kQ9.js";import"./index-CDUiWTe0.js";import{a as R,b as $,c as w,E as D}from"./selectors-BqxAYfPJ.js";import{e as p}from"./actions-OHq3viq2.js";import{P as B}from"./index-CHz7X7MQ.js";import{s as v}from"./index-KrFx5yLV.js";import{u as M}from"./useMoney--idTMigE.js";import{b as Y}from"./ErpApp-Dinm6x2K.js";import{P as k}from"./PaymentForm-BG4s_Uiq.js";import{c as C}from"./calculate-CoT1A6Sl.js";import{D as m}from"./index-BJdx4Rla.js";import{C as O}from"./CloseCircleOutlined-ukgCJgyn.js";import"./index-DEczwmC5.js";import"./dayjs.min-F-PWr_1l.js";import"./Breadcrumb-D-sx2mTz.js";import"./pickAttrs-6YJIpkjS.js";import"./DownOutlined-DFIgJ0J3.js";import"./currency.es-9OAR_aOO.js";import"./index-Dlw7zWyc.js";import"./useFetch-BeMSoi7g.js";import"./color-CnuJOIlI.js";import"./index-CHNYwYGg.js";import"./index-BnGaNyE7.js";import"./useClosable-DMcKrkSm.js";import"./useDate-DCaGA6cU.js";import"./index-Dez4e4gY.js";import"./index-DjixF4la.js";import"./ClockCircleOutlined-CihWjdKe.js";function H({config:a}){const r=L(),s=P();let{entity:n}=a;const i=N(),{isLoading:d,isSuccess:u,current:c}=I(R),[h]=g.useForm(),[t,f]=o.useState(0);o.useEffect(()=>{if(c){const{credit:l,total:x,discount:y}=c;f(C.sub(C.sub(x,y),l))}},[c]),o.useEffect(()=>{u&&(h.resetFields(),i(p.resetAction({actionType:"recordPayment"})),i(p.list({entity:n})),r(`/${n}/`))},[u]);const j=l=>{if(c){const{_id:x}=c,y=c.client&&c.client._id;l={...l,invoice:x,client:y}}i(p.recordPayment({entity:"payment",jsonData:l}))};return e.jsx(F,{isLoading:d,children:e.jsxs(g,{form:h,layout:"vertical",onFinish:j,children:[e.jsx(k,{maxAmount:t}),e.jsx(g.Item,{children:e.jsx(b,{type:"primary",htmlType:"submit",children:s("Record Payment")})})]})})}function J({config:a,currentItem:r}){const s=P(),{entity:n,ENTITY_NAME:i}=a,d=M(),u=L(),[c,h]=o.useState([]),[t,f]=o.useState(r),[j,l]=o.useState({});return o.useEffect(()=>{t!=null&&t.client&&l(t.client)},[t]),o.useEffect(()=>{const x=new AbortController;if(r){const{items:y}=r;h(y),f(r)}return()=>x.abort()},[r]),e.jsxs(e.Fragment,{children:[e.jsx(T,{gutter:[12,12],children:e.jsxs(E,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(B,{onBack:()=>u(`/${n.toLowerCase()}`),title:`Record Payment for ${i} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx("span",{children:t.paymentStatus&&s(t.paymentStatus)}),extra:[e.jsx(b,{onClick:()=>{u(`/${n.toLowerCase()}`)},icon:e.jsx(O,{}),children:s("Cancel")},`${v.generate()}`),e.jsx(b,{onClick:()=>u(`/invoice/read/${t._id}`),icon:e.jsx(Y,{}),children:s("Show Invoice")},`${v.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(_,{dashed:!0})]})}),e.jsxs(T,{gutter:[12,12],children:[e.jsxs(E,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(m,{title:`${s("Client")}  : ${t.client.name}`,column:1,children:[e.jsx(m.Item,{label:s("email"),children:j.email}),e.jsx(m.Item,{label:s("phone"),children:j.phone}),e.jsx(_,{dashed:!0}),e.jsx(m.Item,{label:s("payment status"),children:e.jsx("span",{children:t.paymentStatus&&s(t.paymentStatus)})}),e.jsx(m.Item,{label:s("sub total"),children:d.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(m.Item,{label:s("total"),children:d.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(m.Item,{label:s("discount"),children:d.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(m.Item,{label:s("Paid"),children:d.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(E,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(H,{config:a})})]})]})}function K({config:a}){const r=N(),{id:s}=A();let n=I($(s));o.useEffect(()=>{r(n?p.currentItem({data:n}):p.read({entity:a.entity,id:s}))},[n,s]);const{result:i}=I(w);return n=i,o.useEffect(()=>{r(p.currentAction({actionType:"recordPayment",data:n}))},[n]),e.jsx(D,{children:n?e.jsx(J,{config:a,currentItem:i}):e.jsx(S,{})})}function Ee(){const a="invoice",r=P(),s={PANEL_TITLE:r("invoice"),DATATABLE_TITLE:r("invoice_list"),ADD_NEW_ENTITY:r("add_new_invoice"),ENTITY_NAME:r("invoice"),RECORD_ENTITY:r("record_payment")},n={entity:a,...s};return e.jsx(K,{config:n})}export{Ee as default};
