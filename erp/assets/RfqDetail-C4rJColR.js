import{r as a,o as re,m as se,j as n}from"./index-ZLb2J4fw.js";import{j as ie,r as ae,k as T,a as le,c as H,V as ce,ch as de,aE as ue,c0 as me,c1 as pe,b$ as ge,b_ as he,N as fe,Q as ye,S as xe,ci as P,cj as Ce,ck as be,X as _,b as L,ax as E,aB as je,az as D,aA as S,ai as $,aH as Se,aq as ve}from"./IdurarOs-SjSzUutW.js";import{p as we}from"./pickAttrs-CkwYu8bF.js";import{B as $e}from"./Breadcrumb-k5_ZxNGk.js";import{C as z}from"./index-D5kGrzlF.js";import{n as M}from"./ErpApp-CpB8_dmX.js";import{T as I}from"./index-o-9Ji_Rd.js";import{D as j}from"./index-CeJLX_Es.js";import{F as Ie}from"./Table-DPzjT9ig.js";import{s as B}from"./index-D0djhh2G.js";import{A as ze}from"./ArrowLeftOutlined-CT2uJls2.js";import{C as Ne}from"./CheckCircleOutlined-B1afZ3jQ.js";import{C as Oe}from"./CloseCircleOutlined-CxXxJxFd.js";import"./DownOutlined-D1AlrGPB.js";import"./Skeleton-Wg1VX6xv.js";import"./index-CT8M6ocs.js";import"./PlusOutlined-CiY77jmX.js";import"./useClosable-DmprPeQo.js";import"./index-CX34Vwxd.js";const N=(o,t,e,r,s)=>({background:o,border:`${T(r.lineWidth)} ${r.lineType} ${t}`,[`${s}-icon`]:{color:e}}),Ee=o=>{const{componentCls:t,motionDurationSlow:e,marginXS:r,marginSM:s,fontSize:c,fontSizeLG:p,lineHeight:d,borderRadiusLG:h,motionEaseInOutCirc:u,withDescriptionIconSize:f,colorText:C,colorTextHeading:y,withDescriptionPadding:g,defaultPadding:i}=o;return{[t]:Object.assign(Object.assign({},ae(o)),{position:"relative",display:"flex",alignItems:"center",padding:i,wordWrap:"break-word",borderRadius:h,[`&${t}-rtl`]:{direction:"rtl"},[`${t}-content`]:{flex:1,minWidth:0},[`${t}-icon`]:{marginInlineEnd:r,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:d},"&-message":{color:y},[`&${t}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${e} ${u}, opacity ${e} ${u},
        padding-top ${e} ${u}, padding-bottom ${e} ${u},
        margin-bottom ${e} ${u}`},[`&${t}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${t}-with-description`]:{alignItems:"flex-start",padding:g,[`${t}-icon`]:{marginInlineEnd:s,fontSize:f,lineHeight:0},[`${t}-message`]:{display:"block",marginBottom:r,color:y,fontSize:p},[`${t}-description`]:{display:"block",color:C}},[`${t}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},De=o=>{const{componentCls:t,colorSuccess:e,colorSuccessBorder:r,colorSuccessBg:s,colorWarning:c,colorWarningBorder:p,colorWarningBg:d,colorError:h,colorErrorBorder:u,colorErrorBg:f,colorInfo:C,colorInfoBorder:y,colorInfoBg:g}=o;return{[t]:{"&-success":N(s,r,e,o,t),"&-info":N(g,y,C,o,t),"&-warning":N(d,p,c,o,t),"&-error":Object.assign(Object.assign({},N(f,u,h,o,t)),{[`${t}-description > pre`]:{margin:0,padding:0}})}}},Be=o=>{const{componentCls:t,iconCls:e,motionDurationMid:r,marginXS:s,fontSizeIcon:c,colorIcon:p,colorIconHover:d}=o;return{[t]:{"&-action":{marginInlineStart:s},[`${t}-close-icon`]:{marginInlineStart:s,padding:0,overflow:"hidden",fontSize:c,lineHeight:T(c),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${e}-close`]:{color:p,transition:`color ${r}`,"&:hover":{color:d}}},"&-close-text":{color:p,transition:`color ${r}`,"&:hover":{color:d}}}}},ke=o=>({withDescriptionIconSize:o.fontSizeHeading3,defaultPadding:`${o.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${o.paddingMD}px ${o.paddingContentHorizontalLG}px`}),Re=ie("Alert",o=>[Ee(o),De(o),Be(o)],ke);var He=function(o,t){var e={};for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&t.indexOf(r)<0&&(e[r]=o[r]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(o);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(o,r[s])&&(e[r[s]]=o[r[s]]);return e};const qe={success:me,info:pe,error:ge,warning:he},Ae=o=>{const{icon:t,prefixCls:e,type:r}=o,s=qe[r]||null;return t?de(t,a.createElement("span",{className:`${e}-icon`},t),()=>({className:H(`${e}-icon`,{[t.props.className]:t.props.className})})):a.createElement(s,{className:`${e}-icon`})},Fe=o=>{const{isClosable:t,prefixCls:e,closeIcon:r,handleClose:s}=o,c=r===!0||r===void 0?a.createElement(ue,null):r;return t?a.createElement("button",{type:"button",onClick:s,className:`${e}-close-icon`,tabIndex:0},c):null},Q=o=>{const{description:t,prefixCls:e,message:r,banner:s,className:c,rootClassName:p,style:d,onMouseEnter:h,onMouseLeave:u,onClick:f,afterClose:C,showIcon:y,closable:g,closeText:i,closeIcon:l,action:b}=o,O=He(o,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action"]),[q,W]=a.useState(!1),G=a.useRef(null),{getPrefixCls:X,direction:U,alert:x}=a.useContext(le),m=X("alert",e),[J,Y,K]=Re(m),Z=v=>{var w;W(!0),(w=o.onClose)===null||w===void 0||w.call(o,v)},A=a.useMemo(()=>o.type!==void 0?o.type:s?"warning":"info",[o.type,s]),ee=a.useMemo(()=>i?!0:typeof g=="boolean"?g:l!==!1&&l!==null&&l!==void 0,[i,l,g]),F=s&&y===void 0?!0:y,te=H(m,`${m}-${A}`,{[`${m}-with-description`]:!!t,[`${m}-no-icon`]:!F,[`${m}-banner`]:!!s,[`${m}-rtl`]:U==="rtl"},x==null?void 0:x.className,c,p,K,Y),ne=we(O,{aria:!0,data:!0});return J(a.createElement(ce,{visible:!q,motionName:`${m}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:v=>({maxHeight:v.offsetHeight}),onLeaveEnd:C},v=>{let{className:w,style:oe}=v;return a.createElement("div",Object.assign({ref:G,"data-show":!q,className:H(te,w),style:Object.assign(Object.assign(Object.assign({},x==null?void 0:x.style),d),oe),onMouseEnter:h,onMouseLeave:u,onClick:f,role:"alert"},ne),F?a.createElement(Ae,{description:t,icon:o.icon,prefixCls:m,type:A}):null,a.createElement("div",{className:`${m}-content`},r?a.createElement("div",{className:`${m}-message`},r):null,t?a.createElement("div",{className:`${m}-description`},t):null),b?a.createElement("div",{className:`${m}-action`},b):null,a.createElement(Fe,{isClosable:ee,prefixCls:m,closeIcon:i||(l??(x==null?void 0:x.closeIcon)),handleClose:Z}))}))};function Pe(o,t,e){return t=P(t),Ce(o,be()?Reflect.construct(t,e||[],P(o).constructor):t.apply(o,e))}let Me=function(o){fe(t,o);function t(){var e;return ye(this,t),e=Pe(this,t,arguments),e.state={error:void 0,info:{componentStack:""}},e}return xe(t,[{key:"componentDidCatch",value:function(r,s){this.setState({error:r,info:s})}},{key:"render",value:function(){const{message:r,description:s,children:c}=this.props,{error:p,info:d}=this.state,h=d&&d.componentStack?d.componentStack:null,u=typeof r>"u"?(p||"").toString():r,f=typeof s>"u"?h:s;return p?a.createElement(Q,{type:"error",message:u,description:a.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},f)}):c}}]),t}(a.Component);const V=Q;V.ErrorBoundary=Me;var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"},_e=function(t,e){return a.createElement(_,L({},t,{ref:e,icon:Te}))};const Le=a.forwardRef(_e);var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},Ve=function(t,e){return a.createElement(_,L({},t,{ref:e,icon:Qe}))};const We=a.forwardRef(Ve);function k(){var o,t;try{const e=(t=(o=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:o.current)==null?void 0:t.token;return e?{Authorization:`Bearer ${e}`}:{}}catch{return{}}}const{Title:Ge,Text:R}=ve,Xe={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},Ue={ior:"red",routine:"orange",normal:"default"};function ht(){var g;const{id:o}=re(),t=se(),[e,r]=a.useState(null),[s,c]=a.useState([]),[p,d]=a.useState(!0),[h,u]=a.useState(!1);a.useEffect(()=>{fetch(E+`rfq/withparts/${o}`,{headers:k()}).then(i=>i.json()).then(i=>{if(i.success){const{parts:l,...b}=i.result;r(b),c(l||[])}d(!1)})},[o]);const f=async()=>{u(!0);const l=await(await fetch(E+`rfq/generate-quote/${o}`,{method:"POST",headers:k()})).json();u(!1),l.success?(B.success(`Quote #${l.result.quoteNumber} created!`),setTimeout(()=>t(`/quote/read/${l.result.quoteId}`),800)):B.error(l.message||"Failed to generate quote")},C=async i=>{(await(await fetch(E+`rfq/update/${o}`,{method:"PATCH",headers:k(),body:JSON.stringify({status:i})})).json()).success&&(B.success("Status updated"),r(O=>({...O,status:i})))},y=[{title:"Part Number",dataIndex:"partNumber",key:"partNumber",width:140,render:i=>n.jsx(R,{strong:!0,style:{color:"#034D57"},children:i||"—"})},{title:"NSN",dataIndex:"nsn",key:"nsn",width:130,render:i=>i||"—"},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0,render:i=>i||"—"},{title:"Qty",dataIndex:"quantity",key:"quantity",width:60,align:"center"},{title:"Unit",dataIndex:"unit",key:"unit",width:60,align:"center"},{title:"Research",dataIndex:"status",key:"status",width:100,render:i=>{const l={done:"success",pending:"default",researching:"processing",no_results:"warning"};return n.jsx(I,{color:l[i]||"default",style:{fontSize:11},children:i})}},{title:"Sell Price (OMR)",dataIndex:"unitSellPrice",key:"unitSellPrice",width:120,align:"right",render:(i,l)=>{const b=i||l.unitCostOmr;return b?b.toFixed(3):"—"}},{title:"Recommendation",dataIndex:"recommendation",key:"recommendation",ellipsis:!0,render:i=>i?n.jsx(R,{type:"secondary",style:{fontSize:12},children:i}):"—"}];return p?n.jsx("div",{style:{textAlign:"center",padding:80},children:n.jsx(je,{size:"large",tip:"Loading RFQ..."})}):e?n.jsxs("div",{style:{paddingBottom:40},children:[n.jsx($e,{style:{marginBottom:16},items:[{title:n.jsx("span",{style:{cursor:"pointer",color:"#034D57"},onClick:()=>t("/rfq"),children:"RFQs"})},{title:e.rfqNumber||e.subject||o}]}),n.jsx(z,{style:{borderRadius:8,marginBottom:16,borderLeft:`4px solid ${e.priority==="ior"?"#ff4d4f":e.priority==="routine"?"#fa8c16":"#034D57"}`},bodyStyle:{padding:"16px 20px"},children:n.jsxs(D,{align:"middle",justify:"space-between",wrap:!0,gutter:[8,8],children:[n.jsx(S,{children:n.jsxs(M,{wrap:!0,size:8,children:[n.jsx($,{icon:n.jsx(ze,{}),onClick:()=>t("/rfq"),type:"text",size:"small"}),n.jsx(Ge,{level:4,style:{margin:0,color:"#034D57"},children:e.rfqNumber||e.subject}),n.jsx(I,{color:Ue[e.priority]||"default",style:{fontWeight:600},children:(g=e.priority)==null?void 0:g.toUpperCase()}),n.jsx(I,{color:Xe[e.status]||"default",children:e.status})]})}),n.jsx(S,{children:n.jsxs(M,{wrap:!0,size:8,children:[["new","in_progress","researched"].includes(e.status)&&n.jsx($,{type:"primary",icon:n.jsx(Le,{}),loading:h,onClick:f,style:{background:"#034D57",borderColor:"#034D57"},children:"Generate Quote"}),e.quote&&n.jsx($,{icon:n.jsx(We,{}),type:"primary",ghost:!0,style:{borderColor:"#4CB480",color:"#4CB480"},onClick:()=>t(`/quote/read/${e.quote._id||e.quote}`),children:"View Quote"}),e.status!=="won"&&e.status!=="expired"&&n.jsx($,{icon:n.jsx(Ne,{}),style:{borderColor:"#52c41a",color:"#52c41a"},onClick:()=>C("won"),children:"Mark Won"}),!["lost","expired"].includes(e.status)&&n.jsx($,{icon:n.jsx(Oe,{}),danger:!0,ghost:!0,onClick:()=>C("lost"),children:"Mark Lost"})]})})]})}),n.jsxs(D,{gutter:[16,16],children:[n.jsx(S,{xs:24,md:10,children:n.jsx(z,{title:n.jsx("span",{style:{color:"#034D57",fontWeight:600},children:"RFQ Details"}),size:"small",style:{borderRadius:8,height:"100%"},children:n.jsxs(j,{column:1,size:"small",labelStyle:{color:"#888",fontSize:12},contentStyle:{fontSize:13},children:[n.jsx(j.Item,{label:"RFQ Number",children:e.rfqNumber||"—"}),n.jsx(j.Item,{label:"Client",children:n.jsx(I,{color:"geekblue",children:e.client||"—"})}),n.jsx(j.Item,{label:"Sender",children:e.senderEmail||"—"}),n.jsx(j.Item,{label:"Received",children:e.receivedAt?new Date(e.receivedAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"—"}),n.jsx(j.Item,{label:"Deadline",children:e.deadlineAt?n.jsx("span",{style:{color:new Date(e.deadlineAt)<new Date?"#ff4d4f":"#333"},children:new Date(e.deadlineAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}):"—"}),n.jsx(j.Item,{label:"Parts Count",children:s.length}),e.notes&&n.jsx(j.Item,{label:"Notes",children:e.notes})]})})}),n.jsx(S,{xs:24,md:14,children:n.jsxs(z,{title:n.jsx("span",{style:{color:"#034D57",fontWeight:600},children:"Email Subject"}),size:"small",style:{borderRadius:8,height:"100%"},children:[n.jsx(R,{style:{color:"#555",fontSize:14},children:e.subject||e.rfqNumber||"—"}),e.emailBody&&n.jsxs(n.Fragment,{children:[n.jsx(Se,{style:{margin:"12px 0"}}),n.jsxs("div",{style:{maxHeight:200,overflowY:"auto",fontSize:12,color:"#666",whiteSpace:"pre-wrap",lineHeight:1.6},children:[e.emailBody.slice(0,800),e.emailBody.length>800?"...":""]})]})]})})]}),n.jsx(z,{title:n.jsxs(D,{justify:"space-between",align:"middle",children:[n.jsx(S,{children:n.jsxs("span",{style:{color:"#034D57",fontWeight:600},children:["Parts (",s.length,")"]})}),n.jsx(S,{children:n.jsxs(I,{color:s.some(i=>i.status==="done")?"success":"default",style:{fontSize:12},children:[s.filter(i=>i.status==="done").length," / ",s.length," researched"]})})]}),size:"small",style:{borderRadius:8,marginTop:16},bodyStyle:{padding:0},children:s.length===0?n.jsx("div",{style:{padding:32,textAlign:"center",color:"#999"},children:"No parts extracted from this RFQ yet"}):n.jsx("div",{style:{overflowX:"auto"},children:n.jsx(Ie,{dataSource:s,columns:y,rowKey:"_id",size:"small",pagination:s.length>20?{pageSize:20}:!1,rowClassName:i=>i.status==="no_results"?"part-no-results":""})})}),n.jsx("style",{children:".part-no-results { background: #fffbe6 !important; }"})]}):n.jsx(V,{type:"error",message:"RFQ not found"})}export{ht as default};
