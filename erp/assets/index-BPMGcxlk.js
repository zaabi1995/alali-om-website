import{u as _,j as e,m as $,n as O,r as b}from"./index-ClqzZDiS.js";import{u as I,F as B,D as N,E as z}from"./ErpApp-DOO6aifX.js";import{P as W}from"./index-CARausXA.js";import{A as q}from"./index-BfxgDXRT.js";import{aw as H,ax as K,ai as R,an as U,ay as Y}from"./IdurarOs-CHCZktHs.js";import{e as l}from"./actions-DDScYq2u.js";import{f as G,g as J}from"./selectors-BAFcmx-T.js";import{u as C}from"./index-BaK3w4xR.js";import{s as L}from"./index-KrFx5yLV.js";import{F as Q}from"./Table-B4XMbQJ3.js";import{D as V}from"./DeleteOutlined-BlDXr5qT.js";import{A as X}from"./ArrowLeftOutlined-BmIHV7Lc.js";import{R as Z,v as ee}from"./helpers-OjMEp30H.js";import{P as te}from"./PlusOutlined-CmFXVI8f.js";import{M as ne}from"./index-Cqw7DHRy.js";function se({config:i}){const c=$(),{ADD_NEW_ENTITY:a,entity:n}=i,{can:r}=I();if(!r.create)return null;const d=()=>{c(`/${n.toLowerCase()}/create`)};return e.jsx(R,{onClick:d,type:"primary",icon:e.jsx(te,{}),children:a})}function ae({config:i,extra:c=[]}){const a=U();let{entity:n,dataTableColumns:r,disableAdd:d=!1,searchConfig:s}=i;const{DATATABLE_TITLE:x}=i,{result:y,isLoading:g}=_(G),{pagination:j,items:k}=y,{erpContextAction:m}=C(),{modal:D}=m,{can:h}=I(),w=[{label:a("Show"),key:"read",icon:e.jsx(H,{})},...h.update?[{label:a("Edit"),key:"edit",icon:e.jsx(K,{})}]:[],{label:a("Download"),key:"download",icon:e.jsx(B,{})},...c,...h.delete?[{type:"divider"},{label:a("Delete"),key:"delete",icon:e.jsx(V,{}),danger:!0}]:[]],f=$(),p=t=>{u(l.currentItem({data:t})),f(`/${n}/read/${t._id}`)},A=t=>{const o={...t};u(l.currentAction({actionType:"update",data:o})),f(`/${n}/update/${t._id}`)},S=t=>{window.open(`${Y}${n}/${n}-${t._id}.pdf`,"_blank")},v=t=>{u(l.currentAction({actionType:"delete",data:t})),D.open()},P=t=>{u(l.currentItem({data:t})),f(`/invoice/pay/${t._id}`)};r=[...r,{title:"",key:"action",fixed:"right",render:(t,o)=>e.jsx(N,{menu:{items:w,onClick:({key:E})=>{switch(E){case"read":p(o);break;case"edit":A(o);break;case"download":S(o);break;case"delete":v(o);break;case"recordPayment":P(o);break}}},trigger:["click"],children:e.jsx(z,{style:{cursor:"pointer",fontSize:"24px"},onClick:E=>E.preventDefault()})})}];const u=O(),T=t=>{const o={page:t.current||1,items:t.pageSize||10};u(l.list({entity:n,options:o}))},F=()=>{u(l.list({entity:n}))};b.useEffect(()=>{const t=new AbortController;return F(),()=>{t.abort()}},[]);const M=t=>{const o={equal:t,filter:s==null?void 0:s.entity};u(l.list({entity:n,options:o}))};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:x,ghost:!0,onBack:()=>window.history.back(),backIcon:e.jsx(X,{}),extra:[e.jsx(q,{entity:s==null?void 0:s.entity,displayLabels:["name"],searchFields:"name",onChange:M},`${L.generate()}`),e.jsx(R,{onClick:T,icon:e.jsx(Z,{}),children:a("Refresh")},`${L.generate()}`),!d&&e.jsx(se,{config:i},`${L.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(Q,{columns:r,rowKey:t=>t._id,dataSource:k,pagination:j,loading:g,onChange:T,scroll:{x:!0}})]})}function oe({config:i}){let{entity:c,deleteModalLabels:a,deleteMessage:n="Do you want delete : ",modalTitle:r="Remove Item"}=i;const d=O(),{current:s,isLoading:x,isSuccess:y}=_(J),{state:g,erpContextAction:j}=C(),{deleteModal:k}=g,{modal:m}=j,[D,h]=b.useState("");b.useEffect(()=>{if(y){m.close();const p={page:1,items:10};d(l.list({entity:c,options:p}))}if(s){let p=a.map(A=>ee(s,A)).join(" ");h(p)}},[y,s]);const w=()=>{const p=s._id;d(l.delete({entity:c,id:p})),m.close()},f=()=>{x||m.close()};return e.jsx(ne,{title:r,open:k.isOpen,onOk:w,onCancel:f,confirmLoading:x,children:e.jsxs("p",{children:[n,D]})})}function ke({config:i,extra:c}){const a=O(),{state:n}=C(),{deleteModal:r}=n,d=()=>{a(l.resetState())};return b.useLayoutEffect(()=>{const s=new AbortController;return d(),()=>{s.abort()}},[]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{config:i,extra:c}),e.jsx(oe,{config:i,isOpen:r.isOpen})]})}export{ke as E};
