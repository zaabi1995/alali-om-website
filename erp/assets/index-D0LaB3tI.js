import{r as y,j as e}from"./index-B_4eKp3O.js";import{aM as j,aL as c,aB as S,U as k,aW as q,aY as D,b1 as v}from"./IdurarOs-DJEruZJs.js";import{C as d}from"./index-DSpEofHK.js";import{v as F,r as $,c as O,T as A,F as H}from"./ErpApp-ByZxq-md.js";import{S as w}from"./index-BBG8JGQR.js";import{P as M}from"./progress-D2oiqsby.js";import{T as W}from"./ThunderboltOutlined-1goSrFB_.js";import{C as Q}from"./ClockCircleOutlined-BxWuaZJ3.js";import"./Skeleton-BZGa1gxJ.js";import"./index-BXo1Csai.js";import"./PlusOutlined-Yh4yKj96.js";const{Title:_,Text:a}=D,i="#034D57",u="#4CB480";function re(){var P,C,L,T;const[r,I]=y.useState(null),[x,m]=y.useState({}),[n,b]=y.useState(null),g=()=>{v.get({entity:"procurement/scanner/status"}).then(s=>{s.success&&I(s.result)})};y.useEffect(()=>{g();const s=setInterval(g,5e3);return()=>clearInterval(s)},[]);const R=async(s,f)=>{m(l=>({...l,[s]:!0}));try{const l=await v.post({entity:`procurement/scanner/${s}`});l.success&&b({action:f,result:l.result,at:new Date().toLocaleTimeString()}),g()}finally{m(l=>({...l,[s]:!1}))}},B=async()=>{m(s=>({...s,research:!0}));try{const s=await v.post({entity:"procurement/research/trigger"});s.success&&b({action:"Research",result:s.result,at:new Date().toLocaleTimeString()})}finally{m(s=>({...s,research:!1}))}},o=(r==null?void 0:r.watcher)||{},t=(r==null?void 0:r.fullScan)||{},z=(r==null?void 0:r.researchQueue)||{},h=(r==null?void 0:r.pdfExtraction)||{},p=o.watching&&!o.error;return e.jsxs("div",{style:{padding:24,background:"#f0f2f5",minHeight:"100vh"},children:[e.jsx(_,{level:3,style:{color:i,marginBottom:24},children:"ðŸ“¡ Email Scanner & Research"}),e.jsxs(j,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${p?u:"#ef4444"}`,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(F,{status:p?"processing":"error"}),e.jsxs("div",{children:[e.jsx(a,{type:"secondary",style:{fontSize:12},children:"Maildir Watcher"}),e.jsx("div",{style:{fontWeight:700,color:p?u:"#ef4444"},children:p?"LIVE":o.error||"Offline"})]})]}),o.lastSeen&&e.jsxs(a,{type:"secondary",style:{fontSize:11},children:["Last email: ",new Date(o.lastSeen).toLocaleTimeString()]}),o.filesProcessed>0&&e.jsx("div",{children:e.jsxs(a,{type:"secondary",style:{fontSize:11},children:["Processed: ",o.filesProcessed," emails"]})})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${i}`,borderRadius:8},children:[e.jsx(w,{title:"Full Scan Progress",value:t.running?`${t.processed}/${t.total}`:t.finishedAt?"Done":"Idle",valueStyle:{fontSize:18,color:i}}),t.running&&e.jsx(M,{percent:Math.round(t.processed/(t.total||1)*100),size:"small",strokeColor:i,style:{marginTop:6}}),t.finishedAt&&!t.running&&e.jsxs(a,{type:"secondary",style:{fontSize:11},children:["+",t.newRfqs," RFQs, +",t.newParts," parts"]})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${u}`,borderRadius:8},children:[e.jsx(w,{title:"Research Queue",value:z.queued||0,suffix:"parts",valueStyle:{fontSize:18,color:u}}),e.jsx(a,{type:"secondary",style:{fontSize:11},children:z.running?"ðŸ”„ Running...":"Idle"})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:"3px solid #f59e0b",borderRadius:8},children:[e.jsx(w,{title:"PDF Extraction",value:h.running?`${h.processed}/${h.total}`:h.succeeded||0,suffix:h.running?"":"done",valueStyle:{fontSize:18,color:"#f59e0b"}}),e.jsx(a,{type:"secondary",style:{fontSize:11},children:h.running?"ðŸ”„ Running...":"Idle"})]})})]}),e.jsxs(j,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(c,{xs:24,md:16,children:e.jsxs(d,{title:"âš¡ Manual Controls",style:{borderRadius:8},children:[e.jsxs($,{wrap:!0,size:"middle",children:[e.jsx(S,{type:"primary",icon:e.jsx(O,{spin:x.scan}),loading:x.scan,onClick:()=>R("scan","Incremental Scan"),style:{background:i,borderColor:i},children:"Incremental Scan"}),e.jsx(S,{icon:e.jsx(W,{}),loading:x["scan-all"],onClick:()=>R("scan-all","Full Scan"),disabled:t.running,children:"Full Historical Scan"}),e.jsx(S,{icon:e.jsx(k,{}),loading:x.research,onClick:B,style:{borderColor:u,color:u},children:"Research Pending Parts"})]}),e.jsx(q,{style:{margin:"16px 0 12px"}}),e.jsxs("div",{style:{fontSize:12,color:"#6b7280",lineHeight:1.6},children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Incremental Scan"})," â€” reads new emails since last scan (runs automatically every 30 min)"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Full Historical Scan"})," â€” re-processes all 27,000+ emails (takes 20+ minutes, background)"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Research Pending Parts"})," â€” runs Exa AI supplier search on all unresearched parts"]})]})]})}),e.jsx(c,{xs:24,md:8,children:e.jsx(d,{title:"ðŸ“Š Last Action",style:{borderRadius:8,height:"100%"},children:n?e.jsxs("div",{children:[e.jsx(A,{color:i,style:{color:"#fff",marginBottom:8},children:n.action}),e.jsxs("div",{style:{fontSize:12,color:"#374151"},children:[((P=n.result)==null?void 0:P.new_rfqs)!==void 0&&e.jsxs("div",{children:["âœ… +",n.result.new_rfqs," new RFQs"]}),((C=n.result)==null?void 0:C.new_parts)!==void 0&&e.jsxs("div",{children:["ðŸ“¦ +",n.result.new_parts," parts"]}),((L=n.result)==null?void 0:L.queued)!==void 0&&e.jsxs("div",{children:["ðŸ”¬ ",n.result.queued," parts queued for research"]}),((T=n.result)==null?void 0:T.message)&&e.jsxs("div",{children:["ðŸ’¬ ",n.result.message]})]}),e.jsxs(a,{type:"secondary",style:{fontSize:11},children:["at ",n.at]})]}):e.jsx(a,{type:"secondary",children:"No actions triggered this session"})})})]}),e.jsx(d,{title:"â„¹ï¸ How It Works",style:{borderRadius:8},children:e.jsx(j,{gutter:[16,16],children:[{icon:e.jsx(F,{status:"processing"}),title:"Real-time Watcher",desc:"chokidar watches /www/vmail/alali.om/rfq/ for new emails. New RFQs appear in the ERP within seconds of arrival.",color:u},{icon:e.jsx(Q,{style:{color:i}}),title:"30-min Periodic Scan",desc:"Backup scan every 30 minutes catches any files the watcher may have missed (e.g., during restarts).",color:i},{icon:e.jsx(H,{style:{color:"#f59e0b"}}),title:"PDF OCR Pipeline",desc:"PDF attachments â†’ Kreuzberg (fast) â†’ pdftotext â†’ ocrmypdf (for scanned docs) â†’ LLM part extraction.",color:"#f59e0b"},{icon:e.jsx(k,{style:{color:"#6366f1"}}),title:"Exa Supplier Research",desc:"Each pending part gets 2 Exa neural searches (suppliers + specs). LLM generates procurement recommendations.",color:"#6366f1"}].map(({icon:s,title:f,desc:l,color:E})=>e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs("div",{style:{padding:"12px 0",borderLeft:`3px solid ${E}`,paddingLeft:12},children:[e.jsxs("div",{style:{fontWeight:600,color:E,marginBottom:4},children:[s," ",f]}),e.jsx("div",{style:{fontSize:12,color:"#6b7280",lineHeight:1.5},children:l})]})},f))})})]})}export{re as default};
