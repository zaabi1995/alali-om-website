import{r as n,j as e}from"./index-2QTruxbX.js";import{a as Q,o as W}from"./omrFormat-CZz3ONF8.js";import{aG as s,ai as l,aA as P,aB as r,aD as i,aM as X,ar as Y,ay as h}from"./IdurarOs-B5_OKhCl.js";import{C as A}from"./index-Brg7WuOo.js";import{S as T}from"./index-DV8XaSh8.js";import{m as g}from"./ErpApp-DwgWua7w.js";import{F as Z}from"./Table-DbwH6IfS.js";import{M}from"./index-CtyjmeaE.js";import{T as v}from"./index-BC33uoJK.js";import{S as F}from"./index-DAO1i40V.js";import{s as x}from"./index-BwPLxxfI.js";import{T as ee}from"./index-DE49f7D6.js";import{P as te}from"./index-BYQ8jcxP.js";import{P as se}from"./PlusOutlined-DjBzbDTC.js";import{W as D}from"./WarningOutlined-CEGXYo-C.js";import"./Skeleton-D3cN1ZDR.js";import"./index-DKVj7VvH.js";import"./pickAttrs-DWrS2WwP.js";import"./DownOutlined-BBRFE5gz.js";import"./ActionButton-ty-0Zl-K.js";import"./useClosable-DA4q1O9H.js";import"./fade-BCwvzQiV.js";const{Title:ae}=Y,{TextArea:re}=i;function S(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function q(){return{...S(),"Content-Type":"application/json"}}function E(w){return W(w)}function Te(){const[w,B]=n.useState([]),[o,z]=n.useState(null),[V,L]=n.useState(!1),[b,U]=n.useState({page:1,count:0}),[I,N]=n.useState(""),[c,_]=n.useState(!1),[H,p]=n.useState(!1),[m,j]=n.useState(null),[k]=s.useForm(),[O]=s.useForm(),[R,y]=n.useState(!1),f=()=>{fetch(h+"inventoryitem/stats",{headers:S()}).then(t=>t.json()).then(t=>{t.success&&z(t.result)}).catch(()=>{})},u=async(t=1)=>{L(!0);const a=new URLSearchParams({page:t,items:30});I&&a.set("q",I),c&&a.set("lowStock","true");try{const C=await(await fetch(h+`inventoryitem/list?${a}`,{headers:S()})).json();C.success&&(B(C.result),U(C.pagination||{}))}finally{L(!1)}};n.useEffect(()=>{u(1),f()},[I,c]);const $=async t=>{y(!0);try{const d=await(await fetch(h+"inventoryitem/create",{method:"POST",headers:q(),body:JSON.stringify(t)})).json();d.success?(x.success("Item added"),p(!1),k.resetFields(),u(1),f()):x.error(d.message||"Failed")}finally{y(!1)}},K=async t=>{y(!0);try{const d=await(await fetch(h+`inventoryitem/movement/${m.id}`,{method:"POST",headers:q(),body:JSON.stringify(t)})).json();d.success?(x.success("Movement recorded"),j(null),O.resetFields(),u(1),f()):x.error(d.message||"Failed")}finally{y(!1)}},G=async t=>{await fetch(h+`inventoryitem/delete/${t}`,{method:"DELETE",headers:S()}),x.success("Removed"),u(b.page),f()},J=[{title:"Part Number",dataIndex:"partNumber",render:t=>e.jsx("strong",{children:t}),width:140},{title:"NSN",dataIndex:"nsn",render:t=>t||"â€”",width:120},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"On Hand",dataIndex:"qtyOnHand",align:"center",width:80,render:(t,a)=>e.jsx(ee,{color:t<=(a.reorderLevel||0)&&a.reorderLevel>0?"red":"green",children:t})},{title:"Reserved",dataIndex:"qtyReserved",align:"center",width:80},{title:"Available",dataIndex:"qtyAvailable",align:"center",width:80,render:(t,a)=>e.jsx("strong",{style:{color:t<=(a.reorderLevel||0)&&a.reorderLevel>0?"#e53e3e":"#4CB480"},children:t})},{title:"Unit Cost",dataIndex:"unitCost",align:"right",render:E},{title:"Total Value",dataIndex:"totalValue",align:"right",render:t=>e.jsx("strong",{children:E(t)})},{title:"Location",dataIndex:"warehouseLocation",render:t=>t||"â€”"},{title:"",width:100,render:(t,a)=>e.jsxs(g,{children:[e.jsx(l,{size:"small",onClick:()=>{j({id:a._id,partNumber:a.partNumber})},children:"Move"}),e.jsx(te,{title:"Remove?",onConfirm:()=>G(a._id),children:e.jsx(l,{size:"small",danger:!0,type:"text",children:"Ã—"})})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(ae,{level:4,style:{margin:0,color:"#034D57"},children:"Inventory"}),e.jsx(l,{type:"primary",icon:e.jsx(se,{}),onClick:()=>p(!0),style:{background:"#034D57"},children:"Add Item"})]}),o&&e.jsxs(P,{gutter:12,style:{marginBottom:16},children:[e.jsx(r,{xs:8,children:e.jsx(A,{size:"small",children:e.jsx(T,{title:"Total SKUs",value:o.totalItems})})}),e.jsx(r,{xs:8,children:e.jsx(A,{size:"small",children:e.jsx(T,{title:"Total Value",value:o.totalValue,precision:3,suffix:Q(),valueStyle:{color:"#034D57"}})})}),e.jsx(r,{xs:8,children:e.jsx(A,{size:"small",children:e.jsx(T,{title:"Low Stock Alerts",value:o.lowStock,valueStyle:{color:o.lowStock>0?"#e53e3e":"#4CB480"},prefix:o.lowStock>0?e.jsx(D,{}):null})})})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(i,{placeholder:"Search part#, NSN, description...",prefix:e.jsx(X,{}),allowClear:!0,style:{width:260},onPressEnter:t=>N(t.target.value),onChange:t=>!t.target.value&&N("")}),e.jsx(l,{type:c?"primary":"default",icon:e.jsx(D,{}),onClick:()=>_(t=>!t),danger:c,children:c?"Show All":"Low Stock Only"})]}),e.jsx(Z,{columns:J,dataSource:w,rowKey:"_id",loading:V,size:"small",pagination:{current:b.page,total:b.count,pageSize:30,onChange:t=>u(t)},rowClassName:t=>t.qtyAvailable<=(t.reorderLevel||0)&&t.reorderLevel>0?"ant-table-row-warning":""}),e.jsx(M,{title:"Add Inventory Item",open:H,onCancel:()=>p(!1),footer:null,width:600,children:e.jsxs(s,{form:k,layout:"vertical",onFinish:$,children:[e.jsxs(P,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"partNumber",label:"Part Number",rules:[{required:!0}],children:e.jsx(i,{})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"nsn",label:"NSN",children:e.jsx(i,{})})}),e.jsx(r,{span:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(i,{})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"qtyOnHand",label:"Initial Qty",initialValue:0,children:e.jsx(v,{style:{width:"100%"},min:0})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"unitCost",label:"Unit Cost (OMR)",initialValue:0,children:e.jsx(v,{style:{width:"100%"},precision:3,min:0})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"reorderLevel",label:"Reorder Level",initialValue:0,children:e.jsx(v,{style:{width:"100%"},min:0})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"warehouseLocation",label:"Location",children:e.jsx(i,{placeholder:"e.g. Shelf A-3"})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(F,{options:["EA","SET","PKG","LOT","MTR","KG"].map(t=>({value:t,label:t}))})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(g,{children:[e.jsx(l,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(l,{type:"primary",htmlType:"submit",loading:R,style:{background:"#034D57"},children:"Add"})]})})]})}),e.jsx(M,{title:`Stock Movement â€” ${m==null?void 0:m.partNumber}`,open:!!m,onCancel:()=>j(null),footer:null,children:e.jsxs(s,{form:O,layout:"vertical",onFinish:K,children:[e.jsx(s.Item,{name:"type",label:"Movement Type",rules:[{required:!0}],children:e.jsx(F,{options:[{value:"in",label:"ðŸ“¦ Stock In (receive)"},{value:"out",label:"ðŸ“¤ Stock Out (dispatch)"},{value:"adjust",label:"ðŸ”§ Adjust (set new qty)"},{value:"reserve",label:"ðŸ”’ Reserve"},{value:"release",label:"ðŸ”“ Release Reservation"}]})}),e.jsx(s.Item,{name:"quantity",label:"Quantity",rules:[{required:!0}],children:e.jsx(v,{style:{width:"100%"},min:0})}),e.jsx(s.Item,{name:"reference",label:"Reference (PO#, DN#, etc.)",children:e.jsx(i,{placeholder:"e.g. PO-5/2026"})}),e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(re,{rows:2})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(g,{children:[e.jsx(l,{onClick:()=>j(null),children:"Cancel"}),e.jsx(l,{type:"primary",htmlType:"submit",loading:R,style:{background:"#034D57"},children:"Record"})]})})]})})]})}export{Te as default};
