import{m as R,r as o,j as t}from"./index-CYKalyeL.js";import{a as h,o as m}from"./omrFormat-B-E0oCKV.js";import{d as B}from"./dayjs.min-DGHWcPFV.js";import{ai as u,aB as O,aC as i,ar as T,az as f}from"./IdurarOs-BGw2PPGe.js";import{C as l}from"./index-DcFHw6qe.js";import{S as n}from"./index-CtMb3PWt.js";import{S as _}from"./index-BGUfHx-u.js";import{F as b}from"./Table-CBI2Olew.js";import{T as I}from"./index-BkNufn0G.js";import{m as z,b as M}from"./ErpApp-CeydZZZJ.js";import{P as F}from"./index-BNG2szad.js";import{s as E}from"./index-BQgCxPOT.js";import{P as k}from"./PlusOutlined-FeH87sEb.js";import{D as $}from"./DeleteOutlined-D2OLi6gq.js";import"./Skeleton-BxPCSHmg.js";import"./index-CAMKOCuO.js";import"./pickAttrs-CsXZNnOo.js";import"./DownOutlined-Bn5vGHe8.js";import"./Pagination-CRz1TW9a.js";import"./useClosable-BvmnJMVE.js";import"./ActionButton-C9t4i8h5.js";const{Title:A}=T;function g(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const y={prospect:"default",active:"green",on_hold:"orange",completed:"blue",cancelled:"red"};function le(){const c=R(),[r,C]=o.useState([]),[S,p]=o.useState(!1),[d,P]=o.useState(""),x=async()=>{p(!0);const e=d?`?status=${d}`:"",s=await fetch(f+`project/list${e}`,{headers:g()}).then(a=>a.json()).catch(()=>({}));s.success&&C(s.result||[]),p(!1)};o.useEffect(()=>{x()},[d]);const v=r.reduce((e,s)=>e+(s.revenueOMR||0),0),j=r.reduce((e,s)=>e+(s.profitOMR||0),0),w=r.filter(e=>e.status==="active").length,D=[{title:"Code",dataIndex:"code",width:120,render:(e,s)=>{var a;return t.jsx("a",{onClick:()=>c(`/projects/read/${s._id}`),style:{fontWeight:700,color:"#034D57"},children:e||"PRJ-"+((a=s._id)==null?void 0:a.slice(-4))})}},{title:"Project Name",dataIndex:"name",ellipsis:!0},{title:"Client",dataIndex:["client","name"],render:e=>e||"—"},{title:"Status",dataIndex:"status",width:100,render:e=>t.jsx(I,{color:y[e],children:e==null?void 0:e.replace(/_/g," ").toUpperCase()})},{title:"Budget",dataIndex:"budgetOMR",align:"right",render:e=>e?m(e):"—"},{title:"Revenue",dataIndex:"revenueOMR",align:"right",render:e=>e?t.jsx("span",{style:{color:"#4CB480"},children:m(e)}):"—"},{title:"Profit",dataIndex:"profitOMR",align:"right",render:e=>e!==void 0?t.jsx("span",{style:{color:e>=0?"#4CB480":"#e53e3e",fontWeight:700},children:m(e)}):"—"},{title:"Start",dataIndex:"startDate",width:100,render:e=>e?B(e).format("DD MMM YY"):"—"},{title:"",width:70,render:(e,s)=>t.jsxs(z,{children:[t.jsx(u,{size:"small",icon:t.jsx(M,{}),onClick:()=>c(`/projects/read/${s._id}`)}),t.jsx(F,{title:"Delete?",onConfirm:async()=>{await fetch(f+`project/delete/${s._id}`,{method:"DELETE",headers:g()}),E.success("Deleted"),x()},children:t.jsx(u,{size:"small",danger:!0,icon:t.jsx($,{})})})]})}];return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(A,{level:4,style:{margin:0,color:"#034D57"},children:"Projects & Jobs"}),t.jsx(u,{type:"primary",icon:t.jsx(k,{}),onClick:()=>c("/projects/create"),style:{background:"#034D57"},children:"New Project"})]}),t.jsxs(O,{gutter:12,style:{marginBottom:16},children:[t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Active Projects",value:w,valueStyle:{color:"#034D57"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Revenue",value:v.toFixed(3),suffix:h(),valueStyle:{color:"#4CB480"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Profit",value:j.toFixed(3),suffix:h(),valueStyle:{color:j>=0?"#4CB480":"#e53e3e"}})})}),t.jsx(i,{xs:12,sm:6,children:t.jsx(l,{size:"small",children:t.jsx(n,{title:"Total Projects",value:r.length})})})]}),t.jsx("div",{style:{marginBottom:12},children:t.jsx(_,{placeholder:"Filter by status",allowClear:!0,style:{width:160},onChange:e=>P(e||""),options:Object.keys(y).map(e=>({value:e,label:e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})}),t.jsx(b,{columns:D,dataSource:r,rowKey:"_id",loading:S,size:"small"})]})}export{le as default};
