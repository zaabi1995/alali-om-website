import{m as J,r as l,j as t}from"./index-fQzVIFut.js";import{aZ as v,aB as S,aM as Y,aL as X,a_ as ee,U as te,aY as re}from"./IdurarOs-2nFZV4nX.js";import{R as se}from"./ReloadOutlined-BDMv4kPX.js";import{C}from"./index-CcNtqXvO.js";import{S as ae}from"./index-CmeX8ruA.js";import{r as oe,e as L,T as h,D as le,t as ne,v as ie}from"./ErpApp-uJl2ak2H.js";import{T as ce}from"./index-NwmM02iY.js";import{T as de}from"./ThunderboltOutlined-B4gaHYyd.js";import{s as A}from"./index-BaBBykAj.js";import{F as ue}from"./Table-DNjCQysA.js";import"./Skeleton-C1nKWVYB.js";import"./PlusOutlined-DGREacQj.js";function O(){var u,p;try{const x=(p=(u=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:u.current)==null?void 0:p.token;return x?{Authorization:`Bearer ${x}`}:{}}catch{return{}}}const{Title:he,Text:T}=re,{Option:i}=L,d="#034D57",$="#4CB480",ye={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},fe={ior:"red",routine:"orange",normal:"default"},pe=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function Te(){var z,I,P,D,B;const u=J(),[p,x]=l.useState([]),[N,q]=l.useState(!0),[s,F]=l.useState(null),[xe,Q]=l.useState({}),[m,_]=l.useState({current:1,pageSize:25,total:0}),[y,G]=l.useState("ALL"),[n,g]=l.useState({status:"",priority:"all",q:""}),[H,U]=l.useState(""),[b,k]=l.useState([]),w=l.useCallback(async()=>{try{const r=await(await fetch(v+"rfq/stats",{headers:O()})).json();r.success&&F(r.result)}catch{}},[]),f=l.useCallback(async(e=1)=>{q(!0);try{const r=new URLSearchParams({page:e,items:m.pageSize,...n.status&&n.status!=="active"?{status:n.status}:n.status==="active"?{status:"new,in_progress,researched"}:{},...n.priority!=="all"?{priority:n.priority}:{},...y!=="ALL"?{client:y}:{},...n.q?{q:n.q}:{}}),o=await(await fetch(v+`rfq/list?${r}`,{headers:O()})).json();if(o.success){x(o.result||[]),_(j=>{var E,M;return{...j,current:e,total:((E=o.pagination)==null?void 0:E.total)||((M=o.result)==null?void 0:M.length)||0}});const c={};(o.result||[]).forEach(j=>{c[j.client]=(c[j.client]||0)+1}),Q(c)}}catch{}finally{q(!1)}},[n,y,m.pageSize]);l.useEffect(()=>{w()},[]),l.useEffect(()=>{f(1)},[n,y]);const R=e=>{if(!e.receivedAt)return null;const r=new Date(e.receivedAt),a=e.priority==="ior"?7:10,o=new Date(r.getTime()+a*864e5);return Math.ceil((o-new Date)/864e5)},V=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(e,r)=>t.jsxs("div",{children:[t.jsx(T,{strong:!0,style:{color:d,cursor:"pointer",fontSize:13},onClick:()=>u(`/rfq/${r._id}`),children:e||"â€”"}),r.priority==="ior"&&t.jsx(h,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:e=>t.jsx(h,{color:d,style:{color:"#fff",fontSize:11},children:e})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(e,r)=>t.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>u(`/rfq/${r._id}`),children:e})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,render:e=>t.jsx(h,{color:fe[e]||"default",children:(e||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>t.jsx(h,{color:ye[e]||"default",children:e==null?void 0:e.replace("_"," ")})},{title:"Parts",key:"parts",width:70,render:(e,r)=>t.jsx(ie,{count:r.partsCount||0,showZero:!0,style:{backgroundColor:r.partsCount>0?$:"#e5e7eb",color:r.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,render:e=>e?new Date(e).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"Deadline",key:"deadline",width:110,sorter:(e,r)=>{const a=R(e),o=R(r);return a-o},render:(e,r)=>{if(["expired","quoted","won","lost"].includes(r.status))return t.jsx(T,{type:"secondary",style:{fontSize:11},children:"â€”"});const a=R(r);if(a===null)return t.jsx(T,{type:"secondary",style:{fontSize:11},children:"â€”"});let o,c;return a<0?(o="#ef4444",c=`${Math.abs(a)}d overdue`):a<=2?(o="#ef4444",c=`${a}d left`):a<=5?(o="#f59e0b",c=`${a}d left`):(o="#22c55e",c=`${a}d left`),t.jsx(h,{color:o,style:{fontSize:11,fontWeight:600},children:c})}},{title:"",key:"action",width:60,render:(e,r)=>t.jsx(S,{size:"small",type:"link",style:{color:d,padding:0},onClick:()=>u(`/rfq/${r._id}`),children:"View â†’"})}],W=((z=s==null?void 0:s.byPriority)==null?void 0:z.ior)||0,K=(((I=s==null?void 0:s.byStatus)==null?void 0:I.new)||0)+(((P=s==null?void 0:s.byStatus)==null?void 0:P.in_progress)||0)+(((D=s==null?void 0:s.byStatus)==null?void 0:D.researched)||0),Z=((B=s==null?void 0:s.byStatus)==null?void 0:B.quoted)||0;return t.jsxs("div",{style:{padding:20,background:"#f0f2f5",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(he,{level:3,style:{color:d,margin:0},children:"ðŸ“‹ RFQ Management"}),t.jsx(S,{icon:t.jsx(se,{}),onClick:()=>{w(),f(1)},style:{borderColor:d,color:d},children:"Refresh"})]}),t.jsx(Y,{gutter:[12,12],style:{marginBottom:16},children:[{title:"Total RFQs",value:(s==null?void 0:s.total)||0,color:d},{title:"Active",value:K,color:"#3b82f6"},{title:"IOR Priority",value:W,color:"#ef4444"},{title:"Total Parts",value:(s==null?void 0:s.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:Z,color:$},{title:"Vendors",value:(s==null?void 0:s.totalVendors)||0,color:"#f59e0b"}].map(({title:e,value:r,color:a})=>t.jsx(X,{xs:8,sm:4,children:t.jsx(C,{size:"small",style:{borderTop:`3px solid ${a}`,borderRadius:8,textAlign:"center"},children:t.jsx(ae,{title:e,value:r,valueStyle:{color:a,fontSize:18,fontWeight:700}})})},e))}),t.jsx(C,{size:"small",style:{marginBottom:12,borderRadius:8},children:t.jsxs(oe,{wrap:!0,children:[t.jsx(ee.Search,{placeholder:"Search RFQ#, part, subject...",value:H,onChange:e=>U(e.target.value),onSearch:e=>g(r=>({...r,q:e})),onPressEnter:e=>g(r=>({...r,q:e.target.value})),style:{width:260},prefix:t.jsx(te,{style:{color:"#9ca3af"}})}),t.jsxs(L,{value:n.status||"active",onChange:e=>g(r=>({...r,status:e})),style:{width:140},children:[t.jsx(i,{value:"active",children:"Active"}),t.jsx(i,{value:"new",children:"New"}),t.jsx(i,{value:"in_progress",children:"In Progress"}),t.jsx(i,{value:"researched",children:"Researched"}),t.jsx(i,{value:"quoted",children:"Quoted"}),t.jsx(i,{value:"won",children:"Won"}),t.jsx(i,{value:"lost",children:"Lost"}),t.jsx(i,{value:"",children:"All Statuses"})]}),t.jsxs(L,{value:n.priority,onChange:e=>g(r=>({...r,priority:e})),style:{width:120},children:[t.jsx(i,{value:"all",children:"All Priority"}),t.jsx(i,{value:"ior",children:"ðŸš¨ IOR"}),t.jsx(i,{value:"routine",children:"Routine"}),t.jsx(i,{value:"normal",children:"Normal"})]})]})}),t.jsxs(C,{style:{borderRadius:8},bodyStyle:{padding:0},children:[t.jsx(ce,{activeKey:y,onChange:e=>{G(e),f(1)},size:"small",style:{paddingLeft:8},items:pe.map(({key:e,label:r})=>({key:e,label:t.jsxs("span",{children:[e==="ALL"?t.jsx(de,{}):null," ",r]})}))}),b.length>0&&t.jsxs("div",{style:{marginBottom:12,padding:"8px 12px",background:"#f0f6f7",borderRadius:8,display:"flex",alignItems:"center",gap:12},children:[t.jsxs(h,{color:d,children:[b.length," selected"]}),t.jsx(le,{menu:{items:[{key:"in_progress",label:"Mark In Progress"},{key:"quoted",label:"Mark Quoted"},{key:"won",label:"Mark Won"},{key:"lost",label:"Mark Lost"},{key:"expired",label:"Mark Expired"}],onClick:async({key:e})=>{try{const a=await(await fetch(v+"rfq/bulk-status",{method:"POST",headers:{...O(),"Content-Type":"application/json"},body:JSON.stringify({ids:b,status:e})})).json();a.success?(A.success(`${a.result.modified} RFQs updated to ${e}`),k([]),f(m.current),w()):A.error(a.message||"Failed")}catch(r){A.error("Error: "+r.message)}}},children:t.jsxs(S,{size:"small",type:"primary",style:{background:d,borderColor:d},children:["Bulk Action ",t.jsx(ne,{})]})}),t.jsx(S,{size:"small",onClick:()=>k([]),children:"Clear"})]}),t.jsx(ue,{rowKey:"_id",rowSelection:{selectedRowKeys:b,onChange:k,columnWidth:36},columns:V,dataSource:p,loading:N,size:"small",pagination:{...m,showSizeChanger:!1,showTotal:e=>`${e} RFQs`,onChange:e=>{_(r=>({...r,current:e})),f(e)}},rowClassName:e=>e.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:950},onRow:e=>({onClick:r=>{r.target.closest(".ant-checkbox-wrapper")||u(`/rfq/${e._id}`)},style:{cursor:"pointer"}})})]}),t.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{Te as default};
