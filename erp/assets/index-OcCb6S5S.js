import{r as l,j as e}from"./index-B64B4hdT.js";import{X as C,b as v,ar as _,av as z,ay as m,ak as T}from"./IdurarOs-BkLBhqeA.js";import{C as R}from"./index-CqOoyjLZ.js";import{T as h}from"./index-Cig4hErZ.js";import{F as A}from"./Table-BSzwChIC.js";import{K as E,T as I,l as g,A as k}from"./ErpApp-528vWI4N.js";import{S as B}from"./index-C6yiNU_2.js";import{s as j}from"./index-BJvKXmWR.js";import"./Skeleton-C-oXilSm.js";import"./index-GZM8uBHh.js";import"./PlusOutlined-Bc3Q8YAD.js";import"./useClosable-0xnTc-TC.js";import"./pickAttrs-DWtaam-G.js";import"./DownOutlined-BaONNP-L.js";var L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zm-126 534.1H250.3l-53.8-409.4 139.8 86.1L512 252.9l175.7 234.4 139.8-86.1-53.9 409.4zM512 509c-62.1 0-112.6 50.5-112.6 112.6S449.9 734.2 512 734.2s112.6-50.5 112.6-112.6S574.1 509 512 509zm0 160.9c-26.6 0-48.2-21.6-48.2-48.3 0-26.6 21.6-48.3 48.2-48.3s48.2 21.6 48.2 48.3c0 26.6-21.6 48.3-48.2 48.3z"}}]},name:"crown",theme:"outlined"},M=function(n,u){return l.createElement(C,v({},n,{ref:u,icon:L}))};const F=l.forwardRef(M),{Title:P,Text:d}=_;function w(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function $(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}const r={owner:{color:"gold",icon:e.jsx(F,{}),label:"Owner",desc:"Full access + user management"},admin:{color:"#034D57",icon:e.jsx(E,{}),label:"Admin",desc:"Full ERP access"},staff:{color:"#4CB480",icon:e.jsx(I,{}),label:"Staff",desc:"Create, read, update"},viewer:{color:"default",icon:e.jsx(z,{}),label:"Viewer",desc:"Read-only access"}};function H(){var i,n;try{return((n=(i=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:i.current)==null?void 0:n.role)==="owner"}catch{return!1}}function se(){const[i,n]=l.useState([]),[u,f]=l.useState(!1),[o,S]=l.useState(null),p=H(),x=async()=>{f(!0);const[t,s]=await Promise.all([fetch(m+"users/list",{headers:w()}).then(a=>a.json()).catch(()=>({})),fetch(m+"users/me",{headers:w()}).then(a=>a.json()).catch(()=>({}))]);t.success&&n(t.result||[]),s.success&&S(s.result),f(!1)};l.useEffect(()=>{x()},[]);const b=async(t,s)=>{const a=await fetch(m+`users/update-role/${t}`,{method:"PATCH",headers:$(),body:JSON.stringify({role:s})}).then(c=>c.json()).catch(()=>({}));a.success?(j.success(a.message),x()):j.error(a.message||"Failed â€” only owner can change roles")},O=[{title:"User",key:"user",render:(t,s)=>e.jsxs(g,{children:[e.jsx(k,{style:{background:"#034D57"},icon:e.jsx(T,{})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:600},children:[s.name," ",s.surname||""]}),e.jsx(d,{type:"secondary",style:{fontSize:12},children:s.email})]}),(o==null?void 0:o._id)===s._id&&e.jsx(h,{color:"blue",style:{fontSize:10},children:"You"})]})},{title:"Role",dataIndex:"role",width:200,render:(t,s)=>{const a=r[t]||r.viewer;return!p||(o==null?void 0:o._id)===s._id?e.jsx(h,{color:a.color,icon:a.icon,children:a.label}):e.jsx(B,{value:t||"owner",style:{width:140},onChange:c=>b(s._id,c),options:Object.entries(r).map(([c,y])=>({value:c,label:e.jsxs(g,{children:[y.icon,e.jsx("span",{children:y.label})]})}))})}},{title:"Permissions",dataIndex:"role",width:260,render:t=>{const s=r[t]||r.viewer;return e.jsx(d,{type:"secondary",style:{fontSize:12},children:s.desc})}}];return e.jsxs("div",{style:{padding:24,maxWidth:800},children:[e.jsx(P,{level:4,style:{margin:"0 0 4px",color:"#034D57"},children:"User Management"}),e.jsx(d,{type:"secondary",style:{display:"block",marginBottom:20},children:p?"You can change user roles below.":"Only the owner can change roles."}),e.jsx(R,{size:"small",style:{marginBottom:20,background:"#f8fffe"},children:e.jsx("div",{style:{display:"flex",gap:24,flexWrap:"wrap"},children:Object.entries(r).map(([t,s])=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx(h,{color:s.color,icon:s.icon,children:s.label}),e.jsx(d,{type:"secondary",style:{fontSize:11},children:s.desc})]},t))})}),e.jsx(A,{columns:O,dataSource:i,rowKey:"_id",loading:u,size:"small",pagination:!1,rowClassName:t=>(o==null?void 0:o._id)===t._id?"row-highlight":""})]})}export{se as default};
