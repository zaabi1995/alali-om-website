import{m as I,o as C,r as y,j as e}from"./index-CCCv-zmC.js";import{a as $}from"./omrFormat-Bbsnq4Q4.js";import{d as b}from"./dayjs.min-mQVPuH04.js";import{ay as x,ai as s,aw as B,aA as L,aB as o,ar as O}from"./IdurarOs-aaUhqkKZ.js";import{l as g,F as R}from"./ErpApp-CTiVEe4-.js";import{T as w}from"./index-DBtVKsB6.js";import{s as h}from"./index-DEC9v_5Q.js";import{P as z}from"./index-BJDjP3zE.js";import{C as i}from"./index-DpHkBK2S.js";import{S as n}from"./index-DJp29of0.js";import{D as a}from"./index-C45p-ldG.js";import{F as d}from"./Table-CxeFhHmu.js";import{A as P}from"./ArrowLeftOutlined-BKd7iaLU.js";import{D as T}from"./DeleteOutlined-CYAUFaPk.js";import"./useClosable-DWbgGi3f.js";import"./ActionButton-C_DpBRrz.js";import"./Skeleton-BowpBnhl.js";import"./index-BtSITTzz.js";import"./PlusOutlined-Cr12TcRy.js";import"./pickAttrs-CabtVaPC.js";import"./index-D2kOxtBt.js";import"./DownOutlined-CMyojUlQ.js";const{Title:E}=O;function D(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}const k={draft:"default",received:"blue",approved:"cyan",partially_paid:"orange",paid:"green",overdue:"red",cancelled:"default"};function se(){var p,j;const c=I(),{id:l}=C(),[t,v]=y.useState(null);y.useEffect(()=>{fetch(x+`vendorbill/read/${l}`,{headers:D()}).then(r=>r.json()).then(r=>{r.success&&v(r.result)}).catch(()=>{})},[l]);const F=async()=>{await fetch(x+`vendorbill/delete/${l}`,{method:"DELETE",headers:D()}),h.success("Deleted"),c("/vendor-bill")};if(!t)return e.jsx("div",{style:{padding:24},children:"Loading…"});const S=[{title:"Description",dataIndex:"description"},{title:"Qty",dataIndex:"quantity",width:80,align:"right"},{title:"Unit Price",dataIndex:"unitPrice",align:"right",render:r=>`${parseFloat(r||0).toFixed(4)} ${t.currency}`},{title:"Total",dataIndex:"total",align:"right",render:r=>e.jsxs("b",{children:[parseFloat(r||0).toFixed(3)," ",t.currency]})}];return e.jsxs("div",{style:{padding:24,maxWidth:900},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(g,{children:[e.jsx(s,{icon:e.jsx(P,{}),onClick:()=>c("/vendor-bill")}),e.jsxs(E,{level:4,style:{margin:0,color:"#034D57"},children:["BILL-",t.number,"/",t.year]}),e.jsx(w,{color:k[t.status],children:(p=t.status)==null?void 0:p.replace(/_/g," ").toUpperCase()})]}),e.jsxs(g,{children:[e.jsx(s,{icon:e.jsx(R,{}),style:{borderColor:"#034D57",color:"#034D57"},onClick:async()=>{try{const r=await fetch(`${x}vendorbill/pdf/${l}`,{headers:{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}});if(!r.ok){h.error("Failed to generate PDF");return}const m=await r.blob(),f=URL.createObjectURL(m),u=document.createElement("a");u.href=f,u.download=`BILL-${(t==null?void 0:t.number)||l}.pdf`,u.click(),URL.revokeObjectURL(f)}catch{h.error("PDF download failed")}},children:"Download PDF"}),e.jsx(s,{icon:e.jsx(B,{}),onClick:()=>c(`/vendor-bill/edit/${l}`),children:"Edit"}),e.jsx(z,{title:"Delete this bill?",onConfirm:F,children:e.jsx(s,{danger:!0,icon:e.jsx(T,{}),children:"Delete"})})]})]}),e.jsxs(L,{gutter:12,style:{marginBottom:16},children:[e.jsx(o,{xs:12,sm:6,children:e.jsx(i,{size:"small",children:e.jsx(n,{title:"Total",value:`${parseFloat(t.total||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:"#034D57"}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(i,{size:"small",children:e.jsx(n,{title:"Paid",value:`${parseFloat(t.amountPaid||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:"#4CB480"}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(i,{size:"small",children:e.jsx(n,{title:"Balance Due",value:`${parseFloat(t.balanceDue||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:t.balanceDue>0?"#e53e3e":"#4CB480",fontWeight:700}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(i,{size:"small",children:e.jsx(n,{title:"OMR Equivalent",value:parseFloat(t.totalOMR||0).toFixed(3),suffix:$(),valueStyle:{fontSize:14}})})})]}),e.jsx(i,{title:"Bill Details",size:"small",style:{marginBottom:16},children:e.jsxs(a,{column:{xs:1,sm:2},bordered:!0,size:"small",children:[e.jsx(a.Item,{label:"Vendor",children:e.jsx("b",{children:((j=t.vendor)==null?void 0:j.companyName)||"—"})}),e.jsx(a.Item,{label:"Vendor Invoice #",children:t.vendorRef||"—"}),e.jsx(a.Item,{label:"Bill Date",children:t.date?b(t.date).format("DD MMM YYYY"):"—"}),e.jsx(a.Item,{label:"Due Date",children:t.dueDate?b(t.dueDate).format("DD MMM YYYY"):"—"}),e.jsxs(a.Item,{label:"Currency",children:[t.currency," (rate: ",t.exchangeRate||1,")"]}),e.jsx(a.Item,{label:"Linked PO",children:t.purchaseOrder?`PO-${t.purchaseOrder.number}/${t.purchaseOrder.year}`:"—"}),e.jsxs(a.Item,{label:"Tax",children:[parseFloat(t.taxAmount||0).toFixed(3)," ",t.currency]}),t.notes&&e.jsx(a.Item,{label:"Notes",span:2,children:t.notes})]})}),e.jsx(i,{title:"Line Items",size:"small",children:e.jsx(d,{columns:S,dataSource:t.items||[],rowKey:(r,m)=>m,pagination:!1,size:"small",summary:()=>e.jsxs(d.Summary.Row,{children:[e.jsx(d.Summary.Cell,{index:0,colSpan:3,align:"right",children:e.jsx("b",{children:"Total"})}),e.jsx(d.Summary.Cell,{index:1,align:"right",children:e.jsxs("b",{style:{color:"#034D57"},children:[parseFloat(t.total||0).toFixed(3)," ",t.currency]})})]})})})]})}export{se as default};
