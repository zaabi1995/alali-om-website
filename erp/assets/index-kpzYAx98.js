import{m as I,o as C,r as y,j as e}from"./index-DsxgoXaO.js";import{a as $}from"./omrFormat-C3L8_xkq.js";import{m as b,T as O,F as B,l as L,h as g}from"./ErpApp-3NZWEkOD.js";import{aV as x,aB as i,b5 as R,aM as z,aL as o,aY as P}from"./IdurarOs-BmcscLXI.js";import{s as h}from"./index-DsmABsHN.js";import{P as w}from"./index-DhPG3d6O.js";import{C as s}from"./index-D7xQuJHc.js";import{S as n}from"./index-BSG--CcV.js";import{D as a}from"./index-sVFtD4ck.js";import{F as d}from"./Table-B_wqoxqg.js";import{A as T}from"./ArrowLeftOutlined-w1HDcRvD.js";import"./ActionButton-B143qCRe.js";import"./Skeleton-DKI-OLNZ.js";import"./index-HED-hjAe.js";import"./PlusOutlined-C2sCGP9k.js";const{Title:E}=P;function D(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const M={draft:"default",received:"blue",approved:"cyan",partially_paid:"orange",paid:"green",overdue:"red",cancelled:"default"};function Z(){var p,j;const c=I(),{id:l}=C(),[t,v]=y.useState(null);y.useEffect(()=>{fetch(x+`vendorbill/read/${l}`,{headers:D()}).then(r=>r.json()).then(r=>{r.success&&v(r.result)}).catch(()=>{})},[l]);const S=async()=>{await fetch(x+`vendorbill/delete/${l}`,{method:"DELETE",headers:D()}),h.success("Deleted"),c("/vendor-bill")};if(!t)return e.jsx("div",{style:{padding:24},children:"Loading…"});const F=[{title:"Description",dataIndex:"description"},{title:"Qty",dataIndex:"quantity",width:80,align:"right"},{title:"Unit Price",dataIndex:"unitPrice",align:"right",render:r=>`${parseFloat(r||0).toFixed(4)} ${t.currency}`},{title:"Total",dataIndex:"total",align:"right",render:r=>e.jsxs("b",{children:[parseFloat(r||0).toFixed(3)," ",t.currency]})}];return e.jsxs("div",{style:{padding:24,maxWidth:900},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(b,{children:[e.jsx(i,{icon:e.jsx(T,{}),onClick:()=>c("/vendor-bill")}),e.jsxs(E,{level:4,style:{margin:0,color:"#034D57"},children:["BILL-",t.number,"/",t.year]}),e.jsx(O,{color:M[t.status],children:(p=t.status)==null?void 0:p.replace(/_/g," ").toUpperCase()})]}),e.jsxs(b,{children:[e.jsx(i,{icon:e.jsx(B,{}),style:{borderColor:"#034D57",color:"#034D57"},onClick:async()=>{try{const r=await fetch(`${x}vendorbill/pdf/${l}`,{headers:{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}});if(!r.ok){h.error("Failed to generate PDF");return}const m=await r.blob(),f=URL.createObjectURL(m),u=document.createElement("a");u.href=f,u.download=`BILL-${(t==null?void 0:t.number)||l}.pdf`,u.click(),URL.revokeObjectURL(f)}catch{h.error("PDF download failed")}},children:"Download PDF"}),e.jsx(i,{icon:e.jsx(R,{}),onClick:()=>c(`/vendor-bill/edit/${l}`),children:"Edit"}),e.jsx(w,{title:"Delete this bill?",onConfirm:S,children:e.jsx(i,{danger:!0,icon:e.jsx(L,{}),children:"Delete"})})]})]}),e.jsxs(z,{gutter:12,style:{marginBottom:16},children:[e.jsx(o,{xs:12,sm:6,children:e.jsx(s,{size:"small",children:e.jsx(n,{title:"Total",value:`${parseFloat(t.total||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:"#034D57"}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(s,{size:"small",children:e.jsx(n,{title:"Paid",value:`${parseFloat(t.amountPaid||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:"#4CB480"}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(s,{size:"small",children:e.jsx(n,{title:"Balance Due",value:`${parseFloat(t.balanceDue||0).toFixed(3)} ${t.currency}`,valueStyle:{fontSize:14,color:t.balanceDue>0?"#e53e3e":"#4CB480",fontWeight:700}})})}),e.jsx(o,{xs:12,sm:6,children:e.jsx(s,{size:"small",children:e.jsx(n,{title:"OMR Equivalent",value:parseFloat(t.totalOMR||0).toFixed(3),suffix:$(),valueStyle:{fontSize:14}})})})]}),e.jsx(s,{title:"Bill Details",size:"small",style:{marginBottom:16},children:e.jsxs(a,{column:{xs:1,sm:2},bordered:!0,size:"small",children:[e.jsx(a.Item,{label:"Vendor",children:e.jsx("b",{children:((j=t.vendor)==null?void 0:j.companyName)||"—"})}),e.jsx(a.Item,{label:"Vendor Invoice #",children:t.vendorRef||"—"}),e.jsx(a.Item,{label:"Bill Date",children:t.date?g(t.date).format("DD MMM YYYY"):"—"}),e.jsx(a.Item,{label:"Due Date",children:t.dueDate?g(t.dueDate).format("DD MMM YYYY"):"—"}),e.jsxs(a.Item,{label:"Currency",children:[t.currency," (rate: ",t.exchangeRate||1,")"]}),e.jsx(a.Item,{label:"Linked PO",children:t.purchaseOrder?`PO-${t.purchaseOrder.number}/${t.purchaseOrder.year}`:"—"}),e.jsxs(a.Item,{label:"Tax",children:[parseFloat(t.taxAmount||0).toFixed(3)," ",t.currency]}),t.notes&&e.jsx(a.Item,{label:"Notes",span:2,children:t.notes})]})}),e.jsx(s,{title:"Line Items",size:"small",children:e.jsx(d,{columns:F,dataSource:t.items||[],rowKey:(r,m)=>m,pagination:!1,size:"small",summary:()=>e.jsxs(d.Summary.Row,{children:[e.jsx(d.Summary.Cell,{index:0,colSpan:3,align:"right",children:e.jsx("b",{children:"Total"})}),e.jsx(d.Summary.Cell,{index:1,align:"right",children:e.jsxs("b",{style:{color:"#034D57"},children:[parseFloat(t.total||0).toFixed(3)," ",t.currency]})})]})})})]})}export{Z as default};
