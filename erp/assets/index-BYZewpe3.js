import{r as l,j as e}from"./index-DUJms0D6.js";import{a as V}from"./omrFormat-C4CQjmYz.js";import{d as $}from"./dayjs.min-BzahnmbO.js";import{X as L,b as U,aG as s,ai as i,aw as Y,aA as q,aB as n,aD as o,ar as J,ay as d}from"./IdurarOs-B30-LCOQ.js";import{l as h,Q as W}from"./ErpApp-DDkabuKV.js";import{C as b}from"./index-CyAxxhY0.js";import{S as G}from"./index-BF93yvfc.js";import{T as S}from"./index-DvoWVJab.js";import{P as K}from"./index-DFrivB9v.js";import{M as v}from"./index-BEcbaSPx.js";import{S as I}from"./index-dR7Ye1Yy.js";import{T as w}from"./index-CkFZCKkj.js";import{S as Q}from"./index-B6wmE2T_.js";import{F as X}from"./Table-B0UCs-zn.js";import{s as m}from"./index-Bcgt9tpb.js";import{P as Z}from"./PlusOutlined-CXK5kHAC.js";import{D as ee}from"./DeleteOutlined-Cwki4DTc.js";import"./Skeleton-DxrcQ8CB.js";import"./index-HdV2iirx.js";import"./pickAttrs-DfTUuTsA.js";import"./useClosable-BcPbIM0E.js";import"./ActionButton-4R6uE_jt.js";import"./fade-DETort7_.js";import"./DownOutlined-BJeYAz_H.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M536.1 273H488c-4.4 0-8 3.6-8 8v275.3c0 2.6 1.2 5 3.3 6.5l165.3 120.7c3.6 2.6 8.6 1.9 11.2-1.7l28.6-39c2.7-3.7 1.9-8.7-1.7-11.2L544.1 528.5V281c0-4.4-3.6-8-8-8zm219.8 75.2l156.8 38.3c5 1.2 9.9-2.6 9.9-7.7l.8-161.5c0-6.7-7.7-10.5-12.9-6.3L752.9 334.1a8 8 0 003 14.1zm167.7 301.1l-56.7-19.5a8 8 0 00-10.1 4.8c-1.9 5.1-3.9 10.1-6 15.1-17.8 42.1-43.3 80-75.9 112.5a353 353 0 01-112.5 75.9 352.18 352.18 0 01-137.7 27.8c-47.8 0-94.1-9.3-137.7-27.8a353 353 0 01-112.5-75.9c-32.5-32.5-58-70.4-75.9-112.5A353.44 353.44 0 01171 512c0-47.8 9.3-94.2 27.8-137.8 17.8-42.1 43.3-80 75.9-112.5a353 353 0 01112.5-75.9C430.6 167.3 477 158 524.8 158s94.1 9.3 137.7 27.8A353 353 0 01775 261.7c10.2 10.3 19.8 21 28.6 32.3l59.8-46.8C784.7 146.6 662.2 81.9 524.6 82 285 82.1 92.6 276.7 95 516.4 97.4 751.9 288.9 942 524.8 942c185.5 0 343.5-117.6 403.7-282.3 1.5-4.2-.7-8.9-4.9-10.4z"}}]},name:"history",theme:"outlined"},se=function(j,D){return l.createElement(L,U({},j,{ref:D,icon:te}))};const ae=l.forwardRef(se),{Title:ne}=J;function O(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function z(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}function Fe(){const[p,j]=l.useState([]),[D,T]=l.useState(!1),[M,B]=l.useState(!1),[N,k]=l.useState(!1),[c,A]=l.useState(null),[r,C]=l.useState(null),[f]=s.useForm(),[y]=s.useForm(),u=async()=>{T(!0);const t=await fetch(d+"bankaccount/list",{headers:O()}).then(a=>a.json()).catch(()=>({}));t.success&&j(t.result||[]),T(!1)};l.useEffect(()=>{u()},[]);const F=(t=null)=>{A(t),f.setFieldsValue(t?{...t}:{type:"current",currency:"OMR",isDefault:!1,isActive:!0}),B(!0)},g=()=>{B(!1),f.resetFields(),A(null)},E=async t=>{const a=c?d+`bankaccount/update/${c._id}`:d+"bankaccount/create",x=await fetch(a,{method:c?"PATCH":"POST",headers:z(),body:JSON.stringify(t)}).then(H=>H.json()).catch(()=>({}));x.success?(m.success(c?"Updated":"Created"),g(),u()):m.error(x.message||"Failed")},P=async t=>{const a=await fetch(d+`bankaccount/transaction/${r._id}`,{method:"POST",headers:z(),body:JSON.stringify(t)}).then(x=>x.json()).catch(()=>({}));a.success?(m.success("Transaction recorded"),y.resetFields(),u(),C(a.result)):m.error(a.message||"Failed")},R=async t=>{await fetch(d+`bankaccount/delete/${t}`,{method:"DELETE",headers:O()}),m.success("Deleted"),u()},_=p.reduce((t,a)=>t+(a.currency==="OMR"&&a.currentBalance||0),0);return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(h,{children:[e.jsx(W,{style:{color:"#034D57",fontSize:20}}),e.jsx(ne,{level:4,style:{margin:0,color:"#034D57"},children:"Bank Accounts"})]}),e.jsx(i,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>F(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx(b,{size:"small",style:{marginBottom:16,background:"#f0f9f9"},children:e.jsx(G,{title:"Total Balance",value:_.toFixed(3),suffix:V(13),valueStyle:{color:"#034D57",fontWeight:700}})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:12},children:p.map(t=>e.jsxs(b,{size:"small",title:e.jsxs(h,{children:[t.isDefault&&e.jsx(S,{color:"gold",children:"DEFAULT"}),e.jsx("b",{children:t.name})]}),extra:e.jsxs(h,{children:[e.jsx(i,{size:"small",icon:e.jsx(ae,{}),onClick:()=>{C(t),k(!0)}}),e.jsx(i,{size:"small",icon:e.jsx(Y,{}),onClick:()=>F(t)}),e.jsx(K,{title:"Delete?",onConfirm:()=>R(t._id),children:e.jsx(i,{size:"small",danger:!0,icon:e.jsx(ee,{})})})]}),children:[e.jsxs("div",{style:{fontSize:22,fontWeight:700,color:t.currentBalance>=0?"#034D57":"#e53e3e"},children:[parseFloat(t.currentBalance||0).toFixed(3)," ",e.jsx("span",{style:{fontSize:14},children:t.currency})]}),e.jsxs("div",{style:{color:"#888",fontSize:12,marginTop:4},children:[t.bankName," • ",t.accountNumber||"—"]}),e.jsx(S,{style:{marginTop:6},children:t.type})]},t._id))}),e.jsx(v,{title:c?"Edit Account":"New Bank Account",open:M,onCancel:g,footer:null,width:540,children:e.jsxs(s,{form:f,layout:"vertical",onFinish:E,children:[e.jsxs(q,{gutter:12,children:[e.jsx(n,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Account Label",rules:[{required:!0}],children:e.jsx(o,{placeholder:"e.g. NBO Main Account"})})}),e.jsx(n,{xs:24,sm:8,children:e.jsx(s.Item,{name:"type",label:"Type",initialValue:"current",children:e.jsx(I,{options:["current","savings","petty_cash","other"].map(t=>({value:t,label:t.replace(/_/g," ")}))})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"bankName",label:"Bank Name",children:e.jsx(o,{placeholder:"National Bank of Oman"})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"accountNumber",label:"Account Number",children:e.jsx(o,{})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"iban",label:"IBAN",children:e.jsx(o,{})})}),e.jsx(n,{xs:24,sm:12,children:e.jsx(s.Item,{name:"swiftCode",label:"SWIFT Code",children:e.jsx(o,{})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(I,{options:["OMR","USD","EUR"].map(t=>({value:t,label:t}))})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"openingBalance",label:"Opening Balance",initialValue:0,children:e.jsx(w,{precision:3,style:{width:"100%"}})})}),e.jsx(n,{xs:12,sm:8,children:e.jsx(s.Item,{name:"isDefault",label:"Default",valuePropName:"checked",initialValue:!1,children:e.jsx(Q,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(h,{children:[e.jsx(i,{onClick:g,children:"Cancel"}),e.jsx(i,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})}),e.jsx(v,{title:`Transactions — ${(r==null?void 0:r.name)||""}`,open:N,onCancel:()=>{k(!1),y.resetFields()},footer:null,width:680,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"small",style:{marginBottom:12},children:e.jsxs(s,{form:y,layout:"inline",onFinish:P,children:[e.jsx(s.Item,{name:"type",label:"Type",initialValue:"credit",rules:[{required:!0}],children:e.jsx(I,{options:[{value:"credit",label:"Credit (In)"},{value:"debit",label:"Debit (Out)"}],style:{width:140}})}),e.jsx(s.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(w,{min:0,precision:3,placeholder:"0.000"})}),e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(o,{placeholder:"Description",style:{width:160}})}),e.jsx(s.Item,{children:e.jsx(i,{type:"primary",htmlType:"submit",size:"small",style:{background:"#034D57"},children:"Add"})})]})}),e.jsx(X,{size:"small",rowKey:(t,a)=>a,pagination:{pageSize:10},dataSource:[...r.transactions||[]].reverse(),columns:[{title:"Date",dataIndex:"date",width:110,render:t=>$(t).format("DD MMM YYYY")},{title:"Type",dataIndex:"type",width:70,render:t=>e.jsx(S,{color:t==="credit"?"green":"red",children:t})},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"Amount",dataIndex:"amount",align:"right",render:(t,a)=>e.jsx("span",{style:{color:a.type==="credit"?"#4CB480":"#e53e3e"},children:parseFloat(t||0).toFixed(3)})},{title:"Balance",dataIndex:"balance",align:"right",render:t=>e.jsx("b",{children:parseFloat(t||0).toFixed(3)})}]})]})})]})}export{Fe as default};
