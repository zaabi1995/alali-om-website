import{m as W,r as l,j as t}from"./index-qzPW9k5C.js";import{az as I,ai as P,aB as K,aC as Z,aE as J,aN as Y,ar as X}from"./IdurarOs-DNtyhAIr.js";import{R as ee}from"./ReloadOutlined-B9Mm6w-F.js";import{C as j}from"./index-BT6S6B4u.js";import{S as te}from"./index-ByIMSrJ7.js";import{m as re}from"./ErpApp-C6krObaP.js";import{S as v}from"./index-B6mZ1Nih.js";import{T as se}from"./index-C5J7yocW.js";import{T as oe}from"./ThunderboltOutlined-Co1J3G4Y.js";import{F as ae}from"./Table-BEwP-RQB.js";import{T as f}from"./index-BcmoYINL.js";import{B as ie}from"./index-CBi-E_bn.js";import"./Skeleton-r7dioW59.js";import"./pickAttrs-HYIWXRHU.js";import"./index-Bcrj0uk5.js";import"./DownOutlined-Cv0sD8Lj.js";import"./PlusOutlined-BhF-bFT8.js";import"./Pagination-DLTxefs_.js";import"./useClosable-D4tg0jNW.js";function B(){var d,y;try{const p=(y=(d=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:d.current)==null?void 0:y.token;return p?{Authorization:`Bearer ${p}`}:{}}catch{return{}}}const{Title:le,Text:R}=X,{Option:n}=v,u="#034D57",D="#4CB480",ne={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},ce={ior:"red",routine:"orange",normal:"default"},de=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function qe(){var A,O,T,L,q;const d=W(),[y,p]=l.useState([]),[E,w]=l.useState(!0),[s,N]=l.useState(null),[ue,$]=l.useState({}),[S,C]=l.useState({current:1,pageSize:25,total:0}),[h,F]=l.useState("ALL"),[i,m]=l.useState({status:"",priority:"all",q:""}),[M,Q]=l.useState(""),k=l.useCallback(async()=>{try{const r=await(await fetch(I+"rfq/stats",{headers:B()})).json();r.success&&N(r.result)}catch{}},[]),x=l.useCallback(async(e=1)=>{w(!0);try{const r=new URLSearchParams({page:e,items:S.pageSize,...i.status&&i.status!=="active"?{status:i.status}:i.status==="active"?{status:"new,in_progress,researched"}:{},...i.priority!=="all"?{priority:i.priority}:{},...h!=="ALL"?{client:h}:{},...i.q?{q:i.q}:{}}),a=await(await fetch(I+`rfq/list?${r}`,{headers:B()})).json();if(a.success){p(a.result||[]),C(g=>{var z,_;return{...g,current:e,total:((z=a.pagination)==null?void 0:z.total)||((_=a.result)==null?void 0:_.length)||0}});const c={};(a.result||[]).forEach(g=>{c[g.client]=(c[g.client]||0)+1}),$(c)}}catch{}finally{w(!1)}},[i,h,S.pageSize]);l.useEffect(()=>{k()},[]),l.useEffect(()=>{x(1)},[i,h]);const b=e=>{if(!e.receivedAt)return null;const r=new Date(e.receivedAt),o=e.priority==="ior"?7:10,a=new Date(r.getTime()+o*864e5);return Math.ceil((a-new Date)/864e5)},G=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(e,r)=>t.jsxs("div",{children:[t.jsx(R,{strong:!0,style:{color:u,cursor:"pointer",fontSize:13},onClick:()=>d(`/rfq/${r._id}`),children:e||"â€”"}),r.priority==="ior"&&t.jsx(f,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:e=>t.jsx(f,{color:u,style:{color:"#fff",fontSize:11},children:e})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(e,r)=>t.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>d(`/rfq/${r._id}`),children:e})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,render:e=>t.jsx(f,{color:ce[e]||"default",children:(e||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>t.jsx(f,{color:ne[e]||"default",children:e==null?void 0:e.replace("_"," ")})},{title:"Parts",key:"parts",width:70,render:(e,r)=>t.jsx(ie,{count:r.partsCount||0,showZero:!0,style:{backgroundColor:r.partsCount>0?D:"#e5e7eb",color:r.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,render:e=>e?new Date(e).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"Deadline",key:"deadline",width:110,sorter:(e,r)=>{const o=b(e),a=b(r);return o-a},render:(e,r)=>{if(["expired","quoted","won","lost"].includes(r.status))return t.jsx(R,{type:"secondary",style:{fontSize:11},children:"â€”"});const o=b(r);if(o===null)return t.jsx(R,{type:"secondary",style:{fontSize:11},children:"â€”"});let a,c;return o<0?(a="#ef4444",c=`${Math.abs(o)}d overdue`):o<=2?(a="#ef4444",c=`${o}d left`):o<=5?(a="#f59e0b",c=`${o}d left`):(a="#22c55e",c=`${o}d left`),t.jsx(f,{color:a,style:{fontSize:11,fontWeight:600},children:c})}},{title:"",key:"action",width:60,render:(e,r)=>t.jsx(P,{size:"small",type:"link",style:{color:u,padding:0},onClick:()=>d(`/rfq/${r._id}`),children:"View â†’"})}],H=((A=s==null?void 0:s.byPriority)==null?void 0:A.ior)||0,V=(((O=s==null?void 0:s.byStatus)==null?void 0:O.new)||0)+(((T=s==null?void 0:s.byStatus)==null?void 0:T.in_progress)||0)+(((L=s==null?void 0:s.byStatus)==null?void 0:L.researched)||0),U=((q=s==null?void 0:s.byStatus)==null?void 0:q.quoted)||0;return t.jsxs("div",{style:{padding:20,background:"#f0f2f5",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(le,{level:3,style:{color:u,margin:0},children:"ðŸ“‹ RFQ Management"}),t.jsx(P,{icon:t.jsx(ee,{}),onClick:()=>{k(),x(1)},style:{borderColor:u,color:u},children:"Refresh"})]}),t.jsx(K,{gutter:[12,12],style:{marginBottom:16},children:[{title:"Total RFQs",value:(s==null?void 0:s.total)||0,color:u},{title:"Active",value:V,color:"#3b82f6"},{title:"IOR Priority",value:H,color:"#ef4444"},{title:"Total Parts",value:(s==null?void 0:s.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:U,color:D},{title:"Vendors",value:(s==null?void 0:s.totalVendors)||0,color:"#f59e0b"}].map(({title:e,value:r,color:o})=>t.jsx(Z,{xs:8,sm:4,children:t.jsx(j,{size:"small",style:{borderTop:`3px solid ${o}`,borderRadius:8,textAlign:"center"},children:t.jsx(te,{title:e,value:r,valueStyle:{color:o,fontSize:18,fontWeight:700}})})},e))}),t.jsx(j,{size:"small",style:{marginBottom:12,borderRadius:8},children:t.jsxs(re,{wrap:!0,children:[t.jsx(J.Search,{placeholder:"Search RFQ#, part, subject...",value:M,onChange:e=>Q(e.target.value),onSearch:e=>m(r=>({...r,q:e})),onPressEnter:e=>m(r=>({...r,q:e.target.value})),style:{width:260},prefix:t.jsx(Y,{style:{color:"#9ca3af"}})}),t.jsxs(v,{value:i.status||"active",onChange:e=>m(r=>({...r,status:e})),style:{width:140},children:[t.jsx(n,{value:"active",children:"Active"}),t.jsx(n,{value:"new",children:"New"}),t.jsx(n,{value:"in_progress",children:"In Progress"}),t.jsx(n,{value:"researched",children:"Researched"}),t.jsx(n,{value:"quoted",children:"Quoted"}),t.jsx(n,{value:"won",children:"Won"}),t.jsx(n,{value:"lost",children:"Lost"}),t.jsx(n,{value:"",children:"All Statuses"})]}),t.jsxs(v,{value:i.priority,onChange:e=>m(r=>({...r,priority:e})),style:{width:120},children:[t.jsx(n,{value:"all",children:"All Priority"}),t.jsx(n,{value:"ior",children:"ðŸš¨ IOR"}),t.jsx(n,{value:"routine",children:"Routine"}),t.jsx(n,{value:"normal",children:"Normal"})]})]})}),t.jsxs(j,{style:{borderRadius:8},bodyStyle:{padding:0},children:[t.jsx(se,{activeKey:h,onChange:e=>{F(e),x(1)},size:"small",style:{paddingLeft:8},items:de.map(({key:e,label:r})=>({key:e,label:t.jsxs("span",{children:[e==="ALL"?t.jsx(oe,{}):null," ",r]})}))}),t.jsx(ae,{rowKey:"_id",columns:G,dataSource:y,loading:E,size:"small",pagination:{...S,showSizeChanger:!1,showTotal:e=>`${e} RFQs`,onChange:e=>{C(r=>({...r,current:e})),x(e)}},rowClassName:e=>e.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:900},onRow:e=>({onClick:()=>d(`/rfq/${e._id}`),style:{cursor:"pointer"}})})]}),t.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{qe as default};
