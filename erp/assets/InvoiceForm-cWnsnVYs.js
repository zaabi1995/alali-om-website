import{u as S,j as e,r}from"./index-BJn_oD1P.js";import{d as f}from"./dayjs.min-DKvTBr6F.js";import{A as y}from"./index-CsdX8X-p.js";import{I as k,M as m}from"./index-Zv0RFe-1.js";import{h as T,f as b}from"./ErpApp-D8KMIIKs.js";import"./currency.es-9OAR_aOO.js";import{u as M}from"./useDate-BmVZ7EaN.js";import{aM as c,aL as a,b8 as s,aX as U,aW as w,aB as N,aU as B}from"./IdurarOs-B9KFkIUP.js";import{c as x}from"./calculate-CoT1A6Sl.js";import{S as _}from"./index-iZVoAG3j.js";import{T as v}from"./index-Dy-DZAaz.js";import{D as I}from"./index-B4Fnp3iN.js";import{P as R}from"./PlusOutlined-XHDMkaJO.js";function se({subTotal:l=0,current:i=null}){const{last_invoice_number:t}=S(T);return t===void 0?e.jsx(e.Fragment,{}):e.jsx(Y,{subTotal:l,current:i})}function Y({subTotal:l=0,current:i=null}){const t=B(),{dateFormat:p}=M(),{last_invoice_number:F}=S(T),[D,L]=r.useState(0),[u,j]=r.useState(0),[A,E]=r.useState(0),[C,P]=r.useState(()=>new Date().getFullYear()),[V,q]=r.useState(()=>F+1),O=n=>{j(n/100)};r.useEffect(()=>{if(i){const{taxRate:n=0,year:d,number:o}=i;j(n/100),P(d),q(o)}},[i]),r.useEffect(()=>{const n=x.add(x.multiply(l,u),l);E(Number.parseFloat(x.multiply(l,u))),L(Number.parseFloat(n))},[l,u]);const h=r.useRef(!1);return r.useEffect(()=>{h.current.click()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(c,{gutter:[12,0],children:[e.jsx(a,{className:"gutter-row",span:8,children:e.jsx(s.Item,{name:"client",label:t("Client"),rules:[{required:!0}],children:e.jsx(y,{entity:"client",displayLabels:["name"],searchFields:"name",redirectLabel:"Add New Client",withRedirect:!0,urlToRedirect:"/customer"})})}),e.jsx(a,{className:"gutter-row",span:3,children:e.jsx(s.Item,{label:t("number"),name:"number",initialValue:V,rules:[{required:!0}],children:e.jsx(v,{min:1,style:{width:"100%"}})})}),e.jsx(a,{className:"gutter-row",span:3,children:e.jsx(s.Item,{label:t("year"),name:"year",initialValue:C,rules:[{required:!0}],children:e.jsx(v,{style:{width:"100%"}})})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(s.Item,{label:t("status"),name:"status",rules:[{required:!1}],initialValue:"draft",children:e.jsx(b,{options:[{value:"draft",label:t("Draft")},{value:"pending",label:t("Pending")},{value:"sent",label:t("Sent")}]})})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(s.Item,{label:t("Currency"),name:"currency",rules:[{required:!0}],initialValue:"OMR",children:e.jsx(b,{options:[{value:"OMR",label:"OMR (ر.ع.)"},{value:"USD",label:"USD ($)"},{value:"EUR",label:"EUR (€)"},{value:"AED",label:"AED (د.إ)"},{value:"GBP",label:"GBP (£)"}]})})}),e.jsx(a,{className:"gutter-row",span:8,children:e.jsx(s.Item,{name:"date",label:t("Date"),rules:[{required:!0,type:"object"}],initialValue:f(),children:e.jsx(I,{style:{width:"100%"},format:p})})}),e.jsx(a,{className:"gutter-row",span:6,children:e.jsx(s.Item,{name:"expiredDate",label:t("Expire Date"),rules:[{required:!0,type:"object"}],initialValue:f().add(30,"days"),children:e.jsx(I,{style:{width:"100%"},format:p})})}),e.jsx(a,{className:"gutter-row",span:10,children:e.jsx(s.Item,{label:t("Note"),name:"notes",children:e.jsx(U,{})})}),e.jsx(a,{className:"gutter-row",span:6,children:e.jsx(s.Item,{label:"Project",name:"project",children:e.jsx(y,{entity:"project",displayLabels:["name"],searchFields:"name",redirectLabel:"Add New Project",withRedirect:!0,urlToRedirect:"/projects/create"})})})]}),e.jsx(w,{dashed:!0}),e.jsxs(c,{gutter:[12,12],style:{position:"relative"},children:[e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Item")})}),e.jsx(a,{className:"gutter-row",span:7,children:e.jsx("p",{children:t("Description")})}),e.jsxs(a,{className:"gutter-row",span:3,children:[e.jsx("p",{children:t("Quantity")})," "]}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{children:t("Price")})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Total")})})]}),e.jsx(s.List,{name:"items",children:(n,{add:d,remove:o})=>e.jsxs(e.Fragment,{children:[n.map(g=>e.jsx(k,{remove:o,field:g,current:i},g.key)),e.jsx(s.Item,{children:e.jsx(N,{type:"dashed",onClick:()=>d(),block:!0,icon:e.jsx(R,{}),ref:h,children:t("Add field")})})]})}),e.jsx(w,{dashed:!0}),e.jsxs("div",{style:{position:"relative",width:" 100%",float:"right"},children:[e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(s.Item,{children:e.jsx(N,{type:"primary",htmlType:"submit",icon:e.jsx(R,{}),block:!0,children:t("Save")})})}),e.jsx(a,{className:"gutter-row",span:4,offset:10,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px",margin:0,textAlign:"right"},children:[t("Sub Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:l})})]}),e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:4,offset:15,children:e.jsx(s.Item,{name:"taxRate",rules:[{required:!0}],children:e.jsx(_,{value:u,onChange:O,entity:"taxes",outputValue:"taxValue",displayLabels:["taxName"],withRedirect:!0,urlToRedirect:"/taxes",redirectLabel:t("Add New Tax"),placeholder:t("Select Tax Value")})})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:A})})]}),e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:4,offset:15,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px",margin:0,textAlign:"right"},children:[t("Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:D})})]})]})]})}export{se as I};
