import{r as i,n as L,m as I,u as k,j as e}from"./index-DCPoF18Q.js";import{P as M}from"./index-BX3nTfkL.js";import{O as P,g as D,aB as u,b6 as B,aS as F,b5 as V,aM as g,aW as y,aL as r,aU as W}from"./IdurarOs-36KeyrIs.js";import{e as T}from"./actions-hX-fzDBg.js";import{s as m}from"./index-KrFx5yLV.js";import{c as z}from"./selectors-Bxm8VEt4.js";import{u as _}from"./useMoney-CUDQ7ueI.js";import{F as H}from"./ErpApp-BmqyEhL9.js";import{u as q}from"./useMail-CZxOfiCb.js";import{S as p}from"./index-BBRAo3ft.js";import{D as j}from"./index-CUVOI16b.js";import{s as U}from"./index-DJ9hgZOD.js";import{M as Q}from"./index-DTIkA3MZ.js";import{E as Y}from"./ExclamationCircleOutlined-BrpqlFZR.js";import{C as G}from"./CloseCircleOutlined-Cn5CsYL4.js";var J={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},K=function(c,s){return i.createElement(P,D({},c,{ref:s,icon:J}))};const X=i.forwardRef(K),Z=({item:n,currentErp:c})=>{const{moneyFormatter:s}=_();return e.jsxs(g,{gutter:[12,0],children:[e.jsxs(r,{className:"gutter-row",span:11,children:[e.jsx("p",{style:{marginBottom:5},children:e.jsx("strong",{children:n.itemName})}),e.jsx("p",{children:n.description})]}),e.jsx(r,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:s({amount:n.price,currency_code:c.currency})})}),e.jsx(r,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:n.quantity})}),e.jsx(r,{className:"gutter-row",span:5,children:e.jsx("p",{style:{textAlign:"right",fontWeight:"700"},children:s({amount:n.total,currency_code:c.currency})})}),e.jsx(y,{dashed:!0,style:{marginTop:0,marginBottom:15}})]},n._id)};function pe({config:n,selectedItem:c}){const s=W(),{entity:a,ENTITY_NAME:S}=n,v=L(),f=I(),{moneyFormatter:l}=_(),{send:$,isLoading:b}=q({entity:a}),{result:x}=k(z),N={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[E,w]=i.useState([]),[t,C]=i.useState(c??N),[o,O]=i.useState({}),R=()=>{if(!o.email){U.error("Client has no email address");return}Q.confirm({title:"Send Email",icon:e.jsx(Y,{}),content:e.jsxs("div",{children:[e.jsxs("p",{children:["Send ",e.jsxs("strong",{children:[S," #",t.number,"/",t.year||""]})," to:"]}),e.jsx("p",{children:e.jsx("strong",{children:o.name})}),e.jsx("p",{children:o.email}),e.jsx("p",{style:{marginTop:12,fontSize:"12px",color:"#666"},children:"CC: ali@alali.om"})]}),okText:"Send Email",cancelText:"Cancel",onOk:()=>{$(t._id)}})};return i.useEffect(()=>{if(x){const{items:d,invoice:h,...A}=x;d?(w(d),C(x)):h.items&&(w(h.items),C({...h.items,...A,...h}))}return()=>{w([]),C(N)}},[x]),i.useEffect(()=>{t!=null&&t.client&&O(t.client)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(M,{onBack:()=>{f(`/${a.toLowerCase()}`)},title:`${S} # ${t.number}/${t.year||""}`,ghost:!1,tags:[e.jsx("span",{children:t.status&&s(t.status)},"status"),t.paymentStatus&&e.jsx("span",{children:t.paymentStatus&&s(t.paymentStatus)},"paymentStatus")],extra:[e.jsx(u,{onClick:()=>{f(`/${a.toLowerCase()}`)},icon:e.jsx(G,{}),children:s("Close")},`${m.generate()}`),e.jsx(u,{onClick:()=>{window.open(`${B}${a}/${a}-${t._id}.pdf`,"_blank")},icon:e.jsx(H,{}),children:s("Download PDF")},`${m.generate()}`),e.jsx(u,{loading:b,onClick:R,icon:e.jsx(F,{}),children:s("Send by Email")},`${m.generate()}`),e.jsx(u,{onClick:()=>{v(T.convert({entity:a,id:t._id}))},icon:e.jsx(X,{}),style:{display:a==="quote"?"inline-block":"none"},children:s("Convert to Invoice")},`${m.generate()}`),e.jsx(u,{onClick:()=>{v(T.currentAction({actionType:"update",data:t})),f(`/${a.toLowerCase()}/update/${t._id}`)},type:"primary",icon:e.jsx(V,{}),children:s("Edit")},`${m.generate()}`)],style:{padding:"20px 0px"},children:e.jsxs(g,{children:[e.jsx(p,{title:"Status",value:t.status}),e.jsx(p,{title:s("SubTotal"),value:l({amount:t.subTotal,currency_code:t.currency}),style:{margin:"0 32px"}}),e.jsx(p,{title:s("Total"),value:l({amount:t.total,currency_code:t.currency}),style:{margin:"0 32px"}}),e.jsx(p,{title:s("Paid"),value:l({amount:t.credit,currency_code:t.currency}),style:{margin:"0 32px"}})]})}),e.jsx(y,{dashed:!0}),e.jsxs(j,{title:`Client : ${t.client.name}`,children:[e.jsx(j.Item,{label:s("Address"),children:o.address}),e.jsx(j.Item,{label:s("email"),children:o.email}),e.jsx(j.Item,{label:s("Phone"),children:o.phone})]}),e.jsx(y,{}),e.jsxs(g,{gutter:[12,0],children:[e.jsx(r,{className:"gutter-row",span:11,children:e.jsx("p",{children:e.jsx("strong",{children:s("Product")})})}),e.jsx(r,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Price")})})}),e.jsx(r,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Quantity")})})}),e.jsx(r,{className:"gutter-row",span:5,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Total")})})}),e.jsx(y,{})]}),E.map(d=>e.jsx(Z,{item:d,currentErp:t},d._id)),e.jsx("div",{style:{width:"300px",float:"right",textAlign:"right",fontWeight:"700"},children:e.jsxs(g,{gutter:[12,-5],children:[e.jsx(r,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Sub Total")," :"]})}),e.jsx(r,{className:"gutter-row",span:12,children:e.jsx("p",{children:l({amount:t.subTotal,currency_code:t.currency})})}),e.jsx(r,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Tax Total")," (",t.taxRate," %) :"]})}),e.jsx(r,{className:"gutter-row",span:12,children:e.jsx("p",{children:l({amount:t.taxTotal,currency_code:t.currency})})}),e.jsx(r,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Total")," :"]})}),e.jsx(r,{className:"gutter-row",span:12,children:e.jsx("p",{children:l({amount:t.total,currency_code:t.currency})})})]})})]})}export{pe as R};
