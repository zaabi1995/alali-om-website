import{r as i,j as e,m as ne}from"./index-3oIExkJi.js";import{O as ie,g as oe,b8 as C,aB as j,C as ce,aM as G,aL as O,aW as de,aV as W,aX as ue,U as he,aY as pe}from"./IdurarOs-Cv9DOsbU.js";import{w as D,T as R,e as A,O as ee,D as me,x as fe,y as xe}from"./ErpApp-C4NFy_tQ.js";import{C as B}from"./index-Co9JGffh.js";import{T as te}from"./index-CN5LBpTd.js";import{D as ye}from"./index-MxK396yh.js";import{S as je}from"./SaveOutlined-BizsepzF.js";import{R as be}from"./ReloadOutlined-DHEyNoKT.js";import{s as F}from"./index-DUhxTz7y.js";import{S as ge}from"./index-B0c2RDcT.js";import{T as ve}from"./index-0avTurvo.js";import{T as Se}from"./ThunderboltOutlined-DjTtXb2F.js";import{F as we}from"./Table-Dv3g7-RV.js";import"./Skeleton-B8mAodW2.js";import"./ClockCircleOutlined-Me9fMLSP.js";import"./PlusOutlined-CNL-RZ2c.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Oe=function(m,S){return i.createElement(ie,oe({},m,{ref:S,icon:Ce}))};const Re=i.forwardRef(Oe),{RangePicker:ke}=ye,{Option:E}=A;function Ae({module:o="rfq",onFiltersChange:m,clients:S=[],initialFilters:L={}}){var q;const[x]=C.useForm(),[r,N]=i.useState(!1),[$,z]=i.useState({}),[b,P]=i.useState([]);i.useEffect(()=>{try{const s=localStorage.getItem(`filters_${o}_presets`);s&&P(JSON.parse(s))}catch{}},[o]),i.useEffect(()=>{Object.keys(L).length>0&&(x.setFieldsValue(L),z(L))},[L,x]);const g=()=>{const s=x.getFieldsValue(),a={};Object.keys(s).forEach(u=>{if(s[u]!==void 0&&s[u]!==null&&s[u]!==""&&s[u]!=="all"){if(Array.isArray(s[u])&&s[u].length===0)return;a[u]=s[u]}}),z(a),m&&m(a)},T=()=>{x.resetFields(),z({}),m&&m({})},d=()=>{const s=x.getFieldsValue(),a=prompt("Enter preset name:");if(!a)return;const u={name:a,filters:s,createdAt:new Date().toISOString()},_=[...b,u];P(_),localStorage.setItem(`filters_${o}_presets`,JSON.stringify(_))},k=s=>{x.setFieldsValue(s.filters),g()},M=s=>{const a=b.filter((u,_)=>_!==s);P(a),localStorage.setItem(`filters_${o}_presets`,JSON.stringify(a))},V={rfq:[{value:"all",label:"All Statuses"},{value:"new",label:"New"},{value:"in_progress",label:"In Progress"},{value:"researched",label:"Researched"},{value:"quoted",label:"Quoted"},{value:"won",label:"Won"},{value:"lost",label:"Lost"},{value:"expired",label:"Expired"}],quote:[{value:"all",label:"All Statuses"},{value:"draft",label:"Draft"},{value:"sent",label:"Sent"},{value:"accepted",label:"Accepted"},{value:"declined",label:"Declined"},{value:"expired",label:"Expired"}],invoice:[{value:"all",label:"All Statuses"},{value:"draft",label:"Draft"},{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"partially",label:"Partially Paid"},{value:"overdue",label:"Overdue"},{value:"cancelled",label:"Cancelled"}]},I=[{value:"all",label:"All Priorities"},{value:"routine",label:"Routine"},{value:"urgent",label:"Urgent"},{value:"ior",label:"IOR"}],v=Object.keys($).length;return e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[e.jsxs(j,{icon:e.jsx(Re,{}),onClick:()=>N(!r),type:v>0?"primary":"default",children:["Filters ",v>0&&`(${v})`]}),v>0&&e.jsx(j,{icon:e.jsx(ce,{}),size:"small",onClick:T,children:"Clear All"})]}),v>0&&e.jsx("div",{style:{marginBottom:12},children:e.jsx(D,{wrap:!0,children:Object.entries($).map(([s,a])=>e.jsxs(R,{closable:!0,onClose:()=>{x.setFieldValue(s,void 0),g()},color:"blue",children:[s,": ",typeof a=="object"?JSON.stringify(a):a]},s))})}),r&&e.jsx(B,{size:"small",style:{marginBottom:16,boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:e.jsxs(C,{form:x,layout:"vertical",onFinish:g,children:[e.jsxs(G,{gutter:16,children:[e.jsx(O,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Status",name:"status",children:e.jsx(A,{placeholder:"Select status",allowClear:!0,children:(q=V[o])==null?void 0:q.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})})}),o==="rfq"&&e.jsx(O,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Priority",name:"priority",children:e.jsx(A,{placeholder:"Select priority",allowClear:!0,children:I.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})})}),e.jsx(O,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Client",name:"client",children:e.jsxs(A,{placeholder:"Select client",showSearch:!0,allowClear:!0,filterOption:(s,a)=>a.children.toLowerCase().includes(s.toLowerCase()),children:[e.jsx(E,{value:"all",children:"All Clients"}),S.map(s=>e.jsx(E,{value:s,children:s},s))]})})}),e.jsx(O,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Date Range",name:"dateRange",children:e.jsx(ke,{style:{width:"100%"}})})}),(o==="quote"||o==="invoice")&&e.jsxs(e.Fragment,{children:[e.jsx(O,{xs:12,sm:6,md:3,children:e.jsx(C.Item,{label:e.jsxs(e.Fragment,{children:[e.jsx(ee,{})," Min"]}),name:"minAmount",children:e.jsx(te,{style:{width:"100%"},precision:3,min:0,placeholder:"0.000"})})}),e.jsx(O,{xs:12,sm:6,md:3,children:e.jsx(C.Item,{label:e.jsxs(e.Fragment,{children:[e.jsx(ee,{})," Max"]}),name:"maxAmount",children:e.jsx(te,{style:{width:"100%"},precision:3,min:0,placeholder:"10000.000"})})})]})]}),e.jsx(G,{children:e.jsx(O,{span:24,children:e.jsxs(D,{children:[e.jsx(j,{type:"primary",htmlType:"submit",children:"Apply Filters"}),e.jsx(j,{onClick:T,children:"Clear"}),e.jsx(j,{icon:e.jsx(je,{}),onClick:d,children:"Save Preset"})]})})}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(de,{style:{margin:"16px 0"},children:"Saved Presets"}),e.jsx(D,{wrap:!0,children:b.map((s,a)=>e.jsx(R,{color:"green",closable:!0,onClose:()=>M(a),onClick:()=>k(s),style:{cursor:"pointer"},children:s.name},a))})]})]})})]})}function Q(){var o,m;try{const S=(m=(o=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:o.current)==null?void 0:m.token;return S?{Authorization:`Bearer ${S}`}:{}}catch{return{}}}const{Title:Le,Text:U}=pe,{Option:f}=A,y="#034D57",le="#4CB480",Pe={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},Ie={ior:"red",routine:"orange",normal:"default"},se=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function He(){var H,J,K,Y,Z;const o=ne(),[m,S]=i.useState([]),[L,x]=i.useState(!0),[r,N]=i.useState(null),[$,z]=i.useState({}),[b,P]=i.useState({current:1,pageSize:25,total:0}),[g,T]=i.useState("ALL"),[d,k]=i.useState({status:"",priority:"all",q:""}),[M,V]=i.useState(""),[I,v]=i.useState([]),q=i.useCallback(async()=>{try{const l=await(await fetch(W+"rfq/stats",{headers:Q()})).json();l.success&&N(l.result)}catch{}},[]),s=i.useCallback(async(t=1)=>{x(!0);try{const l=new URLSearchParams({page:t,items:b.pageSize,...d.status&&d.status!=="active"?{status:d.status}:d.status==="active"?{status:"new,in_progress,researched"}:{},...d.priority!=="all"?{priority:d.priority}:{},...g!=="ALL"?{client:g}:{},...d.q?{q:d.q}:{}}),c=await(await fetch(W+`rfq/list?${l}`,{headers:Q()})).json();if(c.success){S(c.result||[]),P(w=>{var p,X;return{...w,current:t,total:((p=c.pagination)==null?void 0:p.total)||((X=c.result)==null?void 0:X.length)||0}});const h={};(c.result||[]).forEach(w=>{h[w.client]=(h[w.client]||0)+1}),z(h)}}catch{}finally{x(!1)}},[d,g,b.pageSize]);i.useEffect(()=>{q()},[]),i.useEffect(()=>{s(1)},[d,g]);const a=t=>{if(!t.receivedAt)return null;const l=new Date(t.receivedAt),n=t.priority==="ior"?7:10,c=new Date(l.getTime()+n*864e5);return Math.ceil((c-new Date)/864e5)},u=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(t,l)=>e.jsxs("div",{children:[e.jsx(U,{strong:!0,style:{color:y,cursor:"pointer",fontSize:13},onClick:()=>o(`/rfq/${l._id}`),children:t||"â€”"}),l.priority==="ior"&&e.jsx(R,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:t=>e.jsx(R,{color:y,style:{color:"#fff",fontSize:11},children:t})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(t,l)=>e.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>o(`/rfq/${l._id}`),children:t})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,responsive:["md"],render:t=>e.jsx(R,{color:Ie[t]||"default",children:(t||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:t=>e.jsx(R,{color:Pe[t]||"default",children:t==null?void 0:t.replace("_"," ")})},{title:"Parts",key:"parts",width:70,responsive:["sm"],render:(t,l)=>e.jsx(xe,{count:l.partsCount||0,showZero:!0,style:{backgroundColor:l.partsCount>0?le:"#e5e7eb",color:l.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,responsive:["lg"],render:t=>t?new Date(t).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"Deadline",key:"deadline",width:110,responsive:["sm"],sorter:(t,l)=>{const n=a(t),c=a(l);return n-c},render:(t,l)=>{if(["expired","quoted","won","lost"].includes(l.status))return e.jsx(U,{type:"secondary",style:{fontSize:11},children:"â€”"});const n=a(l);if(n===null)return e.jsx(U,{type:"secondary",style:{fontSize:11},children:"â€”"});let c,h;return n<0?(c="#ef4444",h=`${Math.abs(n)}d overdue`):n<=2?(c="#ef4444",h=`${n}d left`):n<=5?(c="#f59e0b",h=`${n}d left`):(c="#22c55e",h=`${n}d left`),e.jsx(R,{color:c,style:{fontSize:11,fontWeight:600},children:h})}},{title:"",key:"action",width:60,fixed:"right",render:(t,l)=>e.jsx(j,{size:"small",type:"link",style:{color:y,padding:0},onClick:()=>o(`/rfq/${l._id}`),children:"View â†’"})}],_=((H=r==null?void 0:r.byPriority)==null?void 0:H.ior)||0,re=(((J=r==null?void 0:r.byStatus)==null?void 0:J.new)||0)+(((K=r==null?void 0:r.byStatus)==null?void 0:K.in_progress)||0)+(((Y=r==null?void 0:r.byStatus)==null?void 0:Y.researched)||0),ae=((Z=r==null?void 0:r.byStatus)==null?void 0:Z.quoted)||0;return e.jsxs("div",{style:{padding:"12px",background:"#f0f2f5",minHeight:"100vh"},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginBottom:16,gap:8},children:[e.jsx(Le,{level:3,style:{color:y,margin:0,fontSize:window.innerWidth<768?18:24},children:"ðŸ“‹ RFQ Management"}),e.jsxs(D,{wrap:!0,children:[e.jsx(j,{icon:e.jsx(be,{}),onClick:()=>{q(),s(1)},style:{borderColor:y,color:y},size:window.innerWidth<768?"small":"middle",children:window.innerWidth>=768?"Refresh":""}),e.jsx(j,{size:"small",onClick:()=>{const t=["RFQ Number","Client","Subject","Priority","Status","Parts","Received"],l=m.map(p=>[p.rfqNumber||"",p.client||"",(p.subject||"").replace(/,/g,";"),p.priority||"",p.status||"",p.partsCount||0,p.receivedAt?new Date(p.receivedAt).toLocaleDateString("en-GB"):""]),n=[t.join(","),...l.map(p=>p.join(","))].join(`
`),c=new Blob([n],{type:"text/csv"}),h=URL.createObjectURL(c),w=document.createElement("a");w.href=h,w.download=`rfqs-${new Date().toISOString().slice(0,10)}.csv`,w.click(),URL.revokeObjectURL(h),F.success("CSV exported")},style:{borderColor:"#6366f1",color:"#6366f1"},children:window.innerWidth>=768?"Export CSV":"CSV"})]})]}),e.jsx(G,{gutter:[8,8],style:{marginBottom:12},children:[{title:"Total RFQs",value:(r==null?void 0:r.total)||0,color:y},{title:"Active",value:re,color:"#3b82f6"},{title:"IOR Priority",value:_,color:"#ef4444"},{title:"Total Parts",value:(r==null?void 0:r.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:ae,color:le},{title:"Vendors",value:(r==null?void 0:r.totalVendors)||0,color:"#f59e0b"}].map(({title:t,value:l,color:n})=>e.jsx(O,{xs:8,sm:8,md:4,children:e.jsx(B,{size:"small",style:{borderTop:`3px solid ${n}`,borderRadius:8,textAlign:"center"},children:e.jsx(ge,{title:e.jsx("span",{style:{fontSize:window.innerWidth<768?10:12},children:t}),value:l,valueStyle:{color:n,fontSize:window.innerWidth<768?14:18,fontWeight:700}})})},t))}),e.jsx(Ae,{module:"rfq",onFiltersChange:t=>{k(l=>({...l,status:t.status||l.status,priority:t.priority||l.priority,client:t.client||l.client}))},clients:se.map(t=>t.key).filter(t=>t!=="ALL")}),e.jsx(B,{size:"small",style:{marginBottom:12,borderRadius:8},children:e.jsxs(D,{wrap:!0,children:[e.jsx(ue.Search,{placeholder:"Search RFQ#, part, subject...",value:M,onChange:t=>V(t.target.value),onSearch:t=>k(l=>({...l,q:t})),onPressEnter:t=>k(l=>({...l,q:t.target.value})),style:{width:260},prefix:e.jsx(he,{style:{color:"#9ca3af"}})}),e.jsxs(A,{value:d.status||"active",onChange:t=>k(l=>({...l,status:t})),style:{width:140},children:[e.jsx(f,{value:"active",children:"Active"}),e.jsx(f,{value:"new",children:"New"}),e.jsx(f,{value:"in_progress",children:"In Progress"}),e.jsx(f,{value:"researched",children:"Researched"}),e.jsx(f,{value:"quoted",children:"Quoted"}),e.jsx(f,{value:"won",children:"Won"}),e.jsx(f,{value:"lost",children:"Lost"}),e.jsx(f,{value:"",children:"All Statuses"})]}),e.jsxs(A,{value:d.priority,onChange:t=>k(l=>({...l,priority:t})),style:{width:120},children:[e.jsx(f,{value:"all",children:"All Priority"}),e.jsx(f,{value:"ior",children:"ðŸš¨ IOR"}),e.jsx(f,{value:"routine",children:"Routine"}),e.jsx(f,{value:"normal",children:"Normal"})]})]})}),e.jsxs(B,{style:{borderRadius:8},bodyStyle:{padding:0},children:[e.jsx(ve,{activeKey:g,onChange:t=>{T(t),s(1)},size:"small",style:{paddingLeft:8},items:se.map(({key:t,label:l})=>({key:t,label:e.jsxs("span",{children:[t==="ALL"?e.jsx(Se,{}):null," ",l]})}))}),I.length>0&&e.jsxs("div",{style:{marginBottom:12,padding:"8px 12px",background:"#f0f6f7",borderRadius:8,display:"flex",alignItems:"center",gap:12},children:[e.jsxs(R,{color:y,children:[I.length," selected"]}),e.jsx(me,{menu:{items:[{key:"in_progress",label:"Mark In Progress"},{key:"quoted",label:"Mark Quoted"},{key:"won",label:"Mark Won"},{key:"lost",label:"Mark Lost"},{key:"expired",label:"Mark Expired"}],onClick:async({key:t})=>{try{const n=await(await fetch(W+"rfq/bulk-status",{method:"POST",headers:{...Q(),"Content-Type":"application/json"},body:JSON.stringify({ids:I,status:t})})).json();n.success?(F.success(`${n.result.modified} RFQs updated to ${t}`),v([]),s(b.current),q()):F.error(n.message||"Failed")}catch(l){F.error("Error: "+l.message)}}},children:e.jsxs(j,{size:"small",type:"primary",style:{background:y,borderColor:y},children:["Bulk Action ",e.jsx(fe,{})]})}),e.jsx(j,{size:"small",onClick:()=>v([]),children:"Clear"})]}),e.jsx(we,{rowKey:"_id",rowSelection:{selectedRowKeys:I,onChange:v,columnWidth:36},columns:u,dataSource:m,loading:L,size:"small",pagination:{...b,showSizeChanger:!1,showTotal:t=>`${t} RFQs`,onChange:t=>{P(l=>({...l,current:t})),s(t)},simple:window.innerWidth<768},rowClassName:t=>t.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:window.innerWidth<768?600:950},onRow:t=>({onClick:l=>{l.target.closest(".ant-checkbox-wrapper")||o(`/rfq/${t._id}`)},style:{cursor:"pointer"}})})]}),e.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{He as default};
