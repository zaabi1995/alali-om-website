import{r as n,j as e}from"./index-BhEFxdWu.js";import{a as Q,o as W}from"./omrFormat-fv_Vcouw.js";import{aH as s,ai as l,aB as P,aC as r,aE as i,aN as X,ar as Y,az as h}from"./IdurarOs-BFGNP-pS.js";import{C as N}from"./index-qQcLX_d8.js";import{S as T}from"./index-BvBuna3R.js";import{m as g}from"./ErpApp-DpxD-lYy.js";import{F as Z}from"./Table-PjQfVvg8.js";import{M as F}from"./index-B_1x4s2n.js";import{T as v}from"./index-Bom7ZUjf.js";import{S as M}from"./index-Dx8TonTJ.js";import{s as x}from"./index-BsqZau9P.js";import{T as ee}from"./index-BWTtvXRI.js";import{P as te}from"./index-DBJPtIYA.js";import{P as se}from"./PlusOutlined-CI2uwn_b.js";import{W as E}from"./WarningOutlined-nH0-y_Hk.js";import"./Skeleton-D_qvI9Fm.js";import"./index-CR4CBHwy.js";import"./pickAttrs-CIpC8GS1.js";import"./DownOutlined-BQLUGuSr.js";import"./ActionButton-DiLCEo9P.js";import"./useClosable-DtOuyl_6.js";import"./fade-C9Ao05cm.js";const{Title:ae}=Y,{TextArea:re}=i;function S(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function q(){return{...S(),"Content-Type":"application/json"}}function D(w){return W(w)}function Te(){const[w,z]=n.useState([]),[o,B]=n.useState(null),[V,A]=n.useState(!1),[b,H]=n.useState({page:1,count:0}),[I,L]=n.useState(""),[c,U]=n.useState(!1),[_,p]=n.useState(!1),[m,j]=n.useState(null),[O]=s.useForm(),[k]=s.useForm(),[R,y]=n.useState(!1),f=()=>{fetch(h+"inventoryitem/stats",{headers:S()}).then(t=>t.json()).then(t=>{t.success&&B(t.result)}).catch(()=>{})},u=async(t=1)=>{A(!0);const a=new URLSearchParams({page:t,items:30});I&&a.set("q",I),c&&a.set("lowStock","true");try{const C=await(await fetch(h+`inventoryitem/list?${a}`,{headers:S()})).json();C.success&&(z(C.result),H(C.pagination||{}))}finally{A(!1)}};n.useEffect(()=>{u(1),f()},[I,c]);const $=async t=>{y(!0);try{const d=await(await fetch(h+"inventoryitem/create",{method:"POST",headers:q(),body:JSON.stringify(t)})).json();d.success?(x.success("Item added"),p(!1),O.resetFields(),u(1),f()):x.error(d.message||"Failed")}finally{y(!1)}},J=async t=>{y(!0);try{const d=await(await fetch(h+`inventoryitem/movement/${m.id}`,{method:"POST",headers:q(),body:JSON.stringify(t)})).json();d.success?(x.success("Movement recorded"),j(null),k.resetFields(),u(1),f()):x.error(d.message||"Failed")}finally{y(!1)}},K=async t=>{await fetch(h+`inventoryitem/delete/${t}`,{method:"DELETE",headers:S()}),x.success("Removed"),u(b.page),f()},G=[{title:"Part Number",dataIndex:"partNumber",render:t=>e.jsx("strong",{children:t}),width:140},{title:"NSN",dataIndex:"nsn",render:t=>t||"â€”",width:120},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"On Hand",dataIndex:"qtyOnHand",align:"center",width:80,render:(t,a)=>e.jsx(ee,{color:t<=(a.reorderLevel||0)&&a.reorderLevel>0?"red":"green",children:t})},{title:"Reserved",dataIndex:"qtyReserved",align:"center",width:80},{title:"Available",dataIndex:"qtyAvailable",align:"center",width:80,render:(t,a)=>e.jsx("strong",{style:{color:t<=(a.reorderLevel||0)&&a.reorderLevel>0?"#e53e3e":"#4CB480"},children:t})},{title:"Unit Cost",dataIndex:"unitCost",align:"right",render:D},{title:"Total Value",dataIndex:"totalValue",align:"right",render:t=>e.jsx("strong",{children:D(t)})},{title:"Location",dataIndex:"warehouseLocation",render:t=>t||"â€”"},{title:"",width:100,render:(t,a)=>e.jsxs(g,{children:[e.jsx(l,{size:"small",onClick:()=>{j({id:a._id,partNumber:a.partNumber})},children:"Move"}),e.jsx(te,{title:"Remove?",onConfirm:()=>K(a._id),children:e.jsx(l,{size:"small",danger:!0,type:"text",children:"Ã—"})})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(ae,{level:4,style:{margin:0,color:"#034D57"},children:"Inventory"}),e.jsx(l,{type:"primary",icon:e.jsx(se,{}),onClick:()=>p(!0),style:{background:"#034D57"},children:"Add Item"})]}),o&&e.jsxs(P,{gutter:12,style:{marginBottom:16},children:[e.jsx(r,{xs:8,children:e.jsx(N,{size:"small",children:e.jsx(T,{title:"Total SKUs",value:o.totalItems})})}),e.jsx(r,{xs:8,children:e.jsx(N,{size:"small",children:e.jsx(T,{title:"Total Value",value:o.totalValue,precision:3,suffix:Q(),valueStyle:{color:"#034D57"}})})}),e.jsx(r,{xs:8,children:e.jsx(N,{size:"small",children:e.jsx(T,{title:"Low Stock Alerts",value:o.lowStock,valueStyle:{color:o.lowStock>0?"#e53e3e":"#4CB480"},prefix:o.lowStock>0?e.jsx(E,{}):null})})})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(i,{placeholder:"Search part#, NSN, description...",prefix:e.jsx(X,{}),allowClear:!0,style:{width:260},onPressEnter:t=>L(t.target.value),onChange:t=>!t.target.value&&L("")}),e.jsx(l,{type:c?"primary":"default",icon:e.jsx(E,{}),onClick:()=>U(t=>!t),danger:c,children:c?"Show All":"Low Stock Only"})]}),e.jsx(Z,{columns:G,dataSource:w,rowKey:"_id",loading:V,size:"small",pagination:{current:b.page,total:b.count,pageSize:30,onChange:t=>u(t)},rowClassName:t=>t.qtyAvailable<=(t.reorderLevel||0)&&t.reorderLevel>0?"ant-table-row-warning":""}),e.jsx(F,{title:"Add Inventory Item",open:_,onCancel:()=>p(!1),footer:null,width:600,children:e.jsxs(s,{form:O,layout:"vertical",onFinish:$,children:[e.jsxs(P,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"partNumber",label:"Part Number",rules:[{required:!0}],children:e.jsx(i,{})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"nsn",label:"NSN",children:e.jsx(i,{})})}),e.jsx(r,{span:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(i,{})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"qtyOnHand",label:"Initial Qty",initialValue:0,children:e.jsx(v,{style:{width:"100%"},min:0})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"unitCost",label:"Unit Cost (OMR)",initialValue:0,children:e.jsx(v,{style:{width:"100%"},precision:3,min:0})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"reorderLevel",label:"Reorder Level",initialValue:0,children:e.jsx(v,{style:{width:"100%"},min:0})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"warehouseLocation",label:"Location",children:e.jsx(i,{placeholder:"e.g. Shelf A-3"})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(M,{options:["EA","SET","PKG","LOT","MTR","KG"].map(t=>({value:t,label:t}))})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(g,{children:[e.jsx(l,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(l,{type:"primary",htmlType:"submit",loading:R,style:{background:"#034D57"},children:"Add"})]})})]})}),e.jsx(F,{title:`Stock Movement â€” ${m==null?void 0:m.partNumber}`,open:!!m,onCancel:()=>j(null),footer:null,children:e.jsxs(s,{form:k,layout:"vertical",onFinish:J,children:[e.jsx(s.Item,{name:"type",label:"Movement Type",rules:[{required:!0}],children:e.jsx(M,{options:[{value:"in",label:"ðŸ“¦ Stock In (receive)"},{value:"out",label:"ðŸ“¤ Stock Out (dispatch)"},{value:"adjust",label:"ðŸ”§ Adjust (set new qty)"},{value:"reserve",label:"ðŸ”’ Reserve"},{value:"release",label:"ðŸ”“ Release Reservation"}]})}),e.jsx(s.Item,{name:"quantity",label:"Quantity",rules:[{required:!0}],children:e.jsx(v,{style:{width:"100%"},min:0})}),e.jsx(s.Item,{name:"reference",label:"Reference (PO#, DN#, etc.)",children:e.jsx(i,{placeholder:"e.g. PO-5/2026"})}),e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(re,{rows:2})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(g,{children:[e.jsx(l,{onClick:()=>j(null),children:"Cancel"}),e.jsx(l,{type:"primary",htmlType:"submit",loading:R,style:{background:"#034D57"},children:"Record"})]})})]})})]})}export{Te as default};
