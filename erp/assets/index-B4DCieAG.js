import{m as T,o as V,r as c,j as e}from"./index-CB_AWKJY.js";import{b as g}from"./omrFormat-CTBUnK1w.js";import{d as y}from"./dayjs.min-rDaZbkwJ.js";import{b8 as a,aV as l,aB as u,aM as N,aL as r,aX as j,aY as O}from"./IdurarOs-20-QWMXR.js";import{C as B}from"./index-ByWerc77.js";import{D as P}from"./index-C66cNKtH.js";import{f as i,l as $}from"./ErpApp-Cy5crc22.js";import{T as S}from"./index-DHk3-eFe.js";import{s as x}from"./index-CvT_fNtU.js";import{A as L}from"./ArrowLeftOutlined-DzXe9_hW.js";import{S as D}from"./SaveOutlined-BMnVPMh3.js";import"./Skeleton-C4FpL5iW.js";import"./index-2JQk6u8I.js";import"./PlusOutlined-YO2bg1HW.js";const{Title:F}=O,{TextArea:R}=j;function q(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const U=["salaries","rent","travel","office","utilities","bank_charges","marketing","maintenance","insurance","professional_fees","customs_duties","shipping","telecommunications","other"];function re(){const d=T(),{id:o}=V(),[f]=a.useForm(),[v,w]=c.useState([]),[C,A]=c.useState([]),[I,k]=c.useState([]),[_,b]=c.useState(!1);c.useEffect(()=>{const t={Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`};fetch(l+"vendor/listAll",{headers:t}).then(s=>s.json()).then(s=>{s.result&&w(s.result)}).catch(()=>{}),fetch(l+"project/list",{headers:t}).then(s=>s.json()).then(s=>{s.result&&A(s.result)}).catch(()=>{}),fetch(l+"bankaccount/list",{headers:t}).then(s=>s.json()).then(s=>{s.result&&k(s.result)}).catch(()=>{}),o&&fetch(l+`expense/read/${o}`,{headers:t}).then(s=>s.json()).then(s=>{var m,p;if(s.success&&s.result){const n=s.result;f.setFieldsValue({...n,date:n.date?y(n.date):null,vendor:((m=n.vendor)==null?void 0:m._id)||n.vendor,project:((p=n.project)==null?void 0:p._id)||n.project})}}).catch(()=>{})},[o]);const E=async t=>{var n;b(!0);const s={...t,date:(n=t.date)==null?void 0:n.toISOString()},m=o?l+`expense/update/${o}`:l+"expense/create",p=o?"PATCH":"POST";try{const h=await(await fetch(m,{method:p,headers:q(),body:JSON.stringify(s)})).json();h.success?(x.success(h.message||"Saved"),d(`/expense/read/${h.result._id}`)):x.error(h.message||"Failed")}catch{x.error("Network error")}finally{b(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:800},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(u,{icon:e.jsx(L,{}),onClick:()=>d("/expense")}),e.jsx(F,{level:4,style:{margin:0,color:"#034D57"},children:o?"Edit Expense":"New Expense"})]}),e.jsxs(a,{form:f,layout:"vertical",onFinish:E,children:[e.jsx(B,{title:"Expense Details",size:"small",style:{marginBottom:16},children:e.jsxs(N,{gutter:16,children:[e.jsx(r,{xs:24,sm:16,children:e.jsx(a.Item,{name:"description",label:"Description",rules:[{required:!0}],children:e.jsx(j,{placeholder:"What was this expense for?"})})}),e.jsx(r,{xs:24,sm:8,children:e.jsx(a.Item,{name:"date",label:"Date",rules:[{required:!0}],initialValue:y(),children:e.jsx(P,{style:{width:"100%"}})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"category",label:"Category",rules:[{required:!0}],initialValue:"other",children:e.jsx(i,{options:U.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(S,{min:0,precision:3,style:{width:"100%"},addonAfter:g()})})}),e.jsx(r,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxAmount",label:"VAT Amount",initialValue:0,children:e.jsx(S,{min:0,precision:3,style:{width:"100%"},addonAfter:g()})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"paymentMethod",label:"Payment Method",initialValue:"bank_transfer",children:e.jsx(i,{options:["bank_transfer","cash","cheque","credit_card","other"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"reference",label:"Receipt / Voucher #",children:e.jsx(j,{placeholder:"Receipt number"})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"vendor",label:"Vendor (optional)",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Select vendor",filterOption:(t,s)=>s.label.toLowerCase().includes(t.toLowerCase()),options:v.map(t=>({value:t._id,label:t.companyName}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"project",label:"Project (optional)",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Link to project",filterOption:(t,s)=>s.label.toLowerCase().includes(t.toLowerCase()),options:C.map(t=>({value:t._id,label:`${t.code?t.code+" â€” ":""}${t.name}`}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"bankAccount",label:"Paid From",children:e.jsx(i,{showSearch:!0,allowClear:!0,placeholder:"Bank account",options:I.map(t=>({value:t._id,label:`${t.name} (${t.bankName||""})`}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(a.Item,{name:"status",label:"Status",initialValue:"draft",children:e.jsx(i,{options:["draft","approved","paid","rejected"].map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"notes",label:"Notes",children:e.jsx(R,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs($,{children:[e.jsx(u,{onClick:()=>d("/expense"),children:"Cancel"}),e.jsx(u,{type:"primary",htmlType:"submit",loading:_,icon:e.jsx(D,{}),style:{background:"#034D57"},children:o?"Update":"Create Expense"})]})})]})]})}export{re as default};
