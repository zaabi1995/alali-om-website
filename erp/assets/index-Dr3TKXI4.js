import{r as i,j as e}from"./index-DoaVwaeB.js";import{O as I,g as B,aY as M,aV as g,aR as O}from"./IdurarOs-Cl1uAdiB.js";import{T as x,a9 as m,r as v,A as D,e as H,aa as l,a5 as N,a7 as J,ab as P,ac as $,d as F}from"./ErpApp-ByOG1sFo.js";import{C as W}from"./index-CgTlAi6k.js";import{F as Y}from"./Table-CPtU8t0p.js";import{s as C}from"./index-BBGU4fPh.js";import"./Skeleton-CHNnXOos.js";import"./index-BCGvXwH9.js";import"./PlusOutlined-BS1EpFdV.js";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zm-126 534.1H250.3l-53.8-409.4 139.8 86.1L512 252.9l175.7 234.4 139.8-86.1-53.9 409.4zM512 509c-62.1 0-112.6 50.5-112.6 112.6S449.9 734.2 512 734.2s112.6-50.5 112.6-112.6S574.1 509 512 509zm0 160.9c-26.6 0-48.2-21.6-48.2-48.3 0-26.6 21.6-48.3 48.2-48.3s48.2 21.6 48.2 48.3c0 26.6-21.6 48.3-48.2 48.3z"}}]},name:"crown",theme:"outlined"},U=function(o,u){return i.createElement(I,B({},o,{ref:u,icon:k}))};const V=i.forwardRef(U),{Title:G,Text:d}=M;function y(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function K(){return{...y(),"Content-Type":"application/json"}}const p={owner:e.jsx(V,{}),admin:e.jsx(N,{}),gm:e.jsx(J,{}),manager:e.jsx(P,{}),sales:e.jsx($,{}),staff:e.jsx(F,{})};function q(){var c,o;try{return((o=(c=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:c.current)==null?void 0:o.role)||"staff"}catch{return"staff"}}const R=["owner","admin","gm","manager","sales","staff"];function oe(){const[c,o]=i.useState([]),[u,j]=i.useState(!1),[n,b]=i.useState(null),L=q(),h=m[L]??1,S=h>=m.admin,w=async()=>{j(!0);const[s,t]=await Promise.all([fetch(g+"users/list",{headers:y()}).then(a=>a.json()).catch(()=>({})),fetch(g+"users/me",{headers:y()}).then(a=>a.json()).catch(()=>({}))]);s.success&&o(s.result||[]),t.success&&b(t.result),j(!1)};i.useEffect(()=>{w()},[]);const _=async(s,t)=>{const a=await fetch(g+`users/update-role/${s}`,{method:"PATCH",headers:K(),body:JSON.stringify({role:t})}).then(f=>f.json()).catch(()=>({}));a.success?(C.success(a.message),w()):C.error(a.message||"Failed to update role")},E=[{title:"User",key:"user",render:(s,t)=>e.jsxs(v,{children:[e.jsx(D,{style:{background:"#034D57"},icon:e.jsx(O,{})}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:600},children:[t.name," ",t.surname||"",(n==null?void 0:n._id)===t._id&&e.jsx(x,{color:"blue",style:{fontSize:10,marginLeft:6},children:"You"})]}),e.jsx(d,{type:"secondary",style:{fontSize:12},children:t.email})]})]})},{title:"Role",dataIndex:"role",width:220,render:(s,t)=>{const a=l[s]||l.staff,f=p[s]||e.jsx(O,{}),z=(n==null?void 0:n._id)===t._id,T=m[s]??1;if(!S||z||T>=h)return e.jsx(x,{color:a.color,icon:f,children:a.label});const A=R.filter(r=>m[r]<h);return e.jsx(H,{value:s||"staff",style:{width:150},onChange:r=>_(t._id,r),options:A.map(r=>({value:r,label:e.jsxs(v,{size:4,children:[p[r],e.jsx("span",{children:l[r].label})]})}))})}},{title:"Access Level",dataIndex:"role",width:300,render:s=>{const t=l[s]||l.staff;return e.jsx("div",{children:e.jsx(d,{style:{fontSize:12},children:t.desc})})}},{title:"Member Since",dataIndex:"created",width:120,render:s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"â€”"}];return e.jsxs("div",{style:{padding:24,maxWidth:900},children:[e.jsx(G,{level:4,style:{margin:"0 0 4px",color:"#034D57"},children:"User Management"}),e.jsx(d,{type:"secondary",style:{display:"block",marginBottom:20},children:S?"Manage user roles. You can only assign roles below your own level.":"Contact an Admin or Owner to change user roles."}),e.jsxs(W,{size:"small",style:{marginBottom:20,background:"#f8fffe",borderColor:"#e6f7f5"},children:[e.jsx(d,{strong:!0,style:{display:"block",marginBottom:10,color:"#034D57"},children:"Role Permissions"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px 24px"},children:R.map(s=>{const t=l[s],a=p[s];return e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(x,{color:t.color,icon:a,style:{margin:0,minWidth:70,textAlign:"center"},children:t.label}),e.jsx(d,{type:"secondary",style:{fontSize:11,lineHeight:"22px"},children:t.desc})]},s)})})]}),e.jsx(Y,{columns:E,dataSource:c,rowKey:"_id",loading:u,size:"small",pagination:!1,rowClassName:s=>(n==null?void 0:n._id)===s._id?"row-highlight":""})]})}export{oe as default};
