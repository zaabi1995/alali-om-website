import{m as R,o as F,r as y,j as e}from"./index-BhEFxdWu.js";import{a as n,o as S}from"./omrFormat-fv_Vcouw.js";import{d as x}from"./dayjs.min-DMbpp9_Q.js";import{az as v,ai as p,ax as T,aB as $,aC as o,ar as B}from"./IdurarOs-BFGNP-pS.js";import{m as D}from"./ErpApp-DpxD-lYy.js";import{T as d}from"./index-BWTtvXRI.js";import{P as E}from"./index-DBJPtIYA.js";import{C as a}from"./index-qQcLX_d8.js";import{S as c}from"./index-BvBuna3R.js";import{D as r}from"./index-nCy-TF75.js";import{T as P}from"./index-CR4CBHwy.js";import{F as u}from"./Table-PjQfVvg8.js";import{s as Y}from"./index-BsqZau9P.js";import{A as _}from"./ArrowLeftOutlined-BuNI9jng.js";import{D as w}from"./DeleteOutlined-Duojs1OH.js";import"./useClosable-DtOuyl_6.js";import"./ActionButton-DiLCEo9P.js";import"./Skeleton-D_qvI9Fm.js";import"./pickAttrs-CIpC8GS1.js";import"./PlusOutlined-CI2uwn_b.js";import"./index-Dx8TonTJ.js";import"./DownOutlined-BQLUGuSr.js";const{Title:A}=B;function I(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const k={prospect:"default",active:"green",on_hold:"orange",completed:"blue",cancelled:"red"};function de(){var j,f,g;const m=R(),{id:l}=F(),[t,C]=y.useState(null);y.useEffect(()=>{fetch(v+`project/read/${l}`,{headers:I()}).then(s=>s.json()).then(s=>{s.success&&C(s.result)}).catch(()=>{})},[l]);const M=async()=>{await fetch(v+`project/delete/${l}`,{method:"DELETE",headers:I()}),Y.success("Deleted"),m("/projects")};if(!t)return e.jsx("div",{style:{padding:24},children:"Loading…"});const h=t.revenueOMR>0?(t.profitOMR/t.revenueOMR*100).toFixed(1):0,O=[{title:"Invoice",dataIndex:"number",render:(s,i)=>`INV-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:s=>S(s),align:"right"},{title:"Status",dataIndex:"paymentStatus",render:s=>e.jsx(d,{color:s==="paid"?"green":s==="partial"?"orange":"red",children:s})}],b=[{title:"PO",dataIndex:"number",render:(s,i)=>`PO-${s}/${i.year}`},{title:"Total",dataIndex:"total",render:(s,i)=>`${parseFloat(s||0).toFixed(3)} ${i.currency}`,align:"right"},{title:"Status",dataIndex:"status",render:s=>e.jsx(d,{children:s})}],z=[{title:"Description",dataIndex:"description"},{title:"Category",dataIndex:"category",render:s=>e.jsx(d,{children:s})},{title:"Total",dataIndex:"total",render:s=>S(s),align:"right"},{title:"Date",dataIndex:"date",render:s=>x(s).format("DD MMM YY")}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(D,{children:[e.jsx(p,{icon:e.jsx(_,{}),onClick:()=>m("/projects")}),e.jsx(A,{level:4,style:{margin:0,color:"#034D57"},children:t.code||t.name}),e.jsx(d,{color:k[t.status],children:(j=t.status)==null?void 0:j.replace(/_/g," ").toUpperCase()})]}),e.jsxs(D,{children:[e.jsx(p,{icon:e.jsx(T,{}),onClick:()=>m(`/projects/edit/${l}`),children:"Edit"}),e.jsx(E,{title:"Delete?",onConfirm:M,children:e.jsx(p,{danger:!0,icon:e.jsx(w,{}),children:"Delete"})})]})]}),e.jsxs($,{gutter:12,style:{marginBottom:16},children:[e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Budget",value:parseFloat(t.budgetOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Revenue",value:parseFloat(t.revenueOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:"#4CB480"}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Costs",value:parseFloat(t.costOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:"#e53e3e"}})})}),e.jsx(o,{xs:12,sm:5,children:e.jsx(a,{size:"small",children:e.jsx(c,{title:"Profit",value:parseFloat(t.profitOMR||0).toFixed(3),suffix:n(),valueStyle:{fontSize:14,color:t.profitOMR>=0?"#4CB480":"#e53e3e",fontWeight:700}})})}),e.jsx(o,{xs:12,sm:4,children:e.jsxs(a,{size:"small",style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,color:"#888"},children:"Margin"}),e.jsxs("div",{style:{fontSize:20,fontWeight:700,color:h>=20?"#4CB480":"#e53e3e"},children:[h,"%"]})]})})]}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(r,{column:{xs:1,sm:2},size:"small",bordered:!0,children:[e.jsx(r.Item,{label:"Project Name",children:e.jsx("b",{children:t.name})}),e.jsx(r.Item,{label:"Client",children:((f=t.client)==null?void 0:f.name)||"—"}),e.jsx(r.Item,{label:"Sector",children:((g=t.sector)==null?void 0:g.replace(/_/g," "))||"—"}),e.jsx(r.Item,{label:"Start",children:t.startDate?x(t.startDate).format("DD MMM YYYY"):"—"}),e.jsx(r.Item,{label:"End",children:t.endDate?x(t.endDate).format("DD MMM YYYY"):"—"}),t.description&&e.jsx(r.Item,{label:"Description",span:2,children:t.description})]})}),e.jsx(P,{items:[{key:"invoices",label:`Invoices (${(t.invoices||[]).length})`,children:e.jsx(u,{columns:O,dataSource:t.invoices||[],rowKey:"_id",size:"small",pagination:!1})},{key:"pos",label:`Purchase Orders (${(t.purchaseOrders||[]).length})`,children:e.jsx(u,{columns:b,dataSource:t.purchaseOrders||[],rowKey:"_id",size:"small",pagination:!1})},{key:"expenses",label:`Expenses (${(t.expenses||[]).length})`,children:e.jsx(u,{columns:z,dataSource:t.expenses||[],rowKey:"_id",size:"small",pagination:!1})}]})]})}export{de as default};
