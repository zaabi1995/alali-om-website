import{r as i,j as e}from"./index-a37ismZU.js";import{aG as a,ai as c,aD as l,aM as z,aA as U,aB as s,ar as _,ay as m,aw as $}from"./IdurarOs-W8fmhLsD.js";import{k as g}from"./ErpApp-CFM6gh8w.js";import{S as f}from"./index-C_6iXGmz.js";import{F as L}from"./Table-B_KWV4bG.js";import{M as H}from"./index-BRrs5xtK.js";import{T as b}from"./index-CJla9p3n.js";import{S as T}from"./index-b5Eq8zS6.js";import{s as S}from"./index-D5xfM3h1.js";import{T as A}from"./index-BCo7h2qh.js";import{P as q}from"./index-BArq8LD5.js";import{P as G}from"./PlusOutlined-GlmA91S_.js";import{D as J}from"./DeleteOutlined-BzQxZkxi.js";import"./pickAttrs-C6lZBGt9.js";import"./DownOutlined-DV2zwbY8.js";import"./ActionButton-Dc1xVUU3.js";import"./useClosable-Y2cD7JVn.js";import"./fade-B096mtVI.js";const{Title:Y}=_;function N(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function K(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}const W={product:"blue",service:"green",part:"orange"};function pe(){const[E,D]=i.useState([]),[O,I]=i.useState(!1),[P,k]=i.useState({page:1,count:0}),[u,F]=i.useState(""),[x,v]=i.useState(""),[M,w]=i.useState(!1),[o,C]=i.useState(null),[h]=a.useForm(),d=async(t=1)=>{I(!0);const r=new URLSearchParams({page:t,items:30});u&&r.set("type",u),x&&r.set("q",x);const n=await fetch(m+`product/list?${r}`,{headers:N()}).then(y=>y.json()).catch(()=>({}));n.success&&(D(n.result),k(n.pagination||{})),I(!1)};i.useEffect(()=>{d(1)},[u,x]);const p=(t=null)=>{C(t),h.setFieldsValue(t?{...t}:{type:"product",taxRate:5,unit:"EA",currency:"OMR",taxable:!0,isActive:!0}),w(!0)},j=()=>{w(!1),h.resetFields(),C(null)},R=async t=>{const r=o?m+`product/update/${o._id}`:m+"product/create",n=await fetch(r,{method:o?"PATCH":"POST",headers:K(),body:JSON.stringify(t)}).then(y=>y.json()).catch(()=>({}));n.success?(S.success(o?"Updated":"Created"),j(),d(1)):S.error(n.message||"Failed")},V=async t=>{await fetch(m+`product/delete/${t}`,{method:"DELETE",headers:N()}),S.success("Deleted"),d(1)},B=[{title:"Code",dataIndex:"code",width:90,render:t=>t||"—"},{title:"Name",dataIndex:"name",ellipsis:!0,render:(t,r)=>e.jsx("a",{onClick:()=>p(r),style:{color:"#034D57",fontWeight:600},children:t})},{title:"Part #",dataIndex:"partNumber",width:110,render:t=>t?e.jsx("code",{style:{fontSize:11},children:t}):"—"},{title:"NSN",dataIndex:"nsn",width:110,render:t=>t||"—"},{title:"Type",dataIndex:"type",width:80,render:t=>e.jsx(A,{color:W[t],children:t})},{title:"Sale Price",dataIndex:"salePrice",align:"right",render:(t,r)=>`${parseFloat(t||0).toFixed(3)} ${r.currency||"OMR"}`},{title:"Unit",dataIndex:"unit",width:60,render:t=>t||"EA"},{title:"Active",dataIndex:"isActive",width:70,render:t=>e.jsx(A,{color:t?"green":"default",children:t?"Yes":"No"})},{title:"",width:70,render:(t,r)=>e.jsxs(g,{children:[e.jsx(c,{size:"small",icon:e.jsx($,{}),onClick:()=>p(r)}),e.jsx(q,{title:"Delete?",onConfirm:()=>V(r._id),children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(J,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(Y,{level:4,style:{margin:0,color:"#034D57"},children:"Products & Services"}),e.jsx(c,{type:"primary",icon:e.jsx(G,{}),onClick:()=>p(),style:{background:"#034D57"},children:"Add Item"})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(l,{placeholder:"Search name, part #, NSN...",prefix:e.jsx(z,{}),allowClear:!0,style:{width:240},onPressEnter:t=>v(t.target.value),onChange:t=>!t.target.value&&v("")}),e.jsx(f,{placeholder:"Type",allowClear:!0,style:{width:120},onChange:t=>F(t||""),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})]}),e.jsx(L,{columns:B,dataSource:E,rowKey:"_id",loading:O,size:"small",pagination:{current:P.page,total:P.count,pageSize:30,onChange:t=>d(t)}}),e.jsx(H,{title:o?"Edit Product":"New Product / Service",open:M,onCancel:j,footer:null,width:680,children:e.jsxs(a,{form:h,layout:"vertical",onFinish:R,children:[e.jsxs(U,{gutter:12,children:[e.jsx(s,{xs:24,sm:16,children:e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"code",label:"Internal Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"partNumber",label:"Part Number",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"nsn",label:"NSN",children:e.jsx(l,{placeholder:"NATO Stock Number"})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"type",label:"Type",initialValue:"product",children:e.jsx(f,{options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(f,{options:["OMR","USD","EUR","GBP","AED"].map(t=>({value:t,label:t}))})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"salePrice",label:"Sale Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"costPrice",label:"Cost Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxRate",label:"VAT %",initialValue:5,children:e.jsx(b,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"manufacturer",label:"Manufacturer",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"hsCode",label:"HS Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"category",label:"Category",children:e.jsx(l,{placeholder:"e.g. Aviation Parts"})})}),e.jsx(s,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(l.TextArea,{rows:2})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"taxable",label:"Taxable",valuePropName:"checked",initialValue:!0,children:e.jsx(T,{})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(T,{})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:8},children:e.jsxs(g,{children:[e.jsx(c,{onClick:j,children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{pe as default};
