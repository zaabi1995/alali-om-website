import{V as R,g as A,r as y,j as t}from"./index-BrmSMSB0.js";import{d as M}from"./dayjs.min-CQxfzqfT.js";import{aB as O,aY as _,aZ as b,ac as B}from"./IdurarOs-BQBNJmBS.js";import{r as D,e as P,T as L}from"./ErpApp-VX7sXUMI.js";import{F as Y}from"./Table-BC7b85WN.js";import{R as $}from"./ReloadOutlined-Cv6kVtfi.js";var E={exports:{}};(function(p,C){(function(a,l){p.exports=l()})(R,function(){return function(a,l,s){a=a||{};var i=l.prototype,d={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function g(r,e,n,x){return i.fromToBase(r,e,n,x)}s.en.relativeTime=d,i.fromToBase=function(r,e,n,x,u){for(var S,j,T,w=n.$locale().relativeTime||d,v=a.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],N=v.length,h=0;h<N;h+=1){var o=v[h];o.d&&(S=x?s(r).diff(n,o.d,!0):n.diff(r,o.d,!0));var f=(a.rounding||Math.round)(Math.abs(S));if(T=S>0,f<=o.r||!o.r){f<=1&&h>0&&(o=v[h-1]);var I=w[o.l];u&&(f=u(""+f)),j=typeof I=="string"?I.replace("%d",f):I(f,e,o.l,T);break}}if(e)return j;var z=T?w.future:w.past;return typeof z=="function"?z(j):z.replace("%s",j)},i.to=function(r,e){return g(r,e,this,!0)},i.from=function(r,e){return g(r,e,this)};var c=function(r){return r.$u?s.utc():s()};i.toNow=function(r){return this.to(c(this),r)},i.fromNow=function(r){return this.from(c(this),r)}}})})(E);var k=E.exports;const F=A(k);M.extend(F);const{Title:U,Text:m}=_;function H(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const q={create:"green",update:"blue",delete:"red",view:"default",login:"cyan",email_sent:"purple",pdf_generated:"orange",status_change:"gold"},G=["Quote","Invoice","PurchaseOrder","DeliveryNote","CreditNote","Payment","Rfq","InventoryItem","Opportunity"];function X(){const[p,C]=y.useState([]),[a,l]=y.useState(!1),[s,i]=y.useState({page:1,count:0}),[d,g]=y.useState(""),c=async(e=1)=>{l(!0);const n=new URLSearchParams({page:e,items:50});d&&n.set("entity",d);try{const u=await(await fetch(b+`auditlog/list?${n}`,{headers:H()})).json();u.success&&(C(u.result),i(u.pagination||{}))}finally{l(!1)}};y.useEffect(()=>{c(1)},[d]);const r=[{title:"Time",dataIndex:"created",width:150,render:e=>t.jsx(B,{title:M(e).format("DD MMM YYYY HH:mm:ss"),children:t.jsx(m,{style:{fontSize:11},children:M(e).fromNow()})})},{title:"User",dataIndex:["user","email"],width:180,ellipsis:!0,render:(e,n)=>t.jsx(m,{style:{fontSize:11},children:e||n.userEmail||"â€”"})},{title:"Action",dataIndex:"action",width:110,render:e=>t.jsx(L,{color:q[e]||"default",style:{fontSize:10},children:e==null?void 0:e.toUpperCase().replace("_"," ")})},{title:"Entity",dataIndex:"entity",width:120,render:(e,n)=>t.jsxs("span",{children:[t.jsx(m,{strong:!0,style:{fontSize:11},children:e}),n.entityRef&&t.jsxs(m,{type:"secondary",style:{fontSize:10},children:[" #",n.entityRef]})]})},{title:"Description",dataIndex:"description",ellipsis:!0,render:e=>t.jsx(m,{style:{fontSize:11},children:e||"â€”"})},{title:"IP",dataIndex:"ip",width:110,render:e=>t.jsx(m,{type:"secondary",style:{fontSize:10},children:e||"â€”"})}];return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(U,{level:4,style:{margin:0,color:"#034D57"},children:"Audit Log"}),t.jsx(O,{icon:t.jsx($,{}),onClick:()=>c(1),loading:a,children:"Refresh"})]}),t.jsx(D,{style:{marginBottom:14},wrap:!0,children:t.jsx(P,{placeholder:"Filter by entity",allowClear:!0,style:{width:180},onChange:e=>g(e||""),options:G.map(e=>({value:e,label:e}))})}),p.length===0&&!a&&t.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#aaa"},children:[t.jsx("div",{style:{fontSize:40},children:"ðŸ“‹"}),t.jsx("div",{style:{marginTop:8},children:"No audit logs yet."}),t.jsx("div",{style:{fontSize:12,marginTop:4},children:"Actions like creating, updating, and deleting records will appear here."})]}),(p.length>0||a)&&t.jsx(Y,{columns:r,dataSource:p,rowKey:"_id",loading:a,size:"small",pagination:{current:s.page,total:s.count,pageSize:50,onChange:e=>c(e)}})]})}export{X as default};
