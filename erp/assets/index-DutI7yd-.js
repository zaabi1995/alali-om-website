import{r as y,j as e}from"./index-5ITuoeVY.js";import{aA as j,aB as c,ai as S,aM as k,aI as q,ar as D,at as v}from"./IdurarOs-2NdJjWBV.js";import{C as d}from"./index-DRtkgJqY.js";import{B as I}from"./index-D6h9cC70.js";import{S as w}from"./index-HDFpIo3E.js";import{P as $}from"./progress-BRdczAx1.js";import{k as O,S as A}from"./ErpApp-CTwOYhrl.js";import{T as H}from"./index-en4g6T-d.js";import{C as M}from"./ClockCircleOutlined-CV4B4TUH.js";import{T as Q}from"./ThunderboltOutlined-Dk5DWjYL.js";import{F as W}from"./FilePdfOutlined-tN53kSoV.js";import"./Skeleton-DvXqHqzH.js";import"./index-D4F4D2Tf.js";import"./PlusOutlined-CxDzqDnz.js";import"./pickAttrs-BIVrBSXA.js";import"./useClosable-1Ei4O6MR.js";const{Title:_,Text:o}=D,i="#034D57",u="#4CB480";function oe(){var P,C,T,E;const[r,F]=y.useState(null),[m,x]=y.useState({}),[n,b]=y.useState(null),g=()=>{v.get({entity:"procurement/scanner/status"}).then(s=>{s.success&&F(s.result)})};y.useEffect(()=>{g();const s=setInterval(g,5e3);return()=>clearInterval(s)},[]);const R=async(s,f)=>{x(l=>({...l,[s]:!0}));try{const l=await v.post({entity:`procurement/scanner/${s}`});l.success&&b({action:f,result:l.result,at:new Date().toLocaleTimeString()}),g()}finally{x(l=>({...l,[s]:!1}))}},B=async()=>{x(s=>({...s,research:!0}));try{const s=await v.post({entity:"procurement/research/trigger"});s.success&&b({action:"Research",result:s.result,at:new Date().toLocaleTimeString()})}finally{x(s=>({...s,research:!1}))}},a=(r==null?void 0:r.watcher)||{},t=(r==null?void 0:r.fullScan)||{},z=(r==null?void 0:r.researchQueue)||{},h=(r==null?void 0:r.pdfExtraction)||{},p=a.watching&&!a.error;return e.jsxs("div",{style:{padding:24,background:"#f0f2f5",minHeight:"100vh"},children:[e.jsx(_,{level:3,style:{color:i,marginBottom:24},children:"ðŸ“¡ Email Scanner & Research"}),e.jsxs(j,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${p?u:"#ef4444"}`,borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(I,{status:p?"processing":"error"}),e.jsxs("div",{children:[e.jsx(o,{type:"secondary",style:{fontSize:12},children:"Maildir Watcher"}),e.jsx("div",{style:{fontWeight:700,color:p?u:"#ef4444"},children:p?"LIVE":a.error||"Offline"})]})]}),a.lastSeen&&e.jsxs(o,{type:"secondary",style:{fontSize:11},children:["Last email: ",new Date(a.lastSeen).toLocaleTimeString()]}),a.filesProcessed>0&&e.jsx("div",{children:e.jsxs(o,{type:"secondary",style:{fontSize:11},children:["Processed: ",a.filesProcessed," emails"]})})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${i}`,borderRadius:8},children:[e.jsx(w,{title:"Full Scan Progress",value:t.running?`${t.processed}/${t.total}`:t.finishedAt?"Done":"Idle",valueStyle:{fontSize:18,color:i}}),t.running&&e.jsx($,{percent:Math.round(t.processed/(t.total||1)*100),size:"small",strokeColor:i,style:{marginTop:6}}),t.finishedAt&&!t.running&&e.jsxs(o,{type:"secondary",style:{fontSize:11},children:["+",t.newRfqs," RFQs, +",t.newParts," parts"]})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:`3px solid ${u}`,borderRadius:8},children:[e.jsx(w,{title:"Research Queue",value:z.queued||0,suffix:"parts",valueStyle:{fontSize:18,color:u}}),e.jsx(o,{type:"secondary",style:{fontSize:11},children:z.running?"ðŸ”„ Running...":"Idle"})]})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs(d,{size:"small",style:{borderTop:"3px solid #f59e0b",borderRadius:8},children:[e.jsx(w,{title:"PDF Extraction",value:h.running?`${h.processed}/${h.total}`:h.succeeded||0,suffix:h.running?"":"done",valueStyle:{fontSize:18,color:"#f59e0b"}}),e.jsx(o,{type:"secondary",style:{fontSize:11},children:h.running?"ðŸ”„ Running...":"Idle"})]})})]}),e.jsxs(j,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(c,{xs:24,md:16,children:e.jsxs(d,{title:"âš¡ Manual Controls",style:{borderRadius:8},children:[e.jsxs(O,{wrap:!0,size:"middle",children:[e.jsx(S,{type:"primary",icon:e.jsx(A,{spin:m.scan}),loading:m.scan,onClick:()=>R("scan","Incremental Scan"),style:{background:i,borderColor:i},children:"Incremental Scan"}),e.jsx(S,{icon:e.jsx(Q,{}),loading:m["scan-all"],onClick:()=>R("scan-all","Full Scan"),disabled:t.running,children:"Full Historical Scan"}),e.jsx(S,{icon:e.jsx(k,{}),loading:m.research,onClick:B,style:{borderColor:u,color:u},children:"Research Pending Parts"})]}),e.jsx(q,{style:{margin:"16px 0 12px"}}),e.jsxs("div",{style:{fontSize:12,color:"#6b7280",lineHeight:1.6},children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Incremental Scan"})," â€” reads new emails since last scan (runs automatically every 30 min)"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Full Historical Scan"})," â€” re-processes all 27,000+ emails (takes 20+ minutes, background)"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"Research Pending Parts"})," â€” runs Exa AI supplier search on all unresearched parts"]})]})]})}),e.jsx(c,{xs:24,md:8,children:e.jsx(d,{title:"ðŸ“Š Last Action",style:{borderRadius:8,height:"100%"},children:n?e.jsxs("div",{children:[e.jsx(H,{color:i,style:{color:"#fff",marginBottom:8},children:n.action}),e.jsxs("div",{style:{fontSize:12,color:"#374151"},children:[((P=n.result)==null?void 0:P.new_rfqs)!==void 0&&e.jsxs("div",{children:["âœ… +",n.result.new_rfqs," new RFQs"]}),((C=n.result)==null?void 0:C.new_parts)!==void 0&&e.jsxs("div",{children:["ðŸ“¦ +",n.result.new_parts," parts"]}),((T=n.result)==null?void 0:T.queued)!==void 0&&e.jsxs("div",{children:["ðŸ”¬ ",n.result.queued," parts queued for research"]}),((E=n.result)==null?void 0:E.message)&&e.jsxs("div",{children:["ðŸ’¬ ",n.result.message]})]}),e.jsxs(o,{type:"secondary",style:{fontSize:11},children:["at ",n.at]})]}):e.jsx(o,{type:"secondary",children:"No actions triggered this session"})})})]}),e.jsx(d,{title:"â„¹ï¸ How It Works",style:{borderRadius:8},children:e.jsx(j,{gutter:[16,16],children:[{icon:e.jsx(I,{status:"processing"}),title:"Real-time Watcher",desc:"chokidar watches /www/vmail/alali.om/rfq/ for new emails. New RFQs appear in the ERP within seconds of arrival.",color:u},{icon:e.jsx(M,{style:{color:i}}),title:"30-min Periodic Scan",desc:"Backup scan every 30 minutes catches any files the watcher may have missed (e.g., during restarts).",color:i},{icon:e.jsx(W,{style:{color:"#f59e0b"}}),title:"PDF OCR Pipeline",desc:"PDF attachments â†’ Kreuzberg (fast) â†’ pdftotext â†’ ocrmypdf (for scanned docs) â†’ LLM part extraction.",color:"#f59e0b"},{icon:e.jsx(k,{style:{color:"#6366f1"}}),title:"Exa Supplier Research",desc:"Each pending part gets 2 Exa neural searches (suppliers + specs). LLM generates procurement recommendations.",color:"#6366f1"}].map(({icon:s,title:f,desc:l,color:L})=>e.jsx(c,{xs:24,sm:12,md:6,children:e.jsxs("div",{style:{padding:"12px 0",borderLeft:`3px solid ${L}`,paddingLeft:12},children:[e.jsxs("div",{style:{fontWeight:600,color:L,marginBottom:4},children:[s," ",f]}),e.jsx("div",{style:{fontSize:12,color:"#6b7280",lineHeight:1.5},children:l})]})},f))})})]})}export{oe as default};
