import{m as V,r as o,j as t}from"./index-BolfsKLq.js";import{az as I,ai as _,aB as U,aC as K,aE as W,aN as Z,ar as J}from"./IdurarOs-ImGZrK6V.js";import{R as Y}from"./ReloadOutlined-Blzgat7w.js";import{C as b}from"./index-B1-0owN0.js";import{S as X}from"./index-DiNCbd71.js";import{m as ee}from"./ErpApp-CPyzesRl.js";import{S as j}from"./index-B4i0fLDO.js";import{T as te}from"./index-SyqhotZh.js";import{T as re}from"./ThunderboltOutlined-C0exu4-p.js";import{F as ae}from"./Table-DwPC3CMf.js";import{T as m}from"./index-HROpVfrd.js";import{B as se}from"./index-BqgTFRP1.js";import"./Skeleton-D8BNZGpQ.js";import"./pickAttrs-rA9L7BI5.js";import"./DownOutlined-CA7fmMYD.js";import"./PlusOutlined-CXeZI9c1.js";import"./Pagination-xSPnpsLs.js";import"./useClosable-B9lNjp8n.js";function P(){var l,u;try{const h=(u=(l=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:l.current)==null?void 0:u.token;return h?{Authorization:`Bearer ${h}`}:{}}catch{return{}}}const{Title:oe,Text:ie}=J,{Option:i}=j,n="#034D57",z="#4CB480",le={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},ne={ior:"red",routine:"orange",normal:"default"},ce=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function Te(){var w,k,A,O,T;const l=V(),[u,h]=o.useState([]),[E,R]=o.useState(!0),[a,B]=o.useState(null),[de,N]=o.useState({}),[x,v]=o.useState({current:1,pageSize:25,total:0}),[c,F]=o.useState("ALL"),[s,p]=o.useState({status:"",priority:"all",q:""}),[D,$]=o.useState(""),C=o.useCallback(async()=>{try{const r=await(await fetch(I+"rfq/stats",{headers:P()})).json();r.success&&B(r.result)}catch{}},[]),f=o.useCallback(async(e=1)=>{R(!0);try{const r=new URLSearchParams({page:e,items:x.pageSize,...s.status&&s.status!=="active"?{status:s.status}:s.status==="active"?{status:"new,in_progress,researched"}:{},...s.priority!=="all"?{priority:s.priority}:{},...c!=="ALL"?{client:c}:{},...s.q?{q:s.q}:{}}),d=await(await fetch(I+`rfq/list?${r}`,{headers:P()})).json();if(d.success){h(d.result||[]),v(y=>{var L,q;return{...y,current:e,total:((L=d.pagination)==null?void 0:L.total)||((q=d.result)==null?void 0:q.length)||0}});const S={};(d.result||[]).forEach(y=>{S[y.client]=(S[y.client]||0)+1}),N(S)}}catch{}finally{R(!1)}},[s,c,x.pageSize]);o.useEffect(()=>{C()},[]),o.useEffect(()=>{f(1)},[s,c]);const Q=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(e,r)=>t.jsxs("div",{children:[t.jsx(ie,{strong:!0,style:{color:n,cursor:"pointer",fontSize:13},onClick:()=>l(`/rfq/${r._id}`),children:e||"â€”"}),r.priority==="ior"&&t.jsx(m,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:e=>t.jsx(m,{color:n,style:{color:"#fff",fontSize:11},children:e})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(e,r)=>t.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>l(`/rfq/${r._id}`),children:e})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,render:e=>t.jsx(m,{color:ne[e]||"default",children:(e||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>t.jsx(m,{color:le[e]||"default",children:e==null?void 0:e.replace("_"," ")})},{title:"Parts",key:"parts",width:70,render:(e,r)=>t.jsx(se,{count:r.partsCount||0,showZero:!0,style:{backgroundColor:r.partsCount>0?z:"#e5e7eb",color:r.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,render:e=>e?new Date(e).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"",key:"action",width:60,render:(e,r)=>t.jsx(_,{size:"small",type:"link",style:{color:n,padding:0},onClick:()=>l(`/rfq/${r._id}`),children:"View â†’"})}],G=((w=a==null?void 0:a.byPriority)==null?void 0:w.ior)||0,M=(((k=a==null?void 0:a.byStatus)==null?void 0:k.new)||0)+(((A=a==null?void 0:a.byStatus)==null?void 0:A.in_progress)||0)+(((O=a==null?void 0:a.byStatus)==null?void 0:O.researched)||0),H=((T=a==null?void 0:a.byStatus)==null?void 0:T.quoted)||0;return t.jsxs("div",{style:{padding:20,background:"#f0f2f5",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(oe,{level:3,style:{color:n,margin:0},children:"ðŸ“‹ RFQ Management"}),t.jsx(_,{icon:t.jsx(Y,{}),onClick:()=>{C(),f(1)},style:{borderColor:n,color:n},children:"Refresh"})]}),t.jsx(U,{gutter:[12,12],style:{marginBottom:16},children:[{title:"Total RFQs",value:(a==null?void 0:a.total)||0,color:n},{title:"Active",value:M,color:"#3b82f6"},{title:"IOR Priority",value:G,color:"#ef4444"},{title:"Total Parts",value:(a==null?void 0:a.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:H,color:z},{title:"Vendors",value:(a==null?void 0:a.totalVendors)||0,color:"#f59e0b"}].map(({title:e,value:r,color:g})=>t.jsx(K,{xs:8,sm:4,children:t.jsx(b,{size:"small",style:{borderTop:`3px solid ${g}`,borderRadius:8,textAlign:"center"},children:t.jsx(X,{title:e,value:r,valueStyle:{color:g,fontSize:18,fontWeight:700}})})},e))}),t.jsx(b,{size:"small",style:{marginBottom:12,borderRadius:8},children:t.jsxs(ee,{wrap:!0,children:[t.jsx(W.Search,{placeholder:"Search RFQ#, part, subject...",value:D,onChange:e=>$(e.target.value),onSearch:e=>p(r=>({...r,q:e})),onPressEnter:e=>p(r=>({...r,q:e.target.value})),style:{width:260},prefix:t.jsx(Z,{style:{color:"#9ca3af"}})}),t.jsxs(j,{value:s.status||"active",onChange:e=>p(r=>({...r,status:e})),style:{width:140},children:[t.jsx(i,{value:"active",children:"Active"}),t.jsx(i,{value:"new",children:"New"}),t.jsx(i,{value:"in_progress",children:"In Progress"}),t.jsx(i,{value:"researched",children:"Researched"}),t.jsx(i,{value:"quoted",children:"Quoted"}),t.jsx(i,{value:"won",children:"Won"}),t.jsx(i,{value:"lost",children:"Lost"}),t.jsx(i,{value:"",children:"All Statuses"})]}),t.jsxs(j,{value:s.priority,onChange:e=>p(r=>({...r,priority:e})),style:{width:120},children:[t.jsx(i,{value:"all",children:"All Priority"}),t.jsx(i,{value:"ior",children:"ðŸš¨ IOR"}),t.jsx(i,{value:"routine",children:"Routine"}),t.jsx(i,{value:"normal",children:"Normal"})]})]})}),t.jsxs(b,{style:{borderRadius:8},bodyStyle:{padding:0},children:[t.jsx(te,{activeKey:c,onChange:e=>{F(e),f(1)},size:"small",style:{paddingLeft:8},items:ce.map(({key:e,label:r})=>({key:e,label:t.jsxs("span",{children:[e==="ALL"?t.jsx(re,{}):null," ",r]})}))}),t.jsx(ae,{rowKey:"_id",columns:Q,dataSource:u,loading:E,size:"small",pagination:{...x,showSizeChanger:!1,showTotal:e=>`${e} RFQs`,onChange:e=>{v(r=>({...r,current:e})),f(e)}},rowClassName:e=>e.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:900},onRow:e=>({onClick:()=>l(`/rfq/${e._id}`),style:{cursor:"pointer"}})})]}),t.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{Te as default};
