import{r as d,o as D,m as M,j as n}from"./index-qzPW9k5C.js";import{j as X,m as F,r as G,k as m,a as A,c as C,I as V,br as U,z as Q,p as J,az as Y,aD as Z,ai as K,aB as k,aC as ee,ar as te}from"./IdurarOs-DNtyhAIr.js";import{O as ie,b as re,a as ae,C as le,d as ne,a0 as se}from"./ErpApp-C6krObaP.js";import{C as N}from"./index-BT6S6B4u.js";import{S as oe}from"./index-ByIMSrJ7.js";import{E as ce}from"./index-Bcrj0uk5.js";import{T as P}from"./index-BcmoYINL.js";import{A as de}from"./ArrowLeftOutlined-ZHgLjSSo.js";import{C as me}from"./ClockCircleOutlined-CBV0ymDz.js";import"./Skeleton-r7dioW59.js";import"./index-C5J7yocW.js";import"./PlusOutlined-BhF-bFT8.js";import"./pickAttrs-HYIWXRHU.js";import"./useClosable-D4tg0jNW.js";const ue=e=>{const{componentCls:t,calc:r}=e;return{[t]:Object.assign(Object.assign({},G(e)),{margin:0,padding:0,listStyle:"none",[`${t}-item`]:{position:"relative",margin:0,paddingBottom:e.itemPaddingBottom,fontSize:e.fontSize,listStyle:"none","&-tail":{position:"absolute",insetBlockStart:e.itemHeadSize,insetInlineStart:r(r(e.itemHeadSize).sub(e.tailWidth)).div(2).equal(),height:`calc(100% - ${m(e.itemHeadSize)})`,borderInlineStart:`${m(e.tailWidth)} ${e.lineType} ${e.tailColor}`},"&-pending":{[`${t}-item-head`]:{fontSize:e.fontSizeSM,backgroundColor:"transparent"},[`${t}-item-tail`]:{display:"none"}},"&-head":{position:"absolute",width:e.itemHeadSize,height:e.itemHeadSize,backgroundColor:e.dotBg,border:`${m(e.dotBorderWidth)} ${e.lineType} transparent`,borderRadius:"50%","&-blue":{color:e.colorPrimary,borderColor:e.colorPrimary},"&-red":{color:e.colorError,borderColor:e.colorError},"&-green":{color:e.colorSuccess,borderColor:e.colorSuccess},"&-gray":{color:e.colorTextDisabled,borderColor:e.colorTextDisabled}},"&-head-custom":{position:"absolute",insetBlockStart:r(e.itemHeadSize).div(2).equal(),insetInlineStart:r(e.itemHeadSize).div(2).equal(),width:"auto",height:"auto",marginBlockStart:0,paddingBlock:e.customHeadPaddingVertical,lineHeight:1,textAlign:"center",border:0,borderRadius:0,transform:"translate(-50%, -50%)"},"&-content":{position:"relative",insetBlockStart:r(r(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.lineWidth).equal(),marginInlineStart:r(e.margin).add(e.itemHeadSize).equal(),marginInlineEnd:0,marginBlockStart:0,marginBlockEnd:0,wordBreak:"break-word"},"&-last":{[`> ${t}-item-tail`]:{display:"none"},[`> ${t}-item-content`]:{minHeight:r(e.controlHeightLG).mul(1.2).equal()}}},[`&${t}-alternate,
        &${t}-right,
        &${t}-label`]:{[`${t}-item`]:{"&-tail, &-head, &-head-custom":{insetInlineStart:"50%"},"&-head":{marginInlineStart:r(e.marginXXS).mul(-1).equal(),"&-custom":{marginInlineStart:r(e.tailWidth).div(2).equal()}},"&-left":{[`${t}-item-content`]:{insetInlineStart:`calc(50% - ${m(e.marginXXS)})`,width:`calc(50% - ${m(e.marginSM)})`,textAlign:"start"}},"&-right":{[`${t}-item-content`]:{width:`calc(50% - ${m(e.marginSM)})`,margin:0,textAlign:"end"}}}},[`&${t}-right`]:{[`${t}-item-right`]:{[`${t}-item-tail,
            ${t}-item-head,
            ${t}-item-head-custom`]:{insetInlineStart:`calc(100% - ${m(r(r(e.itemHeadSize).add(e.tailWidth)).div(2).equal())})`},[`${t}-item-content`]:{width:`calc(100% - ${m(r(e.itemHeadSize).add(e.marginXS).equal())})`}}},[`&${t}-pending
        ${t}-item-last
        ${t}-item-tail`]:{display:"block",height:`calc(100% - ${m(e.margin)})`,borderInlineStart:`${m(e.tailWidth)} dotted ${e.tailColor}`},[`&${t}-reverse
        ${t}-item-last
        ${t}-item-tail`]:{display:"none"},[`&${t}-reverse ${t}-item-pending`]:{[`${t}-item-tail`]:{insetBlockStart:e.margin,display:"block",height:`calc(100% - ${m(e.margin)})`,borderInlineStart:`${m(e.tailWidth)} dotted ${e.tailColor}`},[`${t}-item-content`]:{minHeight:r(e.controlHeightLG).mul(1.2).equal()}},[`&${t}-label`]:{[`${t}-item-label`]:{position:"absolute",insetBlockStart:r(r(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.tailWidth).equal(),width:`calc(50% - ${m(e.marginSM)})`,textAlign:"end"},[`${t}-item-right`]:{[`${t}-item-label`]:{insetInlineStart:`calc(50% + ${m(e.marginSM)})`,width:`calc(50% - ${m(e.marginSM)})`,textAlign:"start"}}},"&-rtl":{direction:"rtl",[`${t}-item-head-custom`]:{transform:"translate(50%, -50%)"}}})}},ge=e=>({tailColor:e.colorSplit,tailWidth:e.lineWidthBold,dotBorderWidth:e.wireframe?e.lineWidthBold:e.lineWidth*3,dotBg:e.colorBgContainer,itemPaddingBottom:e.padding*1.25}),pe=X("Timeline",e=>{const t=F(e,{itemHeadSize:10,customHeadPaddingVertical:e.paddingXXS,paddingInlineEnd:2});return[ue(t)]},ge);var he=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(r[i[l]]=e[i[l]]);return r};const H=e=>{var{prefixCls:t,className:r,color:i="blue",dot:l,pending:y=!1,position:b,label:u,children:h}=e,f=he(e,["prefixCls","className","color","dot","pending","position","label","children"]);const{getPrefixCls:p}=d.useContext(A),s=p("timeline",t),S=C(`${s}-item`,{[`${s}-item-pending`]:y},r),a=/blue|red|green|gray/.test(i||"")?void 0:i,o=C(`${s}-item-head`,{[`${s}-item-head-custom`]:!!l,[`${s}-item-head-${i}`]:!a});return d.createElement("li",Object.assign({},f,{className:S}),u&&d.createElement("div",{className:`${s}-item-label`},u),d.createElement("div",{className:`${s}-item-tail`}),d.createElement("div",{className:o,style:{borderColor:a,color:a}},l),d.createElement("div",{className:`${s}-item-content`},h))};var E=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(r[i[l]]=e[i[l]]);return r};const fe=e=>{var{prefixCls:t,className:r,pending:i=!1,children:l,items:y,rootClassName:b,reverse:u=!1,direction:h,hashId:f,pendingDot:p,mode:s=""}=e,S=E(e,["prefixCls","className","pending","children","items","rootClassName","reverse","direction","hashId","pendingDot","mode"]);const a=(c,x)=>s==="alternate"?c==="right"?`${t}-item-right`:c==="left"?`${t}-item-left`:x%2===0?`${t}-item-left`:`${t}-item-right`:s==="left"?`${t}-item-left`:s==="right"?`${t}-item-right`:c==="right"?`${t}-item-right`:"",o=V(y||[]),g=typeof i=="boolean"?null:i;i&&o.push({pending:!!i,dot:p||d.createElement(U,null),children:g}),u&&o.reverse();const $=o.length,v=`${t}-item-last`,T=o.filter(c=>!!c).map((c,x)=>{var I;const W=x===$-2?v:"",_=x===$-1?v:"",{className:L}=c,R=E(c,["className"]);return d.createElement(H,Object.assign({},R,{className:C([L,!u&&i?W:_,a((I=c==null?void 0:c.position)!==null&&I!==void 0?I:"",x)]),key:(c==null?void 0:c.key)||x}))}),B=o.some(c=>!!(c!=null&&c.label)),q=C(t,{[`${t}-pending`]:!!i,[`${t}-reverse`]:!!u,[`${t}-${s}`]:!!s&&!B,[`${t}-label`]:B,[`${t}-rtl`]:h==="rtl"},r,b,f);return d.createElement("ul",Object.assign({},S,{className:q}),T)};function ye(e,t){return e&&Array.isArray(e)?e:Q(t).map(r=>{var i,l;return Object.assign({children:(l=(i=r==null?void 0:r.props)===null||i===void 0?void 0:i.children)!==null&&l!==void 0?l:""},r.props)})}var be=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(r[i[l]]=e[i[l]]);return r};const z=e=>{const{getPrefixCls:t,direction:r,timeline:i}=d.useContext(A),{prefixCls:l,children:y,items:b,className:u,style:h}=e,f=be(e,["prefixCls","children","items","className","style"]),p=t("timeline",l),s=J(p),[S,a,o]=pe(p,s),g=ye(b,y);return S(d.createElement(fe,Object.assign({},f,{className:C(i==null?void 0:i.className,u,o,s),style:Object.assign(Object.assign({},i==null?void 0:i.style),h),prefixCls:p,direction:r,items:g,hashId:a})))};z.Item=H;const{Title:Se,Text:j}=te,w="#034D57",$e="#4CB480";function xe(){var e,t;try{const r=(t=(e=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:e.current)==null?void 0:t.token;return r?{Authorization:`Bearer ${r}`}:{}}catch{return{}}}const O={rfq:{icon:n.jsx(re,{}),color:"#1890ff",label:"RFQ"},quote:{icon:n.jsx(ae,{}),color:$e,label:"Quote"},invoice:{icon:n.jsx(le,{}),color:"#fa8c16",label:"Invoice"},payment:{icon:n.jsx(ne,{}),color:"#52c41a",label:"Payment"},po:{icon:n.jsx(se,{}),color:"#722ed1",label:"PO"}},ve={new:"blue",in_progress:"processing",researched:"purple",quoted:"cyan",draft:"default",sent:"processing",approved:"green",paid:"blue",won:"green",lost:"red",expired:"default",overdue:"red"};function We(){const{id:e}=D(),t=M(),[r,i]=d.useState(!0),[l,y]=d.useState(null),[b,u]=d.useState(null),h=d.useCallback(async()=>{i(!0);try{const o=await(await fetch(`${Y}client/activity/${e}`,{headers:xe()})).json();o.success?y(o):u("Failed to load activity")}catch(a){u(a.message)}i(!1)},[e]);if(d.useEffect(()=>{h()},[h]),r)return n.jsx("div",{style:{textAlign:"center",padding:80},children:n.jsx(Z,{size:"large"})});if(b)return n.jsx("div",{style:{textAlign:"center",padding:80},children:n.jsx(j,{type:"danger",children:b})});const{result:f=[],client:p={},counts:s={}}=l||{},S=a=>{const o={rfq:`/rfq/${a.id}`,quote:`/quote/read/${a.id}`,invoice:`/invoice/read/${a.id}`,payment:`/payment/read/${a.id}`,po:`/purchase-order/read/${a.id}`};o[a.type]&&t(o[a.type])};return n.jsxs("div",{style:{padding:"24px",maxWidth:1e3,margin:"0 auto"},children:[n.jsx(K,{icon:n.jsx(de,{}),onClick:()=>t("/customer"),style:{marginBottom:16},children:"Back to Clients"}),n.jsxs(Se,{level:3,style:{color:w,marginBottom:20},children:[p.name," â€” Activity"]}),n.jsx(k,{gutter:[16,16],style:{marginBottom:24},children:Object.entries(s).map(([a,o])=>{var g,$;return n.jsx(ee,{xs:12,sm:8,md:4,children:n.jsx(N,{size:"small",style:{borderRadius:8,textAlign:"center"},children:n.jsx(oe,{title:a.toUpperCase(),value:o,valueStyle:{color:((g=O[a])==null?void 0:g.color)||w,fontSize:24,fontWeight:800},prefix:($=O[a])==null?void 0:$.icon})})},a)})}),f.length===0?n.jsx(ce,{description:"No activity found for this client"}):n.jsx(N,{style:{borderRadius:12},children:n.jsx(z,{mode:"left",children:f.map((a,o)=>{var v;const g=O[a.type]||O.rfq,$=a.date?new Date(a.date).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short",year:"numeric"}):"";return n.jsx(z.Item,{color:g.color,dot:n.jsx("span",{style:{fontSize:16},children:g.icon}),children:n.jsxs("div",{style:{cursor:"pointer",padding:"4px 0"},onClick:()=>S(a),children:[n.jsx(P,{color:g.color,style:{fontWeight:600,marginRight:8},children:g.label}),n.jsx(j,{strong:!0,style:{color:"#333"},children:a.summary}),a.status&&n.jsx(P,{color:ve[a.status]||"default",style:{marginLeft:8},children:(v=a.status)==null?void 0:v.replace("_"," ")}),(a.total||a.amount)&&n.jsxs("span",{style:{marginLeft:8,display:"inline-flex",alignItems:"center",gap:3},children:[n.jsx(ie,{size:11}),n.jsx(j,{style:{fontWeight:600},children:Number(a.total||a.amount||0).toLocaleString("en-US",{minimumFractionDigits:3})})]}),n.jsx("br",{}),n.jsxs(j,{type:"secondary",style:{fontSize:11},children:[n.jsx(me,{style:{marginRight:4}}),$]})]})},o)})})})]})}export{We as default};
