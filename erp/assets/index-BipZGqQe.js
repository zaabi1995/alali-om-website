import{j as e,r as l}from"./index-CqiROrvI.js";import{d as g}from"./dayjs.min-C_IV7Sgr.js";import{ar as I,ai as R,aA as C,aB as m,ay as S}from"./IdurarOs-U9s3-I7Z.js";import{T as k}from"./index-BIPJbkNP.js";import{a as M,H as T,h as b}from"./ErpApp-DC-1NaCs.js";import{C as h}from"./index-mMksCeTx.js";import{S as y}from"./index-DvOddZcy.js";import{F as x}from"./Table-B6txZ5Lc.js";import{D as z}from"./index-B_rpSTuC.js";import{T as v}from"./index-DAwtC9M-.js";import{P as B}from"./progress-r6u9rHAv.js";import{W as O}from"./WarningOutlined-B9d8WyC2.js";import{D as P}from"./DollarOutlined-CyRwyTS_.js";import"./PlusOutlined-CcJquEGz.js";import"./Skeleton-D-mYmbMD.js";import"./pickAttrs-CYJKFN78.js";import"./index-BS7qSh2D.js";import"./DownOutlined-B4TMFaP8.js";import"./ClockCircleOutlined-BtMVhDtj.js";import"./useClosable-BJjLAl2J.js";const{Title:A,Text:w}=I,{RangePicker:Y}=z;function D(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function i(a){return`${parseFloat(a||0).toFixed(3)} ر.ع.`}function L(){const[a,f]=l.useState(null),[c,o]=l.useState(!1),[n,p]=l.useState([g().startOf("year"),g()]),u=async()=>{o(!0);const t=new URLSearchParams({from:n[0].format("YYYY-MM-DD"),to:n[1].format("YYYY-MM-DD")}),d=await(await fetch(S+`reports/vat?${t}`,{headers:D()})).json();d.success&&f(d.result),o(!1)};l.useEffect(()=>{u()},[]);const s=[{title:"Invoice #",dataIndex:"number",render:(t,r)=>`INV-${t}/${r.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Date",dataIndex:"date",render:t=>g(t).format("DD MMM YYYY"),width:110},{title:"Subtotal",dataIndex:"subTotal",align:"right",render:i},{title:"VAT (5%)",dataIndex:"taxTotal",align:"right",render:t=>e.jsx(w,{style:{color:"#e53e3e"},children:i(t)})},{title:"Total",dataIndex:"total",align:"right",render:t=>e.jsx("strong",{children:i(t)})},{title:"Status",dataIndex:"status",width:90,render:t=>e.jsx(v,{children:t==null?void 0:t.toUpperCase()})}];return e.jsxs("div",{children:[e.jsxs(b,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:n,onChange:t=>t&&p(t)}),e.jsx(R,{type:"primary",onClick:u,loading:c,style:{background:"#034D57"},children:"Run Report"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{gutter:16,style:{marginBottom:20},children:[e.jsx(m,{xs:8,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Total Sales",value:a.totals.subTotal,precision:3,suffix:"OMR"})})}),e.jsx(m,{xs:8,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"VAT Collected (5%)",value:a.totals.taxTotal,precision:3,suffix:"OMR",valueStyle:{color:"#e53e3e"}})})}),e.jsx(m,{xs:8,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Gross Revenue",value:a.totals.total,precision:3,suffix:"OMR",valueStyle:{color:"#034D57"}})})})]}),e.jsx(x,{columns:s,dataSource:a.invoices,rowKey:"_id",size:"small",pagination:{pageSize:20},loading:c,summary:()=>(a==null?void 0:a.totals)&&e.jsxs(x.Summary.Row,{style:{background:"#f0f6f7",fontWeight:700},children:[e.jsxs(x.Summary.Cell,{index:0,colSpan:3,children:["TOTAL (",a.count," invoices)"]}),e.jsx(x.Summary.Cell,{index:3,align:"right",children:i(a.totals.subTotal)}),e.jsx(x.Summary.Cell,{index:4,align:"right",style:{color:"#e53e3e"},children:i(a.totals.taxTotal)}),e.jsx(x.Summary.Cell,{index:5,align:"right",children:i(a.totals.total)}),e.jsx(x.Summary.Cell,{index:6})]})})]})]})}function $(){const[a,f]=l.useState(null),[c,o]=l.useState(!1);l.useEffect(()=>{o(!0),fetch(S+"reports/aged-receivables",{headers:D()}).then(s=>s.json()).then(s=>{s.success&&f(s.result)}).finally(()=>o(!1))},[]);const n=[{title:"Invoice #",dataIndex:"number",render:(s,t)=>`INV-${s}/${t.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Due Date",dataIndex:"expiredDate",render:s=>s?g(s).format("DD MMM YYYY"):"—",width:110},{title:"Days Overdue",dataIndex:"_daysOverdue",width:110,align:"center",render:s=>e.jsx(v,{color:s<=0?"green":s<=30?"orange":s<=60?"red":"purple",children:s<=0?"Current":`${s}d`})},{title:"Balance Due",dataIndex:"_balance",align:"right",render:i}],p=[{key:"current",label:"Current (not yet due)",color:"#4CB480"},{key:"d30",label:"1–30 Days",color:"#fa8c16"},{key:"d60",label:"31–60 Days",color:"#f5222d"},{key:"d90",label:"61–90 Days",color:"#722ed1"},{key:"over90",label:"Over 90 Days",color:"#820014"}],u=a?[...a.buckets.current||[],...a.buckets.d30||[],...a.buckets.d60||[],...a.buckets.d90||[],...a.buckets.over90||[]]:[];return e.jsx("div",{children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{gutter:12,style:{marginBottom:20},children:[p.map(s=>{var t;return e.jsx(m,{xs:12,sm:8,md:4,children:e.jsxs(h,{size:"small",style:{borderTop:`3px solid ${s.color}`},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:s.label}),e.jsx("div",{style:{fontWeight:800,color:s.color,fontSize:14},children:i(a.sums[s.key])}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[((t=a.buckets[s.key])==null?void 0:t.length)||0," invoices"]})]})},s.key)}),e.jsx(m,{xs:12,sm:8,md:4,children:e.jsxs(h,{size:"small",style:{borderTop:"3px solid #034D57",background:"#f0f6f7"},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:"TOTAL RECEIVABLE"}),e.jsx("div",{style:{fontWeight:800,color:"#034D57",fontSize:14},children:i(a.grandTotal)}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[a.count," invoices"]})]})})]}),e.jsx(x,{columns:n,dataSource:u,rowKey:"_id",size:"small",loading:c,pagination:{pageSize:20},rowClassName:s=>s._daysOverdue>90?"ant-table-row-danger":""})]})})}function F(){const[a,f]=l.useState(null),[c,o]=l.useState(!1),[n,p]=l.useState([g().startOf("year"),g()]),u=async()=>{o(!0);const t=new URLSearchParams({from:n[0].format("YYYY-MM-DD"),to:n[1].format("YYYY-MM-DD")}),d=await(await fetch(S+`reports/pnl?${t}`,{headers:D()})).json();d.success&&f(d.result),o(!1)};l.useEffect(()=>{u()},[]);const s=[{title:"Invoice #",dataIndex:"number",render:(t,r)=>`INV-${t}/${r.year}`,width:100},{title:"Client",dataIndex:"client",ellipsis:!0},{title:"Date",dataIndex:"date",render:t=>g(t).format("DD MMM YYYY"),width:110},{title:"Revenue",dataIndex:"revenue",align:"right",render:i},{title:"Cost (est.)",dataIndex:"costOMR",align:"right",render:t=>e.jsx(w,{type:"secondary",children:i(t)})},{title:"Gross Profit",dataIndex:"grossProfit",align:"right",render:t=>e.jsx("strong",{style:{color:t>=0?"#4CB480":"#e53e3e"},children:i(t)})},{title:"Margin",dataIndex:"margin",align:"center",width:100,render:t=>e.jsxs(v,{color:t>=30?"green":t>=10?"orange":"red",children:[t.toFixed(1),"%"]})},{title:"PO Linked",dataIndex:"hasLinkedPO",width:80,align:"center",render:t=>e.jsx(v,{color:t?"green":"default",children:t?"✓":"—"})}];return e.jsxs("div",{children:[e.jsxs(b,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:n,onChange:t=>t&&p(t)}),e.jsx(R,{type:"primary",onClick:u,loading:c,style:{background:"#034D57"},children:"Run Report"})]}),(a==null?void 0:a.summary)&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{gutter:16,style:{marginBottom:20},children:[e.jsx(m,{xs:12,md:6,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Total Revenue",value:a.summary.totalRevenue,precision:3,suffix:"OMR"})})}),e.jsx(m,{xs:12,md:6,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Total Cost (est.)",value:a.summary.totalCost,precision:3,suffix:"OMR",valueStyle:{color:"#e53e3e"}})})}),e.jsx(m,{xs:12,md:6,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Gross Profit",value:a.summary.totalGrossProfit,precision:3,suffix:"OMR",valueStyle:{color:"#4CB480"}})})}),e.jsx(m,{xs:12,md:6,children:e.jsx(h,{size:"small",children:e.jsx(y,{title:"Avg Margin",value:a.summary.avgMargin,precision:1,suffix:"%",valueStyle:{color:a.summary.avgMargin>=30?"#4CB480":"#fa8c16"}})})})]}),e.jsx(x,{columns:s,dataSource:a.deals,rowKey:"_id",size:"small",loading:c,pagination:{pageSize:20}})]})]})}function _(){const[a,f]=l.useState([]),[c,o]=l.useState(!1),[n,p]=l.useState([g().startOf("year"),g()]),u=async()=>{o(!0);const r=new URLSearchParams({from:n[0].format("YYYY-MM-DD"),to:n[1].format("YYYY-MM-DD")}),j=await(await fetch(S+`reports/revenue-by-client?${r}`,{headers:D()})).json();j.success&&f(j.result),o(!1)};l.useEffect(()=>{u()},[]);const s=a.reduce((r,d)=>r+(d.total||0),0),t=[{title:"#",width:40,render:(r,d,j)=>j+1},{title:"Client",dataIndex:"clientName",ellipsis:!0},{title:"Invoices",dataIndex:"invoiceCount",width:80,align:"center"},{title:"Revenue",dataIndex:"total",align:"right",render:i},{title:"Share",dataIndex:"total",width:150,render:r=>e.jsx(B,{percent:s>0?parseFloat((r/s*100).toFixed(1)):0,size:"small",strokeColor:"#034D57",format:d=>`${d}%`})}];return e.jsxs("div",{children:[e.jsxs(b,{style:{marginBottom:16},wrap:!0,children:[e.jsx(Y,{value:n,onChange:r=>r&&p(r)}),e.jsx(R,{type:"primary",onClick:u,loading:c,style:{background:"#034D57"},children:"Run Report"})]}),e.jsx(x,{columns:t,dataSource:a,rowKey:"_id",size:"small",loading:c,pagination:!1})]})}function ie(){return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(A,{level:4,style:{color:"#034D57",marginBottom:20},children:"Financial Reports"}),e.jsx(k,{defaultActiveKey:"vat",items:[{key:"vat",label:e.jsxs("span",{children:[e.jsx(M,{})," VAT Report"]}),children:e.jsx(L,{})},{key:"aged",label:e.jsxs("span",{children:[e.jsx(O,{})," Aged Receivables"]}),children:e.jsx($,{})},{key:"pnl",label:e.jsxs("span",{children:[e.jsx(P,{})," P&L by Deal"]}),children:e.jsx(F,{})},{key:"revenue",label:e.jsxs("span",{children:[e.jsx(T,{})," Revenue by Client"]}),children:e.jsx(_,{})}]})]})}export{ie as default};
