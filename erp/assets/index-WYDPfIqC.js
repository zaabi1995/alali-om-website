import{r as l,j as e}from"./index-C236tqC8.js";import{a as S,o as b}from"./omrFormat-D9zakjTj.js";import{b as U,O as N,Q as V,R as W,l as I}from"./ErpApp-DwaI_8s0.js";import{d as f}from"./dayjs.min-BePh7Oku.js";import{X as A,b as F,ar as K,ai as w,aA as R,aB as g,ay as C,aI as B}from"./IdurarOs-CIvrJM3G.js";import{T as G}from"./index-C-HV-BqQ.js";import{C as m}from"./index-DKmxjtwJ.js";import{S as p}from"./index-f2gLqROF.js";import{F as y}from"./Table-BXAYilt4.js";import{D as H}from"./index-D5L4Ge1X.js";import{T as M}from"./index-C-MdfhzB.js";import{P as E}from"./progress-BkpXQoGd.js";import{W as q}from"./WarningOutlined-CpVmwbGm.js";import"./PlusOutlined-DUjbHxHh.js";import"./Skeleton-BfIMR0fQ.js";import"./pickAttrs-DhldMqNY.js";import"./index-D07aC4PS.js";import"./DownOutlined-C4yJOkOC.js";import"./ClockCircleOutlined-DveV7d10.js";import"./useClosable-BwSv22Km.js";var Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},X=function(h,i){return l.createElement(A,F({},h,{ref:i,icon:Q}))};const J=l.forwardRef(X);var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},ee=function(h,i){return l.createElement(A,F({},h,{ref:i,icon:Z}))};const te=l.forwardRef(ee),{Title:se,Text:P}=K,{RangePicker:k}=H;function D(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function j(t){return b(t)}function ae(){const[t,h]=l.useState(null),[i,d]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{d(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),x=await(await fetch(C+`reports/vat?${s}`,{headers:D()})).json();x.success&&h(x.result),d(!1)};l.useEffect(()=>{u()},[]);const a=[{title:"Invoice #",dataIndex:"number",render:(s,n)=>`INV-${s}/${n.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Date",dataIndex:"date",render:s=>f(s).format("DD MMM YYYY"),width:110},{title:"Subtotal",dataIndex:"subTotal",align:"right",render:j},{title:"VAT (5%)",dataIndex:"taxTotal",align:"right",render:s=>e.jsx(P,{style:{color:"#e53e3e"},children:j(s)})},{title:"Total",dataIndex:"total",align:"right",render:s=>e.jsx("strong",{children:j(s)})},{title:"Status",dataIndex:"status",width:90,render:s=>e.jsx(M,{children:s==null?void 0:s.toUpperCase()})}];return e.jsxs("div",{children:[e.jsxs(I,{style:{marginBottom:16},wrap:!0,children:[e.jsx(k,{value:r,onChange:s=>s&&o(s)}),e.jsx(w,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{gutter:16,style:{marginBottom:20},children:[e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Total Sales",value:t.totals.subTotal,precision:3,suffix:S()})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"VAT Collected (5%)",value:t.totals.taxTotal,precision:3,suffix:S(),valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Gross Revenue",value:t.totals.total,precision:3,suffix:S(),valueStyle:{color:"#034D57"}})})})]}),e.jsx(y,{columns:a,dataSource:t.invoices,rowKey:"_id",size:"small",pagination:{pageSize:20},loading:i,summary:()=>(t==null?void 0:t.totals)&&e.jsxs(y.Summary.Row,{style:{background:"#f0f6f7",fontWeight:700},children:[e.jsxs(y.Summary.Cell,{index:0,colSpan:3,children:["TOTAL (",t.count," invoices)"]}),e.jsx(y.Summary.Cell,{index:3,align:"right",children:j(t.totals.subTotal)}),e.jsx(y.Summary.Cell,{index:4,align:"right",style:{color:"#e53e3e"},children:j(t.totals.taxTotal)}),e.jsx(y.Summary.Cell,{index:5,align:"right",children:j(t.totals.total)}),e.jsx(y.Summary.Cell,{index:6})]})})]})]})}function le(){const[t,h]=l.useState(null),[i,d]=l.useState(!1);l.useEffect(()=>{d(!0),fetch(C+"reports/aged-receivables",{headers:D()}).then(a=>a.json()).then(a=>{a.success&&h(a.result)}).finally(()=>d(!1))},[]);const r=[{title:"Invoice #",dataIndex:"number",render:(a,s)=>`INV-${a}/${s.year}`,width:100},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Due Date",dataIndex:"expiredDate",render:a=>a?f(a).format("DD MMM YYYY"):"—",width:110},{title:"Days Overdue",dataIndex:"_daysOverdue",width:110,align:"center",render:a=>e.jsx(M,{color:a<=0?"green":a<=30?"orange":a<=60?"red":"purple",children:a<=0?"Current":`${a}d`})},{title:"Balance Due",dataIndex:"_balance",align:"right",render:j}],o=[{key:"current",label:"Current (not yet due)",color:"#4CB480"},{key:"d30",label:"1–30 Days",color:"#fa8c16"},{key:"d60",label:"31–60 Days",color:"#f5222d"},{key:"d90",label:"61–90 Days",color:"#722ed1"},{key:"over90",label:"Over 90 Days",color:"#820014"}],u=t?[...t.buckets.current||[],...t.buckets.d30||[],...t.buckets.d60||[],...t.buckets.d90||[],...t.buckets.over90||[]]:[];return e.jsx("div",{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{gutter:12,style:{marginBottom:20},children:[o.map(a=>{var s;return e.jsx(g,{xs:12,sm:8,md:4,children:e.jsxs(m,{size:"small",style:{borderTop:`3px solid ${a.color}`},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:a.label}),e.jsx("div",{style:{fontWeight:800,color:a.color,fontSize:14},children:j(t.sums[a.key])}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[((s=t.buckets[a.key])==null?void 0:s.length)||0," invoices"]})]})},a.key)}),e.jsx(g,{xs:12,sm:8,md:4,children:e.jsxs(m,{size:"small",style:{borderTop:"3px solid #034D57",background:"#f0f6f7"},children:[e.jsx("div",{style:{fontSize:10,color:"#888",marginBottom:4},children:"TOTAL RECEIVABLE"}),e.jsx("div",{style:{fontWeight:800,color:"#034D57",fontSize:14},children:j(t.grandTotal)}),e.jsxs("div",{style:{fontSize:10,color:"#aaa"},children:[t.count," invoices"]})]})})]}),e.jsx(y,{columns:r,dataSource:u,rowKey:"_id",size:"small",loading:i,pagination:{pageSize:20},rowClassName:a=>a._daysOverdue>90?"ant-table-row-danger":""})]})})}function re(){const[t,h]=l.useState(null),[i,d]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{d(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),x=await(await fetch(C+`reports/pnl?${s}`,{headers:D()})).json();x.success&&h(x.result),d(!1)};l.useEffect(()=>{u()},[]);const a=[{title:"Invoice #",dataIndex:"number",render:(s,n)=>`INV-${s}/${n.year}`,width:100},{title:"Client",dataIndex:"client",ellipsis:!0},{title:"Date",dataIndex:"date",render:s=>f(s).format("DD MMM YYYY"),width:110},{title:"Revenue",dataIndex:"revenue",align:"right",render:j},{title:"Cost (est.)",dataIndex:"costOMR",align:"right",render:s=>e.jsx(P,{type:"secondary",children:j(s)})},{title:"Gross Profit",dataIndex:"grossProfit",align:"right",render:s=>e.jsx("strong",{style:{color:s>=0?"#4CB480":"#e53e3e"},children:j(s)})},{title:"Margin",dataIndex:"margin",align:"center",width:100,render:s=>e.jsxs(M,{color:s>=30?"green":s>=10?"orange":"red",children:[s.toFixed(1),"%"]})},{title:"PO Linked",dataIndex:"hasLinkedPO",width:80,align:"center",render:s=>e.jsx(M,{color:s?"green":"default",children:s?"✓":"—"})}];return e.jsxs("div",{children:[e.jsxs(I,{style:{marginBottom:16},wrap:!0,children:[e.jsx(k,{value:r,onChange:s=>s&&o(s)}),e.jsx(w,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),(t==null?void 0:t.summary)&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{gutter:16,style:{marginBottom:20},children:[e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Total Revenue",value:t.summary.totalRevenue,precision:3,suffix:S()})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Total Cost (est.)",value:t.summary.totalCost,precision:3,suffix:S(),valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Gross Profit",value:t.summary.totalGrossProfit,precision:3,suffix:S(),valueStyle:{color:"#4CB480"}})})}),e.jsx(g,{xs:12,md:6,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Avg Margin",value:t.summary.avgMargin,precision:1,suffix:"%",valueStyle:{color:t.summary.avgMargin>=30?"#4CB480":"#fa8c16"}})})})]}),e.jsx(y,{columns:a,dataSource:t.deals,rowKey:"_id",size:"small",loading:i,pagination:{pageSize:20}})]})]})}function ne(){const[t,h]=l.useState([]),[i,d]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{d(!0);const n=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),c=await(await fetch(C+`reports/revenue-by-client?${n}`,{headers:D()})).json();c.success&&h(c.result),d(!1)};l.useEffect(()=>{u()},[]);const a=t.reduce((n,x)=>n+(x.total||0),0),s=[{title:"#",width:40,render:(n,x,c)=>c+1},{title:"Client",dataIndex:"clientName",ellipsis:!0},{title:"Invoices",dataIndex:"invoiceCount",width:80,align:"center"},{title:"Revenue",dataIndex:"total",align:"right",render:j},{title:"Share",dataIndex:"total",width:150,render:n=>e.jsx(E,{percent:a>0?parseFloat((n/a*100).toFixed(1)):0,size:"small",strokeColor:"#034D57",format:x=>`${x}%`})}];return e.jsxs("div",{children:[e.jsxs(I,{style:{marginBottom:16},wrap:!0,children:[e.jsx(k,{value:r,onChange:n=>n&&o(n)}),e.jsx(w,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),e.jsx(y,{columns:s,dataSource:t,rowKey:"_id",size:"small",loading:i,pagination:!1})]})}function ie(){var u,a,s,n,x,c,v,Y,L,O;const[t,h]=l.useState(null),[i,d]=l.useState(!1),r=async()=>{d(!0);const T=await fetch(C+"account/balance-sheet",{headers:D()}).then(z=>z.json()).catch(()=>({}));T.success&&h(T.result),d(!1)};l.useEffect(()=>{r()},[]);const o=({label:T,value:z,bold:_,red:$})=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid #f0f0f0",fontWeight:_?700:400,color:$?"#e53e3e":"inherit"},children:[e.jsx("span",{children:T}),e.jsx("span",{children:b(z||0)})]});return e.jsxs("div",{children:[e.jsx(w,{type:"primary",onClick:r,loading:i,style:{background:"#034D57",marginBottom:16},children:"Refresh"}),t?e.jsxs(R,{gutter:16,children:[e.jsxs(g,{xs:24,sm:12,children:[e.jsxs(m,{title:"ASSETS",size:"small",headStyle:{background:"#034D57",color:"#fff"},style:{marginBottom:16},children:[e.jsx(o,{label:"Accounts Receivable",value:(u=t.assets)==null?void 0:u.accountsReceivable}),e.jsx(o,{label:"Cash & Bank",value:(a=t.assets)==null?void 0:a.cash}),e.jsx(B,{style:{margin:"8px 0"}}),e.jsx(o,{label:"TOTAL ASSETS",value:(s=t.assets)==null?void 0:s.total,bold:!0})]}),e.jsxs(m,{title:"LIABILITIES",size:"small",headStyle:{background:"#e53e3e",color:"#fff"},children:[e.jsx(o,{label:"Accounts Payable",value:(n=t.liabilities)==null?void 0:n.accountsPayable,red:!0}),e.jsx(B,{style:{margin:"8px 0"}}),e.jsx(o,{label:"TOTAL LIABILITIES",value:(x=t.liabilities)==null?void 0:x.total,bold:!0,red:!0})]})]}),e.jsxs(g,{xs:24,sm:12,children:[e.jsxs(m,{title:"EQUITY & PROFIT",size:"small",headStyle:{background:"#4CB480",color:"#fff"},children:[e.jsx(o,{label:"Total Revenue",value:(c=t.equity)==null?void 0:c.revenue}),e.jsx(o,{label:"Total Expenses",value:(v=t.equity)==null?void 0:v.expenses,red:!0}),e.jsx(B,{style:{margin:"8px 0"}}),e.jsx(o,{label:"NET PROFIT",value:(Y=t.equity)==null?void 0:Y.netProfit,bold:!0})]}),e.jsxs(m,{size:"small",style:{marginTop:12,background:"#f0f9f9",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:12,color:"#888"},children:"Net Position (Assets − Liabilities)"}),e.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#034D57"},children:b((((L=t.assets)==null?void 0:L.total)||0)-(((O=t.liabilities)==null?void 0:O.total)||0))}),e.jsxs("div",{style:{fontSize:11,color:"#888",marginTop:2},children:["As of ",f().format("DD MMM YYYY")]})]})]})]}):e.jsx("div",{style:{textAlign:"center",color:"#888",padding:40},children:"Click Refresh to load"})]})}function oe(){const[t,h]=l.useState(null),[i,d]=l.useState(!1),[r,o]=l.useState([f().startOf("year"),f()]),u=async()=>{d(!0);const s=new URLSearchParams({from:r[0].format("YYYY-MM-DD"),to:r[1].format("YYYY-MM-DD")}),n=await fetch(C+`bankaccount/cash-flow?${s}`,{headers:D()}).then(x=>x.json()).catch(()=>({}));n.success&&h(n.result),d(!1)},a=[{title:"Month",dataIndex:"month",render:s=>f(s+"-01").format("MMM YYYY")},{title:"Cash In",dataIndex:"in",align:"right",render:s=>e.jsx("span",{style:{color:"#4CB480"},children:b(s||0)})},{title:"Cash Out",dataIndex:"out",align:"right",render:s=>e.jsx("span",{style:{color:"#e53e3e"},children:b(s||0)})},{title:"Net",dataIndex:"net",align:"right",render:s=>e.jsx("b",{style:{color:s>=0?"#4CB480":"#e53e3e"},children:b(s||0)})}];return e.jsxs("div",{children:[e.jsxs(I,{style:{marginBottom:16},wrap:!0,children:[e.jsx(k,{value:r,onChange:s=>s&&o(s)}),e.jsx(w,{type:"primary",onClick:u,loading:i,style:{background:"#034D57"},children:"Run Report"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{gutter:12,style:{marginBottom:16},children:[e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Cash In",value:parseFloat(t.cashIn||0).toFixed(3),suffix:S(),valueStyle:{color:"#4CB480"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Cash Out",value:parseFloat(t.cashOut||0).toFixed(3),suffix:S(),valueStyle:{color:"#e53e3e"}})})}),e.jsx(g,{xs:8,children:e.jsx(m,{size:"small",children:e.jsx(p,{title:"Net Flow",value:parseFloat(t.netFlow||0).toFixed(3),suffix:S(),valueStyle:{color:t.netFlow>=0?"#4CB480":"#e53e3e",fontWeight:700}})})})]}),e.jsx(y,{columns:a,dataSource:t.monthly||[],rowKey:"month",size:"small",pagination:!1})]})]})}function ce(){const[t,h]=l.useState([]),[i,d]=l.useState(0),[r,o]=l.useState(!1),[u,a]=l.useState([f().startOf("year"),f()]),s={salaries:"Salaries",rent:"Rent",travel:"Travel",office:"Office Supplies",utilities:"Utilities",bank_charges:"Bank Charges",marketing:"Marketing",maintenance:"Maintenance",insurance:"Insurance",professional_fees:"Professional Fees",customs_duties:"Customs & Duties",shipping:"Shipping",telecommunications:"Telecom",other:"Other"},n=async()=>{o(!0);const c=new URLSearchParams({from:u[0].format("YYYY-MM-DD"),to:u[1].format("YYYY-MM-DD")}),v=await fetch(C+`reports/expenses-summary?${c}`,{headers:D()}).then(Y=>Y.json()).catch(()=>({}));v.success&&(h(v.result||[]),d(v.grandTotal||0)),o(!1)},x=[{title:"#",width:40,render:(c,v,Y)=>Y+1},{title:"Category",dataIndex:"_id",render:c=>s[c]||c},{title:"Expenses",dataIndex:"count",width:80,align:"center"},{title:"Total",dataIndex:"total",align:"right",render:c=>e.jsx("b",{children:b(c||0)})},{title:"Share",dataIndex:"total",width:140,render:c=>e.jsx(E,{percent:i>0?parseFloat((c/i*100).toFixed(1)):0,size:"small",strokeColor:"#e53e3e",format:v=>`${v}%`})}];return e.jsxs("div",{children:[e.jsxs(I,{style:{marginBottom:16},wrap:!0,children:[e.jsx(k,{value:u,onChange:c=>c&&a(c)}),e.jsx(w,{type:"primary",onClick:n,loading:r,style:{background:"#034D57"},children:"Run Report"})]}),t.length>0&&e.jsxs("div",{style:{marginBottom:8,fontWeight:700,color:"#034D57"},children:["Total Expenses: ",b(i)]}),e.jsx(y,{columns:x,dataSource:t,rowKey:"_id",size:"small",loading:r,pagination:!1})]})}function Te(){return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(se,{level:4,style:{color:"#034D57",marginBottom:20},children:"Financial Reports"}),e.jsx(G,{defaultActiveKey:"vat",items:[{key:"vat",label:e.jsxs("span",{children:[e.jsx(U,{})," VAT Report"]}),children:e.jsx(ae,{})},{key:"aged",label:e.jsxs("span",{children:[e.jsx(q,{})," Aged Receivables"]}),children:e.jsx(le,{})},{key:"pnl",label:e.jsxs("span",{children:[e.jsx(N,{size:13,style:{verticalAlign:"middle",marginRight:4}})," P&L by Deal"]}),children:e.jsx(re,{})},{key:"revenue",label:e.jsxs("span",{children:[e.jsx(V,{})," Revenue by Client"]}),children:e.jsx(ne,{})},{key:"balance",label:e.jsxs("span",{children:[e.jsx(W,{})," Balance Sheet"]}),children:e.jsx(ie,{})},{key:"cashflow",label:e.jsxs("span",{children:[e.jsx(J,{})," Cash Flow"]}),children:e.jsx(oe,{})},{key:"expenses",label:e.jsxs("span",{children:[e.jsx(te,{})," Expenses"]}),children:e.jsx(ce,{})}]})]})}export{Te as default};
