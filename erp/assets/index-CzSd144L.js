import{m as Y,r as l,j as t}from"./index-BrmSMSB0.js";import{aZ as A,aB as g,aM as X,aL as ee,a_ as te,U as re,aY as se}from"./IdurarOs-BQBNJmBS.js";import{r as N,e as q,T as f,D as oe,t as ne,v as ie}from"./ErpApp-VX7sXUMI.js";import{R as ae}from"./ReloadOutlined-Cv6kVtfi.js";import{s as v}from"./index-BKW3ZT6F.js";import{C as O}from"./index-BbFFr3LJ.js";import{S as le}from"./index-Gz_c_W6_.js";import{T as ce}from"./index-gef2S4g7.js";import{T as de}from"./ThunderboltOutlined-BmESH6qx.js";import{F as ue}from"./Table-BC7b85WN.js";import"./Skeleton-LrXGVglY.js";import"./PlusOutlined-C13xXaIV.js";function L(){var p,y;try{const b=(y=(p=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:p.current)==null?void 0:y.token;return b?{Authorization:`Bearer ${b}`}:{}}catch{return{}}}const{Title:he,Text:T}=se,{Option:d}=q,u="#034D57",$="#4CB480",pe={new:"blue",in_progress:"processing",researched:"purple",quoted:"success",won:"green",lost:"red",expired:"default"},fe={ior:"red",routine:"orange",normal:"default"},ye=[{key:"ALL",label:"All"},{key:"RAFO",label:"RAFO"},{key:"RNO",label:"RNO"},{key:"AGD",label:"AGD"},{key:"MOD",label:"MOD"},{key:"PROC",label:"PROC"},{key:"HAS",label:"HAS"},{key:"RAOBOD",label:"RAOBOD"},{key:"RMSG",label:"RMSG"},{key:"EVAL",label:"EVAL"},{key:"ROP",label:"ROP"},{key:"OTHER",label:"Other"}];function Le(){var P,_,D,B,E;const p=Y(),[y,b]=l.useState([]),[W,z]=l.useState(!0),[s,F]=l.useState(null),[me,Q]=l.useState({}),[j,I]=l.useState({current:1,pageSize:25,total:0}),[m,U]=l.useState("ALL"),[c,w]=l.useState({status:"",priority:"all",q:""}),[V,G]=l.useState(""),[S,k]=l.useState([]),R=l.useCallback(async()=>{try{const r=await(await fetch(A+"rfq/stats",{headers:L()})).json();r.success&&F(r.result)}catch{}},[]),x=l.useCallback(async(e=1)=>{z(!0);try{const r=new URLSearchParams({page:e,items:j.pageSize,...c.status&&c.status!=="active"?{status:c.status}:c.status==="active"?{status:"new,in_progress,researched"}:{},...c.priority!=="all"?{priority:c.priority}:{},...m!=="ALL"?{client:m}:{},...c.q?{q:c.q}:{}}),n=await(await fetch(A+`rfq/list?${r}`,{headers:L()})).json();if(n.success){b(n.result||[]),I(h=>{var a,M;return{...h,current:e,total:((a=n.pagination)==null?void 0:a.total)||((M=n.result)==null?void 0:M.length)||0}});const i={};(n.result||[]).forEach(h=>{i[h.client]=(i[h.client]||0)+1}),Q(i)}}catch{}finally{z(!1)}},[c,m,j.pageSize]);l.useEffect(()=>{R()},[]),l.useEffect(()=>{x(1)},[c,m]);const C=e=>{if(!e.receivedAt)return null;const r=new Date(e.receivedAt),o=e.priority==="ior"?7:10,n=new Date(r.getTime()+o*864e5);return Math.ceil((n-new Date)/864e5)},H=[{title:"RFQ Number",dataIndex:"rfqNumber",key:"rfqNumber",width:150,render:(e,r)=>t.jsxs("div",{children:[t.jsx(T,{strong:!0,style:{color:u,cursor:"pointer",fontSize:13},onClick:()=>p(`/rfq/${r._id}`),children:e||"â€”"}),r.priority==="ior"&&t.jsx(f,{color:"red",style:{marginLeft:4,fontSize:10},children:"IOR"})]})},{title:"Client",dataIndex:"client",key:"client",width:80,render:e=>t.jsx(f,{color:u,style:{color:"#fff",fontSize:11},children:e})},{title:"Subject",dataIndex:"subject",key:"subject",ellipsis:!0,render:(e,r)=>t.jsx("span",{style:{cursor:"pointer",color:"#374151"},onClick:()=>p(`/rfq/${r._id}`),children:e})},{title:"Priority",dataIndex:"priority",key:"priority",width:90,responsive:["md"],render:e=>t.jsx(f,{color:fe[e]||"default",children:(e||"").toUpperCase()})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>t.jsx(f,{color:pe[e]||"default",children:e==null?void 0:e.replace("_"," ")})},{title:"Parts",key:"parts",width:70,responsive:["sm"],render:(e,r)=>t.jsx(ie,{count:r.partsCount||0,showZero:!0,style:{backgroundColor:r.partsCount>0?$:"#e5e7eb",color:r.partsCount>0?"#fff":"#9ca3af"}})},{title:"Received",dataIndex:"receivedAt",key:"receivedAt",width:100,responsive:["lg"],render:e=>e?new Date(e).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short"}):"â€”"},{title:"Deadline",key:"deadline",width:110,responsive:["sm"],sorter:(e,r)=>{const o=C(e),n=C(r);return o-n},render:(e,r)=>{if(["expired","quoted","won","lost"].includes(r.status))return t.jsx(T,{type:"secondary",style:{fontSize:11},children:"â€”"});const o=C(r);if(o===null)return t.jsx(T,{type:"secondary",style:{fontSize:11},children:"â€”"});let n,i;return o<0?(n="#ef4444",i=`${Math.abs(o)}d overdue`):o<=2?(n="#ef4444",i=`${o}d left`):o<=5?(n="#f59e0b",i=`${o}d left`):(n="#22c55e",i=`${o}d left`),t.jsx(f,{color:n,style:{fontSize:11,fontWeight:600},children:i})}},{title:"",key:"action",width:60,fixed:"right",render:(e,r)=>t.jsx(g,{size:"small",type:"link",style:{color:u,padding:0},onClick:()=>p(`/rfq/${r._id}`),children:"View â†’"})}],K=((P=s==null?void 0:s.byPriority)==null?void 0:P.ior)||0,Z=(((_=s==null?void 0:s.byStatus)==null?void 0:_.new)||0)+(((D=s==null?void 0:s.byStatus)==null?void 0:D.in_progress)||0)+(((B=s==null?void 0:s.byStatus)==null?void 0:B.researched)||0),J=((E=s==null?void 0:s.byStatus)==null?void 0:E.quoted)||0;return t.jsxs("div",{style:{padding:"12px",background:"#f0f2f5",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginBottom:16,gap:8},children:[t.jsx(he,{level:3,style:{color:u,margin:0,fontSize:window.innerWidth<768?18:24},children:"ðŸ“‹ RFQ Management"}),t.jsxs(N,{wrap:!0,children:[t.jsx(g,{icon:t.jsx(ae,{}),onClick:()=>{R(),x(1)},style:{borderColor:u,color:u},size:window.innerWidth<768?"small":"middle",children:window.innerWidth>=768?"Refresh":""}),t.jsx(g,{size:"small",onClick:()=>{const e=["RFQ Number","Client","Subject","Priority","Status","Parts","Received"],r=y.map(a=>[a.rfqNumber||"",a.client||"",(a.subject||"").replace(/,/g,";"),a.priority||"",a.status||"",a.partsCount||0,a.receivedAt?new Date(a.receivedAt).toLocaleDateString("en-GB"):""]),o=[e.join(","),...r.map(a=>a.join(","))].join(`
`),n=new Blob([o],{type:"text/csv"}),i=URL.createObjectURL(n),h=document.createElement("a");h.href=i,h.download=`rfqs-${new Date().toISOString().slice(0,10)}.csv`,h.click(),URL.revokeObjectURL(i),v.success("CSV exported")},style:{borderColor:"#6366f1",color:"#6366f1"},children:window.innerWidth>=768?"Export CSV":"CSV"})]})]}),t.jsx(X,{gutter:[8,8],style:{marginBottom:12},children:[{title:"Total RFQs",value:(s==null?void 0:s.total)||0,color:u},{title:"Active",value:Z,color:"#3b82f6"},{title:"IOR Priority",value:K,color:"#ef4444"},{title:"Total Parts",value:(s==null?void 0:s.totalParts)||0,color:"#6366f1"},{title:"Quoted",value:J,color:$},{title:"Vendors",value:(s==null?void 0:s.totalVendors)||0,color:"#f59e0b"}].map(({title:e,value:r,color:o})=>t.jsx(ee,{xs:8,sm:8,md:4,children:t.jsx(O,{size:"small",style:{borderTop:`3px solid ${o}`,borderRadius:8,textAlign:"center"},children:t.jsx(le,{title:t.jsx("span",{style:{fontSize:window.innerWidth<768?10:12},children:e}),value:r,valueStyle:{color:o,fontSize:window.innerWidth<768?14:18,fontWeight:700}})})},e))}),t.jsx(O,{size:"small",style:{marginBottom:12,borderRadius:8},children:t.jsxs(N,{wrap:!0,children:[t.jsx(te.Search,{placeholder:"Search RFQ#, part, subject...",value:V,onChange:e=>G(e.target.value),onSearch:e=>w(r=>({...r,q:e})),onPressEnter:e=>w(r=>({...r,q:e.target.value})),style:{width:260},prefix:t.jsx(re,{style:{color:"#9ca3af"}})}),t.jsxs(q,{value:c.status||"active",onChange:e=>w(r=>({...r,status:e})),style:{width:140},children:[t.jsx(d,{value:"active",children:"Active"}),t.jsx(d,{value:"new",children:"New"}),t.jsx(d,{value:"in_progress",children:"In Progress"}),t.jsx(d,{value:"researched",children:"Researched"}),t.jsx(d,{value:"quoted",children:"Quoted"}),t.jsx(d,{value:"won",children:"Won"}),t.jsx(d,{value:"lost",children:"Lost"}),t.jsx(d,{value:"",children:"All Statuses"})]}),t.jsxs(q,{value:c.priority,onChange:e=>w(r=>({...r,priority:e})),style:{width:120},children:[t.jsx(d,{value:"all",children:"All Priority"}),t.jsx(d,{value:"ior",children:"ðŸš¨ IOR"}),t.jsx(d,{value:"routine",children:"Routine"}),t.jsx(d,{value:"normal",children:"Normal"})]})]})}),t.jsxs(O,{style:{borderRadius:8},bodyStyle:{padding:0},children:[t.jsx(ce,{activeKey:m,onChange:e=>{U(e),x(1)},size:"small",style:{paddingLeft:8},items:ye.map(({key:e,label:r})=>({key:e,label:t.jsxs("span",{children:[e==="ALL"?t.jsx(de,{}):null," ",r]})}))}),S.length>0&&t.jsxs("div",{style:{marginBottom:12,padding:"8px 12px",background:"#f0f6f7",borderRadius:8,display:"flex",alignItems:"center",gap:12},children:[t.jsxs(f,{color:u,children:[S.length," selected"]}),t.jsx(oe,{menu:{items:[{key:"in_progress",label:"Mark In Progress"},{key:"quoted",label:"Mark Quoted"},{key:"won",label:"Mark Won"},{key:"lost",label:"Mark Lost"},{key:"expired",label:"Mark Expired"}],onClick:async({key:e})=>{try{const o=await(await fetch(A+"rfq/bulk-status",{method:"POST",headers:{...L(),"Content-Type":"application/json"},body:JSON.stringify({ids:S,status:e})})).json();o.success?(v.success(`${o.result.modified} RFQs updated to ${e}`),k([]),x(j.current),R()):v.error(o.message||"Failed")}catch(r){v.error("Error: "+r.message)}}},children:t.jsxs(g,{size:"small",type:"primary",style:{background:u,borderColor:u},children:["Bulk Action ",t.jsx(ne,{})]})}),t.jsx(g,{size:"small",onClick:()=>k([]),children:"Clear"})]}),t.jsx(ue,{rowKey:"_id",rowSelection:{selectedRowKeys:S,onChange:k,columnWidth:36},columns:H,dataSource:y,loading:W,size:"small",pagination:{...j,showSizeChanger:!1,showTotal:e=>`${e} RFQs`,onChange:e=>{I(r=>({...r,current:e})),x(e)},simple:window.innerWidth<768},rowClassName:e=>e.priority==="ior"?"ior-row":"",style:{fontSize:13},scroll:{x:window.innerWidth<768?600:950},onRow:e=>({onClick:r=>{r.target.closest(".ant-checkbox-wrapper")||p(`/rfq/${e._id}`)},style:{cursor:"pointer"}})})]}),t.jsx("style",{children:`
        .ior-row td { background: #fff5f5 !important; }
        .ior-row:hover td { background: #ffe4e4 !important; }
        .ant-tabs-tab { font-size: 12px !important; }
      `})]})}export{Le as default};
