import{r as i,j as e}from"./index-CZE4Emnq.js";import{o as U}from"./omrFormat-DnoBT9dY.js";import{b8 as a,aB as c,aX as l,U as z,aM as _,aL as s,aY as L,aV as u,b5 as $}from"./IdurarOs-QyX9qaVp.js";import{l as g,f,T,k as H}from"./ErpApp-C4nlOv7S.js";import{F as J}from"./Table-B0OV9lnU.js";import{M as Y}from"./index-D_Iny5RF.js";import{T as b}from"./index-B7Ep3u25.js";import{S as N}from"./index-CncnRXLQ.js";import{s as S}from"./index-DYgSJ7qL.js";import{P as q}from"./index-ZfNXicBO.js";import{P as G}from"./PlusOutlined-DNId2NLQ.js";import"./ActionButton-43bIcezm.js";import"./fade-C5VLvKC6.js";const{Title:K}=L;function A(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function W(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const X={product:"blue",service:"green",part:"orange"};function ue(){const[E,O]=i.useState([]),[k,I]=i.useState(!1),[P,D]=i.useState({page:1,count:0}),[m,M]=i.useState(""),[x,v]=i.useState(""),[R,w]=i.useState(!1),[o,C]=i.useState(null),[h]=a.useForm(),d=async(t=1)=>{I(!0);const r=new URLSearchParams({page:t,items:30});m&&r.set("type",m),x&&r.set("q",x);const n=await fetch(u+`product/list?${r}`,{headers:A()}).then(y=>y.json()).catch(()=>({}));n.success&&(O(n.result),D(n.pagination||{})),I(!1)};i.useEffect(()=>{d(1)},[m,x]);const p=(t=null)=>{C(t),h.setFieldsValue(t?{...t}:{type:"product",taxRate:5,unit:"EA",currency:"OMR",taxable:!0,isActive:!0}),w(!0)},j=()=>{w(!1),h.resetFields(),C(null)},V=async t=>{const r=o?u+`product/update/${o._id}`:u+"product/create",n=await fetch(r,{method:o?"PATCH":"POST",headers:W(),body:JSON.stringify(t)}).then(y=>y.json()).catch(()=>({}));n.success?(S.success(o?"Updated":"Created"),j(),d(1)):S.error(n.message||"Failed")},F=async t=>{await fetch(u+`product/delete/${t}`,{method:"DELETE",headers:A()}),S.success("Deleted"),d(1)},B=[{title:"Code",dataIndex:"code",width:90,render:t=>t||"—"},{title:"Name",dataIndex:"name",ellipsis:!0,render:(t,r)=>e.jsx("a",{onClick:()=>p(r),style:{color:"#034D57",fontWeight:600},children:t})},{title:"Part #",dataIndex:"partNumber",width:110,render:t=>t?e.jsx("code",{style:{fontSize:11},children:t}):"—"},{title:"NSN",dataIndex:"nsn",width:110,render:t=>t||"—"},{title:"Type",dataIndex:"type",width:80,render:t=>e.jsx(T,{color:X[t],children:t})},{title:"Sale Price",dataIndex:"salePrice",align:"right",render:t=>U(t)},{title:"Unit",dataIndex:"unit",width:60,render:t=>t||"EA"},{title:"Active",dataIndex:"isActive",width:70,render:t=>e.jsx(T,{color:t?"green":"default",children:t?"Yes":"No"})},{title:"",width:70,render:(t,r)=>e.jsxs(g,{children:[e.jsx(c,{size:"small",icon:e.jsx($,{}),onClick:()=>p(r)}),e.jsx(q,{title:"Delete?",onConfirm:()=>F(r._id),children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(H,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(K,{level:4,style:{margin:0,color:"#034D57"},children:"Products & Services"}),e.jsx(c,{type:"primary",icon:e.jsx(G,{}),onClick:()=>p(),style:{background:"#034D57"},children:"Add Item"})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(l,{placeholder:"Search name, part #, NSN...",prefix:e.jsx(z,{}),allowClear:!0,style:{width:240},onPressEnter:t=>v(t.target.value),onChange:t=>!t.target.value&&v("")}),e.jsx(f,{placeholder:"Type",allowClear:!0,style:{width:120},onChange:t=>M(t||""),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})]}),e.jsx(J,{columns:B,dataSource:E,rowKey:"_id",loading:k,size:"small",pagination:{current:P.page,total:P.count,pageSize:30,onChange:t=>d(t)}}),e.jsx(Y,{title:o?"Edit Product":"New Product / Service",open:R,onCancel:j,footer:null,width:680,children:e.jsxs(a,{form:h,layout:"vertical",onFinish:V,children:[e.jsxs(_,{gutter:12,children:[e.jsx(s,{xs:24,sm:16,children:e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"code",label:"Internal Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"partNumber",label:"Part Number",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"nsn",label:"NSN",children:e.jsx(l,{placeholder:"NATO Stock Number"})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"type",label:"Type",initialValue:"product",children:e.jsx(f,{options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(f,{options:["OMR","USD","EUR","GBP","AED"].map(t=>({value:t,label:t}))})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"salePrice",label:"Sale Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"costPrice",label:"Cost Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxRate",label:"VAT %",initialValue:5,children:e.jsx(b,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"manufacturer",label:"Manufacturer",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"hsCode",label:"HS Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"category",label:"Category",children:e.jsx(l,{placeholder:"e.g. Aviation Parts"})})}),e.jsx(s,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(l.TextArea,{rows:2})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"taxable",label:"Taxable",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(N,{})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:8},children:e.jsxs(g,{children:[e.jsx(c,{onClick:j,children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{ue as default};
