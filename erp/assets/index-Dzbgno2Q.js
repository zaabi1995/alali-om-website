import{r as n,j as e}from"./index-BlXZDDd6.js";import{o as P}from"./omrFormat-BrmZ7tIx.js";import{aH as a,ai as o,aB as B,aC as r,aE as c,ar as _,az as d,ax as M}from"./IdurarOs-BD-puWxc.js";import{m as y,W as $}from"./ErpApp-BNfFHiJr.js";import{S as w}from"./index-C3d3OXV3.js";import{F as q}from"./Table-JSMkll-i.js";import{M as L}from"./index-DBKwNqz2.js";import{S as H}from"./index-C0aJ77dG.js";import{s as m}from"./index-9vxUZZ6M.js";import{T as f}from"./index-dUcb3pFk.js";import{P as J}from"./index-B135OXA2.js";import{P as R}from"./PlusOutlined-MDLlbw4k.js";import{D as U}from"./DeleteOutlined-KtD5xQkD.js";import"./pickAttrs-DEwbeKAF.js";import"./DownOutlined-CxVHLUQB.js";import"./ActionButton-Dmz6aAjY.js";import"./useClosable-7-EzhNeu.js";import"./fade-Bgq5qq_R.js";const{Title:Y}=_;function T(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function V(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const K={asset:"blue",liability:"red",equity:"purple",income:"green",expense:"orange",bank:"cyan",receivable:"geekblue",payable:"volcano",tax:"gold"},I=["asset","liability","equity","income","expense","bank","receivable","payable","tax"];function pe(){const[g,v]=n.useState([]),[E,b]=n.useState(!1),[u,F]=n.useState(""),[k,S]=n.useState(!1),[l,A]=n.useState(null),[p]=a.useForm(),h=async()=>{b(!0);const t=u?`?type=${u}`:"?active=all",s=await fetch(d+`account/list${t}`,{headers:T()}).then(i=>i.json()).catch(()=>({}));s.success&&v(s.result||[]),b(!1)};n.useEffect(()=>{h()},[u]);const C=(t=null)=>{A(t),p.setFieldsValue(t?{...t}:{isSystem:!1,isActive:!0}),S(!0)},x=()=>{S(!1),p.resetFields(),A(null)},D=async t=>{const s=l?d+`account/update/${l._id}`:d+"account/create",i=await fetch(s,{method:l?"PATCH":"POST",headers:V(),body:JSON.stringify(t)}).then(O=>O.json()).catch(()=>({}));i.success?(m.success(l?"Updated":"Created"),x(),h()):m.error(i.message||"Failed")},z=async t=>{const s=await fetch(d+`account/delete/${t}`,{method:"DELETE",headers:T()}).then(i=>i.json()).catch(()=>({}));s.success?(m.success("Deleted"),h()):m.error(s.message||"Cannot delete system account")},j={};(g||[]).forEach(t=>{j[t.type]||(j[t.type]=[]),j[t.type].push(t)});const N=[{title:"Code",dataIndex:"code",width:80,sorter:(t,s)=>t.code.localeCompare(s.code)},{title:"Account Name",dataIndex:"name",ellipsis:!0,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("b",{style:{color:"#034D57"},children:t}),s.isSystem&&e.jsx(f,{size:"small",style:{marginLeft:6,fontSize:10},children:"SYSTEM"})]})},{title:"Arabic Name",dataIndex:"nameAr",render:t=>e.jsx("span",{style:{fontFamily:"Tajawal, Arial",direction:"rtl"},children:t||"—"})},{title:"Type",dataIndex:"type",width:100,render:t=>e.jsx(f,{color:K[t],children:t})},{title:"Sub-Type",dataIndex:"subType",width:120,render:t=>(t==null?void 0:t.replace(/_/g," "))||"—"},{title:"Balance",dataIndex:"balance",align:"right",render:t=>P(t)},{title:"Active",dataIndex:"isActive",width:60,render:t=>e.jsx(f,{color:t?"green":"default",children:t?"✓":"✗"})},{title:"",width:70,render:(t,s)=>e.jsxs(y,{children:[e.jsx(o,{size:"small",icon:e.jsx(M,{}),onClick:()=>C(s)}),!s.isSystem&&e.jsx(J,{title:"Delete?",onConfirm:()=>z(s._id),children:e.jsx(o,{size:"small",danger:!0,icon:e.jsx(U,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(y,{children:[e.jsx($,{style:{color:"#034D57",fontSize:20}}),e.jsx(Y,{level:4,style:{margin:0,color:"#034D57"},children:"Chart of Accounts"})]}),e.jsx(o,{type:"primary",icon:e.jsx(R,{}),onClick:()=>C(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(w,{placeholder:"Filter by type",allowClear:!0,style:{width:160},onChange:t=>F(t||""),options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})}),e.jsx(q,{columns:N,dataSource:g,rowKey:"_id",loading:E,size:"small",rowClassName:t=>t.isActive?"":"row-inactive",pagination:{pageSize:50,showSizeChanger:!1}}),e.jsx(L,{title:l?`Edit: ${l.name}`:"New Account",open:k,onCancel:x,footer:null,width:580,children:e.jsxs(a,{form:p,layout:"vertical",onFinish:D,children:[e.jsxs(B,{gutter:12,children:[e.jsx(r,{xs:8,children:e.jsx(a.Item,{name:"code",label:"Account Code",rules:[{required:!0}],children:e.jsx(c,{placeholder:"e.g. 4100"})})}),e.jsx(r,{xs:16,children:e.jsx(a.Item,{name:"name",label:"Account Name",rules:[{required:!0}],children:e.jsx(c,{})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"nameAr",label:"Arabic Name",children:e.jsx(c,{style:{direction:"rtl",fontFamily:"Tajawal, Arial"}})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"type",label:"Type",rules:[{required:!0}],children:e.jsx(w,{options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"subType",label:"Sub-Type",children:e.jsx(c,{placeholder:"e.g. current_asset"})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(c.TextArea,{rows:2})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(H,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(y,{children:[e.jsx(o,{onClick:x,children:"Cancel"}),e.jsx(o,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{pe as default};
