import{r as o,j as e}from"./index-CfD99eWM.js";import{d as le,e as h,k as _,O as se,ab as te,T,w as ne,g as M}from"./ErpApp-5RKUdHDV.js";import{o as L}from"./omrFormat-DaDUL0TV.js";import{b8 as n,aB as b,aM as x,aL as s,aR as ie,aX as i,aW as oe,aY as re,aV as g,b5 as de}from"./IdurarOs-CIf1RHA4.js";import{C as S}from"./index-3Eb24upP.js";import{S as I}from"./index-Da50WqsO.js";import{F as ce}from"./Table-D2HkX3gJ.js";import{M as me}from"./index-ljet-ASd.js";import{T as pe}from"./index-C2hiuglI.js";import{D as V}from"./index-BL8XxP9m.js";import{T as v}from"./index-BbXsmecp.js";import{S as ue}from"./index-DEqLgsCK.js";import{s as w}from"./index-DE8wEg85.js";import{P as he}from"./index-BUvRxWel.js";import{P as H}from"./PlusOutlined-C4PIKCeA.js";import"./Skeleton-OgAJrl8z.js";import"./ActionButton-CVmzQOIY.js";import"./fade-By_iT9J6.js";import"./ClockCircleOutlined-DK-O7DIF.js";const{Title:xe,Text:A}=re;function D(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function je(){return{...D(),"Content-Type":"application/json"}}const ye={General:"default",Sales:"blue",Finance:"green",Procurement:"gold",Operations:"purple",Admin:"cyan",IT:"orange",HR:"pink"},fe={active:"success",inactive:"default",on_leave:"warning"},be=[{value:"housing",label:"Housing Allowance"},{value:"transport",label:"Transport Allowance"},{value:"food",label:"Food Allowance"},{value:"phone",label:"Phone/Communication"},{value:"bonus",label:"Bonus"},{value:"other",label:"Other"}];function Me(){var N,R;const[J,U]=o.useState([]),[p,W]=o.useState(null),[$,E]=o.useState(!1),[G,j]=o.useState(!1),[c,B]=o.useState(null),[q,z]=o.useState(!1),[m]=n.useForm(),[y,u]=o.useState([]),[f,C]=o.useState(!1),P=async()=>{E(!0);const[a,l]=await Promise.all([fetch(g+"employee/list?items=100",{headers:D()}).then(t=>t.json()).catch(()=>({})),fetch(g+"employee/stats",{headers:D()}).then(t=>t.json()).catch(()=>({}))]);a.success&&U(a.result||[]),l.success&&W(l.result),E(!1)};o.useEffect(()=>{P()},[]);const Y=()=>{B(null),m.resetFields(),u([]),C(!1),j(!0)},K=a=>{B(a),m.setFieldsValue({...a,joinDate:a.joinDate?M(a.joinDate):null,endDate:a.endDate?M(a.endDate):null}),u(a.allowancePresets||[]),C(!!a.pasiEnrolled),j(!0)},X=async()=>{var l;let a;try{a=await m.validateFields()}catch{return}a.joinDate&&(a.joinDate=a.joinDate.toISOString()),a.endDate&&(a.endDate=a.endDate.toISOString()),a.allowancePresets=y.filter(t=>t.amount>0),a.pasiEnrolled=f,z(!0);try{const t=c?`employee/update/${c._id}`:"employee/create",d=c?"PATCH":"POST",r=await fetch(g+t,{method:d,headers:je(),body:JSON.stringify(a)}).then(O=>O.json());r.success?(w.success(c?"Updated":`Created: ${(l=r.result)==null?void 0:l.employeeId}`),j(!1),P()):w.error(r.message||"Failed")}finally{z(!1)}},Q=async a=>{(await fetch(g+`employee/delete/${a}`,{method:"DELETE",headers:D()}).then(t=>t.json()).catch(()=>({}))).success?(w.success("Deleted"),P()):w.error("Failed")},Z=()=>u(a=>[...a,{type:"housing",description:"",amount:0}]),ee=a=>u(l=>l.filter((t,d)=>d!==a)),k=(a,l,t)=>u(d=>d.map((r,O)=>O===a?{...r,[l]:t}:r)),F=y.reduce((a,l)=>a+(l.amount||0),0),ae=[{title:"ID",dataIndex:"employeeId",width:90,render:a=>e.jsx(A,{code:!0,style:{fontSize:11},children:a})},{title:"Name",dataIndex:"name",render:(a,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:a}),l.position&&e.jsx(A,{type:"secondary",style:{fontSize:11},children:l.position})]})},{title:"Department",dataIndex:"department",render:a=>e.jsx(T,{color:ye[a]||"default",children:a})},{title:"Contact",render:(a,l)=>e.jsxs("div",{style:{fontSize:11},children:[l.email&&e.jsx("div",{children:l.email}),l.phone&&e.jsx("div",{style:{color:"#888"},children:l.phone})]})},{title:"Basic Salary",dataIndex:"salary",align:"right",render:a=>a?L(a):"â€”"},{title:"Total Pkg",align:"right",render:(a,l)=>{const t=(l.salary||0)+(l.allowancePresets||[]).reduce((d,r)=>d+(r.amount||0),0);return t>0?e.jsx("span",{style:{color:"#4CB480",fontWeight:700},children:L(t)}):"â€”"}},{title:"PASI",dataIndex:"pasiEnrolled",align:"center",render:a=>a?e.jsx(T,{color:"gold",children:"PASI"}):"â€”"},{title:"Status",dataIndex:"status",render:a=>e.jsx(T,{color:fe[a],children:a==null?void 0:a.replace("_"," ").toUpperCase()})},{title:"",key:"actions",width:80,render:(a,l)=>e.jsxs(ne,{size:4,children:[e.jsx(b,{size:"small",icon:e.jsx(de,{}),onClick:()=>K(l)}),e.jsx(he,{title:"Delete employee?",onConfirm:()=>Q(l._id),children:e.jsx(b,{size:"small",danger:!0,icon:e.jsx(_,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(xe,{level:4,style:{margin:0,color:"#034D57"},children:"Employees"}),e.jsx(b,{type:"primary",icon:e.jsx(H,{}),onClick:Y,style:{background:"#034D57",borderColor:"#034D57"},children:"Add Employee"})]}),p&&e.jsxs(x,{gutter:[12,12],style:{marginBottom:16},children:[e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Total",value:p.total,prefix:e.jsx(le,{})})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Active",value:p.active,valueStyle:{color:"#4CB480"}})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Present Today",value:((N=p.today)==null?void 0:N.present)||0,valueStyle:{color:"#034D57"}})})}),e.jsx(s,{xs:12,sm:6,children:e.jsx(S,{size:"small",children:e.jsx(I,{title:"Absent Today",value:((R=p.today)==null?void 0:R.absent)||0,valueStyle:{color:"#e53e3e"}})})})]}),e.jsx(ce,{columns:ae,dataSource:J,rowKey:"_id",loading:$,size:"small",pagination:{pageSize:20}}),e.jsx(me,{title:c?`Edit â€” ${c.name}`:"Add New Employee",open:G,onCancel:()=>j(!1),onOk:X,okText:"Save",confirmLoading:q,width:700,okButtonProps:{style:{background:"#034D57",borderColor:"#034D57"}},children:e.jsx(n,{form:m,layout:"vertical",style:{marginTop:8},children:e.jsx(pe,{items:[{key:"personal",label:e.jsxs("span",{children:[e.jsx(ie,{})," Personal Info"]}),children:e.jsxs(x,{gutter:12,children:[e.jsx(s,{span:14,children:e.jsx(n.Item,{name:"name",label:"Full Name",rules:[{required:!0}],children:e.jsx(i,{})})}),e.jsx(s,{span:10,children:e.jsx(n.Item,{name:"department",label:"Department",children:e.jsx(h,{options:["General","Sales","Finance","Procurement","Operations","Admin","IT","HR"].map(a=>({value:a,label:a})),allowClear:!0})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"position",label:"Position / Job Title",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"nationality",label:"Nationality",children:e.jsx(i,{placeholder:"e.g. Omani, Indian"})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"nationalId",label:"National ID / Passport No.",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"email",label:"Work Email",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"phone",label:"Phone",children:e.jsx(i,{})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"joinDate",label:"Join Date",children:e.jsx(V,{style:{width:"100%"}})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"endDate",label:"End Date (if applicable)",children:e.jsx(V,{style:{width:"100%"}})})}),e.jsx(s,{span:8,children:e.jsx(n.Item,{name:"status",label:"Status",initialValue:"active",children:e.jsx(h,{options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"on_leave",label:"On Leave"}]})})}),e.jsx(s,{span:16,children:e.jsx(n.Item,{name:"notes",label:"Notes",children:e.jsx(i.TextArea,{rows:2})})})]})},{key:"salary",label:"ðŸ’° Salary & Allowances",children:e.jsxs("div",{children:[e.jsxs(x,{gutter:12,children:[e.jsx(s,{span:10,children:e.jsx(n.Item,{name:"salary",label:"Basic Salary",rules:[{required:!0}],children:e.jsx(v,{style:{width:"100%"},min:0,precision:3,addonBefore:"OMR"})})}),e.jsx(s,{span:7,children:e.jsx(n.Item,{name:"salaryType",label:"Pay Type",initialValue:"monthly",children:e.jsx(h,{options:[{value:"monthly",label:"Monthly"},{value:"daily",label:"Daily"},{value:"hourly",label:"Hourly"}]})})}),e.jsx(s,{span:7,children:e.jsx(n.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(i,{})})})]}),e.jsx(oe,{orientation:"left",style:{fontSize:12,color:"#888"},children:"Standard Allowances (auto-included in every payroll run)"}),y.map((a,l)=>e.jsxs("div",{style:{display:"flex",gap:6,marginBottom:6,alignItems:"center"},children:[e.jsx(h,{size:"small",style:{width:160},value:a.type,onChange:t=>k(l,"type",t),options:be}),e.jsx(i,{size:"small",style:{flex:1},placeholder:"Description (optional)",value:a.description,onChange:t=>k(l,"description",t.target.value)}),e.jsx(v,{size:"small",style:{width:130},min:0,precision:3,value:a.amount,onChange:t=>k(l,"amount",t||0),addonBefore:"OMR"}),e.jsx(_,{onClick:()=>ee(l),style:{color:"#e53e3e",cursor:"pointer"}})]},l)),e.jsx(b,{size:"small",icon:e.jsx(H,{}),onClick:Z,style:{marginBottom:10},children:"Add Allowance"}),y.length>0&&e.jsx("div",{style:{background:"#f0f6f7",padding:"8px 12px",borderRadius:6,marginTop:6},children:e.jsxs(A,{style:{fontSize:12},children:["Total package: ",e.jsx(se,{size:11})," ",((m.getFieldValue("salary")||0)+F).toFixed(3),"Â (Basic: ",(m.getFieldValue("salary")||0).toFixed(3)," + Allowances: ",F.toFixed(3),")"]})})]})},{key:"pasi",label:"ðŸ› PASI / GOSI",children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[e.jsx(ue,{checked:f,onChange:C}),e.jsx(A,{children:f?"PASI enrolled â€” deductions will be calculated":"Not enrolled in PASI/GOSI"})]}),f&&e.jsxs(x,{gutter:12,children:[e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"pasiEmployeeRate",label:"Employee Contribution (%)",initialValue:6.5,children:e.jsx(v,{style:{width:"100%"},min:0,max:100,precision:2,addonAfter:"%"})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"pasiEmployerRate",label:"Employer Contribution (%)",initialValue:10.5,children:e.jsx(v,{style:{width:"100%"},min:0,max:100,precision:2,addonAfter:"%"})})}),e.jsx(s,{span:24,children:e.jsxs("div",{style:{background:"#fff8e6",border:"1px solid #fcd34d",borderRadius:6,padding:"10px 14px",fontSize:12},children:[e.jsx("strong",{children:"PASI rates (Oman, 2024):"}),e.jsx("br",{}),"Employee: 6.5% of basic salary Â· Employer: 10.5% of basic salary",e.jsx("br",{}),"Calculated on basic salary only, not allowances"]})})]})]})},{key:"bank",label:e.jsxs("span",{children:[e.jsx(te,{})," Bank Details"]}),children:e.jsxs(x,{gutter:12,children:[e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"bankName",label:"Bank Name",children:e.jsx(h,{options:["BankMuscat","Bank Dhofar","National Bank of Oman","HSBC Oman","Ahli Bank","Sohar International","Bank Nizwa","Al Izz Bank","Other"].map(a=>({value:a,label:a})),allowClear:!0,showSearch:!0})})}),e.jsx(s,{span:12,children:e.jsx(n.Item,{name:"bankAccount",label:"Account Number",children:e.jsx(i,{})})}),e.jsx(s,{span:24,children:e.jsx(n.Item,{name:"iban",label:"IBAN",children:e.jsx(i,{placeholder:"OM00 0000 0000 0000 0000 0000",style:{fontFamily:"monospace"}})})})]})}]})})})]})}export{Me as default};
