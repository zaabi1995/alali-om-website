import{r as n,j as e}from"./index-DynqZcYC.js";import{o as P}from"./omrFormat-5vt2WG1V.js";import{aG as a,ai as o,aA as B,aB as r,aD as c,ar as _,ay as d,aw as M}from"./IdurarOs-DBOvFMl4.js";import{l as j,R as $}from"./ErpApp-Dsj0b1h9.js";import{S as w}from"./index-B0MbqwlP.js";import{F as q}from"./Table-CdLo-aJd.js";import{M as L}from"./index-CNwDSTYA.js";import{S as R}from"./index-BqbImdAD.js";import{s as m}from"./index-Bzh2Kr56.js";import{T as f}from"./index-C6iqSUGl.js";import{P as J}from"./index-Dlubn56L.js";import{P as U}from"./PlusOutlined-DOkyJDj0.js";import{D as H}from"./DeleteOutlined-Ck3yX7uE.js";import"./pickAttrs-BVt-fMi-.js";import"./DownOutlined-JFe7GSFF.js";import"./ActionButton-CPZSuqlQ.js";import"./useClosable-wR5V5ARF.js";import"./fade-BPzEffy4.js";const{Title:Y}=_;function T(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function V(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const G={asset:"blue",liability:"red",equity:"purple",income:"green",expense:"orange",bank:"cyan",receivable:"geekblue",payable:"volcano",tax:"gold"},I=["asset","liability","equity","income","expense","bank","receivable","payable","tax"];function pe(){const[g,v]=n.useState([]),[E,b]=n.useState(!1),[u,F]=n.useState(""),[D,S]=n.useState(!1),[l,A]=n.useState(null),[p]=a.useForm(),h=async()=>{b(!0);const t=u?`?type=${u}`:"?active=all",s=await fetch(d+`account/list${t}`,{headers:T()}).then(i=>i.json()).catch(()=>({}));s.success&&v(s.result||[]),b(!1)};n.useEffect(()=>{h()},[u]);const C=(t=null)=>{A(t),p.setFieldsValue(t?{...t}:{isSystem:!1,isActive:!0}),S(!0)},x=()=>{S(!1),p.resetFields(),A(null)},k=async t=>{const s=l?d+`account/update/${l._id}`:d+"account/create",i=await fetch(s,{method:l?"PATCH":"POST",headers:V(),body:JSON.stringify(t)}).then(O=>O.json()).catch(()=>({}));i.success?(m.success(l?"Updated":"Created"),x(),h()):m.error(i.message||"Failed")},z=async t=>{const s=await fetch(d+`account/delete/${t}`,{method:"DELETE",headers:T()}).then(i=>i.json()).catch(()=>({}));s.success?(m.success("Deleted"),h()):m.error(s.message||"Cannot delete system account")},y={};(g||[]).forEach(t=>{y[t.type]||(y[t.type]=[]),y[t.type].push(t)});const N=[{title:"Code",dataIndex:"code",width:80,sorter:(t,s)=>t.code.localeCompare(s.code)},{title:"Account Name",dataIndex:"name",ellipsis:!0,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("b",{style:{color:"#034D57"},children:t}),s.isSystem&&e.jsx(f,{size:"small",style:{marginLeft:6,fontSize:10},children:"SYSTEM"})]})},{title:"Arabic Name",dataIndex:"nameAr",render:t=>e.jsx("span",{style:{fontFamily:"Tajawal, Arial",direction:"rtl"},children:t||"—"})},{title:"Type",dataIndex:"type",width:100,render:t=>e.jsx(f,{color:G[t],children:t})},{title:"Sub-Type",dataIndex:"subType",width:120,render:t=>(t==null?void 0:t.replace(/_/g," "))||"—"},{title:"Balance",dataIndex:"balance",align:"right",render:t=>P(t)},{title:"Active",dataIndex:"isActive",width:60,render:t=>e.jsx(f,{color:t?"green":"default",children:t?"✓":"✗"})},{title:"",width:70,render:(t,s)=>e.jsxs(j,{children:[e.jsx(o,{size:"small",icon:e.jsx(M,{}),onClick:()=>C(s)}),!s.isSystem&&e.jsx(J,{title:"Delete?",onConfirm:()=>z(s._id),children:e.jsx(o,{size:"small",danger:!0,icon:e.jsx(H,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(j,{children:[e.jsx($,{style:{color:"#034D57",fontSize:20}}),e.jsx(Y,{level:4,style:{margin:0,color:"#034D57"},children:"Chart of Accounts"})]}),e.jsx(o,{type:"primary",icon:e.jsx(U,{}),onClick:()=>C(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(w,{placeholder:"Filter by type",allowClear:!0,style:{width:160},onChange:t=>F(t||""),options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})}),e.jsx(q,{columns:N,dataSource:g,rowKey:"_id",loading:E,size:"small",rowClassName:t=>t.isActive?"":"row-inactive",pagination:{pageSize:50,showSizeChanger:!1}}),e.jsx(L,{title:l?`Edit: ${l.name}`:"New Account",open:D,onCancel:x,footer:null,width:580,children:e.jsxs(a,{form:p,layout:"vertical",onFinish:k,children:[e.jsxs(B,{gutter:12,children:[e.jsx(r,{xs:8,children:e.jsx(a.Item,{name:"code",label:"Account Code",rules:[{required:!0}],children:e.jsx(c,{placeholder:"e.g. 4100"})})}),e.jsx(r,{xs:16,children:e.jsx(a.Item,{name:"name",label:"Account Name",rules:[{required:!0}],children:e.jsx(c,{})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"nameAr",label:"Arabic Name",children:e.jsx(c,{style:{direction:"rtl",fontFamily:"Tajawal, Arial"}})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"type",label:"Type",rules:[{required:!0}],children:e.jsx(w,{options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"subType",label:"Sub-Type",children:e.jsx(c,{placeholder:"e.g. current_asset"})})}),e.jsx(r,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(c.TextArea,{rows:2})})}),e.jsx(r,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(R,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(j,{children:[e.jsx(o,{onClick:x,children:"Cancel"}),e.jsx(o,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{pe as default};
