import{r as n,j as e}from"./index-5ITuoeVY.js";import{d}from"./dayjs.min-S_U6Vk6n.js";import{X as w,b as D,ay as j,ai as g,aM as R,aA as I,aB as m,ar as O}from"./IdurarOs-2NdJjWBV.js";import{C as u}from"./index-DRtkgJqY.js";import{k as B}from"./ErpApp-CTwOYhrl.js";import{S as z,E as P}from"./index-BnwwbmUc.js";import{S as h}from"./index-HDFpIo3E.js";import{F as s}from"./Table-CyRZwroC.js";import{D as T}from"./index-B-VD_0IL.js";import{T as H}from"./index-en4g6T-d.js";import"./Skeleton-DvXqHqzH.js";import"./index-D4F4D2Tf.js";import"./PlusOutlined-CxDzqDnz.js";import"./pickAttrs-BIVrBSXA.js";import"./DownOutlined-D9fXyake.js";import"./ClockCircleOutlined-CV4B4TUH.js";import"./useClosable-1Ei4O6MR.js";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},A=function(c,l){return n.createElement(w,D({},c,{ref:l,icon:k}))};const V=n.forwardRef(A),{Title:E,Text:_}=O,{RangePicker:L}=T;function S(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function le(){var f;const[x,c]=n.useState([]),[l,y]=n.useState(null),[a,C]=n.useState(null),[M,p]=n.useState(!1),[i,v]=n.useState([null,null]);n.useEffect(()=>{fetch(j+"client/listAll",{headers:S()}).then(t=>t.json()).then(t=>t.result&&c(t.result)).catch(()=>{})},[]);const F=async()=>{if(!l)return;p(!0);const t=new URLSearchParams;i[0]&&t.set("from",i[0].format("YYYY-MM-DD")),i[1]&&t.set("to",i[1].format("YYYY-MM-DD"));const r=await fetch(j+`reports/customer-statement/${l}?${t}`,{headers:S()}).then(o=>o.json()).catch(()=>({}));r.success&&C(r.result),p(!1)},b={paid:"green",partial:"orange",unpaid:"red",overdue:"volcano"},Y=[{title:"Date",dataIndex:"date",width:110,render:t=>d(t).format("DD MMM YYYY")},{title:"Invoice",dataIndex:"number",width:110,render:(t,r)=>e.jsxs("b",{children:["INV-",t,"/",r.year]})},{title:"Total",dataIndex:"total",align:"right",render:t=>`${parseFloat(t||0).toFixed(3)} OMR`},{title:"Paid",dataIndex:"credit",align:"right",render:t=>e.jsxs("span",{style:{color:"#4CB480"},children:[parseFloat(t||0).toFixed(3)," OMR"]})},{title:"Balance",align:"right",render:(t,r)=>{const o=(r.total||0)-(r.credit||0);return e.jsxs("b",{style:{color:o>0?"#e53e3e":"#4CB480"},children:[parseFloat(o).toFixed(3)," OMR"]})}},{title:"Due Date",dataIndex:"expiredDate",width:110,render:t=>t?d(t).format("DD MMM YYYY"):"—"},{title:"Status",dataIndex:"paymentStatus",width:90,render:t=>e.jsx(H,{color:b[t],children:t==null?void 0:t.toUpperCase()})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsx(E,{level:4,style:{margin:0,color:"#034D57"},children:"Customer Statement"}),a&&e.jsx(g,{icon:e.jsx(V,{}),onClick:()=>window.print(),children:"Print"})]}),e.jsx(u,{size:"small",style:{marginBottom:20},children:e.jsxs(B,{wrap:!0,children:[e.jsx(z,{showSearch:!0,placeholder:"Select customer",style:{minWidth:260},onChange:t=>y(t),filterOption:(t,r)=>r.label.toLowerCase().includes(t.toLowerCase()),options:x.map(t=>({value:t._id,label:t.name}))}),e.jsx(L,{onChange:t=>v(t||[null,null]),style:{width:240}}),e.jsx(g,{type:"primary",icon:e.jsx(R,{}),onClick:F,loading:M,style:{background:"#034D57"},disabled:!l,children:"Generate"})]})}),a?e.jsxs(e.Fragment,{children:[e.jsx(u,{title:e.jsxs(e.Fragment,{children:[e.jsx("b",{children:(f=a.client)==null?void 0:f.name})," — Account Statement"]}),size:"small",style:{marginBottom:16},extra:e.jsxs(_,{type:"secondary",style:{fontSize:12},children:["Generated ",d().format("DD MMM YYYY HH:mm")]}),children:e.jsxs(I,{gutter:12,children:[e.jsx(m,{xs:8,children:e.jsx(h,{title:"Total Invoiced",value:parseFloat(a.totalInvoiced||0).toFixed(3),suffix:"OMR",valueStyle:{color:"#034D57",fontSize:16}})}),e.jsx(m,{xs:8,children:e.jsx(h,{title:"Total Paid",value:parseFloat(a.totalPaid||0).toFixed(3),suffix:"OMR",valueStyle:{color:"#4CB480",fontSize:16}})}),e.jsx(m,{xs:8,children:e.jsx(h,{title:"Outstanding Balance",value:parseFloat(a.balance||0).toFixed(3),suffix:"OMR",valueStyle:{color:a.balance>0?"#e53e3e":"#4CB480",fontSize:16,fontWeight:700}})})]})}),e.jsx(s,{columns:Y,dataSource:a.invoices||[],rowKey:"_id",size:"small",pagination:{pageSize:20},summary:()=>e.jsxs(s.Summary.Row,{style:{background:"#f5f5f5"},children:[e.jsx(s.Summary.Cell,{colSpan:2,children:e.jsx("b",{children:"TOTAL"})}),e.jsx(s.Summary.Cell,{align:"right",children:e.jsxs("b",{children:[parseFloat(a.totalInvoiced||0).toFixed(3)," OMR"]})}),e.jsx(s.Summary.Cell,{align:"right",children:e.jsxs("b",{style:{color:"#4CB480"},children:[parseFloat(a.totalPaid||0).toFixed(3)," OMR"]})}),e.jsx(s.Summary.Cell,{align:"right",children:e.jsxs("b",{style:{color:"#e53e3e"},children:[parseFloat(a.balance||0).toFixed(3)," OMR"]})}),e.jsx(s.Summary.Cell,{colSpan:2})]})})]}):e.jsx(u,{children:e.jsx(P,{description:"Select a customer and click Generate"})})]})}export{le as default};
