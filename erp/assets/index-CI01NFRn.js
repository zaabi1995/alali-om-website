import{r as n,m as _,j as s}from"./index-Gw_HNjBH.js";import{o as d}from"./omrFormat-BZlcrKfu.js";import{d as z}from"./dayjs.min-C2SyCGbm.js";import{X as I,b as O,ai as h,ar as E,az as p}from"./IdurarOs-UAwEGpS5.js";import{m as j}from"./ErpApp-C9AewPMi.js";import{S as $}from"./index-BwsbrEsS.js";import{F as w}from"./Table-C9MWyt9_.js";import{T as f}from"./index-DdbJb15z.js";import{P as b}from"./index-DQOWZhae.js";import{s as c}from"./index-vXE3JCRA.js";import{P as A}from"./PlusOutlined-Bzoeqrsv.js";import{C as J}from"./CheckCircleOutlined-BqHlb5rb.js";import"./pickAttrs-DlU6u4VP.js";import"./DownOutlined-C8Qn245-.js";import"./useClosable-xvi2rCVs.js";import"./ActionButton-CvK3LaEO.js";var B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},F=function(u,m){return n.createElement(I,O({},u,{ref:m,icon:B}))};const H=n.forwardRef(F),{Title:L,Text:S}=E;function x(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function M(){return{...x(),"Content-Type":"application/json"}}const N={draft:"default",posted:"success",reversed:"error"};function ie(){const[g,u]=n.useState([]),[m,y]=n.useState(!1),[o,C]=n.useState(""),[v,R]=n.useState({current:1,total:0,pageSize:20}),D=_(),l=async(t=1)=>{y(!0);const e=new URLSearchParams({page:t,items:20});o&&e.set("status",o);const r=await fetch(`${p}journalentry/list?${e}`,{headers:x()}).then(a=>a.json()).catch(()=>({}));r.success&&(u(r.result||[]),R(a=>{var i;return{...a,total:((i=r.pagination)==null?void 0:i.count)||0,current:t}})),y(!1)};n.useEffect(()=>{l()},[o]);const T=async t=>{const e=await fetch(`${p}journalentry/post/${t}`,{method:"PATCH",headers:x()}).then(r=>r.json()).catch(()=>({}));e.success?(c.success(e.message),l()):c.error(e.message||"Failed")},k=async t=>{const e=await fetch(`${p}journalentry/reverse/${t}`,{method:"POST",headers:M(),body:JSON.stringify({date:new Date})}).then(r=>r.json()).catch(()=>({}));e.success?(c.success(e.message),l()):c.error(e.message||"Failed")},P=[{title:"Ref",width:120,render:(t,e)=>s.jsxs(S,{strong:!0,style:{color:"#034D57",fontSize:12},children:["JE-",e.number,"/",e.year]})},{title:"Date",dataIndex:"date",width:100,render:t=>z(t).format("DD MMM YYYY")},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"Type",dataIndex:"type",width:100,render:t=>s.jsx(f,{style:{fontSize:11},children:t})},{title:"Debit",width:120,align:"right",render:(t,e)=>{var r;return d(((r=e.lines)==null?void 0:r.reduce((a,i)=>a+(i.debit||0),0))||0)}},{title:"Credit",width:120,align:"right",render:(t,e)=>{var r;return d(((r=e.lines)==null?void 0:r.reduce((a,i)=>a+(i.credit||0),0))||0)}},{title:"Lines",width:60,align:"center",render:(t,e)=>{var r;return s.jsx(f,{children:((r=e.lines)==null?void 0:r.length)||0})}},{title:"Status",dataIndex:"status",width:90,render:t=>s.jsx(f,{color:N[t],children:t==null?void 0:t.toUpperCase()})},{title:"",width:120,render:(t,e)=>s.jsxs(j,{size:4,children:[e.status==="draft"&&s.jsx(b,{title:"Post this journal entry?",description:"This will make it permanent.",onConfirm:()=>T(e._id),okText:"Post",children:s.jsx(h,{size:"small",type:"primary",icon:s.jsx(J,{}),style:{background:"#034D57",borderColor:"#034D57"},children:"Post"})}),e.status==="posted"&&s.jsx(b,{title:"Reverse this entry?",onConfirm:()=>k(e._id),okText:"Reverse",children:s.jsx(h,{size:"small",icon:s.jsx(H,{}),children:"Reverse"})})]})}];return s.jsxs("div",{style:{padding:24},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[s.jsx(L,{level:4,style:{margin:0,color:"#034D57"},children:"Journal Entries"}),s.jsxs(j,{children:[s.jsx($,{placeholder:"All statuses",style:{width:140},allowClear:!0,onChange:C,value:o||void 0,options:[{value:"draft",label:"Draft"},{value:"posted",label:"Posted"},{value:"reversed",label:"Reversed"}]}),s.jsx(h,{type:"primary",icon:s.jsx(A,{}),onClick:()=>D("/journal-entry/create"),style:{background:"#034D57",borderColor:"#034D57"},children:"New Entry"})]})]}),s.jsx(w,{columns:P,dataSource:g,rowKey:"_id",loading:m,size:"small",pagination:{...v,onChange:l},expandable:{expandedRowRender:t=>s.jsx(w,{size:"small",pagination:!1,dataSource:t.lines||[],rowKey:(e,r)=>r,columns:[{title:"Account",render:(e,r)=>s.jsxs("span",{children:[s.jsx(S,{code:!0,style:{fontSize:11},children:r.accountCode})," ",r.accountName]})},{title:"Description",dataIndex:"description",ellipsis:!0},{title:"Debit",dataIndex:"debit",align:"right",render:e=>e>0?d(e):"—"},{title:"Credit",dataIndex:"credit",align:"right",render:e=>e>0?d(e):"—"}]})}})]})}export{ie as default};
