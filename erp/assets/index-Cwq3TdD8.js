import{r as n,m as g,j as t}from"./index-DGBU46UJ.js";import{a as y,F as j,C as b,O as S}from"./ErpApp-CYUZ8TN2.js";import{d as w}from"./dayjs.min-8Z1s2ZZV.js";import{X as v,b as C,ay as I,aC as O,aA as s,aB as c,ai as A,ar as R}from"./IdurarOs-CJ9ViAhm.js";import{C as d}from"./index-CjcNLPXh.js";import{F as T}from"./Table-D6trtlAr.js";import{T as p}from"./index-BJe3uNvq.js";import"./Skeleton-CtKtAXNJ.js";import"./index-CjgSDB-1.js";import"./PlusOutlined-WiqW7VqH.js";import"./pickAttrs-fHa9THfw.js";import"./index-DbQUCUwL.js";import"./DownOutlined-CLg65-LR.js";import"./useClosable-CO9qeB94.js";var z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},D=function(o,l){return n.createElement(v,C({},o,{ref:l,icon:z}))};const k=n.forwardRef(D),{Title:B,Text:K}=R;function F(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function u(r){return`${parseFloat(r||0).toFixed(3)} OMR`}function $({color:r="#4CB480",size:o=28}){return t.jsx("div",{style:{width:o,height:o,borderRadius:"50%",border:`2px solid ${r}`,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:t.jsx(S,{size:o*.42,color:r})})}const h=[{key:"rfqs",label:"Open RFQs",icon:t.jsx(y,{}),color:"#1890ff",desc:"Active procurement requests"},{key:"quotes",label:"Open Quotes",icon:t.jsx(j,{}),color:"#fa8c16",desc:"Quotations pending response"},{key:"invoices",label:"Invoices Due",icon:t.jsx(b,{}),color:"#e53e3e",desc:"Invoices awaiting payment"},{key:"paid",label:"Paid (YTD)",icon:t.jsx($,{}),color:"#4CB480",desc:"Total payments received"}];function X(){const r=g(),[o,l]=n.useState(null),[m,x]=n.useState(!0);if(n.useEffect(()=>{fetch(I+"reports/pipeline",{headers:F()}).then(e=>e.json()).then(e=>{e.success&&l(e.result)}).finally(()=>x(!1))},[]),m)return t.jsx("div",{style:{textAlign:"center",padding:60},children:t.jsx(O,{size:"large"})});const a=(o==null?void 0:o.stages)||{},f=[{title:"Invoice",dataIndex:"number",width:90,render:(e,i)=>t.jsxs("a",{onClick:()=>r(`/invoice/read/${i._id}`),style:{fontWeight:700,color:"#034D57"},children:["INV-",e,"/",i.year]})},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Date",dataIndex:"date",width:110,render:e=>w(e).format("DD MMM YYYY")},{title:"Amount",dataIndex:"total",align:"right",render:e=>t.jsx("strong",{children:u(e)})},{title:"Status",dataIndex:"status",width:100,render:e=>{const i={draft:"default",pending:"blue",sent:"cyan",received:"orange",cancelled:"red",refund:"purple"};return t.jsx(p,{color:i[e]||"default",children:e==null?void 0:e.toUpperCase()})}},{title:"Payment",dataIndex:"paymentStatus",width:100,render:e=>{const i={unpaid:"red","partially paid":"orange",paid:"green"};return e?t.jsx(p,{color:i[e]||"default",children:e==null?void 0:e.toUpperCase()}):"—"}}];return t.jsxs("div",{style:{padding:"24px"},children:[t.jsx(B,{level:4,style:{color:"#034D57",marginBottom:20},children:"Deal Pipeline"}),t.jsx(s,{gutter:16,style:{marginBottom:28},children:h.map((e,i)=>t.jsx(c,{xs:12,md:6,children:t.jsxs(d,{size:"small",style:{borderTop:`4px solid ${e.color}`,textAlign:"center",position:"relative"},bodyStyle:{padding:"16px 12px"},children:[t.jsx("div",{style:{fontSize:28,color:e.color,marginBottom:6},children:e.icon}),t.jsx("div",{style:{fontSize:28,fontWeight:800,color:"#1a1a1a",lineHeight:1},children:e.key==="paid"?t.jsx("span",{style:{fontSize:16},children:u(a[e.key])}):a[e.key]??"—"}),t.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#034D57",marginTop:4},children:e.label}),t.jsx("div",{style:{fontSize:10,color:"#aaa",marginTop:2},children:e.desc}),i<h.length-1&&t.jsx("div",{style:{position:"absolute",right:-14,top:"50%",transform:"translateY(-50%)",zIndex:1},children:t.jsx(k,{style:{color:"#ccc",fontSize:18}})})]})},e.key))}),t.jsx(s,{gutter:12,style:{marginBottom:20},children:[{label:"View Open RFQs",color:"#1890ff",path:"/rfq?status=new,in_progress"},{label:"View Open Quotes",color:"#fa8c16",path:"/quote"},{label:"Outstanding Invoices",color:"#e53e3e",path:"/invoice"},{label:"Aged Receivables",color:"#034D57",path:"/reports"}].map(e=>t.jsx(c,{xs:12,md:6,children:t.jsx(A,{block:!0,onClick:()=>r(e.path),style:{borderColor:e.color,color:e.color,height:40},children:e.label})},e.label))}),t.jsx(d,{title:"Recent Deals",size:"small",children:t.jsx(T,{columns:f,dataSource:(o==null?void 0:o.recentDeals)||[],rowKey:"_id",size:"small",pagination:{pageSize:10},locale:{emptyText:"No invoices yet"}})})]})}export{X as default};
