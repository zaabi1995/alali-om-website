import{m as P,r as s,j as t}from"./index-DynqZcYC.js";import{o as I}from"./omrFormat-5vt2WG1V.js";import{d as m}from"./dayjs.min-xbWELxxT.js";import{ai as c,aD as O,aM as T,ar as b,ay as h}from"./IdurarOs-DBOvFMl4.js";import{l as f,b as k}from"./ErpApp-Dsj0b1h9.js";import{S as Y}from"./index-B0MbqwlP.js";import{F as E}from"./Table-CdLo-aJd.js";import{T as M}from"./index-C6iqSUGl.js";import{P as _}from"./index-Dlubn56L.js";import{s as B}from"./index-Bzh2Kr56.js";import{P as N}from"./PlusOutlined-DOkyJDj0.js";import{D as z}from"./DeleteOutlined-Ck3yX7uE.js";import"./pickAttrs-BVt-fMi-.js";import"./DownOutlined-JFe7GSFF.js";import"./useClosable-wR5V5ARF.js";import"./ActionButton-CPZSuqlQ.js";const{Title:A}=b;function g(){const r=((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token;return r?{Authorization:`Bearer ${r}`}:{}}const L={draft:"default",sent:"blue",acknowledged:"cyan",shipped:"orange",received:"green",cancelled:"red"};function ae(){const r=P(),[x,y]=s.useState([]),[j,p]=s.useState(!1),[o,S]=s.useState({page:1,pages:1,count:0}),[n,w]=s.useState(""),[i,u]=s.useState(""),l=async(e=1)=>{p(!0);const a=new URLSearchParams({page:e,items:20});n&&a.set("status",n),i&&a.set("q",i);try{const d=await(await fetch(h+`purchaseorder/list?${a}`,{headers:g()})).json();d.success&&(y(d.result),S(d.pagination||{}))}finally{p(!1)}};s.useEffect(()=>{l(1)},[n,i]);const D=async e=>{await fetch(h+`purchaseorder/delete/${e}`,{method:"DELETE",headers:g()}),B.success("Deleted"),l(o.page)},C=[{title:"PO #",dataIndex:"number",width:90,render:(e,a)=>t.jsxs("a",{onClick:()=>r(`/purchase-order/read/${a._id}`),style:{fontWeight:700,color:"#034D57"},children:["PO-",e,"/",a.year]})},{title:"Vendor",dataIndex:["vendor","companyName"],ellipsis:!0},{title:"Date",dataIndex:"date",render:e=>e?m(e).format("DD MMM YYYY"):"—"},{title:"Req. By",dataIndex:"deliveryDate",render:e=>e?m(e).format("DD MMM YYYY"):"—"},{title:"Currency",dataIndex:"currency",width:80},{title:"Total",dataIndex:"total",align:"right",render:e=>I(e,3)},{title:"Items",dataIndex:"items",width:60,render:e=>(e==null?void 0:e.length)??0},{title:"Status",dataIndex:"status",width:110,render:e=>t.jsx(M,{color:L[e]||"default",children:e==null?void 0:e.toUpperCase()})},{title:"",width:80,render:(e,a)=>t.jsxs(f,{children:[t.jsx(c,{size:"small",icon:t.jsx(k,{}),onClick:()=>r(`/purchase-order/read/${a._id}`)}),t.jsx(_,{title:"Delete this PO?",onConfirm:()=>D(a._id),okText:"Yes",cancelText:"No",children:t.jsx(c,{size:"small",danger:!0,icon:t.jsx(z,{})})})]})}];return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsx(A,{level:4,style:{margin:0,color:"#034D57"},children:"Purchase Orders"}),t.jsx(c,{type:"primary",icon:t.jsx(N,{}),onClick:()=>r("/purchase-order/create"),style:{background:"#034D57",borderColor:"#034D57"},children:"New Purchase Order"})]}),t.jsxs(f,{style:{marginBottom:16},wrap:!0,children:[t.jsx(O,{placeholder:"Search part#, description...",prefix:t.jsx(T,{}),allowClear:!0,style:{width:240},onPressEnter:e=>u(e.target.value),onChange:e=>!e.target.value&&u("")}),t.jsx(Y,{placeholder:"Filter by status",allowClear:!0,style:{width:160},onChange:e=>w(e||""),options:["draft","sent","acknowledged","shipped","received","cancelled"].map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)}))})]}),t.jsx(E,{columns:C,dataSource:x,rowKey:"_id",loading:j,size:"small",pagination:{current:o.page,total:o.count,pageSize:20,onChange:e=>l(e)},locale:{emptyText:"No purchase orders yet"}})]})}export{ae as default};
