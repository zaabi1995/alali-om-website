import{m as O,o as P,r as d,j as e}from"./index-CTFV7Brr.js";import{b as _}from"./omrFormat-D-sM2f67.js";import{g as S,e as m,w as T}from"./ErpApp-DMSXEY9U.js";import{b8 as s,aV as o,aB as h,aM as N,aL as r,aX as j,aY as B}from"./IdurarOs-BuItXQtq.js";import{C as k}from"./index-DpRBerau.js";import{D as y}from"./index-BT22LTtk.js";import{T as E}from"./index-COzt4akP.js";import{s as p}from"./index-C0zoDyuO.js";import{A as R}from"./ArrowLeftOutlined-fqCPcQQ3.js";import{S as F}from"./SaveOutlined-iYBAgevA.js";import"./Skeleton-CK9OjjLh.js";import"./index-CzggDZE3.js";import"./PlusOutlined-CSb8KqdM.js";import"./ClockCircleOutlined-hOEcQdMQ.js";const{Title:L}=B,{TextArea:b}=j;function $(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}function C(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const J=["defense","aviation","oil_gas","construction","renewable_energy","marine","logistics","health_safety","printing","other"];function te(){const i=O(),{id:n}=P(),[u]=s.useForm(),[D,w]=d.useState([]),[I,x]=d.useState(!1);d.useEffect(()=>{fetch(o+"client/listAll",{headers:C()}).then(t=>t.json()).then(t=>t.result&&w(t.result)).catch(()=>{}),n&&fetch(o+`project/read/${n}`,{headers:C()}).then(t=>t.json()).then(t=>{var a;if(t.success&&t.result){const l=t.result;u.setFieldsValue({...l,startDate:l.startDate?S(l.startDate):null,endDate:l.endDate?S(l.endDate):null,client:((a=l.client)==null?void 0:a._id)||l.client})}}).catch(()=>{})},[n]);const v=async t=>{var g,f;x(!0);const a={...t,startDate:(g=t.startDate)==null?void 0:g.toISOString(),endDate:(f=t.endDate)==null?void 0:f.toISOString()},l=n?o+`project/update/${n}`:o+"project/create";try{const c=await fetch(l,{method:n?"PATCH":"POST",headers:$(),body:JSON.stringify(a)}).then(A=>A.json());c.success?(p.success("Saved"),i(`/projects/read/${c.result._id}`)):p.error(c.message||"Failed")}catch{p.error("Network error")}finally{x(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:760},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(h,{icon:e.jsx(R,{}),onClick:()=>i("/projects")}),e.jsx(L,{level:4,style:{margin:0,color:"#034D57"},children:n?"Edit Project":"New Project"})]}),e.jsxs(s,{form:u,layout:"vertical",onFinish:v,children:[e.jsx(k,{title:"Project Details",size:"small",style:{marginBottom:16},children:e.jsxs(N,{gutter:16,children:[e.jsx(r,{xs:24,sm:8,children:e.jsx(s.Item,{name:"code",label:"Project Code",children:e.jsx(j,{placeholder:"e.g. RAFO-2026-001"})})}),e.jsx(r,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Project Name",rules:[{required:!0}],children:e.jsx(j,{})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"client",label:"Client",children:e.jsx(m,{showSearch:!0,allowClear:!0,filterOption:(t,a)=>a.label.toLowerCase().includes(t.toLowerCase()),placeholder:"Select client",options:D.map(t=>({value:t._id,label:t.name}))})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"sector",label:"Sector",children:e.jsx(m,{placeholder:"Select sector",allowClear:!0,options:J.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}))})})}),e.jsx(r,{xs:12,sm:6,children:e.jsx(s.Item,{name:"startDate",label:"Start Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(r,{xs:12,sm:6,children:e.jsx(s.Item,{name:"endDate",label:"End Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"budgetOMR",label:"Budget (OMR)",initialValue:0,children:e.jsx(E,{min:0,precision:3,style:{width:"100%"},addonAfter:_()})})}),e.jsx(r,{xs:24,sm:12,children:e.jsx(s.Item,{name:"status",label:"Status",initialValue:"prospect",children:e.jsx(m,{options:["prospect","active","on_hold","completed","cancelled"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}))})})}),e.jsx(r,{xs:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(b,{rows:3})})}),e.jsx(r,{xs:24,children:e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(b,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(T,{children:[e.jsx(h,{onClick:()=>i("/projects"),children:"Cancel"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:I,icon:e.jsx(F,{}),style:{background:"#034D57"},children:"Save Project"})]})})]})]})}export{te as default};
