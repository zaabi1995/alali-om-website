import{m as v,r as s,j as t}from"./index-D-3B17BB.js";import{d as m}from"./dayjs.min-BFb01cN1.js";import{ai as c,aE as b,aN as I,ar as T,az as h}from"./IdurarOs-DIHWZIv9.js";import{m as f,b as N}from"./ErpApp-VqBvRvHh.js";import{S as E}from"./index-DS7PtXKP.js";import{F as P}from"./Table-DFnX_dmh.js";import{T as Y}from"./index-DNNlwRee.js";import{P as _}from"./index-DHx_m-b4.js";import{s as k}from"./index-l1lspZv6.js";import{P as M}from"./PlusOutlined-D7WCXFFd.js";import{D as O}from"./DeleteOutlined-1-J3po9G.js";import"./pickAttrs-3JBImAlU.js";import"./DownOutlined-CMKT2r-s.js";import"./Pagination-CgyH5SNg.js";import"./useClosable-DqQmpQFA.js";import"./ActionButton-CIjC0KcO.js";const{Title:z}=T;function x(){const r=((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token;return r?{Authorization:`Bearer ${r}`}:{}}const A={draft:"default",printed:"blue",dispatched:"orange",delivered:"green"};function te(){const r=v(),[g,y]=s.useState([]),[D,p]=s.useState(!1),[i,j]=s.useState({page:1,pages:1,count:0}),[o,S]=s.useState(""),[n,u]=s.useState(""),l=async(e=1)=>{p(!0);const a=new URLSearchParams({page:e,items:20});o&&a.set("status",o),n&&a.set("q",n);try{const d=await(await fetch(h+`deliverynote/list?${a}`,{headers:x()})).json();d.success&&(y(d.result),j(d.pagination||{page:1,pages:1,count:0}))}finally{p(!1)}};s.useEffect(()=>{l(1)},[o,n]);const w=async e=>{await fetch(h+`deliverynote/delete/${e}`,{method:"DELETE",headers:x()}),k.success("Deleted"),l(i.page)},C=[{title:"DN #",dataIndex:"number",width:80,render:(e,a)=>t.jsxs("a",{onClick:()=>r(`/delivery-note/read/${a._id}`),style:{fontWeight:700,color:"#034D57"},children:["DN-",e,"/",a.year]})},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Date",dataIndex:"date",render:e=>e?m(e).format("DD MMM YYYY"):"—"},{title:"Ship Date",dataIndex:"shipDate",render:e=>e?m(e).format("DD MMM YYYY"):"—"},{title:"Carrier",dataIndex:"carrier",render:e=>e||"—"},{title:"Items",dataIndex:"items",width:60,render:e=>(e==null?void 0:e.length)??0},{title:"Status",dataIndex:"status",width:110,render:e=>t.jsx(Y,{color:A[e]||"default",children:e==null?void 0:e.toUpperCase()})},{title:"",width:80,render:(e,a)=>t.jsxs(f,{children:[t.jsx(c,{size:"small",icon:t.jsx(N,{}),onClick:()=>r(`/delivery-note/read/${a._id}`)}),t.jsx(_,{title:"Delete this delivery note?",onConfirm:()=>w(a._id),okText:"Yes",cancelText:"No",children:t.jsx(c,{size:"small",danger:!0,icon:t.jsx(O,{})})})]})}];return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsx(z,{level:4,style:{margin:0,color:"#034D57"},children:"Delivery Notes"}),t.jsx(c,{type:"primary",icon:t.jsx(M,{}),onClick:()=>r("/delivery-note/create"),style:{background:"#034D57",borderColor:"#034D57"},children:"Add New Delivery Note"})]}),t.jsxs(f,{style:{marginBottom:16},wrap:!0,children:[t.jsx(b,{placeholder:"Search part#, carrier...",prefix:t.jsx(I,{}),allowClear:!0,style:{width:240},onPressEnter:e=>u(e.target.value),onChange:e=>!e.target.value&&u("")}),t.jsx(E,{placeholder:"Filter by status",allowClear:!0,style:{width:160},onChange:e=>S(e||""),options:[{value:"draft",label:"Draft"},{value:"printed",label:"Printed"},{value:"dispatched",label:"Dispatched"},{value:"delivered",label:"Delivered"}]})]}),t.jsx(P,{columns:C,dataSource:g,rowKey:"_id",loading:D,size:"small",pagination:{current:i.page,total:i.count,pageSize:20,onChange:e=>l(e)},locale:{emptyText:"No delivery notes yet"}})]})}export{te as default};
