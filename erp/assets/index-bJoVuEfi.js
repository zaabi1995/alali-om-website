import{u as _,j as e,m as $,n as O,r as b}from"./index-CfD99eWM.js";import{u as I,F as M,k as N,D as z,E as U}from"./ErpApp-5RKUdHDV.js";import{P as W}from"./index-fkYoPCRr.js";import{A as q}from"./index-7szDsYDw.js";import{b4 as H,b5 as K,aB as R,aU as Y,b6 as G}from"./IdurarOs-CIf1RHA4.js";import{e as l}from"./actions-Px5jb2zY.js";import{f as J,g as Q}from"./selectors-B-ETPa_h.js";import{u as C}from"./index-DRS2OJXo.js";import{s as L}from"./index-KrFx5yLV.js";import{F as V}from"./Table-D2HkX3gJ.js";import{A as X}from"./ArrowLeftOutlined-nIbloWvE.js";import{R as Z,v as ee}from"./helpers-CWEMnYqY.js";import{P as te}from"./PlusOutlined-C4PIKCeA.js";import{M as se}from"./index-ljet-ASd.js";function ne({config:i}){const c=$(),{ADD_NEW_ENTITY:a,entity:s}=i,{can:r}=I();if(!r.create)return null;const d=()=>{c(`/${s.toLowerCase()}/create`)};return e.jsx(R,{onClick:d,type:"primary",icon:e.jsx(te,{}),children:a})}function ae({config:i,extra:c=[]}){const a=Y();let{entity:s,dataTableColumns:r,disableAdd:d=!1,searchConfig:n}=i;const{DATATABLE_TITLE:x}=i,{result:y,isLoading:g}=_(J),{pagination:j,items:k}=y,{erpContextAction:m}=C(),{modal:D}=m,{can:h}=I(),w=[{label:a("Show"),key:"read",icon:e.jsx(H,{})},...h.update?[{label:a("Edit"),key:"edit",icon:e.jsx(K,{})}]:[],{label:a("Download"),key:"download",icon:e.jsx(M,{})},...c,...h.delete?[{type:"divider"},{label:a("Delete"),key:"delete",icon:e.jsx(N,{}),danger:!0}]:[]],f=$(),p=t=>{u(l.currentItem({data:t})),f(`/${s}/read/${t._id}`)},A=t=>{const o={...t};u(l.currentAction({actionType:"update",data:o})),f(`/${s}/update/${t._id}`)},S=t=>{window.open(`${G}${s}/${s}-${t._id}.pdf`,"_blank")},v=t=>{u(l.currentAction({actionType:"delete",data:t})),D.open()},P=t=>{u(l.currentItem({data:t})),f(`/invoice/pay/${t._id}`)};r=[...r,{title:"",key:"action",fixed:"right",render:(t,o)=>e.jsx(z,{menu:{items:w,onClick:({key:E})=>{switch(E){case"read":p(o);break;case"edit":A(o);break;case"download":S(o);break;case"delete":v(o);break;case"recordPayment":P(o);break}}},trigger:["click"],children:e.jsx(U,{style:{cursor:"pointer",fontSize:"24px"},onClick:E=>E.preventDefault()})})}];const u=O(),T=t=>{const o={page:t.current||1,items:t.pageSize||10};u(l.list({entity:s,options:o}))},F=()=>{u(l.list({entity:s}))};b.useEffect(()=>{const t=new AbortController;return F(),()=>{t.abort()}},[]);const B=t=>{const o={equal:t,filter:n==null?void 0:n.entity};u(l.list({entity:s,options:o}))};return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:x,ghost:!0,onBack:()=>window.history.back(),backIcon:e.jsx(X,{}),extra:[e.jsx(q,{entity:n==null?void 0:n.entity,displayLabels:["name"],searchFields:"name",onChange:B},`${L.generate()}`),e.jsx(R,{onClick:T,icon:e.jsx(Z,{}),children:a("Refresh")},`${L.generate()}`),!d&&e.jsx(ne,{config:i},`${L.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(V,{columns:r,rowKey:t=>t._id,dataSource:k,pagination:j,loading:g,onChange:T,scroll:{x:!0}})]})}function oe({config:i}){let{entity:c,deleteModalLabels:a,deleteMessage:s="Do you want delete : ",modalTitle:r="Remove Item"}=i;const d=O(),{current:n,isLoading:x,isSuccess:y}=_(Q),{state:g,erpContextAction:j}=C(),{deleteModal:k}=g,{modal:m}=j,[D,h]=b.useState("");b.useEffect(()=>{if(y){m.close();const p={page:1,items:10};d(l.list({entity:c,options:p}))}if(n){let p=a.map(A=>ee(n,A)).join(" ");h(p)}},[y,n]);const w=()=>{const p=n._id;d(l.delete({entity:c,id:p})),m.close()},f=()=>{x||m.close()};return e.jsx(se,{title:r,open:k.isOpen,onOk:w,onCancel:f,confirmLoading:x,children:e.jsxs("p",{children:[s,D]})})}function je({config:i,extra:c}){const a=O(),{state:s}=C(),{deleteModal:r}=s,d=()=>{a(l.resetState())};return b.useLayoutEffect(()=>{const n=new AbortController;return d(),()=>{n.abort()}},[]),e.jsxs(e.Fragment,{children:[e.jsx(ae,{config:i,extra:c}),e.jsx(oe,{config:i,isOpen:r.isOpen})]})}export{je as E};
