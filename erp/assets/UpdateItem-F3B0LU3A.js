import{n as q,m as w,u as M,r as m,o as R,j as e}from"./index-CTFV7Brr.js";import{g as d}from"./ErpApp-DMSXEY9U.js";import{P as B}from"./index-Cg2nNOoR.js";import{b8 as D,aB as F,aW as I,ba as N,aU as O}from"./IdurarOs-BuItXQtq.js";import{e as C}from"./actions-BxdFnOjm.js";import{c as b}from"./calculate-CoT1A6Sl.js";import{s as T}from"./index-KrFx5yLV.js";import{e as Z}from"./selectors-C4H2qqqE.js";import{C as A}from"./CloseCircleOutlined-BYAi4dKe.js";import{P as W}from"./PlusOutlined-CSb8KqdM.js";function z({form:l,translate:x}){const s=()=>{l.submit()};return e.jsx(F,{onClick:s,type:"primary",icon:e.jsx(W,{}),children:x("update")})}function st({config:l,UpdateForm:x}){const s=O();let{entity:u}=l;const j=q(),f=w(),{current:n,isLoading:Y,isSuccess:y}=M(Z),[i]=D.useForm(),[E,h]=m.useState(0),L={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[c,$]=m.useState(n??L),{id:S}=R(),v=(t,a)=>{const p=a.items;let r=0;p&&(p.map(o=>{if(o&&o.quantity&&o.price){let g=b.multiply(o.quantity,o.price);r=b.add(r,g)}}),h(r))},H=t=>{let a={...t};if(t&&((t.date||t.expiredDate)&&(a.date=d(t.date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),a.expiredDate=d(t.expiredDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),t.items)){let p=[];t.items.map(r=>{const{quantity:o,price:g,itemName:P,description:U}=r,k=r.quantity*r.price;p.push({total:k,quantity:o,price:g,itemName:P,description:U})}),a.items=p}j(C.update({entity:u,id:S,jsonData:a}))};return m.useEffect(()=>{y&&(i.resetFields(),h(0),j(C.resetAction({actionType:"update"})),f(`/${u.toLowerCase()}/read/${S}`))},[y]),m.useEffect(()=>{if(n){$(n);let t={...n};t.date&&(t.date=d(t.date)),t.expiredDate&&(t.expiredDate=d(t.expiredDate)),t.taxRate||(t.taxRate=0);const{subTotal:a}=t;i.resetFields(),i.setFieldsValue(t),h(a)}},[n]),e.jsxs(e.Fragment,{children:[e.jsx(B,{onBack:()=>{f(`/${u.toLowerCase()}`)},title:s("update"),ghost:!1,tags:[e.jsx("span",{children:c.status&&s(c.status)},"status"),c.paymentStatus&&e.jsx("span",{children:c.paymentStatus&&s(c.paymentStatus)},"paymentStatus")],extra:[e.jsx(F,{onClick:()=>{f(`/${u.toLowerCase()}`)},icon:e.jsx(A,{}),children:s("Cancel")},`${T.generate()}`),e.jsx(z,{translate:s,form:i},`${T.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(I,{dashed:!0}),e.jsx(N,{isLoading:Y,children:e.jsx(D,{form:i,layout:"vertical",onFinish:H,onValuesChange:v,children:e.jsx(x,{subTotal:E,current:n})})})]})}export{st as U};
