import{j as e,r as y}from"./index-CTFV7Brr.js";import{d as N,a2 as P,g as L,T as $,e as F}from"./ErpApp-DMSXEY9U.js";import{aY as J,aV as b,aB as K,aM as U,aL as W,aN as M,aX as D}from"./IdurarOs-BuItXQtq.js";import{T as V}from"./index-CzggDZE3.js";import{D as R}from"./index-BT22LTtk.js";import{F as Y}from"./Table-DWRONg7I.js";import{s as B}from"./index-C0zoDyuO.js";import{C as X}from"./ClockCircleOutlined-hOEcQdMQ.js";import{S as q}from"./SaveOutlined-iYBAgevA.js";import"./PlusOutlined-CSb8KqdM.js";const{Title:G,Text:_}=J;function k(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function Q(){return{...k(),"Content-Type":"application/json"}}const S=[{value:"present",label:"Present",color:"#4CB480"},{value:"absent",label:"Absent",color:"#e53e3e"},{value:"late",label:"Late",color:"#fa8c16"},{value:"half_day",label:"Half Day",color:"#1890ff"},{value:"remote",label:"Remote",color:"#722ed1"},{value:"on_leave",label:"On Leave",color:"#eb2f96"},{value:"holiday",label:"Holiday",color:"#888"}];Object.fromEntries(S.map(c=>[c.value,c.color]));Object.fromEntries(S.map(c=>[c.value,c.label]));function Z(){const[c,w]=y.useState(L()),[p,O]=y.useState([]),[f,g]=y.useState(!1),[C,x]=y.useState(!1),[d,j]=y.useState({}),i=y.useCallback(async t=>{g(!0),j({});try{const s=await fetch(b+`attendance/by-date/${t.format("YYYY-MM-DD")}`,{headers:k()}).then(n=>n.json());s.success&&O(s.result||[])}finally{g(!1)}},[]);y.useEffect(()=>{i(c)},[c]);const o=(t,s,n)=>{j(l=>({...l,[t]:{...l[t]||{},[s]:n}}))},a=async()=>{x(!0);try{const t=p.map(n=>{const l=n.employee,r=d[l._id]||{};return{employee:l._id,status:r.status??n.status??"present",checkIn:r.checkIn??n.checkIn??null,checkOut:r.checkOut??n.checkOut??null,notes:r.notes??n.notes??null}}),s=await fetch(b+"attendance/bulk-mark",{method:"POST",headers:Q(),body:JSON.stringify({date:c.format("YYYY-MM-DD"),records:t})}).then(n=>n.json());s.success?(B.success(`Saved ${s.result.length} records`),i(c)):B.error(s.message||"Save failed")}finally{x(!1)}},m={present:0,absent:0,late:0,half_day:0,remote:0,on_leave:0,holiday:0,unmarked:0};p.forEach(t=>{var l,r;const s=(l=t.employee)==null?void 0:l._id,n=((r=d[s])==null?void 0:r.status)??t.status;n?m[n]!==void 0&&m[n]++:m.unmarked++});const v=[{title:"Employee",dataIndex:"employee",fixed:"left",width:180,render:t=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:13},children:t==null?void 0:t.name}),e.jsxs(_,{type:"secondary",style:{fontSize:11},children:[t==null?void 0:t.department," Â· ",t==null?void 0:t.employeeId]})]})},{title:"Status",width:140,render:(t,s)=>{var r,h;const n=(r=s.employee)==null?void 0:r._id,l=((h=d[n])==null?void 0:h.status)??s.status??void 0;return e.jsx(F,{value:l,style:{width:128},placeholder:"Markâ€¦",onChange:u=>o(n,"status",u),options:S.map(u=>({value:u.value,label:e.jsx("span",{style:{color:u.color},children:u.label})}))})}},{title:"Check In",width:110,render:(t,s)=>{var r,h;const n=(r=s.employee)==null?void 0:r._id,l=((h=d[n])==null?void 0:h.checkIn)??s.checkIn??null;return e.jsx(D,{style:{width:90},placeholder:"08:00",value:l||"",onChange:u=>o(n,"checkIn",u.target.value)})}},{title:"Check Out",width:110,render:(t,s)=>{var r,h;const n=(r=s.employee)==null?void 0:r._id,l=((h=d[n])==null?void 0:h.checkOut)??s.checkOut??null;return e.jsx(D,{style:{width:90},placeholder:"17:00",value:l||"",onChange:u=>o(n,"checkOut",u.target.value)})}},{title:"Hours",width:70,render:(t,s)=>{var T,A,E,z;const n=((A=d[(T=s.employee)==null?void 0:T._id])==null?void 0:A.checkIn)??s.checkIn,l=((z=d[(E=s.employee)==null?void 0:E._id])==null?void 0:z.checkOut)??s.checkOut;if(!n||!l)return e.jsx(_,{type:"secondary",children:"â€”"});const[r,h]=n.split(":").map(Number),[u,H]=l.split(":").map(Number),I=(u*60+H-(r*60+h))/60;return e.jsx(_,{style:{color:I>=8?"#4CB480":"#fa8c16"},children:I>0?I.toFixed(1):"â€”"})}},{title:"Notes",width:160,render:(t,s)=>{var r,h;const n=(r=s.employee)==null?void 0:r._id,l=((h=d[n])==null?void 0:h.notes)??s.notes??"";return e.jsx(D,{style:{fontSize:11},placeholder:"Optional note",value:l,onChange:u=>o(n,"notes",u.target.value)})}}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginBottom:16,flexWrap:"wrap"},children:[e.jsx(R,{value:c,onChange:t=>t&&w(t),style:{width:160}}),e.jsx(K,{icon:e.jsx(q,{}),type:"primary",loading:C,onClick:a,style:{background:"#034D57",borderColor:"#034D57"},children:"Save Attendance"}),Object.keys(d).length>0&&e.jsxs($,{color:"warning",children:[Object.keys(d).length," unsaved changes"]})]}),e.jsxs(U,{gutter:[8,8],style:{marginBottom:16},children:[S.slice(0,6).map(t=>e.jsx(W,{children:e.jsxs("div",{style:{background:"#f8f8f8",borderRadius:6,padding:"6px 12px",borderLeft:`3px solid ${t.color}`,minWidth:70,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:t.color},children:m[t.value]||0}),e.jsx("div",{style:{fontSize:10,color:"#888"},children:t.label})]})},t.value)),m.unmarked>0&&e.jsx(W,{children:e.jsxs("div",{style:{background:"#fff7e6",borderRadius:6,padding:"6px 12px",borderLeft:"3px solid #fa8c16",minWidth:70,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#fa8c16"},children:m.unmarked}),e.jsx("div",{style:{fontSize:10,color:"#888"},children:"Unmarked"})]})})]}),e.jsx(M,{spinning:f,children:e.jsx(Y,{columns:v,dataSource:p,rowKey:t=>{var s;return((s=t.employee)==null?void 0:s._id)||t._id},size:"small",pagination:!1,scroll:{x:800},rowClassName:t=>{var n,l;return(((l=d[(n=t.employee)==null?void 0:n._id])==null?void 0:l.status)??t.status)==="absent"?"row-absent":""}})})]})}function ee(){const[c,w]=y.useState(L()),[p,O]=y.useState([]),[f,g]=y.useState({}),[C,x]=y.useState(!1),d=async i=>{x(!0);try{const a=(await fetch(b+"employee/list?items=100",{headers:k()}).then(t=>t.json())).result||[];O(a);const m=await Promise.all(a.map(t=>fetch(b+`attendance/monthly/${t._id}/${i.year()}/${i.month()+1}`,{headers:k()}).then(s=>s.json()).catch(()=>({})))),v={};a.forEach((t,s)=>{var n,l;v[t._id]=((l=(n=m[s])==null?void 0:n.result)==null?void 0:l.summary)||{}}),g(v)}finally{x(!1)}};y.useEffect(()=>{d(c)},[c]);const j=[{title:"Employee",dataIndex:"name",fixed:"left",width:160,render:(i,o)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:i}),e.jsx(_,{type:"secondary",style:{fontSize:11},children:o.department})]})},{title:"âœ“ Present",align:"center",width:80,render:(i,o)=>{var a;return e.jsx("span",{style:{color:"#4CB480",fontWeight:700},children:((a=f[o._id])==null?void 0:a.present)||0})}},{title:"âœ— Absent",align:"center",width:80,render:(i,o)=>{var a;return e.jsx("span",{style:{color:"#e53e3e",fontWeight:700},children:((a=f[o._id])==null?void 0:a.absent)||0})}},{title:"â° Late",align:"center",width:80,render:(i,o)=>{var a;return e.jsx("span",{style:{color:"#fa8c16",fontWeight:700},children:((a=f[o._id])==null?void 0:a.late)||0})}},{title:"Â½ Half",align:"center",width:80,render:(i,o)=>{var a;return((a=f[o._id])==null?void 0:a.half_day)||0}},{title:"ðŸ  Remote",align:"center",width:80,render:(i,o)=>{var a;return((a=f[o._id])==null?void 0:a.remote)||0}},{title:"ðŸŒ´ Leave",align:"center",width:80,render:(i,o)=>{var a;return((a=f[o._id])==null?void 0:a.on_leave)||0}},{title:"Work Days",align:"center",width:90,render:(i,o)=>{var a;return e.jsx("strong",{children:((a=f[o._id])==null?void 0:a.workingDays)||0})}},{title:"Hrs Total",align:"right",width:90,render:(i,o)=>{var m;const a=((m=f[o._id])==null?void 0:m.totalHours)||0;return e.jsxs("span",{style:{color:a>0?"#034D57":"#ccc"},children:[a.toFixed(1),"h"]})}}];return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(R,{picker:"month",value:c,onChange:i=>i&&w(i),style:{width:160}})}),e.jsx(M,{spinning:C,children:e.jsx(Y,{columns:j,dataSource:p,rowKey:"_id",size:"small",pagination:!1,scroll:{x:800}})})]})}function he(){return e.jsxs("div",{style:{padding:24},children:[e.jsxs(G,{level:4,style:{margin:"0 0 20px",color:"#034D57"},children:[e.jsx(N,{style:{marginRight:8}}),"Attendance"]}),e.jsx(V,{defaultActiveKey:"daily",items:[{key:"daily",label:e.jsxs(e.Fragment,{children:[e.jsx(P,{})," Daily Attendance"]}),children:e.jsx(Z,{})},{key:"monthly",label:e.jsxs(e.Fragment,{children:[e.jsx(X,{})," Monthly Summary"]}),children:e.jsx(ee,{})}]})]})}export{he as default};
