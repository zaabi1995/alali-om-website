import{r as l,m as Z,j as e}from"./index-Z1oWpwI1.js";import{X as _,b as P,ay as x,aA as w,aB as O,ai as u,av as ee,aC as te,T as ne,aD as re,ar as oe}from"./IdurarOs-fW_xq9ii.js";import{B as W,l as j,S as le}from"./ErpApp-CAxdkFuJ.js";import{C as A}from"./index-CbsWBcA0.js";import{S as ae}from"./index-KW2T8X_D.js";import{A as se}from"./index-BhysE8gM.js";import{S as b,E as ie}from"./index-BRWnsjjB.js";import{P as ce}from"./progress-BcNz86D9.js";import{T as y}from"./index-UqyvOyaF.js";import{M as D}from"./index-BHU2k1qc.js";import{W as de}from"./WarningOutlined-BfRBMxhw.js";import{R as ue}from"./ReloadOutlined-DG3_gCCB.js";import{T as he}from"./TrophyOutlined-DiIyhdYd.js";import{E as me}from"./ExportOutlined-Du328EFb.js";import{C as ge}from"./ClockCircleOutlined-BR5g962H.js";import"./Skeleton-BZzm72Gy.js";import"./index-DvfwOYEh.js";import"./PlusOutlined-CmlJp9in.js";import"./pickAttrs-CZ_DBIBd.js";import"./DownOutlined-XirTV1B3.js";import"./useClosable-C8Kmz1ZZ.js";import"./ActionButton-DiK0PQe8.js";import"./fade-CHKcf0El.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M834.1 469.2A347.49 347.49 0 00751.2 354l-29.1-26.7a8.09 8.09 0 00-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 01-47.5 46.1 352.6 352.6 0 00-100.3 121.5A347.75 347.75 0 00160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0075.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 00760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0027.7-136c0-48.8-10-96.2-29.9-140.9zM713 808.5c-53.7 53.2-125 82.4-201 82.4s-147.3-29.2-201-82.4c-53.5-53.1-83-123.5-83-198.4 0-43.5 9.8-85.2 29.1-124 18.8-37.9 46.8-71.8 80.8-97.9a349.6 349.6 0 0058.6-56.8c25-30.5 44.6-64.5 58.2-101a240 240 0 0012.1-46.5c24.1 22.2 44.3 49 61.2 80.4 33.4 62.6 48.8 118.3 45.8 165.7a74.01 74.01 0 0024.4 59.8 73.36 73.36 0 0053.4 18.8c19.7-1 37.8-9.7 51-24.4 13.3-14.9 24.8-30.1 34.4-45.6 14 17.9 25.7 37.4 35 58.4 15.9 35.8 24 73.9 24 113.1 0 74.9-29.5 145.4-83 198.4z"}}]},name:"fire",theme:"outlined"},ye=function(a,s){return l.createElement(_,P({},a,{ref:s,icon:fe}))};const U=l.forwardRef(ye);var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"},xe=function(a,s){return l.createElement(_,P({},a,{ref:s,icon:pe}))};const G=l.forwardRef(xe);var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},ve=function(a,s){return l.createElement(_,P({},a,{ref:s,icon:je}))};const Se=l.forwardRef(ve),{Title:be,Text:f,Paragraph:B}=oe,{Option:v}=b,h="#034D57",k="#4CB480";function S(){var r,a;try{const s=(a=(r=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:r.current)==null?void 0:a.token;return s?{Authorization:`Bearer ${s}`}:{}}catch{return{}}}const R={defense:{label:"Defense & Security",color:"red"},oil_gas:{label:"Oil & Gas",color:"orange"},aviation:{label:"Aviation",color:"blue"},marine:{label:"Marine",color:"cyan"},construction:{label:"Construction",color:"brown"},renewable:{label:"Renewable Energy",color:"green"},printing:{label:"Printing",color:"purple"},health_safety:{label:"Health & Safety",color:"geekblue"},logistics:{label:"Logistics",color:"magenta"},general:{label:"General Supply",color:"default"},unknown:{label:"Other",color:"default"}},N=[{value:"spotted",label:"Spotted",color:"blue"},{value:"evaluating",label:"Evaluating",color:"orange"},{value:"bidding",label:"Bidding",color:"purple"},{value:"won",label:"Won",color:"success"},{value:"lost",label:"Lost",color:"error"},{value:"ignored",label:"Ignored",color:"default"}];function J(r){return r>=70?"#f5222d":r>=50?"#fa8c16":r>=30?k:"#8c8c8c"}function Ce(r){return r==null?null:r<0?e.jsx(y,{color:"default",children:"Closed"}):r<=7?e.jsxs(y,{color:"red",icon:e.jsx(U,{}),children:[r,"d left"]}):r<=14?e.jsxs(y,{color:"orange",icon:e.jsx(de,{}),children:[r,"d left"]}):e.jsxs(y,{color:"green",icon:e.jsx(ge,{}),children:[r,"d left"]})}function Ue(){var H,I,V;const r=Z(),[a,s]=l.useState([]),[i,q]=l.useState(null),[M,$]=l.useState(!0),[T,L]=l.useState(!1),[c,Q]=l.useState({page:1,pages:1,count:0}),[d,z]=l.useState({status:"",sector:"",sort:"relevance"}),[m,C]=l.useState({open:!1,id:null,notes:""}),E=l.useCallback(async()=>{try{const n=await(await fetch(x+"opportunity/stats",{headers:S()})).json();n.success&&q(n.result)}catch{}},[]),p=l.useCallback(async(t=1)=>{$(!0);try{const n=new URLSearchParams({page:t,items:12,sort:d.sort});d.status&&n.set("status",d.status),d.sector&&n.set("sector",d.sector);const o=await(await fetch(x+`opportunity/list?${n}`,{headers:S()})).json();o.success&&(s(o.result),Q(o.pagination))}catch{}$(!1)},[d]);l.useEffect(()=>{E(),p(1)},[p]);const F=async()=>{L(!0);try{(await(await fetch(x+"opportunity/scan",{method:"POST",headers:{...S(),"Content-Type":"application/json"}})).json()).success&&D.info({title:"Scan Started",content:"Scanning eTendering portal... This takes ~2 minutes. Refresh the page shortly."})}catch{}setTimeout(()=>L(!1),5e3)},X=async(t,n)=>{try{await fetch(x+`opportunity/update/${t}`,{method:"PATCH",headers:{...S(),"Content-Type":"application/json"},body:JSON.stringify({status:n})}),s(g=>g.map(o=>o._id===t?{...o,status:n}:o)),E()}catch{}},K=async()=>{try{await fetch(x+`opportunity/update/${m.id}`,{method:"PATCH",headers:{...S(),"Content-Type":"application/json"},body:JSON.stringify({notes:m.notes})}),s(t=>t.map(n=>n._id===m.id?{...n,notes:m.notes}:n)),C({open:!1,id:null,notes:""})}catch{}};return e.jsxs("div",{style:{padding:"24px",maxWidth:1400,margin:"0 auto"},children:[e.jsxs(w,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsxs(O,{children:[e.jsxs(be,{level:2,style:{margin:0,color:h},children:[e.jsx(W,{style:{marginRight:8}}),"Opportunities"]}),e.jsx(f,{type:"secondary",children:"Live tenders from Oman eTendering portal â€” matched to Alali's capabilities"})]}),e.jsx(O,{children:e.jsxs(j,{children:[e.jsx(u,{icon:e.jsx(ue,{}),onClick:()=>{E(),p(1)},children:"Refresh"}),e.jsx(u,{type:"primary",icon:e.jsx(le,{spin:T}),onClick:F,loading:T,style:{backgroundColor:h,borderColor:h},children:"Scan eTendering Now"})]})})]}),i&&e.jsx(w,{gutter:16,style:{marginBottom:24},children:[{title:"Total Opportunities",value:i.total,icon:e.jsx(W,{}),color:h},{title:"High Priority",value:i.highPriority,icon:e.jsx(U,{}),color:"#f5222d"},{title:"Evaluating",value:((H=i.byStatus)==null?void 0:H.evaluating)||0,icon:e.jsx(ee,{}),color:"#fa8c16"},{title:"Bidding",value:((I=i.byStatus)==null?void 0:I.bidding)||0,icon:e.jsx(G,{}),color:"#722ed1"},{title:"Won",value:((V=i.byStatus)==null?void 0:V.won)||0,icon:e.jsx(he,{}),color:k},{title:"New Today",value:i.recentlyAdded||0,icon:e.jsx(Se,{}),color:"#1890ff"}].map(t=>e.jsx(O,{xs:12,sm:8,md:4,children:e.jsx(A,{size:"small",style:{textAlign:"center"},children:e.jsx(ae,{title:t.title,value:t.value,valueStyle:{color:t.color,fontSize:22},prefix:t.icon})})},t.title))}),!M&&a.length===0&&(i==null?void 0:i.total)===0&&e.jsx(se,{type:"info",showIcon:!0,message:"No opportunities loaded yet",description:'Click "Scan eTendering Now" to fetch live tenders from the Oman Tender Board portal. The scan takes ~2 minutes.',style:{marginBottom:24},action:e.jsx(u,{size:"small",type:"primary",onClick:F,loading:T,style:{backgroundColor:h,borderColor:h},children:"Scan Now"})}),e.jsx(A,{size:"small",style:{marginBottom:16},children:e.jsxs(j,{wrap:!0,children:[e.jsx(b,{placeholder:"Filter by sector",allowClear:!0,style:{width:200},value:d.sector||void 0,onChange:t=>z(n=>({...n,sector:t||""})),children:Object.entries(R).filter(([t])=>t!=="unknown").map(([t,n])=>e.jsx(v,{value:t,children:n.label},t))}),e.jsx(b,{placeholder:"Filter by status",allowClear:!0,style:{width:160},value:d.status||void 0,onChange:t=>z(n=>({...n,status:t||""})),children:N.map(t=>e.jsx(v,{value:t.value,children:t.label},t.value))}),e.jsxs(b,{value:d.sort,style:{width:160},onChange:t=>z(n=>({...n,sort:t})),children:[e.jsx(v,{value:"relevance",children:"Sort: Relevance"}),e.jsx(v,{value:"deadline",children:"Sort: Deadline"}),e.jsx(v,{value:"newest",children:"Sort: Newest"})]}),e.jsxs(f,{type:"secondary",children:[c.count," opportunities found"]})]})}),M?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(te,{size:"large"})}):a.length===0?e.jsx(ie,{description:"No opportunities match your filters"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{gutter:[16,16],children:a.map(t=>{var g;const n=R[t.sector]||R.unknown;return N.find(o=>o.value===t.status),e.jsx(O,{xs:24,sm:24,md:12,lg:8,children:e.jsxs(A,{size:"small",style:{height:"100%",borderLeft:`4px solid ${J(t.relevanceScore)}`,borderRadius:8},title:e.jsxs(j,{children:[e.jsx(ne,{title:`Relevance: ${t.relevanceScore}/100`,children:e.jsx(ce,{type:"circle",percent:t.relevanceScore,width:32,strokeColor:J(t.relevanceScore),format:o=>e.jsx("span",{style:{fontSize:9},children:o})})}),e.jsx(y,{color:n.color,children:n.label}),Ce(t.daysLeft)]}),extra:e.jsx(b,{size:"small",value:t.status,style:{width:110},onChange:o=>X(t._id,o),options:N.map(o=>({value:o.value,label:o.label}))}),children:[t.titleEn&&e.jsx(B,{ellipsis:{rows:2},style:{fontWeight:600,marginBottom:2,fontSize:13},children:t.titleEn}),e.jsx(B,{ellipsis:{rows:t.titleEn?1:2},style:{fontWeight:t.titleEn?400:600,fontSize:t.titleEn?11:13,marginBottom:4,direction:"rtl",textAlign:"right",color:t.titleEn?"#888":"inherit"},children:t.titleAr||t.title}),e.jsxs(f,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:2},children:["ðŸ“ ",t.ministryEn||t.ministry]}),t.ministryAr&&t.ministryEn&&e.jsx(f,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:6,direction:"rtl",textAlign:"right",color:"#aaa"},children:t.ministryAr}),t.tenderNo&&e.jsxs(f,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8},children:["TND: ",t.tenderNo]}),((g=t.matchReasons)==null?void 0:g.length)>0&&e.jsx("div",{style:{marginBottom:8},children:t.matchReasons.slice(0,2).map((o,Y)=>e.jsxs(y,{color:"geekblue",style:{marginBottom:4,fontSize:11},children:["âœ“ ",o]},Y))}),t.notes&&e.jsxs(B,{ellipsis:{rows:1},style:{fontSize:12,color:"#666",marginBottom:8},children:["ðŸ“ ",t.notes]}),e.jsxs(j,{style:{marginTop:8},wrap:!0,children:[t.link&&e.jsx(u,{size:"small",icon:e.jsx(me,{}),href:t.link,target:"_blank",rel:"noopener noreferrer",children:"View Tender"}),e.jsx(u,{size:"small",onClick:()=>C({open:!0,id:t._id,notes:t.notes||""}),children:"Notes"}),e.jsx(u,{size:"small",type:"primary",icon:e.jsx(G,{}),onClick:()=>r("/quote/create"),style:{backgroundColor:k,borderColor:k},children:"Create Quote"})]})]})},t._id)})}),c.pages>1&&e.jsx(w,{justify:"center",style:{marginTop:24},children:e.jsxs(j,{children:[e.jsx(u,{disabled:c.page<=1,onClick:()=>p(c.page-1),children:"Previous"}),e.jsxs(f,{children:["Page ",c.page," of ",c.pages]}),e.jsx(u,{disabled:c.page>=c.pages,onClick:()=>p(c.page+1),children:"Next"})]})})]}),e.jsx(D,{title:"Add Notes",open:m.open,onOk:K,onCancel:()=>C({open:!1,id:null,notes:""}),okText:"Save",okButtonProps:{style:{backgroundColor:h,borderColor:h}},children:e.jsx(re.TextArea,{rows:4,value:m.notes,onChange:t=>C(n=>({...n,notes:t.target.value})),placeholder:"Add notes about this opportunity â€” contacts, strategy, requirements..."})})]})}export{Ue as default};
