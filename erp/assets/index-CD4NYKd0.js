import{r as i,j as t}from"./index-DsxgoXaO.js";import{m as f,f as x,h as c,ad as j,T as S}from"./ErpApp-3NZWEkOD.js";import{aB as w,aY as I,aV as T,ac as z}from"./IdurarOs-BmcscLXI.js";import{F as C}from"./Table-B_wqoxqg.js";import{R}from"./ReloadOutlined-CY18iOxY.js";c.extend(j);const{Title:A,Text:n}=I;function O(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const _={create:"green",update:"blue",delete:"red",view:"default",login:"cyan",email_sent:"purple",pdf_generated:"orange",status_change:"gold"},E=["Quote","Invoice","PurchaseOrder","DeliveryNote","CreditNote","Payment","Rfq","InventoryItem","Opportunity"];function Y(){const[r,y]=i.useState([]),[s,p]=i.useState(!1),[u,h]=i.useState({page:1,count:0}),[o,g]=i.useState(""),l=async(e=1)=>{p(!0);const a=new URLSearchParams({page:e,items:50});o&&a.set("entity",o);try{const d=await(await fetch(T+`auditlog/list?${a}`,{headers:O()})).json();d.success&&(y(d.result),h(d.pagination||{}))}finally{p(!1)}};i.useEffect(()=>{l(1)},[o]);const m=[{title:"Time",dataIndex:"created",width:150,render:e=>t.jsx(z,{title:c(e).format("DD MMM YYYY HH:mm:ss"),children:t.jsx(n,{style:{fontSize:11},children:c(e).fromNow()})})},{title:"User",dataIndex:["user","email"],width:180,ellipsis:!0,render:(e,a)=>t.jsx(n,{style:{fontSize:11},children:e||a.userEmail||"â€”"})},{title:"Action",dataIndex:"action",width:110,render:e=>t.jsx(S,{color:_[e]||"default",style:{fontSize:10},children:e==null?void 0:e.toUpperCase().replace("_"," ")})},{title:"Entity",dataIndex:"entity",width:120,render:(e,a)=>t.jsxs("span",{children:[t.jsx(n,{strong:!0,style:{fontSize:11},children:e}),a.entityRef&&t.jsxs(n,{type:"secondary",style:{fontSize:10},children:[" #",a.entityRef]})]})},{title:"Description",dataIndex:"description",ellipsis:!0,render:e=>t.jsx(n,{style:{fontSize:11},children:e||"â€”"})},{title:"IP",dataIndex:"ip",width:110,render:e=>t.jsx(n,{type:"secondary",style:{fontSize:10},children:e||"â€”"})}];return t.jsxs("div",{style:{padding:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx(A,{level:4,style:{margin:0,color:"#034D57"},children:"Audit Log"}),t.jsx(w,{icon:t.jsx(R,{}),onClick:()=>l(1),loading:s,children:"Refresh"})]}),t.jsx(f,{style:{marginBottom:14},wrap:!0,children:t.jsx(x,{placeholder:"Filter by entity",allowClear:!0,style:{width:180},onChange:e=>g(e||""),options:E.map(e=>({value:e,label:e}))})}),r.length===0&&!s&&t.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#aaa"},children:[t.jsx("div",{style:{fontSize:40},children:"ðŸ“‹"}),t.jsx("div",{style:{marginTop:8},children:"No audit logs yet."}),t.jsx("div",{style:{fontSize:12,marginTop:4},children:"Actions like creating, updating, and deleting records will appear here."})]}),(r.length>0||s)&&t.jsx(C,{columns:m,dataSource:r,rowKey:"_id",loading:s,size:"small",pagination:{current:u.page,total:u.count,pageSize:50,onChange:e=>l(e)}})]})}export{Y as default};
