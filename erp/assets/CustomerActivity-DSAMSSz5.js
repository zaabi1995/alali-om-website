import{o as T,m as B,r as n,j as e}from"./index-BJn_oD1P.js";import{aV as E,aN as L,aB as R,aM as q,aL as $,aY as w}from"./IdurarOs-B9KFkIUP.js";import{m as z,T as y,O as I,C as N,c as F,a as _,b as k,g as D,ag as P}from"./ErpApp-D8KMIIKs.js";import{C as h}from"./index-FeqLAMca.js";import{S as U}from"./index-DvT_oepy.js";import{T as j}from"./Timeline-WOcJ7R7U.js";import{A as W}from"./ArrowLeftOutlined-3Yl9C9El.js";import"./Skeleton-CxF7GD-W.js";import"./index-DRV5_-om.js";import"./PlusOutlined-XHDMkaJO.js";const{Title:G,Text:c}=w,S="#034D57",M="#4CB480";function Q(){var o,a;try{const i=(a=(o=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:o.current)==null?void 0:a.token;return i?{Authorization:`Bearer ${i}`}:{}}catch{return{}}}const d={rfq:{icon:e.jsx(F,{}),color:"#1890ff",label:"RFQ"},quote:{icon:e.jsx(_,{}),color:M,label:"Quote"},invoice:{icon:e.jsx(k,{}),color:"#fa8c16",label:"Invoice"},payment:{icon:e.jsx(D,{}),color:"#52c41a",label:"Payment"},po:{icon:e.jsx(P,{}),color:"#722ed1",label:"PO"}},Y={new:"blue",in_progress:"processing",researched:"purple",quoted:"cyan",draft:"default",sent:"processing",approved:"green",paid:"blue",won:"green",lost:"red",expired:"default",overdue:"red"};function oe(){const{id:o}=T(),a=B(),[i,u]=n.useState(!0),[v,C]=n.useState(null),[p,g]=n.useState(null),m=n.useCallback(async()=>{u(!0);try{const r=await(await fetch(`${E}client/activity/${o}`,{headers:Q()})).json();r.success?C(r):g("Failed to load activity")}catch(t){g(t.message)}u(!1)},[o]);if(n.useEffect(()=>{m()},[m]),i)return e.jsx("div",{style:{textAlign:"center",padding:80},children:e.jsx(L,{size:"large"})});if(p)return e.jsx("div",{style:{textAlign:"center",padding:80},children:e.jsx(c,{type:"danger",children:p})});const{result:x=[],client:b={},counts:O={}}=v||{},A=t=>{const r={rfq:`/rfq/${t.id}`,quote:`/quote/read/${t.id}`,invoice:`/invoice/read/${t.id}`,payment:`/payment/read/${t.id}`,po:`/purchase-order/read/${t.id}`};r[t.type]&&a(r[t.type])};return e.jsxs("div",{style:{padding:"24px",maxWidth:1e3,margin:"0 auto"},children:[e.jsx(R,{icon:e.jsx(W,{}),onClick:()=>a("/customer"),style:{marginBottom:16},children:"Back to Clients"}),e.jsxs(G,{level:3,style:{color:S,marginBottom:20},children:[b.name," â€” Activity"]}),e.jsx(q,{gutter:[16,16],style:{marginBottom:24},children:Object.entries(O).map(([t,r])=>{var s,l;return e.jsx($,{xs:12,sm:8,md:4,children:e.jsx(h,{size:"small",style:{borderRadius:8,textAlign:"center"},children:e.jsx(U,{title:t.toUpperCase(),value:r,valueStyle:{color:((s=d[t])==null?void 0:s.color)||S,fontSize:24,fontWeight:800},prefix:(l=d[t])==null?void 0:l.icon})})},t)})}),x.length===0?e.jsx(z,{description:"No activity found for this client"}):e.jsx(h,{style:{borderRadius:12},children:e.jsx(j,{mode:"left",children:x.map((t,r)=>{var f;const s=d[t.type]||d.rfq,l=t.date?new Date(t.date).toLocaleDateString("en-GB",{timeZone:"Asia/Muscat",day:"2-digit",month:"short",year:"numeric"}):"";return e.jsx(j.Item,{color:s.color,dot:e.jsx("span",{style:{fontSize:16},children:s.icon}),children:e.jsxs("div",{style:{cursor:"pointer",padding:"4px 0"},onClick:()=>A(t),children:[e.jsx(y,{color:s.color,style:{fontWeight:600,marginRight:8},children:s.label}),e.jsx(c,{strong:!0,style:{color:"#333"},children:t.summary}),t.status&&e.jsx(y,{color:Y[t.status]||"default",style:{marginLeft:8},children:(f=t.status)==null?void 0:f.replace("_"," ")}),(t.total||t.amount)&&e.jsxs("span",{style:{marginLeft:8,display:"inline-flex",alignItems:"center",gap:3},children:[e.jsx(I,{size:11}),e.jsx(c,{style:{fontWeight:600},children:Number(t.total||t.amount||0).toLocaleString("en-US",{minimumFractionDigits:3})})]}),e.jsx("br",{}),e.jsxs(c,{type:"secondary",style:{fontSize:11},children:[e.jsx(N,{style:{marginRight:4}}),l]})]})},r)})})})]})}export{oe as default};
