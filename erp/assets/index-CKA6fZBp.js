import{r as i,j as e}from"./index-BrmSMSB0.js";import{o as P}from"./omrFormat-CidjQbpz.js";import{b7 as a,aB as o,aM as _,aL as l,a_ as c,aY as B,aZ as d,b4 as M}from"./IdurarOs-BQBNJmBS.js";import{r as y,a8 as $,e as w,T as f}from"./ErpApp-VX7sXUMI.js";import{F as L}from"./Table-BC7b85WN.js";import{M as q}from"./index-CTlTvbVf.js";import{S as J}from"./index-DCc4kxwS.js";import{s as u}from"./index-BKW3ZT6F.js";import{P as R}from"./index-D5quAkUB.js";import{P as U}from"./PlusOutlined-C13xXaIV.js";import{D as Y}from"./DeleteOutlined-CUq-bkxF.js";import"./ActionButton-z5ADh3nj.js";import"./fade-CTXCYOzv.js";const{Title:H}=B;function T(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}function V(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}const K={asset:"blue",liability:"red",equity:"purple",income:"green",expense:"orange",bank:"cyan",receivable:"geekblue",payable:"volcano",tax:"gold"},I=["asset","liability","equity","income","expense","bank","receivable","payable","tax"];function oe(){const[g,v]=i.useState([]),[E,b]=i.useState(!1),[m,F]=i.useState(""),[k,S]=i.useState(!1),[r,A]=i.useState(null),[p]=a.useForm(),h=async()=>{b(!0);const t=m?`?type=${m}`:"?active=all",s=await fetch(d+`account/list${t}`,{headers:T()}).then(n=>n.json()).catch(()=>({}));s.success&&v(s.result||[]),b(!1)};i.useEffect(()=>{h()},[m]);const C=(t=null)=>{A(t),p.setFieldsValue(t?{...t}:{isSystem:!1,isActive:!0}),S(!0)},x=()=>{S(!1),p.resetFields(),A(null)},D=async t=>{const s=r?d+`account/update/${r._id}`:d+"account/create",n=await fetch(s,{method:r?"PATCH":"POST",headers:V(),body:JSON.stringify(t)}).then(O=>O.json()).catch(()=>({}));n.success?(u.success(r?"Updated":"Created"),x(),h()):u.error(n.message||"Failed")},z=async t=>{const s=await fetch(d+`account/delete/${t}`,{method:"DELETE",headers:T()}).then(n=>n.json()).catch(()=>({}));s.success?(u.success("Deleted"),h()):u.error(s.message||"Cannot delete system account")},j={};(g||[]).forEach(t=>{j[t.type]||(j[t.type]=[]),j[t.type].push(t)});const N=[{title:"Code",dataIndex:"code",width:80,sorter:(t,s)=>t.code.localeCompare(s.code)},{title:"Account Name",dataIndex:"name",ellipsis:!0,render:(t,s)=>e.jsxs(e.Fragment,{children:[e.jsx("b",{style:{color:"#034D57"},children:t}),s.isSystem&&e.jsx(f,{size:"small",style:{marginLeft:6,fontSize:10},children:"SYSTEM"})]})},{title:"Arabic Name",dataIndex:"nameAr",render:t=>e.jsx("span",{style:{fontFamily:"Tajawal, Arial",direction:"rtl"},children:t||"—"})},{title:"Type",dataIndex:"type",width:100,render:t=>e.jsx(f,{color:K[t],children:t})},{title:"Sub-Type",dataIndex:"subType",width:120,render:t=>(t==null?void 0:t.replace(/_/g," "))||"—"},{title:"Balance",dataIndex:"balance",align:"right",render:t=>P(t)},{title:"Active",dataIndex:"isActive",width:60,render:t=>e.jsx(f,{color:t?"green":"default",children:t?"✓":"✗"})},{title:"",width:70,render:(t,s)=>e.jsxs(y,{children:[e.jsx(o,{size:"small",icon:e.jsx(M,{}),onClick:()=>C(s)}),!s.isSystem&&e.jsx(R,{title:"Delete?",onConfirm:()=>z(s._id),children:e.jsx(o,{size:"small",danger:!0,icon:e.jsx(Y,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(y,{children:[e.jsx($,{style:{color:"#034D57",fontSize:20}}),e.jsx(H,{level:4,style:{margin:0,color:"#034D57"},children:"Chart of Accounts"})]}),e.jsx(o,{type:"primary",icon:e.jsx(U,{}),onClick:()=>C(),style:{background:"#034D57"},children:"Add Account"})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(w,{placeholder:"Filter by type",allowClear:!0,style:{width:160},onChange:t=>F(t||""),options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})}),e.jsx(L,{columns:N,dataSource:g,rowKey:"_id",loading:E,size:"small",rowClassName:t=>t.isActive?"":"row-inactive",pagination:{pageSize:50,showSizeChanger:!1}}),e.jsx(q,{title:r?`Edit: ${r.name}`:"New Account",open:k,onCancel:x,footer:null,width:580,children:e.jsxs(a,{form:p,layout:"vertical",onFinish:D,children:[e.jsxs(_,{gutter:12,children:[e.jsx(l,{xs:8,children:e.jsx(a.Item,{name:"code",label:"Account Code",rules:[{required:!0}],children:e.jsx(c,{placeholder:"e.g. 4100"})})}),e.jsx(l,{xs:16,children:e.jsx(a.Item,{name:"name",label:"Account Name",rules:[{required:!0}],children:e.jsx(c,{})})}),e.jsx(l,{xs:24,children:e.jsx(a.Item,{name:"nameAr",label:"Arabic Name",children:e.jsx(c,{style:{direction:"rtl",fontFamily:"Tajawal, Arial"}})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"type",label:"Type",rules:[{required:!0}],children:e.jsx(w,{options:I.map(t=>({value:t,label:t.charAt(0).toUpperCase()+t.slice(1)}))})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"subType",label:"Sub-Type",children:e.jsx(c,{placeholder:"e.g. current_asset"})})}),e.jsx(l,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(c.TextArea,{rows:2})})}),e.jsx(l,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(J,{})})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(y,{children:[e.jsx(o,{onClick:x,children:"Cancel"}),e.jsx(o,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{oe as default};
