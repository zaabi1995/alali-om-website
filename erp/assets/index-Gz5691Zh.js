import{m as O,o as P,r as d,j as e}from"./index-DllBwakO.js";import{b as _}from"./omrFormat-DH5IRqNB.js";import{d as S}from"./dayjs.min-DaZr1Ooh.js";import{b7 as s,aZ as o,aB as m,aM as T,aL as a,a_ as j,aY as N}from"./IdurarOs-hlQABX05.js";import{C as B}from"./index-CyWvGQBP.js";import{e as p,r as k}from"./ErpApp-8JV0hddW.js";import{D as y}from"./index-DudeiCKw.js";import{T as E}from"./index-B5nW5caG.js";import{s as h}from"./index-C3qVZkcK.js";import{A as R}from"./ArrowLeftOutlined-CYTR_b6m.js";import{S as F}from"./SaveOutlined-BYa1UFLy.js";import"./Skeleton-CN3Ugn-J.js";import"./index-C1pYz5Qc.js";import"./PlusOutlined-DpixQtx6.js";import"./ClockCircleOutlined-BcAAxwsC.js";const{Title:L}=N,{TextArea:b}=j;function $(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`,"Content-Type":"application/json"}}function C(){return{Authorization:`Bearer ${((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token}`}}const J=["defense","aviation","oil_gas","construction","renewable_energy","marine","logistics","health_safety","printing","other"];function se(){const i=O(),{id:n}=P(),[u]=s.useForm(),[D,w]=d.useState([]),[I,x]=d.useState(!1);d.useEffect(()=>{fetch(o+"client/listAll",{headers:C()}).then(t=>t.json()).then(t=>t.result&&w(t.result)).catch(()=>{}),n&&fetch(o+`project/read/${n}`,{headers:C()}).then(t=>t.json()).then(t=>{var r;if(t.success&&t.result){const l=t.result;u.setFieldsValue({...l,startDate:l.startDate?S(l.startDate):null,endDate:l.endDate?S(l.endDate):null,client:((r=l.client)==null?void 0:r._id)||l.client})}}).catch(()=>{})},[n]);const v=async t=>{var g,f;x(!0);const r={...t,startDate:(g=t.startDate)==null?void 0:g.toISOString(),endDate:(f=t.endDate)==null?void 0:f.toISOString()},l=n?o+`project/update/${n}`:o+"project/create";try{const c=await fetch(l,{method:n?"PATCH":"POST",headers:$(),body:JSON.stringify(r)}).then(A=>A.json());c.success?(h.success("Saved"),i(`/projects/read/${c.result._id}`)):h.error(c.message||"Failed")}catch{h.error("Network error")}finally{x(!1)}};return e.jsxs("div",{style:{padding:24,maxWidth:760},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[e.jsx(m,{icon:e.jsx(R,{}),onClick:()=>i("/projects")}),e.jsx(L,{level:4,style:{margin:0,color:"#034D57"},children:n?"Edit Project":"New Project"})]}),e.jsxs(s,{form:u,layout:"vertical",onFinish:v,children:[e.jsx(B,{title:"Project Details",size:"small",style:{marginBottom:16},children:e.jsxs(T,{gutter:16,children:[e.jsx(a,{xs:24,sm:8,children:e.jsx(s.Item,{name:"code",label:"Project Code",children:e.jsx(j,{placeholder:"e.g. RAFO-2026-001"})})}),e.jsx(a,{xs:24,sm:16,children:e.jsx(s.Item,{name:"name",label:"Project Name",rules:[{required:!0}],children:e.jsx(j,{})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"client",label:"Client",children:e.jsx(p,{showSearch:!0,allowClear:!0,filterOption:(t,r)=>r.label.toLowerCase().includes(t.toLowerCase()),placeholder:"Select client",options:D.map(t=>({value:t._id,label:t.name}))})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"sector",label:"Sector",children:e.jsx(p,{placeholder:"Select sector",allowClear:!0,options:J.map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"startDate",label:"Start Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(a,{xs:12,sm:6,children:e.jsx(s.Item,{name:"endDate",label:"End Date",children:e.jsx(y,{style:{width:"100%"}})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"budgetOMR",label:"Budget (OMR)",initialValue:0,children:e.jsx(E,{min:0,precision:3,style:{width:"100%"},addonAfter:_()})})}),e.jsx(a,{xs:24,sm:12,children:e.jsx(s.Item,{name:"status",label:"Status",initialValue:"prospect",children:e.jsx(p,{options:["prospect","active","on_hold","completed","cancelled"].map(t=>({value:t,label:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}))})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(b,{rows:3})})}),e.jsx(a,{xs:24,children:e.jsx(s.Item,{name:"notes",label:"Notes",children:e.jsx(b,{rows:2})})})]})}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(k,{children:[e.jsx(m,{onClick:()=>i("/projects"),children:"Cancel"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:I,icon:e.jsx(F,{}),style:{background:"#034D57"},children:"Save Project"})]})})]})]})}export{se as default};
