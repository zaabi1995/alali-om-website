import{r as i,j as e}from"./index-CyT0g67B.js";import{o as z}from"./omrFormat-adc6t2SR.js";import{aG as a,ai as c,aD as l,aM as U,aA as _,aB as s,ar as L,ay as m,aw as $}from"./IdurarOs-CoqKtLRd.js";import{l as g}from"./ErpApp-n-sDWNhY.js";import{S as f}from"./index-C33Svftv.js";import{F as H}from"./Table-CMJN-8Gn.js";import{M as q}from"./index-CXhEjtWF.js";import{T as b}from"./index-PHiq-IdS.js";import{S as T}from"./index-wMXea0O0.js";import{s as S}from"./index-CSjDvpTZ.js";import{T as A}from"./index-xZM8wvuw.js";import{P as G}from"./index-B4xX700u.js";import{P as J}from"./PlusOutlined-CsTGChi8.js";import{D as Y}from"./DeleteOutlined-Cj9hpv5Q.js";import"./pickAttrs-CO3lP972.js";import"./DownOutlined-C1w3tzOL.js";import"./ActionButton-CZ1WJjCn.js";import"./useClosable-D0kOyM-I.js";import"./fade-Cap0Kps1.js";const{Title:K}=L;function N(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function W(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`,"Content-Type":"application/json"}}const Q={product:"blue",service:"green",part:"orange"};function ye(){const[E,D]=i.useState([]),[O,I]=i.useState(!1),[P,k]=i.useState({page:1,count:0}),[u,M]=i.useState(""),[x,v]=i.useState(""),[R,w]=i.useState(!1),[o,C]=i.useState(null),[h]=a.useForm(),d=async(t=1)=>{I(!0);const r=new URLSearchParams({page:t,items:30});u&&r.set("type",u),x&&r.set("q",x);const n=await fetch(m+`product/list?${r}`,{headers:N()}).then(y=>y.json()).catch(()=>({}));n.success&&(D(n.result),k(n.pagination||{})),I(!1)};i.useEffect(()=>{d(1)},[u,x]);const p=(t=null)=>{C(t),h.setFieldsValue(t?{...t}:{type:"product",taxRate:5,unit:"EA",currency:"OMR",taxable:!0,isActive:!0}),w(!0)},j=()=>{w(!1),h.resetFields(),C(null)},F=async t=>{const r=o?m+`product/update/${o._id}`:m+"product/create",n=await fetch(r,{method:o?"PATCH":"POST",headers:W(),body:JSON.stringify(t)}).then(y=>y.json()).catch(()=>({}));n.success?(S.success(o?"Updated":"Created"),j(),d(1)):S.error(n.message||"Failed")},V=async t=>{await fetch(m+`product/delete/${t}`,{method:"DELETE",headers:N()}),S.success("Deleted"),d(1)},B=[{title:"Code",dataIndex:"code",width:90,render:t=>t||"—"},{title:"Name",dataIndex:"name",ellipsis:!0,render:(t,r)=>e.jsx("a",{onClick:()=>p(r),style:{color:"#034D57",fontWeight:600},children:t})},{title:"Part #",dataIndex:"partNumber",width:110,render:t=>t?e.jsx("code",{style:{fontSize:11},children:t}):"—"},{title:"NSN",dataIndex:"nsn",width:110,render:t=>t||"—"},{title:"Type",dataIndex:"type",width:80,render:t=>e.jsx(A,{color:Q[t],children:t})},{title:"Sale Price",dataIndex:"salePrice",align:"right",render:t=>z(t)},{title:"Unit",dataIndex:"unit",width:60,render:t=>t||"EA"},{title:"Active",dataIndex:"isActive",width:70,render:t=>e.jsx(A,{color:t?"green":"default",children:t?"Yes":"No"})},{title:"",width:70,render:(t,r)=>e.jsxs(g,{children:[e.jsx(c,{size:"small",icon:e.jsx($,{}),onClick:()=>p(r)}),e.jsx(G,{title:"Delete?",onConfirm:()=>V(r._id),children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(Y,{})})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(K,{level:4,style:{margin:0,color:"#034D57"},children:"Products & Services"}),e.jsx(c,{type:"primary",icon:e.jsx(J,{}),onClick:()=>p(),style:{background:"#034D57"},children:"Add Item"})]}),e.jsxs(g,{style:{marginBottom:12},wrap:!0,children:[e.jsx(l,{placeholder:"Search name, part #, NSN...",prefix:e.jsx(U,{}),allowClear:!0,style:{width:240},onPressEnter:t=>v(t.target.value),onChange:t=>!t.target.value&&v("")}),e.jsx(f,{placeholder:"Type",allowClear:!0,style:{width:120},onChange:t=>M(t||""),options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})]}),e.jsx(H,{columns:B,dataSource:E,rowKey:"_id",loading:O,size:"small",pagination:{current:P.page,total:P.count,pageSize:30,onChange:t=>d(t)}}),e.jsx(q,{title:o?"Edit Product":"New Product / Service",open:R,onCancel:j,footer:null,width:680,children:e.jsxs(a,{form:h,layout:"vertical",onFinish:F,children:[e.jsxs(_,{gutter:12,children:[e.jsx(s,{xs:24,sm:16,children:e.jsx(a.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"code",label:"Internal Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"partNumber",label:"Part Number",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"nsn",label:"NSN",children:e.jsx(l,{placeholder:"NATO Stock Number"})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"type",label:"Type",initialValue:"product",children:e.jsx(f,{options:[{value:"product",label:"Product"},{value:"service",label:"Service"},{value:"part",label:"Part"}]})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"unit",label:"Unit",initialValue:"EA",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:8,children:e.jsx(a.Item,{name:"currency",label:"Currency",initialValue:"OMR",children:e.jsx(f,{options:["OMR","USD","EUR","GBP","AED"].map(t=>({value:t,label:t}))})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"salePrice",label:"Sale Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"costPrice",label:"Cost Price",initialValue:0,children:e.jsx(b,{min:0,precision:3,style:{width:"100%"}})})}),e.jsx(s,{xs:12,sm:8,children:e.jsx(a.Item,{name:"taxRate",label:"VAT %",initialValue:5,children:e.jsx(b,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"manufacturer",label:"Manufacturer",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"hsCode",label:"HS Code",children:e.jsx(l,{})})}),e.jsx(s,{xs:24,sm:12,children:e.jsx(a.Item,{name:"category",label:"Category",children:e.jsx(l,{placeholder:"e.g. Aviation Parts"})})}),e.jsx(s,{xs:24,children:e.jsx(a.Item,{name:"description",label:"Description",children:e.jsx(l.TextArea,{rows:2})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"taxable",label:"Taxable",valuePropName:"checked",initialValue:!0,children:e.jsx(T,{})})}),e.jsx(s,{xs:12,children:e.jsx(a.Item,{name:"isActive",label:"Active",valuePropName:"checked",initialValue:!0,children:e.jsx(T,{})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:8},children:e.jsxs(g,{children:[e.jsx(c,{onClick:j,children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",style:{background:"#034D57"},children:"Save"})]})})]})})]})}export{ye as default};
