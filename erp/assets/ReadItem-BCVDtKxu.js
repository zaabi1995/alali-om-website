import{r as l,n as U,m as J,u as Q,j as e}from"./index-BJn_oD1P.js";import{P as X}from"./index-B4bABjRq.js";import{O as G,g as K,b8 as c,aB as x,b6 as Z,aS as ee,b5 as te,aM as v,aW as S,aL as a,aX as N,aU as se,aV as I}from"./IdurarOs-B9KFkIUP.js";import{e as A}from"./actions-BTh9aIOf.js";import{s as p}from"./index-KrFx5yLV.js";import{c as re}from"./selectors-CfGAJljn.js";import{u as k}from"./useMoney-I41lLEc2.js";import{F as ne,S as ae,f as oe}from"./ErpApp-D8KMIIKs.js";import{u as ie}from"./useMail-Bnj5o0zK.js";import{S as w}from"./index-DvT_oepy.js";import{D as C}from"./index-BNO6rdwb.js";import{M as F}from"./index-DIJZd9a_.js";import{D as le}from"./index-B4Fnp3iN.js";import{s as j}from"./index-DeAJXS45.js";import{E as ce}from"./ExclamationCircleOutlined-HEH7zRPW.js";import{C as de}from"./CloseCircleOutlined-BY87jS8Y.js";var ue={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},me=function(d,s){return l.createElement(G,K({},d,{ref:s,icon:ue}))};const he=l.forwardRef(me);function E(){const o=((JSON.parse(localStorage.getItem("auth"))||{}).current||{}).token;return o?{Authorization:`Bearer ${o}`}:{}}const xe=({item:o,currentErp:d})=>{const{moneyFormatter:s}=k();return e.jsxs(v,{gutter:[12,0],children:[e.jsxs(a,{className:"gutter-row",span:11,children:[e.jsx("p",{style:{marginBottom:5},children:e.jsx("strong",{children:o.itemName})}),e.jsx("p",{children:o.description})]}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:s({amount:o.price,currency_code:d.currency})})}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:o.quantity})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{style:{textAlign:"right",fontWeight:"700"},children:s({amount:o.total,currency_code:d.currency})})}),e.jsx(S,{dashed:!0,style:{marginTop:0,marginBottom:15}})]},o._id)};function Ie({config:o,selectedItem:d}){const s=se(),{entity:i,ENTITY_NAME:P}=o,_=U(),g=J(),{moneyFormatter:u}=k(),{send:D,isLoading:L}=ie({entity:i}),{result:y}=Q(re),$={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[R,b]=l.useState([]),[t,O]=l.useState(d??$),[m,M]=l.useState({}),[V,T]=l.useState(!1),[B,q]=l.useState([]),[f]=c.useForm(),Y=()=>{if(!m.email){j.error("Client has no email address");return}F.confirm({title:"Send Email",icon:e.jsx(ce,{}),content:e.jsxs("div",{children:[e.jsxs("p",{children:["Send ",e.jsxs("strong",{children:[P," #",t.number,"/",t.year||""]})," to:"]}),e.jsx("p",{children:e.jsx("strong",{children:m.name})}),e.jsx("p",{children:m.email}),e.jsx("p",{style:{marginTop:12,fontSize:"12px",color:"#666"},children:"CC: ali@alali.om"})]}),okText:"Send Email",cancelText:"Cancel",onOk:()=>{D(t._id)}})},z=async()=>{try{const n=await(await fetch(I+"vendor/listAll",{headers:E()})).json();n.success&&q(n.result||[])}catch(r){console.error("Failed to load vendors",r)}},H=async()=>{if(t.converted){j.warning("This quote has already been converted");return}await z(),T(!0)},W=async r=>{try{const h=await(await fetch(I+`purchaseorder/convert-from-quote/${t._id}`,{method:"POST",headers:{...E(),"Content-Type":"application/json"},body:JSON.stringify(r)})).json();h.success?(j.success(h.message||"Purchase Order created successfully"),T(!1),f.resetFields(),g(`/purchase-order/read/${h.result._id}`)):j.error(h.message||"Failed to create PO")}catch(n){j.error("Error creating Purchase Order"),console.error(n)}};return l.useEffect(()=>{if(y){const{items:r,invoice:n,...h}=y;r?(b(r),O(y)):n.items&&(b(n.items),O({...n.items,...h,...n}))}return()=>{b([]),O($)}},[y]),l.useEffect(()=>{t!=null&&t.client&&M(t.client)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(X,{onBack:()=>{g(`/${i.toLowerCase()}`)},title:`${P} # ${t.number}/${t.year||""}`,ghost:!1,tags:[e.jsx("span",{children:t.status&&s(t.status)},"status"),t.paymentStatus&&e.jsx("span",{children:t.paymentStatus&&s(t.paymentStatus)},"paymentStatus")],extra:[e.jsx(x,{onClick:()=>{g(`/${i.toLowerCase()}`)},icon:e.jsx(de,{}),children:s("Close")},`${p.generate()}`),e.jsx(x,{onClick:()=>{window.open(`${Z}${i}/${i}-${t._id}.pdf`,"_blank")},icon:e.jsx(ne,{}),children:s("Download PDF")},`${p.generate()}`),e.jsx(x,{loading:L,onClick:Y,icon:e.jsx(ee,{}),children:s("Send by Email")},`${p.generate()}`),e.jsx(x,{onClick:()=>{_(A.convert({entity:i,id:t._id}))},icon:e.jsx(he,{}),style:{display:i==="quote"?"inline-block":"none"},children:s("Convert to Invoice")},`${p.generate()}`),e.jsx(x,{onClick:H,icon:e.jsx(ae,{}),style:{display:i==="quote"?"inline-block":"none"},children:s("Convert to PO")},`${p.generate()}`),e.jsx(x,{onClick:()=>{_(A.currentAction({actionType:"update",data:t})),g(`/${i.toLowerCase()}/update/${t._id}`)},type:"primary",icon:e.jsx(te,{}),children:s("Edit")},`${p.generate()}`)],style:{padding:"20px 0px"},children:e.jsxs(v,{children:[e.jsx(w,{title:"Status",value:t.status}),e.jsx(w,{title:s("SubTotal"),value:u({amount:t.subTotal,currency_code:t.currency}),style:{margin:"0 32px"}}),e.jsx(w,{title:s("Total"),value:u({amount:t.total,currency_code:t.currency}),style:{margin:"0 32px"}}),e.jsx(w,{title:s("Paid"),value:u({amount:t.credit,currency_code:t.currency}),style:{margin:"0 32px"}})]})}),e.jsx(S,{dashed:!0}),e.jsxs(C,{title:`Client : ${t.client.name}`,children:[e.jsx(C.Item,{label:s("Address"),children:m.address}),e.jsx(C.Item,{label:s("email"),children:m.email}),e.jsx(C.Item,{label:s("Phone"),children:m.phone})]}),e.jsx(S,{}),e.jsxs(v,{gutter:[12,0],children:[e.jsx(a,{className:"gutter-row",span:11,children:e.jsx("p",{children:e.jsx("strong",{children:s("Product")})})}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Price")})})}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Quantity")})})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{style:{textAlign:"right"},children:e.jsx("strong",{children:s("Total")})})}),e.jsx(S,{})]}),R.map(r=>e.jsx(xe,{item:r,currentErp:t},r._id)),e.jsx("div",{style:{width:"300px",float:"right",textAlign:"right",fontWeight:"700"},children:e.jsxs(v,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Sub Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:12,children:e.jsx("p",{children:u({amount:t.subTotal,currency_code:t.currency})})}),e.jsx(a,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Tax Total")," (",t.taxRate," %) :"]})}),e.jsx(a,{className:"gutter-row",span:12,children:e.jsx("p",{children:u({amount:t.taxTotal,currency_code:t.currency})})}),e.jsx(a,{className:"gutter-row",span:12,children:e.jsxs("p",{children:[s("Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:12,children:e.jsx("p",{children:u({amount:t.total,currency_code:t.currency})})})]})}),e.jsx(F,{title:"Convert Quote to Purchase Order",open:V,onCancel:()=>{T(!1),f.resetFields()},onOk:()=>f.submit(),okText:"Create PO",width:600,children:e.jsxs(c,{form:f,layout:"vertical",onFinish:W,children:[e.jsx(c.Item,{name:"vendor",label:"Vendor",rules:[{required:!0,message:"Please select a vendor"}],children:e.jsx(oe,{placeholder:"Select vendor",showSearch:!0,optionFilterProp:"children",filterOption:(r,n)=>((n==null?void 0:n.label)??"").toLowerCase().includes(r.toLowerCase()),options:B.map(r=>({value:r._id,label:r.companyName}))})}),e.jsx(c.Item,{name:"deliveryDate",label:"Requested Delivery Date",children:e.jsx(le,{style:{width:"100%"},format:"YYYY-MM-DD"})}),e.jsx(c.Item,{name:"incoterms",label:"Incoterms",initialValue:"FCA",children:e.jsx(N,{placeholder:"e.g., FCA, FOB, CIF"})}),e.jsx(c.Item,{name:"paymentTerms",label:"Payment Terms",initialValue:"Net 30",children:e.jsx(N,{placeholder:"e.g., Net 30, Net 60"})}),e.jsx(c.Item,{name:"notes",label:"Notes",children:e.jsx(N.TextArea,{rows:3,placeholder:"Additional notes or instructions"})})]})})]})}export{Ie as R};
