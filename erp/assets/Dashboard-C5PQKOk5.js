import{r as h,j as e,m as E,n as V,u as M}from"./index-5ITuoeVY.js";import{u as _}from"./useMoney-B8y42MbY.js";import{D as W,E as q,s as N,F as K,C as X,a as k,B as L,S as Z,T as G,b as J}from"./ErpApp-CTwOYhrl.js";import{X as Y,b as ee,av as te,aw as ie,am as se,ax as oe,at as P,ay as R,az as O,aA as S,aB as j,ai as ne,ar as ae,aC as Q}from"./IdurarOs-2NdJjWBV.js";import{u as le}from"./useFetch-CofGxbKO.js";import{e as I}from"./actions-CuuVq9zK.js";import{F as re}from"./FilePdfOutlined-tN53kSoV.js";import{F as ce}from"./Table-CyRZwroC.js";import{C as de}from"./CheckCircleOutlined-B9NkHmHZ.js";import{C as H}from"./index-DRtkgJqY.js";import"./pickAttrs-BIVrBSXA.js";import"./index-BnwwbmUc.js";import"./DownOutlined-D9fXyake.js";import"./Skeleton-DvXqHqzH.js";import"./index-D4F4D2Tf.js";import"./PlusOutlined-CxDzqDnz.js";var ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M193 796c0 17.7 14.3 32 32 32h574c17.7 0 32-14.3 32-32V563c0-176.2-142.8-319-319-319S193 386.8 193 563v233zm72-233c0-136.4 110.6-247 247-247s247 110.6 247 247v193H404V585c0-5.5-4.5-10-10-10h-44c-5.5 0-10 4.5-10 10v171h-75V563zm-48.1-252.5l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3l-67.9-67.9a8.03 8.03 0 00-11.3 0l-39.6 39.6a8.03 8.03 0 000 11.3l67.9 67.9c3.1 3.1 8.1 3.1 11.3 0zm669.6-79.2l-39.6-39.6a8.03 8.03 0 00-11.3 0l-67.9 67.9a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l67.9-67.9c3.1-3.2 3.1-8.2 0-11.3zM832 892H192c-17.7 0-32 14.3-32 32v24c0 4.4 3.6 8 8 8h688c4.4 0 8-3.6 8-8v-24c0-17.7-14.3-32-32-32zM484 180h56c4.4 0 8-3.6 8-8V76c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v96c0 4.4 3.6 8 8 8z"}}]},name:"alert",theme:"outlined"},he=function(s,t){return h.createElement(Y,ee({},s,{ref:t,icon:ue}))};const me=h.forwardRef(he);function A({...o}){const s=se();let{entity:t,dataTableColumns:r}=o;const n=[{label:s("Show"),key:"read",icon:e.jsx(te,{})},{label:s("Edit"),key:"edit",icon:e.jsx(ie,{})},{label:s("Download"),key:"download",icon:e.jsx(re,{})}],c=E(),a=V(),C=l=>{a(I.currentItem({data:l})),c(`/${t}/read/${l._id}`)},m=l=>{a(I.currentAction({actionType:"update",data:l})),c(`/${t}/update/${l._id}`)},d=l=>{window.open(`${oe}${t}/${t}-${l._id}.pdf`,"_blank")};r=[...r,{title:"",key:"action",render:(l,p)=>e.jsx(W,{menu:{items:n,onClick:({key:g})=>{switch(g){case"read":C(p);break;case"edit":m(p);break;case"download":d(p);break}}},trigger:["click"],children:e.jsx(q,{style:{cursor:"pointer",fontSize:"24px"},onClick:g=>g.preventDefault()})})}];const y=()=>P.list({entity:t}),{result:b,isLoading:x,isSuccess:v}=le(y),z=()=>v&&b?b.slice(0,5):[];return e.jsx(ce,{columns:r,rowKey:l=>l._id,dataSource:v&&z(),pagination:!1,loading:x,scroll:{x:!0}})}const xe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20id='Layer_1'%20data-name='Layer%201'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20741.36%20415.06'%3e%3cg%20id='RHhDp6'%3e%3cpath%20d='M259.9,219.89c-.63-49.2,11.44-95.41,35.76-137.75C331.7,19.4,371.24-.36,439.78,34.99c10.67,5.5,53.6,35.43,57.81,44.54,5.03,10.87-27.48,103.87-29.11,122.3-34.69-37.51-99.37-98.66-154.85-69.62-45.05,23.58-12.02,62.54,11.46,87.68h406.25l-39.14,70.23-289.2-2c-1.11,4.66.87,3.3,2.53,4.6,12.44,9.72,80.97,31.54,94.75,31.54l172.05,1.99-39.49,71.25H10.03l39.24-71.24h272.14l-37.11-36.13H69.33l39.23-70.23h151.33Z'/%3e%3c/g%3e%3c/svg%3e";function U({size:o=14,color:s="currentColor",style:t={},className:r=""}){return e.jsx("img",{src:xe,alt:"OMR",className:r,style:{width:o*1.8,height:o,display:"inline-block",verticalAlign:"middle",filter:s==="currentColor"?"brightness(0)":"brightness(0) saturate(0)",opacity:1,...t}})}const{Title:f,Text:Le}=ae;function $(){return{Authorization:`Bearer ${localStorage.getItem("x-auth-token")}`}}function u({icon:o,label:s,value:t,color:r,subtitle:n,loading:c,onClick:a}){return e.jsx(j,{xs:12,sm:8,md:6,lg:4,children:e.jsxs(H,{onClick:a,style:{borderRadius:10,border:`1px solid ${r}22`,cursor:a?"pointer":"default",transition:"box-shadow 0.2s"},bodyStyle:{padding:"14px 12px",textAlign:"center"},hoverable:!!a,children:[e.jsx("div",{style:{fontSize:24,color:r,marginBottom:4},children:o}),c?e.jsx(Q,{size:"small"}):e.jsx("div",{style:{fontSize:24,fontWeight:800,color:"#034D57",lineHeight:1},children:(t==null?void 0:t.toLocaleString())??"—"}),e.jsx("div",{style:{fontSize:12,color:"#555",marginTop:3,fontWeight:600},children:s}),n&&e.jsx("div",{style:{fontSize:11,color:"#aaa",marginTop:1},children:n})]})})}function w({title:o,value:s,subtitle:t,loading:r,color:n="#034D57"}){_(),M(N);const c=!r&&s!==void 0?Number(s||0).toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):null;return e.jsx(j,{xs:12,sm:12,md:6,lg:6,children:e.jsxs(H,{style:{borderRadius:10,borderLeft:`3px solid ${n}`},bodyStyle:{padding:"14px 16px"},children:[e.jsx("div",{style:{fontSize:12,color:"#888",fontWeight:600,marginBottom:6},children:o}),r?e.jsx(Q,{size:"small"}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:7},children:[e.jsx(U,{size:14,style:{filter:"brightness(0) saturate(100%) invert(20%) sepia(60%) saturate(400%) hue-rotate(160deg)"}}),e.jsx("span",{style:{fontSize:20,fontWeight:800,color:n,fontVariantNumeric:"tabular-nums"},children:c??"0.000"})]}),e.jsx("div",{style:{fontSize:11,color:"#aaa",marginTop:2},children:t})]})})}function pe(){var B,F;_();const o=E(),s=M(N),[t,r]=h.useState(null),[n,c]=h.useState(!0),[a,C]=h.useState(null);h.useEffect(()=>{fetch(R+"rfq/stats",{headers:$()}).then(i=>i.json()).then(i=>{i.success&&r(i.result)}).catch(()=>{}).finally(()=>c(!1)),fetch(R+"opportunity/stats",{headers:$()}).then(i=>i.json()).then(i=>{i.success&&C(i.result)}).catch(()=>{})},[]);const m=async({entity:i,currency:T})=>P.summary({entity:i,options:{currency:T}}),{result:d,isLoading:y,onFetch:b}=O(),{result:x,isLoading:v,onFetch:z}=O(),{result:l,isLoading:p,onFetch:g}=O();h.useEffect(()=>{const i=(s==null?void 0:s.default_currency_code)||"OMR";b(m({entity:"invoice",currency:i})),z(m({entity:"quote",currency:i})),g(m({entity:"payment",currency:i}))},[s==null?void 0:s.default_currency_code]);const D=[{title:"#",dataIndex:"number",width:70},{title:"Client",dataIndex:["client","name"],ellipsis:!0},{title:"Total",dataIndex:"total",align:"right",render:(i,T)=>e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,fontSize:12},children:[e.jsx(U,{size:10}),Number(i||0).toLocaleString("en-US",{minimumFractionDigits:3})]})},{title:"Status",dataIndex:"status",width:90,render:i=>e.jsx("span",{style:{fontSize:12,textTransform:"capitalize"},children:i})}];return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(f,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Quick Actions"}),e.jsx(S,{gutter:[12,12],children:[{label:"New Quote",icon:e.jsx(K,{}),color:"#034D57",path:"/quote/create"},{label:"New Invoice",icon:e.jsx(X,{}),color:"#4CB480",path:"/invoice/create"},{label:"View RFQs",icon:e.jsx(k,{}),color:"#1890ff",path:"/rfq"},{label:"Opportunities",icon:e.jsx(L,{}),color:"#fa8c16",path:"/opportunities"}].map(i=>e.jsx(j,{xs:12,sm:6,children:e.jsx(ne,{block:!0,icon:i.icon,onClick:()=>o(i.path),style:{height:52,borderRadius:8,borderColor:i.color,color:i.color,fontWeight:600,fontSize:13},children:i.label})},i.label))})]}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx(f,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Procurement"}),e.jsxs(S,{gutter:[12,12],children:[e.jsx(u,{icon:e.jsx(k,{}),label:"Total RFQs",value:t==null?void 0:t.total,color:"#034D57",loading:n,onClick:()=>o("/rfq")}),e.jsx(u,{icon:e.jsx(Z,{}),label:"Active",value:t==null?void 0:t.active,color:"#1890ff",subtitle:"open RFQs",loading:n,onClick:()=>o("/rfq?status=new,in_progress,researched")}),e.jsx(u,{icon:e.jsx(me,{}),label:"IOR",value:(B=t==null?void 0:t.byPriority)==null?void 0:B.ior,color:"#ff4d4f",subtitle:"priority",loading:n,onClick:()=>o("/rfq?priority=ior")}),e.jsx(u,{icon:e.jsx(de,{}),label:"Quoted",value:(F=t==null?void 0:t.byStatus)==null?void 0:F.quoted,color:"#52c41a",loading:n,onClick:()=>o("/rfq?status=quoted")}),e.jsx(u,{icon:e.jsx(G,{}),label:"Suppliers",value:t==null?void 0:t.totalVendors,color:"#4CB480",loading:n,onClick:()=>o("/suppliers")}),e.jsx(u,{icon:e.jsx(J,{}),label:"Parts",value:t==null?void 0:t.totalParts,color:"#722ed1",loading:n,onClick:()=>o("/parts")}),e.jsx(u,{icon:e.jsx(L,{}),label:"Opportunities",value:(a==null?void 0:a.total)??"—",color:"#fa8c16",subtitle:a!=null&&a.highPriority?`${a.highPriority} high priority`:void 0,loading:!1,onClick:()=>o("/opportunities")})]})]}),e.jsx("div",{className:"space20"}),e.jsxs("div",{style:{marginBottom:6},children:[e.jsx(f,{level:5,style:{color:"#034D57",textTransform:"uppercase",fontSize:12,letterSpacing:1.5,marginBottom:12},children:"Financial Summary"}),e.jsxs(S,{gutter:[12,12],children:[e.jsx(w,{title:"Invoices This Month",value:d==null?void 0:d.total,loading:y,color:"#034D57",subtitle:"billed"}),e.jsx(w,{title:"Quotes This Month",value:x==null?void 0:x.total,loading:v,color:"#1890ff",subtitle:"proposed"}),e.jsx(w,{title:"Received Payments",value:l==null?void 0:l.total,loading:p,color:"#52c41a",subtitle:"this month"}),e.jsx(w,{title:"Unpaid Balance",value:d==null?void 0:d.total_undue,loading:y,color:"#ff4d4f",subtitle:"outstanding"})]})]}),e.jsx("div",{className:"space30"}),e.jsxs(S,{gutter:[16,16],children:[e.jsx(j,{xs:24,lg:12,children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{borderRadius:8},children:[e.jsx(f,{level:5,style:{color:"#034D57",marginBottom:12},children:"Recent Invoices"}),e.jsx(A,{entity:"invoice",dataTableColumns:D})]})}),e.jsx(j,{xs:24,lg:12,children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{borderRadius:8},children:[e.jsx(f,{level:5,style:{color:"#034D57",marginBottom:12},children:"Recent Quotes"}),e.jsx(A,{entity:"quote",dataTableColumns:D})]})})]})]}):null}function Re(){return e.jsx(pe,{})}export{Re as default};
