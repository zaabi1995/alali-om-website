import{r as l,m as Y,j as e}from"./index-P0d3qDOI.js";import{O as K,g as Z,aV as p,aM as w,aL as T,aB as u,b4 as ee,aN as te,ac as ne,aX as re,aY as oe}from"./IdurarOs-C9Hfvmhw.js";import{B as H,l as j,d as le,a3 as L,f as S,m as se,T as x,C as ie}from"./ErpApp-DhsEC5_U.js";import{C as E}from"./index-D7ycNofp.js";import{S as ae}from"./index-B9Siwb96.js";import{A as ce}from"./index-lSvV4oKT.js";import{P as de}from"./progress-DpCf3QQp.js";import{M as D}from"./index-CqP-1A0t.js";import{R as ue}from"./ReloadOutlined-DyzIo6dP.js";import{T as he}from"./TrophyOutlined-wchksPDH.js";import{S as ge}from"./StarOutlined-DocnkjtD.js";import{E as me}from"./ExportOutlined-IOyt3Jx7.js";import{W as ye}from"./WarningOutlined-BhgFwH10.js";import"./Skeleton-HlVWT2JN.js";import"./index-uRPskGn0.js";import"./PlusOutlined-7jHXhlhV.js";import"./ActionButton-I_KEJ-cH.js";import"./fade-BGkIwWik.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M834.1 469.2A347.49 347.49 0 00751.2 354l-29.1-26.7a8.09 8.09 0 00-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8-1.4 1.5-3 1.9-4.1 2-1.1.1-2.8-.1-4.3-1.5-1.4-1.2-2.1-3-2-4.8 3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 01-47.5 46.1 352.6 352.6 0 00-100.3 121.5A347.75 347.75 0 00160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0075.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 00760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0027.7-136c0-48.8-10-96.2-29.9-140.9zM713 808.5c-53.7 53.2-125 82.4-201 82.4s-147.3-29.2-201-82.4c-53.5-53.1-83-123.5-83-198.4 0-43.5 9.8-85.2 29.1-124 18.8-37.9 46.8-71.8 80.8-97.9a349.6 349.6 0 0058.6-56.8c25-30.5 44.6-64.5 58.2-101a240 240 0 0012.1-46.5c24.1 22.2 44.3 49 61.2 80.4 33.4 62.6 48.8 118.3 45.8 165.7a74.01 74.01 0 0024.4 59.8 73.36 73.36 0 0053.4 18.8c19.7-1 37.8-9.7 51-24.4 13.3-14.9 24.8-30.1 34.4-45.6 14 17.9 25.7 37.4 35 58.4 15.9 35.8 24 73.9 24 113.1 0 74.9-29.5 145.4-83 198.4z"}}]},name:"fire",theme:"outlined"},fe=function(c,d){return l.createElement(K,Z({},c,{ref:d,icon:xe}))};const J=l.forwardRef(fe),{Title:pe,Text:y,Paragraph:N}=oe,{Option:b}=S,h="#034D57",k="#4CB480";function v(){var r,c;try{const d=(c=(r=JSON.parse(localStorage.getItem("auth")||"{}"))==null?void 0:r.current)==null?void 0:c.token;return d?{Authorization:`Bearer ${d}`}:{}}catch{return{}}}const z={defense:{label:"Defense & Security",color:"red"},oil_gas:{label:"Oil & Gas",color:"orange"},aviation:{label:"Aviation",color:"blue"},marine:{label:"Marine",color:"cyan"},construction:{label:"Construction",color:"brown"},renewable:{label:"Renewable Energy",color:"green"},printing:{label:"Printing",color:"purple"},health_safety:{label:"Health & Safety",color:"geekblue"},logistics:{label:"Logistics",color:"magenta"},general:{label:"General Supply",color:"default"},unknown:{label:"Other",color:"default"}},R=[{value:"spotted",label:"Spotted",color:"blue"},{value:"evaluating",label:"Evaluating",color:"orange"},{value:"bidding",label:"Bidding",color:"purple"},{value:"won",label:"Won",color:"success"},{value:"lost",label:"Lost",color:"error"},{value:"ignored",label:"Ignored",color:"default"}];function G(r){return r>=70?"#f5222d":r>=50?"#fa8c16":r>=30?k:"#8c8c8c"}function je(r){return r==null?null:r<0?e.jsx(x,{color:"default",children:"Closed"}):r<=7?e.jsxs(x,{color:"red",icon:e.jsx(J,{}),children:[r,"d left"]}):r<=14?e.jsxs(x,{color:"orange",icon:e.jsx(ye,{}),children:[r,"d left"]}):e.jsxs(x,{color:"green",icon:e.jsx(ie,{}),children:[r,"d left"]})}function Me(){var M,$,W;const r=Y(),[c,d]=l.useState([]),[s,U]=l.useState(null),[_,P]=l.useState(!0),[O,F]=l.useState(!1),[i,q]=l.useState({page:1,pages:1,count:0}),[a,A]=l.useState({status:"",sector:"",sort:"relevance"}),[g,C]=l.useState({open:!1,id:null,notes:""}),B=l.useCallback(async()=>{try{const n=await(await fetch(p+"opportunity/stats",{headers:v()})).json();n.success&&U(n.result)}catch{}},[]),f=l.useCallback(async(t=1)=>{P(!0);try{const n=new URLSearchParams({page:t,items:12,sort:a.sort});a.status&&n.set("status",a.status),a.sector&&n.set("sector",a.sector);const o=await(await fetch(p+`opportunity/list?${n}`,{headers:v()})).json();o.success&&(d(o.result),q(o.pagination))}catch{}P(!1)},[a]);l.useEffect(()=>{B(),f(1)},[f]);const I=async()=>{F(!0);try{(await(await fetch(p+"opportunity/scan",{method:"POST",headers:{...v(),"Content-Type":"application/json"}})).json()).success&&D.info({title:"Scan Started",content:"Scanning eTendering portal... This takes ~2 minutes. Refresh the page shortly."})}catch{}setTimeout(()=>F(!1),5e3)},V=async(t,n)=>{try{await fetch(p+`opportunity/update/${t}`,{method:"PATCH",headers:{...v(),"Content-Type":"application/json"},body:JSON.stringify({status:n})}),d(m=>m.map(o=>o._id===t?{...o,status:n}:o)),B()}catch{}},Q=async()=>{try{await fetch(p+`opportunity/update/${g.id}`,{method:"PATCH",headers:{...v(),"Content-Type":"application/json"},body:JSON.stringify({notes:g.notes})}),d(t=>t.map(n=>n._id===g.id?{...n,notes:g.notes}:n)),C({open:!1,id:null,notes:""})}catch{}};return e.jsxs("div",{style:{padding:"24px",maxWidth:1400,margin:"0 auto"},children:[e.jsxs(w,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsxs(T,{children:[e.jsxs(pe,{level:2,style:{margin:0,color:h},children:[e.jsx(H,{style:{marginRight:8}}),"Opportunities"]}),e.jsx(y,{type:"secondary",children:"Live tenders from Oman eTendering portal â€” matched to Alali's capabilities"})]}),e.jsx(T,{children:e.jsxs(j,{children:[e.jsx(u,{icon:e.jsx(ue,{}),onClick:()=>{B(),f(1)},children:"Refresh"}),e.jsx(u,{type:"primary",icon:e.jsx(le,{spin:O}),onClick:I,loading:O,style:{backgroundColor:h,borderColor:h},children:"Scan eTendering Now"})]})})]}),s&&e.jsx(w,{gutter:16,style:{marginBottom:24},children:[{title:"Total Opportunities",value:s.total,icon:e.jsx(H,{}),color:h},{title:"High Priority",value:s.highPriority,icon:e.jsx(J,{}),color:"#f5222d"},{title:"Evaluating",value:((M=s.byStatus)==null?void 0:M.evaluating)||0,icon:e.jsx(ee,{}),color:"#fa8c16"},{title:"Bidding",value:(($=s.byStatus)==null?void 0:$.bidding)||0,icon:e.jsx(L,{}),color:"#722ed1"},{title:"Won",value:((W=s.byStatus)==null?void 0:W.won)||0,icon:e.jsx(he,{}),color:k},{title:"New Today",value:s.recentlyAdded||0,icon:e.jsx(ge,{}),color:"#1890ff"}].map(t=>e.jsx(T,{xs:12,sm:8,md:4,children:e.jsx(E,{size:"small",style:{textAlign:"center"},children:e.jsx(ae,{title:t.title,value:t.value,valueStyle:{color:t.color,fontSize:22},prefix:t.icon})})},t.title))}),!_&&c.length===0&&(s==null?void 0:s.total)===0&&e.jsx(ce,{type:"info",showIcon:!0,message:"No opportunities loaded yet",description:'Click "Scan eTendering Now" to fetch live tenders from the Oman Tender Board portal. The scan takes ~2 minutes.',style:{marginBottom:24},action:e.jsx(u,{size:"small",type:"primary",onClick:I,loading:O,style:{backgroundColor:h,borderColor:h},children:"Scan Now"})}),e.jsx(E,{size:"small",style:{marginBottom:16},children:e.jsxs(j,{wrap:!0,children:[e.jsx(S,{placeholder:"Filter by sector",allowClear:!0,style:{width:200},value:a.sector||void 0,onChange:t=>A(n=>({...n,sector:t||""})),children:Object.entries(z).filter(([t])=>t!=="unknown").map(([t,n])=>e.jsx(b,{value:t,children:n.label},t))}),e.jsx(S,{placeholder:"Filter by status",allowClear:!0,style:{width:160},value:a.status||void 0,onChange:t=>A(n=>({...n,status:t||""})),children:R.map(t=>e.jsx(b,{value:t.value,children:t.label},t.value))}),e.jsxs(S,{value:a.sort,style:{width:160},onChange:t=>A(n=>({...n,sort:t})),children:[e.jsx(b,{value:"relevance",children:"Sort: Relevance"}),e.jsx(b,{value:"deadline",children:"Sort: Deadline"}),e.jsx(b,{value:"newest",children:"Sort: Newest"})]}),e.jsxs(y,{type:"secondary",children:[i.count," opportunities found"]})]})}),_?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(te,{size:"large"})}):c.length===0?e.jsx(se,{description:"No opportunities match your filters"}):e.jsxs(e.Fragment,{children:[e.jsx(w,{gutter:[16,16],children:c.map(t=>{var m;const n=z[t.sector]||z.unknown;return R.find(o=>o.value===t.status),e.jsx(T,{xs:24,sm:24,md:12,lg:8,children:e.jsxs(E,{size:"small",style:{height:"100%",borderLeft:`4px solid ${G(t.relevanceScore)}`,borderRadius:8},title:e.jsxs(j,{children:[e.jsx(ne,{title:`Relevance: ${t.relevanceScore}/100`,children:e.jsx(de,{type:"circle",percent:t.relevanceScore,width:32,strokeColor:G(t.relevanceScore),format:o=>e.jsx("span",{style:{fontSize:9},children:o})})}),e.jsx(x,{color:n.color,children:n.label}),je(t.daysLeft)]}),extra:e.jsx(S,{size:"small",value:t.status,style:{width:110},onChange:o=>V(t._id,o),options:R.map(o=>({value:o.value,label:o.label}))}),children:[t.titleEn&&e.jsx(N,{ellipsis:{rows:2},style:{fontWeight:600,marginBottom:2,fontSize:13},children:t.titleEn}),e.jsx(N,{ellipsis:{rows:t.titleEn?1:2},style:{fontWeight:t.titleEn?400:600,fontSize:t.titleEn?11:13,marginBottom:4,direction:"rtl",textAlign:"right",color:t.titleEn?"#888":"inherit"},children:t.titleAr||t.title}),e.jsxs(y,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:2},children:["ðŸ“ ",t.ministryEn||t.ministry]}),t.ministryAr&&t.ministryEn&&e.jsx(y,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:6,direction:"rtl",textAlign:"right",color:"#aaa"},children:t.ministryAr}),t.tenderNo&&e.jsxs(y,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:8},children:["TND: ",t.tenderNo]}),((m=t.matchReasons)==null?void 0:m.length)>0&&e.jsx("div",{style:{marginBottom:8},children:t.matchReasons.slice(0,2).map((o,X)=>e.jsxs(x,{color:"geekblue",style:{marginBottom:4,fontSize:11},children:["âœ“ ",o]},X))}),t.notes&&e.jsxs(N,{ellipsis:{rows:1},style:{fontSize:12,color:"#666",marginBottom:8},children:["ðŸ“ ",t.notes]}),e.jsxs(j,{style:{marginTop:8},wrap:!0,children:[t.link&&e.jsx(u,{size:"small",icon:e.jsx(me,{}),href:t.link,target:"_blank",rel:"noopener noreferrer",children:"View Tender"}),e.jsx(u,{size:"small",onClick:()=>C({open:!0,id:t._id,notes:t.notes||""}),children:"Notes"}),e.jsx(u,{size:"small",type:"primary",icon:e.jsx(L,{}),onClick:()=>r("/quote/create"),style:{backgroundColor:k,borderColor:k},children:"Create Quote"})]})]})},t._id)})}),i.pages>1&&e.jsx(w,{justify:"center",style:{marginTop:24},children:e.jsxs(j,{children:[e.jsx(u,{disabled:i.page<=1,onClick:()=>f(i.page-1),children:"Previous"}),e.jsxs(y,{children:["Page ",i.page," of ",i.pages]}),e.jsx(u,{disabled:i.page>=i.pages,onClick:()=>f(i.page+1),children:"Next"})]})})]}),e.jsx(D,{title:"Add Notes",open:g.open,onOk:Q,onCancel:()=>C({open:!1,id:null,notes:""}),okText:"Save",okButtonProps:{style:{backgroundColor:h,borderColor:h}},children:e.jsx(re.TextArea,{rows:4,value:g.notes,onChange:t=>C(n=>({...n,notes:t.target.value})),placeholder:"Add notes about this opportunity â€” contacts, strategy, requirements..."})})]})}export{Me as default};
